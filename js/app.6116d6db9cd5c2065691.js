webpackJsonp([1],{1070:function(t,e,n){t.exports=n(1071)},1071:function(t,e,n){"use strict";(function(t,r){function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i,o=n(1072),a=_interopRequireDefault(o);i="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:r;var s=(0,a.default)(i);e.default=s}).call(e,n(13),n(1110)(t))},1072:function(t,e,n){"use strict";function symbolObservablePonyfill(t){var e,n=t.Symbol;return"function"==typeof n?n.observable?e=n.observable:(e=n("observable"),n.observable=e):e="@@observable",e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=symbolObservablePonyfill},1110:function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},1112:function(t,e,n){"use strict";function startBootstrap(){i.platformBrowserDynamic().bootstrapModule(o.AppModule).then(function(t){return t})}function main(){if(!window.cordova)return startBootstrap();document.addEventListener("deviceready",startBootstrap,!1)}var r=n(0),i=n(187),o=n(491);r.enableProdMode(),e.main=main,"complete"===document.readyState?main():document.addEventListener("DOMContentLoaded",main)},170:function(t,e,n){"use strict";var r=n(443),i=n(1),o=n(81);n(82),n(268),n(448),n(453),n(270);var a=n(769),s=n(768),u=n(767),l=n(766),c=["string","string[]","number","symbol","function"],p="Expected selector to be one of:\n    "+c.join(",")+". Instead recieved %s",h=function(t){return c.indexOf(typeof t,0)>=0||Array.isArray(t)},f=function(){function NgRedux(t){var e=this;this.ngZone=t,this._store=null,this._store$=null,this.getState=function(){return e._store.getState()},this.subscribe=function(t){return e._store.subscribe(t)},this.replaceReducer=function(t){return e._store.replaceReducer(t)},this.dispatch=function(t){return u.invariant(!!e._store,"Dispatch failed: did you forget to configure your store? https://github.com/angular-redux/ng2-redux/blob/master/README.md#quick-start"),e.ngZone.run(function(){return e._store.dispatch(t)})},NgRedux.instance=this,this._store$=new o.BehaviorSubject(null).filter(function(t){return null!==t}).switchMap(function(t){return i.Observable.from(t)})}return NgRedux.prototype.configureStore=function(t,e,n,i){void 0===n&&(n=[]),void 0===i&&(i=[]),u.invariant(!this._store,"Store already configured!");var o=r.compose,a=o.apply(void 0,[r.applyMiddleware.apply(void 0,n)].concat(i))(r.createStore),s=a(t,e);this.setStore(s)},NgRedux.prototype.provideStore=function(t){u.invariant(!this._store,"Store already configured!"),this.setStore(t)},NgRedux.prototype.select=function(t,e){if(!t)return this._store$.distinctUntilChanged(e);u.invariant(h(t),p,t);var n,r=this._store$.distinctUntilChanged();return n="string"==typeof t||"number"==typeof t||"symbol"==typeof t?r.map(function(e){return e[t]}):Array.isArray(t)?r.map(function(e){return l.getIn(e,t)}):r.map(t),n.distinctUntilChanged(e)},NgRedux.prototype.getStateSlice=function(t,e){var n=e(t);return u.invariant(a.isPlainObject(n),"`mapStateToScope` must return an object. Instead received %s.",n),n},NgRedux.prototype.setStore=function(t){this._store=t,this._store$.next(t),this._defaultMapStateToTarget=function(){return{}},this._defaultMapDispatchToTarget=function(t){return{dispatch:t}};var e=s.omit(t,["dispatch","getState","subscribe","replaceReducer"]);Object.assign(this,e)},NgRedux}();e.NgRedux=f},20:function(t,e,n){"use strict";var r=n(664);e.DestinationActions=r.DestinationActions;var i=n(668);e.SpotsActions=i.SpotsActions;var o=n(665);e.NearbySpotsActions=o.NearbySpotsActions;var a=n(670);e.TutorialActions=a.TutorialActions;var s=n(666);e.PlacesActions=s.PlacesActions;var u=n(663);e.AppModeActions=u.AppModeActions;var l=n(662);e.AddSpotStepActions=l.AddSpotStepActions;var c=n(667);e.ReportSpotStepActions=c.ReportSpotStepActions;var p=n(669);e.SpotsListModeActions=p.SpotsListModeActions,e.ACTION_PROVIDERS=[r.DestinationActions,i.SpotsActions,o.NearbySpotsActions,s.PlacesActions,a.TutorialActions,u.AppModeActions,l.AddSpotStepActions,c.ReportSpotStepActions,p.SpotsListModeActions]},21:function(t,e,n){"use strict";var r=n(170);e.NgRedux=r.NgRedux;var i=n(439);e.DevToolsExtension=i.DevToolsExtension;var o=n(764);e.select=o.select;var a=n(765);e.NgReduxModule=a.NgReduxModule},264:function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}__export(n(687)),__export(n(686)),__export(n(684)),__export(n(688)),__export(n(690)),__export(n(692))},33:function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}__export(n(731)),__export(n(732)),__export(n(730))},432:function(t,e,n){"use strict";var r=n(0);Object.defineProperty(e,"__esModule",{value:!0}),e.default=[r.trigger("slideLeft",[r.state("in",r.style({transform:"translate3d(0, 0, 0)",position:"absolute",top:0,left:0})),r.transition("void => *",[r.style({transform:"translate3d(100%, 0, 0)",position:"absolute",top:0,left:0}),r.animate("600ms cubic-bezier(0.77, 0, 0.175, 1)")]),r.transition("* => void",[r.animate("600ms cubic-bezier(0.77, 0, 0.175, 1)",r.style({transform:"translate3d(100%, 0, 0)",position:"absolute",top:0,left:0}))])]),r.trigger("slideRight",[r.state("in",r.style({transform:"translate3d(0, 0, 0)",position:"absolute",top:0,left:0})),r.transition("void => *",[r.style({transform:"translate3d(-100%, 0, 0)",position:"absolute",top:0,left:0}),r.animate("600ms cubic-bezier(0.77, 0, 0.175, 1)")]),r.transition("* => void",[r.animate("600ms cubic-bezier(0.77, 0, 0.175, 1)",r.style({transform:"translate3d(-100%, 0, 0)",position:"absolute",top:0,left:0}))])]),r.trigger("slideUp",[r.state("open",r.style({overflowY:"hidden",maxHeight:"300px"})),r.state("closed",r.style({maxHeight:0,overflowY:"hidden"})),r.transition("open => closed",r.animate("600ms ease-out")),r.transition("closed => open",r.animate("600ms ease-in"))])]},433:function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}__export(n(702))},434:function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}__export(n(705))},435:function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}__export(n(708)),__export(n(709)),__export(n(711))},436:function(t,e,n){"use strict";var r=n(761),i=r.a.Symbol;e.a=i},437:function(t,e,n){"use strict";function isPlainObject(t){if(!n.i(o.a)(t)||n.i(r.a)(t)!=a)return!1;var e=n.i(i.a)(t);if(null===e)return!0;var s=c.call(e,"constructor")&&e.constructor;return"function"==typeof s&&s instanceof s&&l.call(s)==p}var r=n(755),i=n(757),o=n(762),a="[object Object]",s=Function.prototype,u=Object.prototype,l=s.toString,c=u.hasOwnProperty,p=l.call(Object);e.a=isPlainObject},438:function(t,e,n){(function(n,r){var i,i;!function(e){t.exports=e()}(function(){var t;return function e(t,n,r){function s(a,u){if(!n[a]){if(!t[a]){var l="function"==typeof i&&i;if(!u&&l)return i(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var p=n[a]={exports:{}};t[a][0].call(p.exports,function(e){var n=t[a][1][e];return s(n?n:e)},p,p.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof i&&i,a=0;a<r.length;a++)s(r[a]);return s}({1:[function(t,e,n){"use strict";function serializePaintVertexArrays(t,e){var n={};for(var r in t){var i=t[r].paintVertexArray;if(0!==i.length){var o=i.serialize(e),a=i.constructor.serialize();n[r]={array:o,type:a}}}return n}var r=t("./program_configuration"),i=function(t,e){this.vertexOffset=t,this.primitiveOffset=e,this.vertexLength=0,this.primitiveLength=0},o=function(t,e,n){var i=this;this.globalProperties={zoom:n};var o=t.layoutVertexArrayType;this.layoutVertexArray=new o;var a=t.elementArrayType;a&&(this.elementArray=new a);var s=t.elementArrayType2;s&&(this.elementArray2=new s),this.layerData={};for(var u=0,l=e;u<l.length;u+=1){var c=l[u],p=r.createDynamic(t.paintAttributes||[],c,n);i.layerData[c.id]={layer:c,programConfiguration:p,paintVertexArray:new p.PaintVertexArray}}this.segments=[],this.segments2=[]};o.prototype.prepareSegment=function(t){var e=this.segments[this.segments.length-1];return(!e||e.vertexLength+t>o.MAX_VERTEX_ARRAY_LENGTH)&&(e=new i(this.layoutVertexArray.length,this.elementArray.length),this.segments.push(e)),e},o.prototype.prepareSegment2=function(t){var e=this.segments2[this.segments2.length-1];return(!e||e.vertexLength+t>o.MAX_VERTEX_ARRAY_LENGTH)&&(e=new i(this.layoutVertexArray.length,this.elementArray2.length),this.segments2.push(e)),e},o.prototype.populatePaintArrays=function(t){var e=this;for(var n in this.layerData){var r=e.layerData[n];0!==r.paintVertexArray.bytesPerElement&&r.programConfiguration.populatePaintArray(r.layer,r.paintVertexArray,e.layoutVertexArray.length,e.globalProperties,t)}},o.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},o.prototype.serialize=function(t){return{layoutVertexArray:this.layoutVertexArray.serialize(t),elementArray:this.elementArray&&this.elementArray.serialize(t),elementArray2:this.elementArray2&&this.elementArray2.serialize(t),paintVertexArrays:serializePaintVertexArrays(this.layerData,t),segments:this.segments,segments2:this.segments2}},o.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,e.exports=o},{"./program_configuration":15}],2:[function(t,e,n){"use strict";var r=t("./array_group"),i=t("./buffer_group"),o=t("../util/util"),a=function(t,e){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.index=t.index,t.arrays?this.buffers=new i(e,t.layers,t.zoom,t.arrays):this.arrays=new r(e,t.layers,t.zoom)};a.prototype.populate=function(t,e){for(var n=this,r=0,i=t;r<i.length;r+=1){var o=i[r];n.layers[0].filter(o)&&(n.addFeature(o),e.featureIndex.insert(o,n.index))}},a.prototype.isEmpty=function(){return this.arrays.isEmpty()},a.prototype.serialize=function(t){return{zoom:this.zoom,layerIds:this.layers.map(function(t){return t.id}),arrays:this.arrays.serialize(t)}},a.prototype.destroy=function(){this.buffers&&(this.buffers.destroy(),this.buffers=null)},e.exports=a,a.deserialize=function(t,e){if(e){for(var n={},r=0,i=t;r<i.length;r+=1){var a=i[r],s=a.layerIds.map(function(t){return e.getLayer(t)}).filter(Boolean);if(0!==s.length)for(var u=s[0].createBucket(o.extend({layers:s},a)),l=0,c=s;l<c.length;l+=1){var p=c[l];n[p.id]=u}}return n}}},{"../util/util":129,"./array_group":1,"./buffer_group":9}],3:[function(t,e,n){"use strict";function addCircleVertex(t,e,n,r,i){t.emplaceBack(2*e+(r+1)/2,2*n+(i+1)/2)}var i=t("../bucket"),o=t("../vertex_array_type"),a=t("../element_array_type"),s=t("../load_geometry"),u=t("../extent"),l={layoutVertexArrayType:o([{name:"a_pos",components:2,type:"Int16"}]),elementArrayType:a(),paintAttributes:[{property:"circle-color",type:"Uint8"},{property:"circle-radius",type:"Uint16",multiplier:10},{property:"circle-blur",type:"Uint16",multiplier:10},{property:"circle-opacity",type:"Uint8",multiplier:255},{property:"circle-stroke-color",type:"Uint8"},{property:"circle-stroke-width",type:"Uint16",multiplier:10},{property:"circle-stroke-opacity",type:"Uint8",multiplier:255}]},c=function(t){function r(e){t.call(this,e,l)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype.addFeature=function(t){for(var e=this.arrays,n=0,r=s(t);n<r.length;n+=1)for(var i=r[n],o=0,a=i;o<a.length;o+=1){var l=a[o],c=l.x,p=l.y;if(!(c<0||c>=u||p<0||p>=u)){var h=e.prepareSegment(4),f=h.vertexLength;addCircleVertex(e.layoutVertexArray,c,p,-1,-1),addCircleVertex(e.layoutVertexArray,c,p,1,-1),addCircleVertex(e.layoutVertexArray,c,p,1,1),addCircleVertex(e.layoutVertexArray,c,p,-1,1),e.elementArray.emplaceBack(f,f+1,f+2),e.elementArray.emplaceBack(f,f+3,f+2),h.vertexLength+=4,h.primitiveLength+=2}}e.populatePaintArrays(t.properties)},r}(i);e.exports=c},{"../bucket":2,"../element_array_type":10,"../extent":11,"../load_geometry":13,"../vertex_array_type":17}],4:[function(t,e,n){"use strict";var i=t("../bucket"),o=t("../vertex_array_type"),a=t("../element_array_type"),s=t("../load_geometry"),u=t("earcut"),l=t("../../util/classify_rings"),c=500,p={layoutVertexArrayType:o([{name:"a_pos",components:2,type:"Int16"}]),elementArrayType:a(3),elementArrayType2:a(2),paintAttributes:[{property:"fill-color",type:"Uint8"},{property:"fill-outline-color",type:"Uint8"},{property:"fill-opacity",type:"Uint8",multiplier:255}]},h=function(t){function r(e){t.call(this,e,p)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype.addFeature=function(t){for(var e=this.arrays,n=0,r=l(s(t),c);n<r.length;n+=1){for(var i=r[n],o=0,a=0,p=i;a<p.length;a+=1){o+=p[a].length}for(var h=e.prepareSegment(o),f=h.vertexLength,d=[],m=[],y=0,g=i;y<g.length;y+=1){var v=g[y];if(0!==v.length){v!==i[0]&&m.push(d.length/2);var _=e.prepareSegment2(v.length),x=_.vertexLength;e.layoutVertexArray.emplaceBack(v[0].x,v[0].y),e.elementArray2.emplaceBack(x+v.length-1,x),d.push(v[0].x),d.push(v[0].y);for(var b=1;b<v.length;b++)e.layoutVertexArray.emplaceBack(v[b].x,v[b].y),e.elementArray2.emplaceBack(x+b-1,x+b),d.push(v[b].x),d.push(v[b].y);_.vertexLength+=v.length,_.primitiveLength+=v.length}}for(var w=u(d,m),S=0;S<w.length;S+=3)e.elementArray.emplaceBack(f+w[S],f+w[S+1],f+w[S+2]);h.vertexLength+=o,h.primitiveLength+=w.length/3}e.populatePaintArrays(t.properties)},r}(i);e.exports=h},{"../../util/classify_rings":113,"../bucket":2,"../element_array_type":10,"../load_geometry":13,"../vertex_array_type":17,earcut:136}],5:[function(t,e,n){"use strict";function addVertex(t,e,n,r,i,o,a,s){t.emplaceBack(e,n,2*Math.floor(r*f)+a,i*f*2,o*f*2,Math.round(s))}function isBoundaryEdge(t,e){return t.x===e.x&&(t.x<0||t.x>u)||t.y===e.y&&(t.y<0||t.y>u)}var i=t("../bucket"),o=t("../vertex_array_type"),a=t("../element_array_type"),s=t("../load_geometry"),u=t("../extent"),l=t("earcut"),c=t("../../util/classify_rings"),p=500,h={layoutVertexArrayType:o([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal",components:3,type:"Int16"},{name:"a_edgedistance",components:1,type:"Int16"}]),elementArrayType:a(3),paintAttributes:[{property:"fill-extrusion-base",type:"Uint16"},{property:"fill-extrusion-height",type:"Uint16"},{property:"fill-extrusion-color",type:"Uint8"}]},f=Math.pow(2,13),d=function(t){function r(e){t.call(this,e,h)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype.addFeature=function(t){for(var e=this.arrays,n=0,r=c(s(t),p);n<r.length;n+=1){for(var i=r[n],o=0,a=0,u=i;a<u.length;a+=1){o+=u[a].length}for(var h=e.prepareSegment(5*o),f=[],d=[],m=[],y=0,g=i;y<g.length;y+=1){var v=g[y];if(0!==v.length){v!==i[0]&&d.push(f.length/2);for(var _=0,x=0;x<v.length;x++){var b=v[x];if(addVertex(e.layoutVertexArray,b.x,b.y,0,0,1,1,0),m.push(h.vertexLength++),x>=1){var w=v[x-1];if(!isBoundaryEdge(b,w)){var S=b.sub(w)._perp()._unit();addVertex(e.layoutVertexArray,b.x,b.y,S.x,S.y,0,0,_),addVertex(e.layoutVertexArray,b.x,b.y,S.x,S.y,0,1,_),_+=w.dist(b),addVertex(e.layoutVertexArray,w.x,w.y,S.x,S.y,0,0,_),addVertex(e.layoutVertexArray,w.x,w.y,S.x,S.y,0,1,_);var T=h.vertexLength;e.elementArray.emplaceBack(T,T+1,T+2),e.elementArray.emplaceBack(T+1,T+2,T+3),h.vertexLength+=4,h.primitiveLength+=2}}f.push(b.x),f.push(b.y)}}}for(var E=l(f,d),A=0;A<E.length;A+=3)e.elementArray.emplaceBack(m[E[A]],m[E[A+1]],m[E[A+2]]);h.primitiveLength+=E.length/3}e.populatePaintArrays(t.properties)},r}(i);e.exports=d},{"../../util/classify_rings":113,"../bucket":2,"../element_array_type":10,"../extent":11,"../load_geometry":13,"../vertex_array_type":17,earcut:136}],6:[function(e,n,r){"use strict";function addLineVertex(t,e,n,r,i,o,a){t.emplaceBack(e.x<<1|r,e.y<<1|i,Math.round(l*n.x)+128,Math.round(l*n.y)+128,1+(0===o?0:o<0?-1:1)|(a*f&63)<<2,a*f>>6)}var i=e("../bucket"),o=e("../vertex_array_type"),a=e("../element_array_type"),s=e("../load_geometry"),u=e("../extent"),l=63,c=Math.cos(Math.PI/180*37.5),p=15,h=15,f=.5,d=Math.pow(2,h-1)/f,m={layoutVertexArrayType:o([{name:"a_pos",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}]),paintAttributes:[{property:"line-color",type:"Uint8"},{property:"line-blur",multiplier:10,type:"Uint8"},{property:"line-opacity",multiplier:10,type:"Uint8"},{property:"line-gap-width",multiplier:10,type:"Uint8",name:"a_gapwidth"},{property:"line-offset",multiplier:1,type:"Int8"}],elementArrayType:a()},y=function(e){function t(t){e.call(this,t,m)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.addFeature=function(t){for(var e=this,n=this.layers[0].layout,r=n["line-join"],i=n["line-cap"],o=n["line-miter-limit"],a=n["line-round-limit"],u=0,l=s(t,h);u<l.length;u+=1){var c=l[u];e.addLine(c,t.properties,r,i,o,a)}},t.prototype.addLine=function(t,e,n,r,i,o){for(var a=this,s=t.length;s>2&&t[s-1].equals(t[s-2]);)s--;if(!(t.length<2)){"bevel"===n&&(i=1.05);var l=p*(u/(512*this.overscaling)),h=t[0],f=t[s-1],d=h.equals(f),m=this.arrays,y=m.prepareSegment(10*s);if(2!==s||!d){this.distance=0;var g,v,_,x,b,w,S,T=r,E=d?"butt":r,A=!0;this.e1=this.e2=this.e3=-1,d&&(g=t[s-2],b=h.sub(g)._unit()._perp());for(var P=0;P<s;P++)if(!(_=d&&P===s-1?t[1]:t[P+1])||!t[P].equals(_)){b&&(x=b),g&&(v=g),g=t[P],b=_?_.sub(g)._unit()._perp():x,x=x||b;var C=x.add(b);0===C.x&&0===C.y||C._unit();var M=C.x*b.x+C.y*b.y,k=0!==M?1/M:1/0,z=M<c&&v&&_;if(z&&P>0){var I=g.dist(v);if(I>2*l){var L=g.sub(g.sub(v)._mult(l/I)._round());a.distance+=L.dist(v),a.addCurrentVertex(L,a.distance,x.mult(1),0,0,!1,y),v=L}}var O=v&&_,D=O?n:_?T:E;if(O&&"round"===D&&(k<o?D="miter":k<=2&&(D="fakeround")),"miter"===D&&k>i&&(D="bevel"),"bevel"===D&&(k>2&&(D="flipbevel"),k<i&&(D="miter")),v&&(a.distance+=g.dist(v)),"miter"===D)C._mult(k),a.addCurrentVertex(g,a.distance,C,0,0,!1,y);else if("flipbevel"===D){if(k>100)C=b.clone().mult(-1);else{var R=x.x*b.y-x.y*b.x>0?-1:1,B=k*x.add(b).mag()/x.sub(b).mag();C._perp()._mult(B*R)}a.addCurrentVertex(g,a.distance,C,0,0,!1,y),a.addCurrentVertex(g,a.distance,C.mult(-1),0,0,!1,y)}else if("bevel"===D||"fakeround"===D){var j=x.x*b.y-x.y*b.x>0,F=-Math.sqrt(k*k-1);if(j?(S=0,w=F):(w=0,S=F),A||a.addCurrentVertex(g,a.distance,x,w,S,!1,y),"fakeround"===D){for(var N,U=Math.floor(8*(.5-(M-.5))),V=0;V<U;V++)N=b.mult((V+1)/(U+1))._add(x)._unit(),a.addPieSliceVertex(g,a.distance,N,j,y);a.addPieSliceVertex(g,a.distance,C,j,y);for(var q=U-1;q>=0;q--)N=x.mult((q+1)/(U+1))._add(b)._unit(),a.addPieSliceVertex(g,a.distance,N,j,y)}_&&a.addCurrentVertex(g,a.distance,b,-w,-S,!1,y)}else"butt"===D?(A||a.addCurrentVertex(g,a.distance,x,0,0,!1,y),_&&a.addCurrentVertex(g,a.distance,b,0,0,!1,y)):"square"===D?(A||(a.addCurrentVertex(g,a.distance,x,1,1,!1,y),a.e1=a.e2=-1),_&&a.addCurrentVertex(g,a.distance,b,-1,-1,!1,y)):"round"===D&&(A||(a.addCurrentVertex(g,a.distance,x,0,0,!1,y),a.addCurrentVertex(g,a.distance,x,1,1,!0,y),a.e1=a.e2=-1),_&&(a.addCurrentVertex(g,a.distance,b,-1,-1,!0,y),a.addCurrentVertex(g,a.distance,b,0,0,!1,y)));if(z&&P<s-1){var G=g.dist(_);if(G>2*l){var Z=g.add(_.sub(g)._mult(l/G)._round());a.distance+=Z.dist(g),a.addCurrentVertex(Z,a.distance,b.mult(1),0,0,!1,y),g=Z}}A=!1}m.populatePaintArrays(e)}}},t.prototype.addCurrentVertex=function(t,e,n,r,i,o,a){var s,u=o?1:0,l=this.arrays,c=l.layoutVertexArray,p=l.elementArray;s=n.clone(),r&&s._sub(n.perp()._mult(r)),addLineVertex(c,t,s,u,0,r,e),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),this.e1=this.e2,this.e2=this.e3,s=n.mult(-1),i&&s._sub(n.perp()._mult(i)),addLineVertex(c,t,s,u,1,-i,e),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),this.e1=this.e2,this.e2=this.e3,e>d/2&&(this.distance=0,this.addCurrentVertex(t,this.distance,n,r,i,o,a))},t.prototype.addPieSliceVertex=function(t,e,n,r,i){var o=r?1:0;n=n.mult(r?-1:1);var a=this.arrays,s=a.layoutVertexArray,u=a.elementArray;addLineVertex(s,t,n,0,o,0,e),this.e3=i.vertexLength++,this.e1>=0&&this.e2>=0&&(u.emplaceBack(this.e1,this.e2,this.e3),i.primitiveLength++),r?this.e2=this.e3:this.e1=this.e3},t}(i);n.exports=y},{"../bucket":2,"../element_array_type":10,"../extent":11,"../load_geometry":13,"../vertex_array_type":17}],7:[function(t,e,n){"use strict";function addVertex(t,e,n,r,i,o,a,s,u,l,c){t.emplaceBack(e,n,Math.round(64*r),Math.round(64*i),o/4,a/4,10*(l||0),c,10*(s||0),10*Math.min(u||25,25))}function addCollisionBoxVertex(t,e,n,r,i){return t.emplaceBack(e.x,e.y,Math.round(n.x),Math.round(n.y),10*r,10*i)}var r=t("point-geometry"),i=t("../array_group"),o=t("../buffer_group"),a=t("../vertex_array_type"),s=t("../element_array_type"),u=t("../extent"),l=t("../../symbol/anchor"),c=t("../../symbol/get_anchors"),p=t("../../util/token"),h=t("../../symbol/quads"),f=t("../../symbol/shaping"),d=t("../../symbol/resolve_text"),m=t("../../symbol/mergelines"),y=t("../../symbol/clip_line"),g=t("../../util/util"),v=t("../../util/script_detection"),_=t("../load_geometry"),x=t("../../symbol/collision_feature"),b=t("../../util/find_pole_of_inaccessibility"),w=t("../../util/classify_rings"),S=t("vector-tile").VectorTileFeature,T=t("../../source/rtl_text_plugin"),E=f.shapeText,A=f.shapeIcon,P=f.WritingMode,C=h.getGlyphQuads,M=h.getIconQuads,k=s(),z=a([{name:"a_pos",components:2,type:"Int16"},{name:"a_offset",components:2,type:"Int16"},{name:"a_texture_pos",components:2,type:"Uint16"},{name:"a_data",components:4,type:"Uint8"}]),I={glyph:{layoutVertexArrayType:z,elementArrayType:k},icon:{layoutVertexArrayType:z,elementArrayType:k},collisionBox:{layoutVertexArrayType:a([{name:"a_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"},{name:"a_data",components:2,type:"Uint8"}]),elementArrayType:s(2)}},L=function(t){var e=this;if(this.collisionBoxArray=t.collisionBoxArray,this.symbolQuadsArray=t.symbolQuadsArray,this.symbolInstancesArray=t.symbolInstancesArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.index=t.index,this.sdfIcons=t.sdfIcons,this.iconsNeedLinear=t.iconsNeedLinear,this.adjustedTextSize=t.adjustedTextSize,this.adjustedIconSize=t.adjustedIconSize,this.fontstack=t.fontstack,t.arrays){this.buffers={};for(var n in t.arrays)t.arrays[n]&&(e.buffers[n]=new o(I[n],t.layers,t.zoom,t.arrays[n]))}};L.prototype.populate=function(t,e){var n=this,r=this.layers[0].layout,i=r["text-field"],o=r["text-font"],a=r["icon-image"],s=i&&o,u=a;if(this.features=[],s||u){for(var l=e.iconDependencies,c=e.glyphDependencies,h=c[o]=c[o]||{},f=0;f<t.length;f++){var y=t[f];if(n.layers[0].filter(y)){var g;s&&(g=T.applyArabicShaping?T.applyArabicShaping(d(y,r)):d(y,r));var v;if(u&&(v=p(y.properties,a)),(g||v)&&(n.features.push({text:g,icon:v,index:f,sourceLayerIndex:y.sourceLayerIndex,geometry:_(y),properties:y.properties,type:S.types[y.type]}),v&&(l[v]=!0),g))for(var x=0;x<g.length;x++)h[g.charCodeAt(x)]=!0}}"line"===r["symbol-placement"]&&(this.features=m(this.features))}},L.prototype.isEmpty=function(){return this.arrays.icon.isEmpty()&&this.arrays.glyph.isEmpty()&&this.arrays.collisionBox.isEmpty()},L.prototype.serialize=function(t){return{zoom:this.zoom,layerIds:this.layers.map(function(t){return t.id}),sdfIcons:this.sdfIcons,iconsNeedLinear:this.iconsNeedLinear,adjustedTextSize:this.adjustedTextSize,adjustedIconSize:this.adjustedIconSize,fontstack:this.fontstack,arrays:g.mapObject(this.arrays,function(e){return e.isEmpty()?null:e.serialize(t)})}},L.prototype.destroy=function(){this.buffers&&(this.buffers.icon&&this.buffers.icon.destroy(),this.buffers.glyph&&this.buffers.glyph.destroy(),this.buffers.collisionBox&&this.buffers.collisionBox.destroy(),this.buffers=null)},L.prototype.createArrays=function(){var t=this;this.arrays=g.mapObject(I,function(e){return new i(e,t.layers,t.zoom)})},L.prototype.prepare=function(t,e){var n=this;this.createArrays(),this.adjustedTextMaxSize=this.layers[0].getLayoutValue("text-size",{zoom:18}),this.adjustedTextSize=this.layers[0].getLayoutValue("text-size",{zoom:this.zoom+1}),this.adjustedIconMaxSize=this.layers[0].getLayoutValue("icon-size",{zoom:18}),this.adjustedIconSize=this.layers[0].getLayoutValue("icon-size",{zoom:this.zoom+1});var r=512*this.overscaling;this.tilePixelRatio=u/r,this.compareText={},this.iconsNeedLinear=!1,this.symbolInstancesStartIndex=this.symbolInstancesArray.length;var i=this.layers[0].layout,o=.5,a=.5;switch(i["text-anchor"]){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(i["text-anchor"]){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}for(var s="right"===i["text-justify"]?1:"left"===i["text-justify"]?0:.5,l=24,c=i["text-line-height"]*l,p="line"!==i["symbol-placement"]?i["text-max-width"]*l:0,h=i["text-letter-spacing"]*l,f=[i["text-offset"][0]*l,i["text-offset"][1]*l],d=this.fontstack=i["text-font"].join(","),m="map"===i["text-rotation-alignment"]&&"line"===i["symbol-placement"],y=0,_=this.features;y<_.length;y+=1){var x,b=_[y];if(b.text){var w=v.allowsVerticalWritingMode(b.text);x={},x[P.horizontal]=E(b.text,t[d],p,c,o,a,s,h,f,l,P.horizontal),x[P.vertical]=w&&m&&E(b.text,t[d],p,c,o,a,s,h,f,l,P.vertical)}else x={};var S;if(b.icon){var T=e[b.icon];S=A(T,n.layers[0].getLayoutValue("icon-offset",{zoom:n.zoom},b.properties)),T&&(void 0===n.sdfIcons?n.sdfIcons=T.sdf:n.sdfIcons!==T.sdf&&g.warnOnce("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),1!==T.pixelRatio?n.iconsNeedLinear=!0:0===i["icon-rotate"]&&n.layers[0].isLayoutValueFeatureConstant("icon-rotate")||(n.iconsNeedLinear=!0))}(x[P.horizontal]||S)&&n.addFeature(b,x,S)}this.symbolInstancesEndIndex=this.symbolInstancesArray.length},L.prototype.addFeature=function(t,e,n){var r=this,i=this.layers[0].layout,o=24,a=this.adjustedTextSize/o,s=void 0!==this.adjustedTextMaxSize?this.adjustedTextMaxSize:this.adjustedTextSize,p=this.tilePixelRatio*a,h=this.tilePixelRatio*s/o,f=this.tilePixelRatio*this.adjustedIconSize,d=this.tilePixelRatio*i["symbol-spacing"],m=i["symbol-avoid-edges"],g=i["text-padding"]*this.tilePixelRatio,v=i["icon-padding"]*this.tilePixelRatio,_=i["text-max-angle"]/180*Math.PI,x="map"===i["text-rotation-alignment"]&&"line"===i["symbol-placement"],S="map"===i["icon-rotation-alignment"]&&"line"===i["symbol-placement"],T=i["text-allow-overlap"]||i["icon-allow-overlap"]||i["text-ignore-placement"]||i["icon-ignore-placement"],E=i["symbol-placement"],A=d/2,C=function(i,o){var a=!(o.x<0||o.x>u||o.y<0||o.y>u);if(!m||a){var s=a||T;r.addSymbolInstance(o,i,e,n,r.layers[0],s,r.symbolInstancesArray.length,r.collisionBoxArray,t.index,t.sourceLayerIndex,r.index,p,g,x,f,v,S,{zoom:r.zoom},t.properties)}};if("line"===E)for(var M=0,k=y(t.geometry,0,0,u,u);M<k.length;M+=1)for(var z=k[M],I=c(z,d,_,e[P.vertical]||e[P.horizontal],n,o,h,r.overscaling,u),L=0,O=I;L<O.length;L+=1){var D=O[L],R=e[P.horizontal];R&&r.anchorIsTooClose(R.text,A,D)||C(z,D)}else if("Polygon"===t.type)for(var B=0,j=w(t.geometry,0);B<j.length;B+=1){var F=j[B],N=b(F,16);C(F[0],new l(N.x,N.y,0))}else if("LineString"===t.type)for(var U=0,V=t.geometry;U<V.length;U+=1){var q=V[U];C(q,new l(q[0].x,q[0].y,0))}else if("Point"===t.type)for(var G=0,Z=t.geometry;G<Z.length;G+=1)for(var W=Z[G],H=0,X=W;H<X.length;H+=1){var $=X[H];C([$],new l($.x,$.y,0))}},L.prototype.anchorIsTooClose=function(t,e,n){var r=this.compareText;if(t in r){for(var i=r[t],o=i.length-1;o>=0;o--)if(n.dist(i[o])<e)return!0}else r[t]=[];return r[t].push(n),!1},L.prototype.place=function(t,e){var n=this;this.createArrays();var r=this.layers[0].layout,i=t.maxScale,o="map"===r["text-rotation-alignment"]&&"line"===r["symbol-placement"],a="map"===r["icon-rotation-alignment"]&&"line"===r["symbol-placement"];if(r["text-allow-overlap"]||r["icon-allow-overlap"]||r["text-ignore-placement"]||r["icon-ignore-placement"]){var s=this.symbolInstancesArray.toArray(this.symbolInstancesStartIndex,this.symbolInstancesEndIndex),u=t.angle,l=Math.sin(u),c=Math.cos(u);this.sortedSymbolInstances=s.sort(function(t,e){return(l*t.anchorPointX+c*t.anchorPointY|0)-(l*e.anchorPointX+c*e.anchorPointY|0)||e.index-t.index})}for(var p=this.symbolInstancesStartIndex;p<this.symbolInstancesEndIndex;p++){var h=n.sortedSymbolInstances?n.sortedSymbolInstances[p-n.symbolInstancesStartIndex]:n.symbolInstancesArray.get(p),f={boxStartIndex:h.textBoxStartIndex,boxEndIndex:h.textBoxEndIndex},d={boxStartIndex:h.iconBoxStartIndex,boxEndIndex:h.iconBoxEndIndex},m=!(h.textBoxStartIndex===h.textBoxEndIndex),y=!(h.iconBoxStartIndex===h.iconBoxEndIndex),g=r["text-optional"]||!m,v=r["icon-optional"]||!y,_=m?t.placeCollisionFeature(f,r["text-allow-overlap"],r["symbol-avoid-edges"]):t.minScale,x=y?t.placeCollisionFeature(d,r["icon-allow-overlap"],r["symbol-avoid-edges"]):t.minScale;g||v?!v&&_?_=Math.max(x,_):!g&&x&&(x=Math.max(x,_)):x=_=Math.max(x,_),m&&(t.insertCollisionFeature(f,_,r["text-ignore-placement"]),_<=i&&n.addSymbols(n.arrays.glyph,h.glyphQuadStartIndex,h.glyphQuadEndIndex,_,r["text-keep-upright"],o,t.angle,h.writingModes)),y&&(t.insertCollisionFeature(d,x,r["icon-ignore-placement"]),x<=i&&n.addSymbols(n.arrays.icon,h.iconQuadStartIndex,h.iconQuadEndIndex,x,r["icon-keep-upright"],a,t.angle))}e&&this.addToDebugBuffers(t)},L.prototype.addSymbols=function(t,e,n,r,i,o,a,s){for(var u=this,l=t.elementArray,c=t.layoutVertexArray,p=this.zoom,h=Math.max(Math.log(r)/Math.LN2+p,0),f=e;f<n;f++){var d=u.symbolQuadsArray.get(f).SymbolQuad,m=(d.anchorAngle+a+Math.PI)%(2*Math.PI);if(s&P.vertical){if(o&&d.writingMode===P.vertical){if(i&&o&&m<=5*Math.PI/4||m>7*Math.PI/4)continue}else if(i&&o&&m<=3*Math.PI/4||m>5*Math.PI/4)continue}else if(i&&o&&(m<=Math.PI/2||m>3*Math.PI/2))continue;var y=d.tl,g=d.tr,v=d.bl,_=d.br,x=d.tex,b=d.anchorPoint,w=Math.max(p+Math.log(d.minScale)/Math.LN2,h),S=Math.min(p+Math.log(d.maxScale)/Math.LN2,25);if(!(S<=w)){w===h&&(w=0);var T=Math.round(d.glyphAngle/(2*Math.PI)*256),E=t.prepareSegment(4),A=E.vertexLength;addVertex(c,b.x,b.y,y.x,y.y,x.x,x.y,w,S,h,T),addVertex(c,b.x,b.y,g.x,g.y,x.x+x.w,x.y,w,S,h,T),addVertex(c,b.x,b.y,v.x,v.y,x.x,x.y+x.h,w,S,h,T),addVertex(c,b.x,b.y,_.x,_.y,x.x+x.w,x.y+x.h,w,S,h,T),l.emplaceBack(A,A+1,A+2),l.emplaceBack(A+1,A+2,A+3),E.vertexLength+=4,E.primitiveLength+=2}}},L.prototype.addToDebugBuffers=function(t){for(var e=this,n=this.arrays.collisionBox,i=n.layoutVertexArray,o=n.elementArray,a=-t.angle,s=t.yStretch,u=this.symbolInstancesStartIndex;u<this.symbolInstancesEndIndex;u++){var l=e.symbolInstancesArray.get(u);l.textCollisionFeature={boxStartIndex:l.textBoxStartIndex,boxEndIndex:l.textBoxEndIndex},l.iconCollisionFeature={boxStartIndex:l.iconBoxStartIndex,boxEndIndex:l.iconBoxEndIndex};for(var c=0;c<2;c++){var p=l[0===c?"textCollisionFeature":"iconCollisionFeature"];if(p)for(var h=p.boxStartIndex;h<p.boxEndIndex;h++){var f=e.collisionBoxArray.get(h),d=f.anchorPoint,m=new r(f.x1,f.y1*s)._rotate(a),y=new r(f.x2,f.y1*s)._rotate(a),g=new r(f.x1,f.y2*s)._rotate(a),v=new r(f.x2,f.y2*s)._rotate(a),_=Math.max(0,Math.min(25,e.zoom+Math.log(f.maxScale)/Math.LN2)),x=Math.max(0,Math.min(25,e.zoom+Math.log(f.placementScale)/Math.LN2)),b=n.prepareSegment(4),w=b.vertexLength;addCollisionBoxVertex(i,d,m,_,x),addCollisionBoxVertex(i,d,y,_,x),addCollisionBoxVertex(i,d,v,_,x),addCollisionBoxVertex(i,d,g,_,x),o.emplaceBack(w,w+1),o.emplaceBack(w+1,w+2),o.emplaceBack(w+2,w+3),o.emplaceBack(w+3,w),b.vertexLength+=4,b.primitiveLength+=4}}}},L.prototype.addSymbolInstance=function(t,e,n,r,i,o,a,s,u,l,c,p,h,f,d,m,y,v,_){var b,w,S,T=this,E=[];for(var A in n){var k=parseInt(A,10);n[k]&&(E=E.concat(o?C(t,n[k],p,e,i,f,k):[]),b=new x(s,e,t,u,l,c,n[k],p,h,f,!1))}var z=this.symbolQuadsArray.length;if(E&&E.length)for(var I=0;I<E.length;I++)T.addSymbolQuad(E[I]);var O=this.symbolQuadsArray.length,D=b?b.boxStartIndex:this.collisionBoxArray.length,R=b?b.boxEndIndex:this.collisionBoxArray.length;r&&(S=o?M(t,r,d,e,i,y,n[P.horizontal],v,_):[],w=new x(s,e,t,u,l,c,r,d,m,y,!0));var B=this.symbolQuadsArray.length;S&&1===S.length&&this.addSymbolQuad(S[0]);var j=this.symbolQuadsArray.length,F=w?w.boxStartIndex:this.collisionBoxArray.length,N=w?w.boxEndIndex:this.collisionBoxArray.length;j>L.MAX_QUADS&&g.warnOnce("Too many symbols being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),O>L.MAX_QUADS&&g.warnOnce("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907");var U=(n[P.vertical]?P.vertical:0)|(n[P.horizontal]?P.horizontal:0);return this.symbolInstancesArray.emplaceBack(D,R,F,N,z,O,B,j,t.x,t.y,a,U)},L.prototype.addSymbolQuad=function(t){return this.symbolQuadsArray.emplaceBack(t.anchorPoint.x,t.anchorPoint.y,t.tl.x,t.tl.y,t.tr.x,t.tr.y,t.bl.x,t.bl.y,t.br.x,t.br.y,t.tex.h,t.tex.w,t.tex.x,t.tex.y,t.anchorAngle,t.glyphAngle,t.maxScale,t.minScale,t.writingMode)},L.MAX_QUADS=65535,e.exports=L},{"../../source/rtl_text_plugin":49,"../../symbol/anchor":75,"../../symbol/clip_line":77,"../../symbol/collision_feature":79,"../../symbol/get_anchors":81,"../../symbol/mergelines":84,"../../symbol/quads":85,"../../symbol/resolve_text":86,"../../symbol/shaping":87,"../../util/classify_rings":113,"../../util/find_pole_of_inaccessibility":119,"../../util/script_detection":126,"../../util/token":128,"../../util/util":129,"../array_group":1,"../buffer_group":9,"../element_array_type":10,"../extent":11,"../load_geometry":13,"../vertex_array_type":17,"point-geometry":197,"vector-tile":206}],8:[function(t,e,n){"use strict";var r={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT"},i=function(t,e,n){this.arrayBuffer=t.arrayBuffer,this.length=t.length,this.attributes=e.members,this.itemSize=e.bytesPerElement,this.type=n,this.arrayType=e};i.fromStructArray=function(t,e){return new i(t.serialize(),t.constructor.serialize(),e)},i.prototype.bind=function(t){var e=t[this.type];this.buffer?t.bindBuffer(e,this.buffer):(this.gl=t,this.buffer=t.createBuffer(),t.bindBuffer(e,this.buffer),t.bufferData(e,this.arrayBuffer,t.STATIC_DRAW),this.arrayBuffer=null)},i.prototype.setVertexAttribPointers=function(t,e,n){for(var i=this,o=0;o<this.attributes.length;o++){var a=i.attributes[o],s=e[a.name];void 0!==s&&t.vertexAttribPointer(s,a.components,t[r[a.type]],!1,i.arrayType.bytesPerElement,a.offset+(i.arrayType.bytesPerElement*n||0))}},i.prototype.destroy=function(){this.buffer&&this.gl.deleteBuffer(this.buffer)},i.BufferType={VERTEX:"ARRAY_BUFFER",ELEMENT:"ELEMENT_ARRAY_BUFFER"},e.exports=i},{}],9:[function(t,e,n){"use strict";var r=t("../util/util"),i=t("./buffer"),o=t("./program_configuration"),a=t("../render/vertex_array_object"),s=function(t,e,n,s){var u=this;this.layoutVertexBuffer=new i(s.layoutVertexArray,t.layoutVertexArrayType.serialize(),i.BufferType.VERTEX),s.elementArray&&(this.elementBuffer=new i(s.elementArray,t.elementArrayType.serialize(),i.BufferType.ELEMENT)),s.elementArray2&&(this.elementBuffer2=new i(s.elementArray2,t.elementArrayType2.serialize(),i.BufferType.ELEMENT)),this.layerData={};for(var l=0,c=e;l<c.length;l+=1){var p=c[l],h=s.paintVertexArrays&&s.paintVertexArrays[p.id],f=o.createDynamic(t.paintAttributes||[],p,n),d=h?new i(h.array,h.type,i.BufferType.VERTEX):null;u.layerData[p.id]={programConfiguration:f,paintVertexBuffer:d}}this.segments=s.segments,this.segments2=s.segments2;for(var m=0,y=[this.segments,this.segments2];m<y.length;m+=1)for(var g=y[m],v=0,_=g||[];v<_.length;v+=1){var x=_[v];x.vaos=r.mapObject(u.layerData,function(){return new a})}};s.prototype.destroy=function(){var t=this;this.layoutVertexBuffer.destroy(),this.elementBuffer&&this.elementBuffer.destroy(),this.elementBuffer2&&this.elementBuffer2.destroy();for(var e in this.layerData){var n=t.layerData[e].paintVertexBuffer;n&&n.destroy()}for(var r=0,i=[this.segments,this.segments2];r<i.length;r+=1)for(var o=i[r],a=0,s=o||[];a<s.length;a+=1){var u=s[a];for(var l in u.vaos)u.vaos[l].destroy()}},e.exports=s},{"../render/vertex_array_object":39,"../util/util":129,"./buffer":8,"./program_configuration":15}],10:[function(t,e,n){"use strict";function createElementArrayType(t){return r({members:[{type:"Uint16",name:"vertices",components:t||3}]})}var r=t("../util/struct_array");e.exports=createElementArrayType},{"../util/struct_array":127}],11:[function(t,e,n){"use strict";e.exports=8192},{}],12:[function(t,e,n){"use strict";function translateDistance(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function topDownFeatureComparator(t,e){return e-t}function getLineWidth(t){return t["line-gap-width"]>0?t["line-gap-width"]+2*t["line-width"]:t["line-width"]}function translate(t,e,n,i,o){if(!e[0]&&!e[1])return t;e=r.convert(e),"viewport"===n&&e._rotate(-i);for(var a=[],s=0;s<t.length;s++){for(var u=t[s],l=[],c=0;c<u.length;c++)l.push(u[c].sub(e._mult(o)));a.push(l)}return a}function offsetLine(t,e){for(var n=[],i=new r(0,0),o=0;o<t.length;o++){for(var a=t[o],s=[],u=0;u<a.length;u++){var l=a[u-1],c=a[u],p=a[u+1],h=0===u?i:c.sub(l)._unit()._perp(),f=u===a.length-1?i:p.sub(c)._unit()._perp(),d=h._add(f)._unit(),m=d.x*f.x+d.y*f.y;d._mult(1/m),s.push(d._mult(e)._add(c))}n.push(s)}return n}var r=t("point-geometry"),i=t("./load_geometry"),o=t("./extent"),a=t("feature-filter"),s=t("../util/struct_array"),u=t("grid-index"),l=t("../util/dictionary_coder"),c=t("vector-tile"),p=t("pbf"),h=t("../util/vectortile_to_geojson"),f=t("../util/util").arraysIntersect,d=t("../util/intersection_tests"),m=d.multiPolygonIntersectsBufferedMultiPoint,y=d.multiPolygonIntersectsMultiPolygon,g=d.multiPolygonIntersectsBufferedMultiLine,v=s({members:[{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]}),_=function(t,e,n){if(t.grid){var r=t,i=e;t=r.coord,e=r.overscaling,this.grid=new u(r.grid),this.featureIndexArray=new v(r.featureIndexArray),this.rawTileData=i,this.bucketLayerIDs=r.bucketLayerIDs}else this.grid=new u(o,16,0),this.featureIndexArray=new v;this.coord=t,this.overscaling=e,this.x=t.x,this.y=t.y,this.z=t.z-Math.log(e)/Math.LN2,this.setCollisionTile(n)};_.prototype.insert=function(t,e){var n=this,r=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(t.index,t.sourceLayerIndex,e);for(var o=i(t),a=0;a<o.length;a++){for(var s=o[a],u=[1/0,1/0,-(1/0),-(1/0)],l=0;l<s.length;l++){var c=s[l];u[0]=Math.min(u[0],c.x),u[1]=Math.min(u[1],c.y),u[2]=Math.max(u[2],c.x),u[3]=Math.max(u[3],c.y)}n.grid.insert(r,u[0],u[1],u[2],u[3])}},_.prototype.setCollisionTile=function(t){this.collisionTile=t},_.prototype.serialize=function(t){var e=this.grid.toArrayBuffer();return t&&t.push(e),{coord:this.coord,overscaling:this.overscaling,grid:e,featureIndexArray:this.featureIndexArray.serialize(t),bucketLayerIDs:this.bucketLayerIDs}},_.prototype.query=function(t,e){this.vtLayers||(this.vtLayers=new c.VectorTile(new p(this.rawTileData)).layers,this.sourceLayerCoder=new l(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]));var n={},i=t.params||{},s=o/t.tileSize/t.scale,u=a(i.filter),h=0;for(var f in e){var d=e[f],m=d.paint,y=0;"line"===d.type?y=getLineWidth(m)/2+Math.abs(m["line-offset"])+translateDistance(m["line-translate"]):"fill"===d.type?y=translateDistance(m["fill-translate"]):"fill-extrusion"===d.type?y=translateDistance(m["fill-extrusion-translate"]):"circle"===d.type&&(y=m["circle-radius"]+translateDistance(m["circle-translate"])),h=Math.max(h,y*s)}for(var g=t.queryGeometry.map(function(t){return t.map(function(t){return new r(t.x,t.y)})}),v=1/0,_=1/0,x=-(1/0),b=-(1/0),w=0;w<g.length;w++)for(var S=g[w],T=0;T<S.length;T++){var E=S[T];v=Math.min(v,E.x),_=Math.min(_,E.y),x=Math.max(x,E.x),b=Math.max(b,E.y)}var A=this.grid.query(v-h,_-h,x+h,b+h);A.sort(topDownFeatureComparator),this.filterMatching(n,A,this.featureIndexArray,g,u,i.layers,e,t.bearing,s);var P=this.collisionTile.queryRenderedSymbols(g,t.scale);return P.sort(),this.filterMatching(n,P,this.collisionTile.collisionBoxArray,g,u,i.layers,e,t.bearing,s),n},_.prototype.filterMatching=function(t,e,n,r,o,a,s,u,l){for(var c,p=this,d=0;d<e.length;d++){var v=e[d];if(v!==c){c=v;var _=n.get(v),x=p.bucketLayerIDs[_.bucketIndex];if(!a||f(a,x)){var b=p.sourceLayerCoder.decode(_.sourceLayerIndex),w=p.vtLayers[b],S=w.feature(_.featureIndex);if(o(S))for(var T=null,E=0;E<x.length;E++){var A=x[E];if(!(a&&a.indexOf(A)<0)){var P=s[A];if(P){var C;if("symbol"!==P.type){T||(T=i(S));var M=P.paint;if("line"===P.type){C=translate(r,M["line-translate"],M["line-translate-anchor"],u,l);var k=getLineWidth(M)/2*l;if(M["line-offset"]&&(T=offsetLine(T,M["line-offset"]*l)),!g(C,T,k))continue}else if("fill"===P.type||"fill-extrusion"===P.type){var z=P.type;if(C=translate(r,M[z+"-translate"],M[z+"-translate-anchor"],u,l),!y(C,T))continue}else if("circle"===P.type){C=translate(r,M["circle-translate"],M["circle-translate-anchor"],u,l);var I=M["circle-radius"]*l;if(!m(C,T,I))continue}}var L=new h(S,p.z,p.x,p.y);L.layer=P.serialize();var O=t[A];void 0===O&&(O=t[A]=[]),O.push(L)}}}}}}},e.exports=_},{"../util/dictionary_coder":115,"../util/intersection_tests":122,"../util/struct_array":127,"../util/util":129,"../util/vectortile_to_geojson":130,"./extent":11,"./load_geometry":13,"feature-filter":138,"grid-index":149,pbf:196,"point-geometry":197,"vector-tile":206}],13:[function(t,e,n){"use strict";function createBounds(t){return{min:-1*Math.pow(2,t-1),max:Math.pow(2,t-1)-1}}var r=t("../util/util"),i=t("./extent"),o={15:createBounds(15),16:createBounds(16)};e.exports=function(t,e){for(var n=o[e||16],a=i/t.extent,s=t.loadGeometry(),u=0;u<s.length;u++)for(var l=s[u],c=0;c<l.length;c++){var p=l[c];p.x=Math.round(p.x*a),p.y=Math.round(p.y*a),(p.x<n.min||p.x>n.max||p.y<n.min||p.y>n.max)&&r.warnOnce("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return s}},{"../util/util":129,"./extent":11}],14:[function(t,e,n){"use strict";var r=t("../util/struct_array"),i=r({members:[{name:"a_pos",type:"Int16",components:2}]});e.exports=i},{"../util/struct_array":127}],15:[function(t,e,n){"use strict";function getPaintAttributeValue(t,e,n,r){if(!t.zoomStops)return e.getPaintValue(t.property,n,r);var o=t.zoomStops.map(function(o){return e.getPaintValue(t.property,i.extend({},n,{zoom:o}),r)});return 1===o.length?o[0]:o}function normalizePaintAttribute(t,e){var n=t.property.replace(e.type+"-","").replace(/-/g,"_"),r="color"===e._paintSpecifications[t.property].type;return i.extend({name:"a_"+n,components:r?4:1,multiplier:r?255:1},t)}var r=t("./vertex_array_type"),i=t("../util/util"),o=function(){this.attributes=[],this.uniforms=[],this.interpolationUniforms=[],this.pragmas={vertex:{},fragment:{}},this.cacheKey=""};o.createDynamic=function(t,e,n){for(var i=new o,a=0,s=t;a<s.length;a+=1){var u=s[a],l=normalizePaintAttribute(u,e),c=l.name.slice(2);e.isPaintValueFeatureConstant(l.property)?i.addZoomAttribute(c,l):e.isPaintValueZoomConstant(l.property)?i.addPropertyAttribute(c,l):i.addZoomAndPropertyAttribute(c,l,e,n)}return i.PaintVertexArray=r(i.attributes),i},o.createStatic=function(t){for(var e=new o,n=0,r=t;n<r.length;n+=1){var i=r[n];e.addUniform(i,"u_"+i)}return e},o.prototype.addUniform=function(t,e){var n=this.getPragmas(t);n.define.push("uniform {precision} {type} "+e+";"),n.initialize.push("{precision} {type} "+t+" = "+e+";"),this.cacheKey+="/u_"+t},o.prototype.addZoomAttribute=function(t,e){this.uniforms.push(e),this.addUniform(t,e.name)},o.prototype.addPropertyAttribute=function(t,e){var n=this.getPragmas(t);this.attributes.push(e),n.define.push("varying {precision} {type} "+t+";"),n.vertex.define.push("attribute {precision} {type} "+e.name+";"),n.vertex.initialize.push(t+" = "+e.name+" / "+e.multiplier+".0;"),this.cacheKey+="/a_"+t},o.prototype.addZoomAndPropertyAttribute=function(t,e,n,r){var o=this,a=this.getPragmas(t);a.define.push("varying {precision} {type} "+t+";");for(var s=0,u=n.getPaintValueStopZoomLevels(e.property);s<u.length&&u[s]<r;)s++;var l=Math.max(0,Math.min(u.length-4,s-2)),c="u_"+t+"_t";a.vertex.define.push("uniform lowp float "+c+";"),this.interpolationUniforms.push({name:c,property:e.property,stopOffset:l});for(var p=[],h=0;h<4;h++)p.push(u[Math.min(l+h,u.length-1)]);var f=[];if(1===e.components)this.attributes.push(i.extend({},e,{components:4,zoomStops:p})),a.vertex.define.push("attribute {precision} vec4 "+e.name+";"),f.push(e.name);else for(var d=0;d<4;d++){var m=e.name+d;f.push(m),o.attributes.push(i.extend({},e,{name:m,zoomStops:[p[d]]})),a.vertex.define.push("attribute {precision} {type} "+m+";")}a.vertex.initialize.push(t+" = evaluate_zoom_function_"+e.components+"(            "+f.join(", ")+", "+c+") / "+e.multiplier+".0;"),this.cacheKey+="/z_"+t},o.prototype.getPragmas=function(t){return this.pragmas[t]||(this.pragmas[t]={define:[],initialize:[]},this.pragmas[t].fragment={define:[],initialize:[]},this.pragmas[t].vertex={define:[],initialize:[]}),this.pragmas[t]},o.prototype.applyPragmas=function(t,e){var n=this;return t.replace(/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,function(t,r,i,o,a){return n.pragmas[a][r].concat(n.pragmas[a][e][r]).join("\n").replace(/{type}/g,o).replace(/{precision}/g,i)})},o.prototype.populatePaintArray=function(t,e,n,r,i){var o=e.length;e.resize(n);for(var a=0,s=this.attributes;a<s.length;a+=1)for(var u=s[a],l=getPaintAttributeValue(u,t,r,i),c=o;c<n;c++){var p=e.get(c);if(4===u.components)for(var h=0;h<4;h++)p[u.name+h]=l[h]*u.multiplier;else p[u.name]=l*u.multiplier}},o.prototype.setUniforms=function(t,e,n,r){for(var i=0,o=this.uniforms;i<o.length;i+=1){var a=o[i],s=n.getPaintValue(a.property,r);4===a.components?t.uniform4fv(e[a.name],s):t.uniform1f(e[a.name],s)}for(var u=0,l=this.interpolationUniforms;u<l.length;u+=1){var c=l[u],p=n.getPaintInterpolationT(c.property,r);t.uniform1f(e[c.name],Math.max(0,Math.min(4,p-c.stopOffset)))}},e.exports=o},{"../util/util":129,"./vertex_array_type":17}],16:[function(t,e,n){"use strict";var r=t("../util/struct_array"),i=r({members:[{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]});e.exports=i},{"../util/struct_array":127}],17:[function(t,e,n){"use strict";function createVertexArrayType(t){return r({members:t,alignment:4})}var r=t("../util/struct_array");e.exports=createVertexArrayType},{"../util/struct_array":127}],18:[function(t,e,n){"use strict";var r=function(t,e,n){this.column=t,this.row=e,this.zoom=n};r.prototype.clone=function(){return new r(this.column,this.row,this.zoom)},r.prototype.zoomTo=function(t){return this.clone()._zoomTo(t)},r.prototype.sub=function(t){return this.clone()._sub(t)},r.prototype._zoomTo=function(t){var e=Math.pow(2,t-this.zoom);return this.column*=e,this.row*=e,this.zoom=t,this},r.prototype._sub=function(t){return t=t.zoomTo(this.zoom),this.column-=t.column,this.row-=t.row,this},e.exports=r},{}],19:[function(t,e,n){"use strict";var r=t("../util/util").wrap,i=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};i.prototype.wrap=function(){return new i(r(this.lng,-180,180),this.lat)},i.prototype.toArray=function(){return[this.lng,this.lat]},i.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},i.convert=function(t){if(t instanceof i)return t;if(t&&t.hasOwnProperty("lng")&&t.hasOwnProperty("lat"))return new i(t.lng,t.lat);if(Array.isArray(t)&&2===t.length)return new i(t[0],t[1]);throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")},e.exports=i},{"../util/util":129}],20:[function(t,e,n){"use strict";var r=t("./lng_lat"),i=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};i.prototype.setNorthEast=function(t){return this._ne=r.convert(t),this},i.prototype.setSouthWest=function(t){return this._sw=r.convert(t),this},i.prototype.extend=function(t){var e,n,o=this._sw,a=this._ne;if(t instanceof r)e=t,n=t;else{if(!(t instanceof i))return Array.isArray(t)?t.every(Array.isArray)?this.extend(i.convert(t)):this.extend(r.convert(t)):this;if(e=t._sw,n=t._ne,!e||!n)return this}return o||a?(o.lng=Math.min(e.lng,o.lng),o.lat=Math.min(e.lat,o.lat),a.lng=Math.max(n.lng,a.lng),a.lat=Math.max(n.lat,a.lat)):(this._sw=new r(e.lng,e.lat),this._ne=new r(n.lng,n.lat)),this},i.prototype.getCenter=function(){return new r((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},i.prototype.getSouthWest=function(){return this._sw},i.prototype.getNorthEast=function(){return this._ne},i.prototype.getNorthWest=function(){return new r(this.getWest(),this.getNorth())},i.prototype.getSouthEast=function(){return new r(this.getEast(),this.getSouth())},i.prototype.getWest=function(){return this._sw.lng},i.prototype.getSouth=function(){return this._sw.lat},i.prototype.getEast=function(){return this._ne.lng},i.prototype.getNorth=function(){return this._ne.lat},i.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},i.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},i.convert=function(t){return!t||t instanceof i?t:new i(t)},e.exports=i},{"./lng_lat":19}],21:[function(t,e,n){"use strict";var r=t("./lng_lat"),i=t("point-geometry"),o=t("./coordinate"),a=t("../util/util"),s=t("../util/interpolate"),u=t("../source/tile_coord"),l=t("../data/extent"),c=t("@mapbox/gl-matrix"),p=c.vec4,h=c.mat4,f=c.mat2,d=function(t,e,n){this.tileSize=512,this._renderWorldCopies=void 0===n||n,this._minZoom=t||0,this._maxZoom=e||22,this.latRange=[-85.05113,85.05113],this.width=0,this.height=0,this._center=new r(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0},m={minZoom:{},maxZoom:{},worldSize:{},centerPoint:{},size:{},bearing:{},pitch:{},fov:{},zoom:{},center:{},unmodified:{},x:{},y:{},point:{}};m.minZoom.get=function(){return this._minZoom},m.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},m.maxZoom.get=function(){return this._maxZoom},m.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},m.worldSize.get=function(){return this.tileSize*this.scale},m.centerPoint.get=function(){return this.size._div(2)},m.size.get=function(){return new i(this.width,this.height)},m.bearing.get=function(){return-this.angle/Math.PI*180},m.bearing.set=function(t){var e=-a.wrap(t,-180,180)*Math.PI/180;this.angle!==e&&(this._unmodified=!1,this.angle=e,this._calcMatrices(),this.rotationMatrix=f.create(),f.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},m.pitch.get=function(){return this._pitch/Math.PI*180},m.pitch.set=function(t){var e=a.clamp(t,0,60)/180*Math.PI;this._pitch!==e&&(this._unmodified=!1,this._pitch=e,this._calcMatrices())},m.fov.get=function(){return this._fov/Math.PI*180},m.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},m.zoom.get=function(){return this._zoom},m.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())},m.center.get=function(){return this._center},m.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},d.prototype.coveringZoomLevel=function(t){return(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize))},d.prototype.coveringTiles=function(t){var e=this.coveringZoomLevel(t),n=e;if(e<t.minzoom)return[];e>t.maxzoom&&(e=t.maxzoom);var r=this.pointCoordinate(this.centerPoint,e),o=new i(r.column-.5,r.row-.5),a=[this.pointCoordinate(new i(0,0),e),this.pointCoordinate(new i(this.width,0),e),this.pointCoordinate(new i(this.width,this.height),e),this.pointCoordinate(new i(0,this.height),e)];return u.cover(e,a,t.reparseOverscaled?n:e,this._renderWorldCopies).sort(function(t,e){return o.dist(t)-o.dist(e)})},d.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()},m.unmodified.get=function(){return this._unmodified},d.prototype.zoomScale=function(t){return Math.pow(2,t)},d.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},d.prototype.project=function(t){return new i(this.lngX(t.lng),this.latY(t.lat))},d.prototype.unproject=function(t){return new r(this.xLng(t.x),this.yLat(t.y))},m.x.get=function(){return this.lngX(this.center.lng)},m.y.get=function(){return this.latY(this.center.lat)},m.point.get=function(){return new i(this.x,this.y)},d.prototype.lngX=function(t){return(180+t)*this.worldSize/360},d.prototype.latY=function(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))*this.worldSize/360},d.prototype.xLng=function(t){return 360*t/this.worldSize-180},d.prototype.yLat=function(t){var e=180-360*t/this.worldSize;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90},d.prototype.setLocationAtPoint=function(t,e){var n=this.pointCoordinate(e)._sub(this.pointCoordinate(this.centerPoint));this.center=this.coordinateLocation(this.locationCoordinate(t)._sub(n))},d.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},d.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},d.prototype.locationCoordinate=function(t){return new o(this.lngX(t.lng)/this.tileSize,this.latY(t.lat)/this.tileSize,this.zoom).zoomTo(this.tileZoom)},d.prototype.coordinateLocation=function(t){var e=t.zoomTo(this.zoom);return new r(this.xLng(e.column*this.tileSize),this.yLat(e.row*this.tileSize))},d.prototype.pointCoordinate=function(t,e){void 0===e&&(e=this.tileZoom);var n=0,r=[t.x,t.y,0,1],i=[t.x,t.y,1,1];p.transformMat4(r,r,this.pixelMatrixInverse),p.transformMat4(i,i,this.pixelMatrixInverse);var a=r[3],u=i[3],l=r[0]/a,c=i[0]/u,h=r[1]/a,f=i[1]/u,d=r[2]/a,m=i[2]/u,y=d===m?0:(n-d)/(m-d);return new o(s(l,c,y)/this.tileSize,s(h,f,y)/this.tileSize,this.zoom)._zoomTo(e)},d.prototype.coordinatePoint=function(t){var e=t.zoomTo(this.zoom),n=[e.column*this.tileSize,e.row*this.tileSize,0,1];return p.transformMat4(n,n,this.pixelMatrix),new i(n[0]/n[3],n[1]/n[3])},d.prototype.calculatePosMatrix=function(t,e){var n=t.toCoordinate(e),r=this.worldSize/this.zoomScale(n.zoom),i=h.identity(new Float64Array(16));return h.translate(i,i,[n.column*r,n.row*r,0]),h.scale(i,i,[r/l,r/l,1]),h.multiply(i,this.projMatrix,i),new Float32Array(i)},d.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var t,e,n,r,o,a,s,u,l=this.size,c=this._unmodified;this.latRange&&(t=this.latY(this.latRange[1]),e=this.latY(this.latRange[0]),o=e-t<l.y?l.y/(e-t):0),this.lngRange&&(n=this.lngX(this.lngRange[0]),r=this.lngX(this.lngRange[1]),a=r-n<l.x?l.x/(r-n):0);var p=Math.max(a||0,o||0);if(p)return this.center=this.unproject(new i(a?(r+n)/2:this.x,o?(e+t)/2:this.y)),this.zoom+=this.scaleZoom(p),this._unmodified=c,void(this._constraining=!1);if(this.latRange){var h=this.y,f=l.y/2;h-f<t&&(u=t+f),h+f>e&&(u=e-f)}if(this.lngRange){var d=this.x,m=l.x/2;d-m<n&&(s=n+m),d+m>r&&(s=r-m)}void 0===s&&void 0===u||(this.center=this.unproject(new i(void 0!==s?s:this.x,void 0!==u?u:this.y))),this._unmodified=c,this._constraining=!1}},d.prototype._calcMatrices=function(){if(this.height){this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var t=this._fov/2,e=Math.PI/2+this._pitch,n=Math.sin(t)*this.cameraToCenterDistance/Math.sin(Math.PI-e-t),r=Math.cos(Math.PI/2-this._pitch)*n+this.cameraToCenterDistance,i=1.01*r,o=new Float64Array(16);h.perspective(o,this._fov,this.width/this.height,1,i),h.scale(o,o,[1,-1,1]),h.translate(o,o,[0,0,-this.cameraToCenterDistance]),h.rotateX(o,o,this._pitch),h.rotateZ(o,o,this.angle),h.translate(o,o,[-this.x,-this.y,0]);var a=this.worldSize/(2*Math.PI*6378137*Math.abs(Math.cos(this.center.lat*(Math.PI/180))));if(h.scale(o,o,[1,1,a,1]),this.projMatrix=o,o=h.create(),h.scale(o,o,[this.width/2,-this.height/2,1]),h.translate(o,o,[1,-1,0]),this.pixelMatrix=h.multiply(new Float64Array(16),o,this.projMatrix),!(o=h.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=o}},Object.defineProperties(d.prototype,m),e.exports=d},{"../data/extent":11,"../source/tile_coord":53,"../util/interpolate":121,"../util/util":129,"./coordinate":18,"./lng_lat":19,"@mapbox/gl-matrix":133,"point-geometry":197}],22:[function(t,e,n){"use strict";var r,i=t("./util/worker_pool");e.exports=function(){return r||(r=new i),r}},{"./util/worker_pool":132}],23:[function(t,e,n){"use strict";var r={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]};e.exports=function(t,e,n,i){i=i||1;var o,a,s,u,l,c,p,h,f=[];for(o=0,a=t.length;o<a;o++)if(l=r[t[o]]){for(h=null,s=0,u=l[1].length;s<u;s+=2)l[1][s]===-1&&l[1][s+1]===-1?h=null:(c=e+l[1][s]*i,p=n-l[1][s+1]*i,h&&f.push(h.x,h.y,c,p),h={x:c,y:p});e+=l[0]*i}return f}},{}],24:[function(t,e,n){"use strict";var r=t("./util/browser"),i=e.exports={};i.version=t("../package.json").version,i.workerCount=Math.max(Math.floor(r.hardwareConcurrency/2),1),i.Map=t("./ui/map"),i.NavigationControl=t("./ui/control/navigation_control"),i.GeolocateControl=t("./ui/control/geolocate_control"),i.AttributionControl=t("./ui/control/attribution_control"),i.ScaleControl=t("./ui/control/scale_control"),i.Popup=t("./ui/popup"),i.Marker=t("./ui/marker"),i.Style=t("./style/style"),i.LngLat=t("./geo/lng_lat"),i.LngLatBounds=t("./geo/lng_lat_bounds"),i.Point=t("point-geometry"),i.Evented=t("./util/evented"),i.util=t("./util/util"),i.supported=t("./util/browser").supported;var o=t("./util/ajax");i.util.getJSON=o.getJSON,i.util.getArrayBuffer=o.getArrayBuffer;var a=t("./util/config");i.config=a;var s=t("./source/rtl_text_plugin");i.setRTLTextPlugin=s.setRTLTextPlugin,Object.defineProperty(i,"accessToken",{get:function(){return a.ACCESS_TOKEN},set:function(t){a.ACCESS_TOKEN=t}})},{"../package.json":216,"./geo/lng_lat":19,"./geo/lng_lat_bounds":20,"./source/rtl_text_plugin":49,"./style/style":63,"./ui/control/attribution_control":93,"./ui/control/geolocate_control":94,"./ui/control/navigation_control":95,"./ui/control/scale_control":96,"./ui/map":105,"./ui/marker":106,"./ui/popup":107,"./util/ajax":109,"./util/browser":110,"./util/config":114,"./util/evented":118,"./util/util":129,"point-geometry":197}],25:[function(t,e,n){"use strict";function drawBackground(t,e,n){var i=t.gl,o=t.transform,a=o.tileSize,s=n.paint["background-color"],u=n.paint["background-pattern"],l=n.paint["background-opacity"],c=!u&&1===s[3]&&1===l;if(t.isOpaquePass===c){i.disable(i.STENCIL_TEST),t.setDepthSublayer(0);var p;u?(p=t.useProgram("fillPattern",t.basicFillProgramConfiguration),r.prepare(u,t,p),t.tileExtentPatternVAO.bind(i,p,t.tileExtentBuffer)):(p=t.useProgram("fill",t.basicFillProgramConfiguration),i.uniform4fv(p.u_color,s),t.tileExtentVAO.bind(i,p,t.tileExtentBuffer)),i.uniform1f(p.u_opacity,l);for(var h=o.coveringTiles({tileSize:a}),f=0,d=h;f<d.length;f+=1){var m=d[f];u&&r.setTile({coord:m,tileSize:a},t,p),i.uniformMatrix4fv(p.u_matrix,!1,t.transform.calculatePosMatrix(m)),i.drawArrays(i.TRIANGLE_STRIP,0,t.tileExtentBuffer.length)}}}var r=t("./pattern");e.exports=drawBackground},{"./pattern":37}],26:[function(t,e,n){"use strict";function drawCircles(t,e,n,i){if(!t.isOpaquePass){var o=t.gl;t.setDepthSublayer(0),t.depthMask(!1),o.disable(o.STENCIL_TEST);for(var a=0;a<i.length;a++){var s=i[a],u=e.getTile(s),l=u.getBucket(n);if(l){var c=l.buffers,p=c.layerData[n.id],h=p.programConfiguration,f=t.useProgram("circle",h);h.setUniforms(o,f,n,{zoom:t.transform.zoom}),"map"===n.paint["circle-pitch-scale"]?(o.uniform1i(f.u_scale_with_map,!0),o.uniform2f(f.u_extrude_scale,t.transform.pixelsToGLUnits[0]*t.transform.cameraToCenterDistance,t.transform.pixelsToGLUnits[1]*t.transform.cameraToCenterDistance)):(o.uniform1i(f.u_scale_with_map,!1),o.uniform2fv(f.u_extrude_scale,t.transform.pixelsToGLUnits)),o.uniform1f(f.u_devicepixelratio,r.devicePixelRatio),o.uniformMatrix4fv(f.u_matrix,!1,t.translatePosMatrix(s.posMatrix,u,n.paint["circle-translate"],n.paint["circle-translate-anchor"]));for(var d=0,m=c.segments;d<m.length;d+=1){var y=m[d];y.vaos[n.id].bind(o,f,c.layoutVertexBuffer,c.elementBuffer,p.paintVertexBuffer,y.vertexOffset),o.drawElements(o.TRIANGLES,3*y.primitiveLength,o.UNSIGNED_SHORT,3*y.primitiveOffset*2)}}}}}var r=t("../util/browser");e.exports=drawCircles},{"../util/browser":110}],27:[function(t,e,n){"use strict";function drawCollisionDebug(t,e,n,r){var i=t.gl;i.enable(i.STENCIL_TEST);for(var o=t.useProgram("collisionBox"),a=0;a<r.length;a++){var s=r[a],u=e.getTile(s),l=u.getBucket(n);if(l){var c=l.buffers.collisionBox;if(c){i.uniformMatrix4fv(o.u_matrix,!1,s.posMatrix),t.enableTileClippingMask(s),t.lineWidth(1),i.uniform1f(o.u_scale,Math.pow(2,t.transform.zoom-u.coord.z)),i.uniform1f(o.u_zoom,10*t.transform.zoom),i.uniform1f(o.u_maxzoom,10*(u.coord.z+1));for(var p=0,h=c.segments;p<h.length;p+=1){var f=h[p];f.vaos[n.id].bind(i,o,c.layoutVertexBuffer,c.elementBuffer,null,f.vertexOffset),i.drawElements(i.LINES,2*f.primitiveLength,i.UNSIGNED_SHORT,2*f.primitiveOffset*2)}}}}}e.exports=drawCollisionDebug},{}],28:[function(t,e,n){"use strict";function drawDebug(t,e,n){for(var r=0;r<n.length;r++)drawDebugTile(t,e,n[r])}function drawDebugTile(t,e,n){var c=t.gl;c.disable(c.STENCIL_TEST),t.lineWidth(1*i.devicePixelRatio);var p=n.posMatrix,h=t.useProgram("debug");c.uniformMatrix4fv(h.u_matrix,!1,p),c.uniform4f(h.u_color,1,0,0,1),t.debugVAO.bind(c,h,t.debugBuffer),c.drawArrays(c.LINE_STRIP,0,t.debugBuffer.length);for(var f=r(n.toString(),50,200,5),d=new l,m=0;m<f.length;m+=2)d.emplaceBack(f[m],f[m+1]);var y=s.fromStructArray(d,s.BufferType.VERTEX);(new u).bind(c,h,y),c.uniform4f(h.u_color,1,1,1,1);for(var g=e.getTile(n).tileSize,v=a/(Math.pow(2,t.transform.zoom-n.z)*g),_=[[-1,-1],[-1,1],[1,-1],[1,1]],x=0;x<_.length;x++){var b=_[x];c.uniformMatrix4fv(h.u_matrix,!1,o.translate([],p,[v*b[0],v*b[1],0])),c.drawArrays(c.LINES,0,y.length)}c.uniform4f(h.u_color,0,0,0,1),c.uniformMatrix4fv(h.u_matrix,!1,p),c.drawArrays(c.LINES,0,y.length)}var r=t("../lib/debugtext"),i=t("../util/browser"),o=t("@mapbox/gl-matrix").mat4,a=t("../data/extent"),s=t("../data/buffer"),u=t("./vertex_array_object"),l=t("../data/pos_array");e.exports=drawDebug},{"../data/buffer":8,"../data/extent":11,"../data/pos_array":14,"../lib/debugtext":23,"../util/browser":110,"./vertex_array_object":39,"@mapbox/gl-matrix":133}],29:[function(t,e,n){"use strict";function drawFill(t,e,n,r){var i=t.gl;i.enable(i.STENCIL_TEST);var o=!n.paint["fill-pattern"]&&n.isPaintValueFeatureConstant("fill-color")&&n.isPaintValueFeatureConstant("fill-opacity")&&1===n.paint["fill-color"][3]&&1===n.paint["fill-opacity"];t.isOpaquePass===o&&(t.setDepthSublayer(1),drawFillTiles(t,e,n,r,drawFillTile)),!t.isOpaquePass&&n.paint["fill-antialias"]&&(t.lineWidth(2),t.depthMask(!1),t.setDepthSublayer(n.getPaintProperty("fill-outline-color")?2:0),drawFillTiles(t,e,n,r,drawStrokeTile))}function drawFillTiles(t,e,n,r,i){for(var o=!0,a=0,s=r;a<s.length;a+=1){var u=s[a],l=e.getTile(u),c=l.getBucket(n);c&&(t.enableTileClippingMask(u),i(t,e,n,l,u,c.buffers,o),o=!1)}}function drawFillTile(t,e,n,r,i,o,a){for(var s=t.gl,u=o.layerData[n.id],l=setFillProgram("fill",n.paint["fill-pattern"],t,u,n,r,i,a),c=0,p=o.segments;c<p.length;c+=1){var h=p[c];h.vaos[n.id].bind(s,l,o.layoutVertexBuffer,o.elementBuffer,u.paintVertexBuffer,h.vertexOffset),s.drawElements(s.TRIANGLES,3*h.primitiveLength,s.UNSIGNED_SHORT,3*h.primitiveOffset*2)}}function drawStrokeTile(t,e,n,r,i,o,a){var s=t.gl,u=o.layerData[n.id],l=n.paint["fill-pattern"]&&!n.getPaintProperty("fill-outline-color"),c=setFillProgram("fillOutline",l,t,u,n,r,i,a);s.uniform2f(c.u_world,s.drawingBufferWidth,s.drawingBufferHeight);for(var p=0,h=o.segments2;p<h.length;p+=1){var f=h[p];f.vaos[n.id].bind(s,c,o.layoutVertexBuffer,o.elementBuffer2,u.paintVertexBuffer,f.vertexOffset),s.drawElements(s.LINES,2*f.primitiveLength,s.UNSIGNED_SHORT,2*f.primitiveOffset*2)}}function setFillProgram(t,e,n,i,o,a,s,u){var l,c=n.currentProgram;return e?(l=n.useProgram(t+"Pattern",i.programConfiguration),(u||l!==c)&&(i.programConfiguration.setUniforms(n.gl,l,o,{zoom:n.transform.zoom}),r.prepare(o.paint["fill-pattern"],n,l)),r.setTile(a,n,l)):(l=n.useProgram(t,i.programConfiguration),(u||l!==c)&&i.programConfiguration.setUniforms(n.gl,l,o,{zoom:n.transform.zoom})),n.gl.uniformMatrix4fv(l.u_matrix,!1,n.translatePosMatrix(s.posMatrix,a,o.paint["fill-translate"],o.paint["fill-translate-anchor"])),l}var r=t("./pattern");e.exports=drawFill},{"./pattern":37}],30:[function(t,e,n){"use strict";function draw(t,e,n,r){if(0!==n.paint["fill-extrusion-opacity"]){var i=t.gl;i.disable(i.STENCIL_TEST),i.enable(i.DEPTH_TEST),t.depthMask(!0);var o=new ExtrusionTexture(i,t,n);o.bindFramebuffer(),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT);for(var a=0;a<r.length;a++)drawExtrusion(t,e,n,r[a]);o.unbindFramebuffer(),o.renderToMap()}}function ExtrusionTexture(t,e,n){this.gl=t,this.width=e.width,this.height=e.height,this.painter=e,this.layer=n,this.texture=null,this.fbo=null,this.fbos=this.painter.preFbos[this.width]&&this.painter.preFbos[this.width][this.height]}function drawExtrusion(t,e,n,r){if(!t.isOpaquePass){var i=e.getTile(r),o=i.getBucket(n);if(o){var a=o.buffers,u=t.gl,l=n.paint["fill-extrusion-pattern"],c=a.layerData[n.id],p=c.programConfiguration,h=t.useProgram(l?"fillExtrusionPattern":"fillExtrusion",p);p.setUniforms(u,h,n,{zoom:t.transform.zoom}),l&&(s.prepare(l,t,h),s.setTile(i,t,h),u.uniform1f(h.u_height_factor,-Math.pow(2,r.z)/i.tileSize/8)),t.gl.uniformMatrix4fv(h.u_matrix,!1,t.translatePosMatrix(r.posMatrix,i,n.paint["fill-extrusion-translate"],n.paint["fill-extrusion-translate-anchor"])),setLight(h,t);for(var f=0,d=a.segments;f<d.length;f+=1){var m=d[f];m.vaos[n.id].bind(u,h,a.layoutVertexBuffer,a.elementBuffer,c.paintVertexBuffer,m.vertexOffset),u.drawElements(u.TRIANGLES,3*m.primitiveLength,u.UNSIGNED_SHORT,3*m.primitiveOffset*2)}}}}function setLight(t,e){var n=e.gl,r=e.style.light,i=r.calculated.position,o=[i.x,i.y,i.z],a=u.create();"viewport"===r.calculated.anchor&&u.fromRotation(a,-e.transform.angle),c.transformMat3(o,o,a),n.uniform3fv(t.u_lightpos,o),n.uniform1f(t.u_lightintensity,r.calculated.intensity),n.uniform3fv(t.u_lightcolor,r.calculated.color.slice(0,3))}var r=t("@mapbox/gl-matrix"),i=t("../data/buffer"),o=t("./vertex_array_object"),a=t("../data/pos_array"),s=t("./pattern"),u=r.mat3,l=r.mat4,c=r.vec3;e.exports=draw,ExtrusionTexture.prototype.bindFramebuffer=function(){var t=this.gl;if(this.texture=this.painter.getViewportTexture(this.width,this.height),t.activeTexture(t.TEXTURE1),this.texture?t.bindTexture(t.TEXTURE_2D,this.texture):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),this.texture.width=this.width,this.texture.height=this.height),this.fbos)this.fbo=this.fbos.pop(),t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0);else{this.fbo=t.createFramebuffer();var e=t.createRenderbuffer(),n=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,e),t.bindRenderbuffer(t.RENDERBUFFER,n),t.renderbufferStorage(t.RENDERBUFFER,t.RGBA4,this.width,this.height),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,e),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0)}},ExtrusionTexture.prototype.unbindFramebuffer=function(){this.painter.bindDefaultFramebuffer(),this.fbos?this.fbos.push(this.fbo):(this.painter.preFbos[this.width]||(this.painter.preFbos[this.width]={}),this.painter.preFbos[this.width][this.height]=[this.fbo]),this.painter.saveViewportTexture(this.texture)},ExtrusionTexture.prototype.renderToMap=function(){var t=this.gl,e=this.painter,n=e.useProgram("extrusionTexture");t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.texture),t.uniform1f(n.u_opacity,this.layer.paint["fill-extrusion-opacity"]),t.uniform1i(n.u_texture,1),t.uniformMatrix4fv(n.u_matrix,!1,l.ortho(l.create(),0,e.width,e.height,0,0,1)),t.disable(t.DEPTH_TEST),t.uniform1i(n.u_xdim,e.width),t.uniform1i(n.u_ydim,e.height);var r=new a;r.emplaceBack(0,0),r.emplaceBack(e.width,0),r.emplaceBack(0,e.height),r.emplaceBack(e.width,e.height);var s=i.fromStructArray(r,i.BufferType.VERTEX);(new o).bind(t,n,s),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.enable(t.DEPTH_TEST)}},{"../data/buffer":8,"../data/pos_array":14,"./pattern":37,"./vertex_array_object":39,"@mapbox/gl-matrix":133}],31:[function(t,e,n){"use strict";function drawLineTile(t,e,n,o,a,s,u,l,c){var p,h,f,d,m=e.gl,y=a.paint["line-dasharray"],g=a.paint["line-pattern"];if(l||c){var v=1/i(n,1,e.transform.tileZoom);if(y){p=e.lineAtlas.getDash(y.from,"round"===a.layout["line-cap"]),h=e.lineAtlas.getDash(y.to,"round"===a.layout["line-cap"]);var _=p.width*y.fromScale,x=h.width*y.toScale;m.uniform2f(t.u_patternscale_a,v/_,-p.height/2),m.uniform2f(t.u_patternscale_b,v/x,-h.height/2),m.uniform1f(t.u_sdfgamma,e.lineAtlas.width/(256*Math.min(_,x)*r.devicePixelRatio)/2)}else if(g){if(f=e.spriteAtlas.getPosition(g.from,!0),d=e.spriteAtlas.getPosition(g.to,!0),!f||!d)return;m.uniform2f(t.u_pattern_size_a,f.size[0]*g.fromScale/v,d.size[1]),m.uniform2f(t.u_pattern_size_b,d.size[0]*g.toScale/v,d.size[1])}m.uniform2f(t.u_gl_units_to_pixels,1/e.transform.pixelsToGLUnits[0],1/e.transform.pixelsToGLUnits[1])}l&&(y?(m.uniform1i(t.u_image,0),m.activeTexture(m.TEXTURE0),e.lineAtlas.bind(m),m.uniform1f(t.u_tex_y_a,p.y),m.uniform1f(t.u_tex_y_b,h.y),m.uniform1f(t.u_mix,y.t)):g&&(m.uniform1i(t.u_image,0),m.activeTexture(m.TEXTURE0),e.spriteAtlas.bind(m,!0),m.uniform2fv(t.u_pattern_tl_a,f.tl),m.uniform2fv(t.u_pattern_br_a,f.br),m.uniform2fv(t.u_pattern_tl_b,d.tl),m.uniform2fv(t.u_pattern_br_b,d.br),m.uniform1f(t.u_fade,g.t)),m.uniform1f(t.u_width,a.paint["line-width"])),e.enableTileClippingMask(s);var b=e.translatePosMatrix(s.posMatrix,n,a.paint["line-translate"],a.paint["line-translate-anchor"]);m.uniformMatrix4fv(t.u_matrix,!1,b),m.uniform1f(t.u_ratio,1/i(n,1,e.transform.zoom));for(var w=0,S=o.segments;w<S.length;w+=1){var T=S[w];T.vaos[a.id].bind(m,t,o.layoutVertexBuffer,o.elementBuffer,u.paintVertexBuffer,T.vertexOffset),m.drawElements(m.TRIANGLES,3*T.primitiveLength,m.UNSIGNED_SHORT,3*T.primitiveOffset*2)}}var r=t("../util/browser"),i=t("../source/pixels_to_tile_units");e.exports=function(t,e,n,r){if(!t.isOpaquePass){t.setDepthSublayer(0),t.depthMask(!1);var i=t.gl;if(i.enable(i.STENCIL_TEST),!(n.paint["line-width"]<=0))for(var o,a=n.paint["line-dasharray"]?"lineSDF":n.paint["line-pattern"]?"linePattern":"line",s=!0,u=0,l=r;u<l.length;u+=1){var c=l[u],p=e.getTile(c),h=p.getBucket(n);if(h){var f=h.buffers.layerData[n.id],d=t.currentProgram,m=t.useProgram(a,f.programConfiguration),y=s||m!==d,g=o!==p.coord.z;y&&f.programConfiguration.setUniforms(t.gl,m,n,{zoom:t.transform.zoom}),drawLineTile(m,t,p,h.buffers,n,c,f,y,g),o=p.coord.z,s=!1}}}}},{"../source/pixels_to_tile_units":46,"../util/browser":110}],32:[function(t,e,n){"use strict";function drawRaster(t,e,n,r){if(!t.isOpaquePass){var i=t.gl;i.enable(i.DEPTH_TEST),t.depthMask(!0),i.depthFunc(i.LESS);for(var o=r.length&&r[0].z,a=0;a<r.length;a++){var s=r[a];t.setDepthSublayer(s.z-o),drawRasterTile(t,e,n,s)}i.depthFunc(i.LEQUAL)}}function drawRasterTile(t,e,n,r){var i=t.gl;i.disable(i.STENCIL_TEST);var o=e.getTile(r),a=t.transform.calculatePosMatrix(r,e.getSource().maxzoom);o.registerFadeDuration(t.style.animationLoop,n.paint["raster-fade-duration"]);var s=t.useProgram("raster");i.uniformMatrix4fv(s.u_matrix,!1,a),i.uniform1f(s.u_brightness_low,n.paint["raster-brightness-min"]),i.uniform1f(s.u_brightness_high,n.paint["raster-brightness-max"]),i.uniform1f(s.u_saturation_factor,saturationFactor(n.paint["raster-saturation"])),i.uniform1f(s.u_contrast_factor,contrastFactor(n.paint["raster-contrast"])),i.uniform3fv(s.u_spin_weights,spinWeights(n.paint["raster-hue-rotate"]));var u,l,c=o.sourceCache&&o.sourceCache.findLoadedParent(r,0,{}),p=getFadeValues(o,c,n,t.transform);i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o.texture),i.activeTexture(i.TEXTURE1),c?(i.bindTexture(i.TEXTURE_2D,c.texture),u=Math.pow(2,c.coord.z-o.coord.z),l=[o.coord.x*u%1,o.coord.y*u%1]):i.bindTexture(i.TEXTURE_2D,o.texture),i.uniform2fv(s.u_tl_parent,l||[0,0]),i.uniform1f(s.u_scale_parent,u||1),i.uniform1f(s.u_buffer_scale,1),i.uniform1f(s.u_fade_t,p.mix),i.uniform1f(s.u_opacity,p.opacity*n.paint["raster-opacity"]),i.uniform1i(s.u_image0,0),i.uniform1i(s.u_image1,1);var h=o.boundsBuffer||t.rasterBoundsBuffer;(o.boundsVAO||t.rasterBoundsVAO).bind(i,s,h),i.drawArrays(i.TRIANGLE_STRIP,0,h.length)}function spinWeights(t){t*=Math.PI/180;var e=Math.sin(t),n=Math.cos(t);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}function contrastFactor(t){return t>0?1/(1-t):1+t}function saturationFactor(t){return t>0?1-1/(1.001-t):-t}function getFadeValues(t,e,n,i){var o=n.paint["raster-fade-duration"];if(t.sourceCache&&o>0){var a=Date.now(),s=(a-t.timeAdded)/o,u=e?(a-e.timeAdded)/o:-1,l=t.sourceCache.getSource(),c=i.coveringZoomLevel({tileSize:l.tileSize,roundZoom:l.roundZoom}),p=!e||Math.abs(e.coord.z-c)>Math.abs(t.coord.z-c),h=r.clamp(p?s:1-u,0,1);return e?{opacity:1,mix:1-h}:{opacity:h,mix:0}}return{opacity:1,mix:0}}var r=t("../util/util");e.exports=drawRaster},{"../util/util":129}],33:[function(t,e,n){"use strict";function drawSymbols(t,e,n,r){if(!t.isOpaquePass){var o=!(n.layout["text-allow-overlap"]||n.layout["icon-allow-overlap"]||n.layout["text-ignore-placement"]||n.layout["icon-ignore-placement"]),a=t.gl;o?a.disable(a.STENCIL_TEST):a.enable(a.STENCIL_TEST),t.setDepthSublayer(0),t.depthMask(!1),drawLayerSymbols(t,e,n,r,!1,n.paint["icon-translate"],n.paint["icon-translate-anchor"],n.layout["icon-rotation-alignment"],n.layout["icon-rotation-alignment"],n.layout["icon-size"],n.paint["icon-halo-width"],n.paint["icon-halo-color"],n.paint["icon-halo-blur"],n.paint["icon-opacity"],n.paint["icon-color"]),drawLayerSymbols(t,e,n,r,!0,n.paint["text-translate"],n.paint["text-translate-anchor"],n.layout["text-rotation-alignment"],n.layout["text-pitch-alignment"],n.layout["text-size"],n.paint["text-halo-width"],n.paint["text-halo-color"],n.paint["text-halo-blur"],n.paint["text-opacity"],n.paint["text-color"]),e.map.showCollisionBoxes&&i(t,e,n,r)}}function drawLayerSymbols(t,e,n,r,i,o,a,s,u,l,c,p,h,f,d){if(i||!t.style.sprite||t.style.sprite.loaded()){var m=t.gl,y="map"===s,g="map"===u,v=g;v?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST);for(var _,x,b=0,w=r;b<w.length;b+=1){var S=w[b],T=e.getTile(S),E=T.getBucket(n);if(E){var A=i?E.buffers.glyph:E.buffers.icon;if(A&&A.segments.length){var P=i||E.sdfIcons;_&&E.fontstack===x||(_=t.useProgram(P?"symbolSDF":"symbolIcon"),setSymbolDrawState(_,t,i,P,y,g,E.fontstack,l,E.iconsNeedLinear,i?E.adjustedTextSize:E.adjustedIconSize,f)),t.enableTileClippingMask(S),m.uniformMatrix4fv(_.u_matrix,!1,t.translatePosMatrix(S.posMatrix,T,o,a)),drawTileSymbols(_,t,n,T,A,i,P,g,l,c,p,h,d),x=E.fontstack}}}v||m.enable(m.DEPTH_TEST)}}function setSymbolDrawState(t,e,n,i,o,a,s,u,l,c,p){var h=e.gl,f=e.transform;if(h.uniform1i(t.u_rotate_with_map,o),h.uniform1i(t.u_pitch_with_map,a),h.activeTexture(h.TEXTURE0),h.uniform1i(t.u_texture,0),n){var d=s&&e.glyphSource.getGlyphAtlas(s);if(!d)return;d.updateTexture(h),h.uniform2f(t.u_texsize,d.width/4,d.height/4)}else{var m=e.options.rotating||e.options.zooming,y=1!==u||r.devicePixelRatio!==e.spriteAtlas.pixelRatio||l,g=a||f.pitch;e.spriteAtlas.bind(h,i||m||y||g),h.uniform2f(t.u_texsize,e.spriteAtlas.width/4,e.spriteAtlas.height/4)}h.activeTexture(h.TEXTURE1),e.frameHistory.bind(h),h.uniform1i(t.u_fadetexture,1);var v=Math.log(u/c)/Math.LN2||0;h.uniform1f(t.u_zoom,10*(f.zoom-v)),h.uniform1f(t.u_pitch,f.pitch/360*2*Math.PI),h.uniform1f(t.u_bearing,f.bearing/360*2*Math.PI),h.uniform1f(t.u_aspect_ratio,f.width/f.height),h.uniform1f(t.u_opacity,p)}function drawTileSymbols(t,e,n,r,i,c,p,h,f,d,m,y,g){var v=e.gl,_=e.transform,x=f/(c?24:1);if(h){var b=o(r,x,_.zoom);v.uniform2f(t.u_extrude_scale,b,b)}else{var w=_.cameraToCenterDistance*x;v.uniform2f(t.u_extrude_scale,_.pixelsToGLUnits[0]*w,_.pixelsToGLUnits[1]*w)}if(p){var S=x*(h?Math.cos(_._pitch):1)*_.cameraToCenterDistance;d&&(v.uniform1f(t.u_gamma,(y*s/a+l)/S),v.uniform4fv(t.u_color,m),v.uniform1f(t.u_buffer,(u-d/x)/a),drawSymbolElements(i,n,v,t)),v.uniform1f(t.u_gamma,l/S),v.uniform4fv(t.u_color,g),v.uniform1f(t.u_buffer,.75)}drawSymbolElements(i,n,v,t)}function drawSymbolElements(t,e,n,r){for(var i=0,o=t.segments;i<o.length;i+=1){var a=o[i];a.vaos[e.id].bind(n,r,t.layoutVertexBuffer,t.elementBuffer,null,a.vertexOffset),n.drawElements(n.TRIANGLES,3*a.primitiveLength,n.UNSIGNED_SHORT,3*a.primitiveOffset*2)}}var r=t("../util/browser"),i=t("./draw_collision_debug"),o=t("../source/pixels_to_tile_units");e.exports=drawSymbols;var a=8,s=1.19,u=6,l=.105/r.devicePixelRatio},{"../source/pixels_to_tile_units":46,"../util/browser":110,"./draw_collision_debug":27}],34:[function(t,e,n){"use strict";var r=function(){this.changeTimes=new Float64Array(256),this.changeOpacities=new Uint8Array(256),this.opacities=new Uint8ClampedArray(256),this.array=new Uint8Array(this.opacities.buffer),this.previousZoom=0,this.firstFrame=!0};r.prototype.record=function(t,e,n){var r=this;this.firstFrame&&(t=0,this.firstFrame=!1),e=Math.floor(10*e);var i;if(e<this.previousZoom)for(i=e+1;i<=this.previousZoom;i++)r.changeTimes[i]=t,r.changeOpacities[i]=r.opacities[i];else for(i=e;i>this.previousZoom;i--)r.changeTimes[i]=t,r.changeOpacities[i]=r.opacities[i];for(i=0;i<256;i++){var o=t-r.changeTimes[i],a=255*(n?o/n:1);r.opacities[i]=i<=e?r.changeOpacities[i]+a:r.changeOpacities[i]-a}this.changed=!0,this.previousZoom=e},r.prototype.bind=function(t){this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.changed&&(t.texSubImage2D(t.TEXTURE_2D,0,0,0,256,1,t.ALPHA,t.UNSIGNED_BYTE,this.array),this.changed=!1)):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,256,1,0,t.ALPHA,t.UNSIGNED_BYTE,this.array))},e.exports=r},{}],35:[function(t,e,n){"use strict";var r=t("../util/util"),i=function(t,e){this.width=t,this.height=e,this.nextRow=0,this.bytes=4,this.data=new Uint8Array(this.width*this.height*this.bytes),this.positions={}};i.prototype.setSprite=function(t){this.sprite=t},i.prototype.getDash=function(t,e){var n=t.join(",")+e;return this.positions[n]||(this.positions[n]=this.addDash(t,e)),this.positions[n]},i.prototype.addDash=function(t,e){var n=this,i=e?7:0,o=2*i+1,a=128;if(this.nextRow+o>this.height)return r.warnOnce("LineAtlas out of space"),null;for(var s=0,u=0;u<t.length;u++)s+=t[u];for(var l=this.width/s,c=l/2,p=t.length%2==1,h=-i;h<=i;h++)for(var f=n.nextRow+i+h,d=n.width*f,m=p?-t[t.length-1]:0,y=t[0],g=1,v=0;v<this.width;v++){for(;y<v/l;)m=y,y+=t[g],p&&g===t.length-1&&(y+=t[0]),g++;var _,x=Math.abs(v-m*l),b=Math.abs(v-y*l),w=Math.min(x,b),S=g%2==1;if(e){var T=i?h/i*(c+1):0;if(S){var E=c-Math.abs(T);_=Math.sqrt(w*w+E*E)}else _=c-Math.sqrt(w*w+T*T)}else _=(S?1:-1)*w;n.data[3+4*(d+v)]=Math.max(0,Math.min(255,_+a))}var A={y:(this.nextRow+i+.5)/this.height,height:2*i/this.height,width:s};return this.nextRow+=o,this.dirty=!0,A},i.prototype.bind=function(t){this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,this.data))):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,this.data))},e.exports=i},{"../util/util":129}],36:[function(t,e,n){"use strict";var r=t("../util/browser"),i=t("@mapbox/gl-matrix").mat4,o=t("./frame_history"),a=t("../source/source_cache"),s=t("../data/extent"),u=t("../source/pixels_to_tile_units"),l=t("../util/util"),c=t("../data/buffer"),p=t("./vertex_array_object"),h=t("../data/raster_bounds_array"),f=t("../data/pos_array"),d=t("../data/program_configuration"),m=t("./shaders"),y={symbol:t("./draw_symbol"),circle:t("./draw_circle"),line:t("./draw_line"),fill:t("./draw_fill"),"fill-extrusion":t("./draw_fill_extrusion"),raster:t("./draw_raster"),background:t("./draw_background"),debug:t("./draw_debug")},g=function(t,e){this.gl=t,this.transform=e,this.reusableTextures={tiles:{},viewport:null},this.preFbos={},this.frameHistory=new o,this.setup(),this.numSublayers=a.maxUnderzooming+a.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.lineWidthRange=t.getParameter(t.ALIASED_LINE_WIDTH_RANGE),this.basicFillProgramConfiguration=d.createStatic(["color","opacity"]),this.emptyProgramConfiguration=new d};g.prototype.resize=function(t,e){var n=this.gl;this.width=t*r.devicePixelRatio,this.height=e*r.devicePixelRatio,n.viewport(0,0,this.width,this.height)},g.prototype.setup=function(){var t=this.gl;t.verbose=!0,t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.STENCIL_TEST),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),this._depthMask=!1,t.depthMask(!1);var e=new f;e.emplaceBack(0,0),e.emplaceBack(s,0),e.emplaceBack(0,s),e.emplaceBack(s,s),this.tileExtentBuffer=c.fromStructArray(e,c.BufferType.VERTEX),this.tileExtentVAO=new p,this.tileExtentPatternVAO=new p;var n=new f;n.emplaceBack(0,0),n.emplaceBack(s,0),n.emplaceBack(s,s),n.emplaceBack(0,s),n.emplaceBack(0,0),this.debugBuffer=c.fromStructArray(n,c.BufferType.VERTEX),this.debugVAO=new p;var r=new h;r.emplaceBack(0,0,0,0),r.emplaceBack(s,0,32767,0),r.emplaceBack(0,s,0,32767),r.emplaceBack(s,s,32767,32767),this.rasterBoundsBuffer=c.fromStructArray(r,c.BufferType.VERTEX),this.rasterBoundsVAO=new p},g.prototype.clearColor=function(){var t=this.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},g.prototype.clearStencil=function(){var t=this.gl;t.clearStencil(0),t.stencilMask(255),t.clear(t.STENCIL_BUFFER_BIT)},g.prototype.clearDepth=function(){var t=this.gl;t.clearDepth(1),this.depthMask(!0),t.clear(t.DEPTH_BUFFER_BIT)},g.prototype._renderTileClippingMasks=function(t){var e=this,n=this.gl;n.colorMask(!1,!1,!1,!1),this.depthMask(!1),n.disable(n.DEPTH_TEST),n.enable(n.STENCIL_TEST),n.stencilMask(248),n.stencilOp(n.KEEP,n.KEEP,n.REPLACE);var r=1;this._tileClippingMaskIDs={};for(var i=0,o=t;i<o.length;i+=1){var a=o[i],s=e._tileClippingMaskIDs[a.id]=r++<<3;n.stencilFunc(n.ALWAYS,s,248);var u=e.useProgram("fill",e.basicFillProgramConfiguration);n.uniformMatrix4fv(u.u_matrix,!1,a.posMatrix),e.tileExtentVAO.bind(n,u,e.tileExtentBuffer),n.drawArrays(n.TRIANGLE_STRIP,0,e.tileExtentBuffer.length)}n.stencilMask(0),n.colorMask(!0,!0,!0,!0),this.depthMask(!0),n.enable(n.DEPTH_TEST)},g.prototype.enableTileClippingMask=function(t){var e=this.gl;e.stencilFunc(e.EQUAL,this._tileClippingMaskIDs[t.id],248)},g.prototype.prepareBuffers=function(){},g.prototype.bindDefaultFramebuffer=function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,null)},g.prototype.render=function(t,e){if(this.style=t,this.options=e,this.lineAtlas=t.lineAtlas,this.spriteAtlas=t.spriteAtlas,this.spriteAtlas.setSprite(t.sprite),this.glyphSource=t.glyphSource,this.frameHistory.record(Date.now(),this.transform.zoom,t.getTransition().duration),this.prepareBuffers(),this.clearColor(),this.clearDepth(),this.showOverdrawInspector(e.showOverdrawInspector),this.depthRange=(t._order.length+2)*this.numSublayers*this.depthEpsilon,this.isOpaquePass=!0,this.renderPass(),this.isOpaquePass=!1,this.renderPass(),this.options.showTileBoundaries){var n=this.style.sourceCaches[Object.keys(this.style.sourceCaches)[0]];n&&y.debug(this,n,n.getVisibleCoordinates())}},g.prototype.renderPass=function(){var t,e,n=this,r=this.style._order;this.currentLayer=this.isOpaquePass?r.length-1:0,this.isOpaquePass?this._showOverdrawInspector||this.gl.disable(this.gl.BLEND):this.gl.enable(this.gl.BLEND);for(var i=0;i<r.length;i++){var o=n.style._layers[r[n.currentLayer]];o.source!==(t&&t.id)&&(t=n.style.sourceCaches[o.source],e=[],t&&(t.prepare&&t.prepare(),n.clearStencil(),e=t.getVisibleCoordinates(),t.getSource().isTileClipped&&n._renderTileClippingMasks(e)),n.isOpaquePass||e.reverse()),n.renderLayer(n,t,o,e),n.currentLayer+=n.isOpaquePass?-1:1}},g.prototype.depthMask=function(t){t!==this._depthMask&&(this._depthMask=t,this.gl.depthMask(t))},g.prototype.renderLayer=function(t,e,n,r){n.isHidden(this.transform.zoom)||("background"===n.type||r.length)&&(this.id=n.id,y[n.type](t,e,n,r))},g.prototype.setDepthSublayer=function(t){var e=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon,n=e-1+this.depthRange;this.gl.depthRange(n,e)},g.prototype.translatePosMatrix=function(t,e,n,r){if(!n[0]&&!n[1])return t;if("viewport"===r){var o=Math.sin(-this.transform.angle),a=Math.cos(-this.transform.angle);n=[n[0]*a-n[1]*o,n[0]*o+n[1]*a]}var s=[u(e,n[0],this.transform.zoom),u(e,n[1],this.transform.zoom),0],l=new Float32Array(16);return i.translate(l,t,s),l},g.prototype.saveTileTexture=function(t){var e=this.reusableTextures.tiles[t.size];e?e.push(t):this.reusableTextures.tiles[t.size]=[t]},g.prototype.saveViewportTexture=function(t){this.reusableTextures.viewport=t},g.prototype.getTileTexture=function(t){var e=this.reusableTextures.tiles[t];return e&&e.length>0?e.pop():null},g.prototype.getViewportTexture=function(t,e){var n=this.reusableTextures.viewport;if(n)return n.width===t&&n.height===e?n:(this.gl.deleteTexture(n),void(this.reusableTextures.viewport=null))},g.prototype.lineWidth=function(t){this.gl.lineWidth(l.clamp(t,this.lineWidthRange[0],this.lineWidthRange[1]))},g.prototype.showOverdrawInspector=function(t){if(t||this._showOverdrawInspector){this._showOverdrawInspector=t;var e=this.gl;if(t){e.blendFunc(e.CONSTANT_COLOR,e.ONE);var n=8,r=1/n;e.blendColor(r,r,r,0),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT)}else e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA)}},g.prototype.createProgram=function(t,e){var n=this.gl,i=n.createProgram(),o=m[t],a="#define MAPBOX_GL_JS\n#define DEVICE_PIXEL_RATIO "+r.devicePixelRatio.toFixed(1)+"\n";this._showOverdrawInspector&&(a+="#define OVERDRAW_INSPECTOR;\n");var s=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(s,e.applyPragmas(a+m.prelude.fragmentSource+o.fragmentSource,"fragment")),n.compileShader(s),n.attachShader(i,s);var u=n.createShader(n.VERTEX_SHADER);n.shaderSource(u,e.applyPragmas(a+m.prelude.vertexSource+o.vertexSource,"vertex")),n.compileShader(u),n.attachShader(i,u),n.linkProgram(i);for(var l=n.getProgramParameter(i,n.ACTIVE_ATTRIBUTES),c={program:i,numAttributes:l},p=0;p<l;p++){var h=n.getActiveAttrib(i,p);c[h.name]=n.getAttribLocation(i,h.name)}for(var f=n.getProgramParameter(i,n.ACTIVE_UNIFORMS),d=0;d<f;d++){var y=n.getActiveUniform(i,d);c[y.name]=n.getUniformLocation(i,y.name)}return c},g.prototype._createProgramCached=function(t,e){this.cache=this.cache||{};var n=""+t+(e.cacheKey||"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[n]||(this.cache[n]=this.createProgram(t,e)),this.cache[n]},g.prototype.useProgram=function(t,e){var n=this.gl,r=this._createProgramCached(t,e||this.emptyProgramConfiguration);return this.currentProgram!==r&&(n.useProgram(r.program),this.currentProgram=r),r},e.exports=g},{"../data/buffer":8,"../data/extent":11,"../data/pos_array":14,"../data/program_configuration":15,"../data/raster_bounds_array":16,"../source/pixels_to_tile_units":46,"../source/source_cache":51,"../util/browser":110,"../util/util":129,"./draw_background":25,"./draw_circle":26,"./draw_debug":28,"./draw_fill":29,"./draw_fill_extrusion":30,"./draw_line":31,"./draw_raster":32,"./draw_symbol":33,"./frame_history":34,"./shaders":38,"./vertex_array_object":39,"@mapbox/gl-matrix":133}],37:[function(t,e,n){"use strict";var r=t("../source/pixels_to_tile_units");n.prepare=function(t,e,n){var r=e.gl,i=e.spriteAtlas.getPosition(t.from,!0),o=e.spriteAtlas.getPosition(t.to,!0);i&&o&&(r.uniform1i(n.u_image,0),r.uniform2fv(n.u_pattern_tl_a,i.tl),r.uniform2fv(n.u_pattern_br_a,i.br),r.uniform2fv(n.u_pattern_tl_b,o.tl),r.uniform2fv(n.u_pattern_br_b,o.br),r.uniform1f(n.u_mix,t.t),r.uniform2fv(n.u_pattern_size_a,i.size),r.uniform2fv(n.u_pattern_size_b,o.size),r.uniform1f(n.u_scale_a,t.fromScale),r.uniform1f(n.u_scale_b,t.toScale),r.activeTexture(r.TEXTURE0),e.spriteAtlas.bind(r,!0))},n.setTile=function(t,e,n){var i=e.gl;i.uniform1f(n.u_tile_units_to_pixels,1/r(t,1,e.transform.tileZoom));var o=Math.pow(2,t.coord.z),a=t.tileSize*Math.pow(2,e.transform.tileZoom)/o,s=a*(t.coord.x+t.coord.w*o),u=a*t.coord.y;i.uniform2f(n.u_pixel_coord_upper,s>>16,u>>16),i.uniform2f(n.u_pixel_coord_lower,65535&s,65535&u)}},{"../source/pixels_to_tile_units":46}],38:[function(t,e,n){"use strict";t("path");e.exports={prelude:{fragmentSource:"#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n",vertexSource:"#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\nfloat evaluate_zoom_function_1(const vec4 values, const float t) {\n    if (t < 1.0) {\n        return mix(values[0], values[1], t);\n    } else if (t < 2.0) {\n        return mix(values[1], values[2], t - 1.0);\n    } else {\n        return mix(values[2], values[3], t - 2.0);\n    }\n}\nvec4 evaluate_zoom_function_4(const vec4 value0, const vec4 value1, const vec4 value2, const vec4 value3, const float t) {\n    if (t < 1.0) {\n        return mix(value0, value1, t);\n    } else if (t < 2.0) {\n        return mix(value1, value2, t - 1.0);\n    } else {\n        return mix(value2, value3, t - 2.0);\n    }\n}\n\n// The offset depends on how many pixels are between the world origin and the edge of the tile:\n// vec2 offset = mod(pixel_coord, size)\n//\n// At high zoom levels there are a ton of pixels between the world origin and the edge of the tile.\n// The glsl spec only guarantees 16 bits of precision for highp floats. We need more than that.\n//\n// The pixel_coord is passed in as two 16 bit values:\n// pixel_coord_upper = floor(pixel_coord / 2^16)\n// pixel_coord_lower = mod(pixel_coord, 2^16)\n//\n// The offset is calculated in a series of steps that should preserve this precision:\nvec2 get_pattern_pos(const vec2 pixel_coord_upper, const vec2 pixel_coord_lower,\n    const vec2 pattern_size, const float tile_units_to_pixels, const vec2 pos) {\n\n    vec2 offset = mod(mod(mod(pixel_coord_upper, pattern_size) * 256.0, pattern_size) * 256.0 + pixel_coord_lower, pattern_size);\n    return (tile_units_to_pixels * pos + offset) / pattern_size;\n}\n"},circle:{fragmentSource:"#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\n\nvarying vec2 v_extrude;\nvarying lowp float v_antialiasblur;\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize mediump float radius\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp vec4 stroke_color\n    #pragma mapbox: initialize mediump float stroke_width\n    #pragma mapbox: initialize lowp float stroke_opacity\n\n    float extrude_length = length(v_extrude);\n    float antialiased_blur = -max(blur, v_antialiasblur);\n\n    float opacity_t = smoothstep(0.0, antialiased_blur, extrude_length - 1.0);\n\n    float color_t = stroke_width < 0.01 ? 0.0 : smoothstep(\n        antialiased_blur,\n        0.0,\n        extrude_length - radius / (radius + stroke_width)\n    );\n\n    gl_FragColor = opacity_t * mix(color * opacity, stroke_color * stroke_opacity, color_t);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform bool u_scale_with_map;\nuniform vec2 u_extrude_scale;\n\nattribute vec2 a_pos;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\n\nvarying vec2 v_extrude;\nvarying lowp float v_antialiasblur;\n\nvoid main(void) {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize mediump float radius\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp vec4 stroke_color\n    #pragma mapbox: initialize mediump float stroke_width\n    #pragma mapbox: initialize lowp float stroke_opacity\n\n    // unencode the extrusion vector that we snuck into the a_pos vector\n    v_extrude = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n\n    vec2 extrude = v_extrude * (radius + stroke_width) * u_extrude_scale;\n    // multiply a_pos by 0.5, since we had it * 2 in order to sneak\n    // in extrusion data\n    gl_Position = u_matrix * vec4(floor(a_pos * 0.5), 0, 1);\n\n    if (u_scale_with_map) {\n        gl_Position.xy += extrude;\n    } else {\n        gl_Position.xy += extrude * gl_Position.w;\n    }\n\n    // This is a minimum blur distance that serves as a faux-antialiasing for\n    // the circle. since blur is a ratio of the circle's size and the intent is\n    // to keep the blur at roughly 1px, the two are inversely related.\n    v_antialiasblur = 1.0 / DEVICE_PIXEL_RATIO / (radius + stroke_width);\n}\n"},collisionBox:{fragmentSource:"uniform float u_zoom;\nuniform float u_maxzoom;\n\nvarying float v_max_zoom;\nvarying float v_placement_zoom;\n\nvoid main() {\n\n    float alpha = 0.5;\n\n    gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0) * alpha;\n\n    if (v_placement_zoom > u_zoom) {\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0) * alpha;\n    }\n\n    if (u_zoom >= v_max_zoom) {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0) * alpha * 0.25;\n    }\n\n    if (v_placement_zoom >= u_maxzoom) {\n        gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0) * alpha * 0.2;\n    }\n}\n",vertexSource:"attribute vec2 a_pos;\nattribute vec2 a_extrude;\nattribute vec2 a_data;\n\nuniform mat4 u_matrix;\nuniform float u_scale;\n\nvarying float v_max_zoom;\nvarying float v_placement_zoom;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos + a_extrude / u_scale, 0.0, 1.0);\n\n    v_max_zoom = a_data.x;\n    v_placement_zoom = a_data.y;\n}\n"},debug:{fragmentSource:"uniform lowp vec4 u_color;\n\nvoid main() {\n    gl_FragColor = u_color;\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, step(32767.0, a_pos.x), 1);\n}\n"},fill:{fragmentSource:"#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_FragColor = color * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},fillOutline:{fragmentSource:"#pragma mapbox: define lowp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n\nvarying vec2 v_pos;\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 outline_color\n    #pragma mapbox: initialize lowp float opacity\n\n    float dist = length(v_pos - gl_FragCoord.xy);\n    float alpha = smoothstep(1.0, 0.0, dist);\n    gl_FragColor = outline_color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\nuniform vec2 u_world;\n\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 outline_color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\n}\n"},fillOutlinePattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a, u_pattern_br_a, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b, u_pattern_br_b, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    // find distance to outline for alpha interpolation\n\n    float dist = length(v_pos - gl_FragCoord.xy);\n    float alpha = smoothstep(1.0, 0.0, dist);\n\n\n    gl_FragColor = mix(color1, color2, u_mix) * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_world;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\n}\n"},fillPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a, u_pattern_br_a, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b, u_pattern_br_b, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    gl_FragColor = mix(color1, color2, u_mix) * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n}\n"},fillExtrusion:{fragmentSource:"varying vec4 v_color;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 color\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n    #pragma mapbox: initialize lowp vec4 color\n\n    gl_FragColor = v_color;\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\nuniform lowp vec4 u_outline_color;\n\nattribute vec2 a_pos;\nattribute vec3 a_normal;\nattribute float a_edgedistance;\n\nvarying vec4 v_color;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\n#pragma mapbox: define lowp vec4 color\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n    #pragma mapbox: initialize lowp vec4 color\n\n    float ed = a_edgedistance; // use each attrib in order to not trip a VAO assert\n    float t = mod(a_normal.x, 2.0);\n\n    gl_Position = u_matrix * vec4(a_pos, t > 0.0 ? height : base, 1);\n\n#ifdef OUTLINE\n    color = u_outline_color;\n#endif\n\n    // Relative luminance (how dark/bright is the surface color?)\n    float colorvalue = color.r * 0.2126 + color.g * 0.7152 + color.b * 0.0722;\n\n    v_color = vec4(0.0, 0.0, 0.0, 1.0);\n\n    // Add slight ambient lighting so no extrusions are totally black\n    vec4 ambientlight = vec4(0.03, 0.03, 0.03, 1.0);\n    color += ambientlight;\n\n    // Calculate cos(theta), where theta is the angle between surface normal and diffuse light ray\n    float directional = clamp(dot(a_normal / 16384.0, u_lightpos), 0.0, 1.0);\n\n    // Adjust directional so that\n    // the range of values for highlight/shading is narrower\n    // with lower light intensity\n    // and with lighter/brighter surface colors\n    directional = mix((1.0 - u_lightintensity), max((1.0 - colorvalue + u_lightintensity), 1.0), directional);\n\n    // Add gradient along z axis of side surfaces\n    if (a_normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    // Assign final color based on surface + ambient light color, diffuse light directional, and light color\n    // with lower bounds adjusted to hue of light\n    // so that shading is tinted with the complementary (opposite) color to the light color\n    v_color.r += clamp(color.r * directional * u_lightcolor.r, mix(0.0, 0.3, 1.0 - u_lightcolor.r), 1.0);\n    v_color.g += clamp(color.g * directional * u_lightcolor.g, mix(0.0, 0.3, 1.0 - u_lightcolor.g), 1.0);\n    v_color.b += clamp(color.b * directional * u_lightcolor.b, mix(0.0, 0.3, 1.0 - u_lightcolor.b), 1.0);\n}\n"},fillExtrusionPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a, u_pattern_br_a, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b, u_pattern_br_b, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    vec4 mixedColor = mix(color1, color2, u_mix);\n\n    gl_FragColor = mixedColor * v_lighting;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\nuniform float u_height_factor;\n\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\n\nattribute vec2 a_pos;\nattribute vec3 a_normal;\nattribute float a_edgedistance;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\nvarying float v_directional;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n\n    float t = mod(a_normal.x, 2.0);\n    float z = t > 0.0 ? height : base;\n\n    gl_Position = u_matrix * vec4(a_pos, z, 1);\n\n    vec2 pos = a_normal.x == 1.0 && a_normal.y == 0.0 && a_normal.z == 16384.0\n        ? a_pos // extrusion top\n        : vec2(a_edgedistance, z * u_height_factor); // extrusion side\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, pos);\n\n    v_lighting = vec4(0.0, 0.0, 0.0, 1.0);\n    float directional = clamp(dot(a_normal / 16383.0, u_lightpos), 0.0, 1.0);\n    directional = mix((1.0 - u_lightintensity), max((0.5 + u_lightintensity), 1.0), directional);\n\n    if (a_normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    v_lighting.rgb += clamp(directional * u_lightcolor, mix(vec3(0.0), vec3(0.3), 1.0 - u_lightcolor), vec3(1.0));\n}\n"},extrusionTexture:{fragmentSource:"uniform sampler2D u_texture;\nuniform float u_opacity;\n\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_FragColor = texture2D(u_texture, v_pos) * u_opacity;\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform int u_xdim;\nuniform int u_ydim;\nattribute vec2 a_pos;\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos.x = a_pos.x / float(u_xdim);\n    v_pos.y = 1.0 - a_pos.y / float(u_ydim);\n}\n"},line:{fragmentSource:"#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvarying vec2 v_width2;\nvarying vec2 v_normal;\nvarying float v_gamma_scale;\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\n// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform mediump float u_width;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize mediump float gapwidth\n    #pragma mapbox: initialize lowp float offset\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset; \n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_width2 = vec2(outset, inset);\n}\n"},linePattern:{fragmentSource:"uniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_fade;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float x_a = mod(v_linesofar / u_pattern_size_a.x, 1.0);\n    float x_b = mod(v_linesofar / u_pattern_size_b.x, 1.0);\n    float y_a = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_a.y);\n    float y_b = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_b.y);\n    vec2 pos_a = mix(u_pattern_tl_a, u_pattern_br_a, vec2(x_a, y_a));\n    vec2 pos_b = mix(u_pattern_tl_b, u_pattern_br_b, vec2(x_b, y_b));\n\n    vec4 color = mix(texture2D(u_image, pos_a), texture2D(u_image, pos_b), u_fade);\n\n    gl_FragColor = color * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform mediump float u_width;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n\nvoid main() {\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp float offset\n    #pragma mapbox: initialize mediump float gapwidth\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset; \n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_linesofar = a_linesofar;\n    v_width2 = vec2(outset, inset);\n}\n"},lineSDF:{fragmentSource:"\nuniform sampler2D u_image;\nuniform float u_sdfgamma;\nuniform float u_mix;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float sdfdist_a = texture2D(u_image, v_tex_a).a;\n    float sdfdist_b = texture2D(u_image, v_tex_b).a;\n    float sdfdist = mix(sdfdist_a, sdfdist_b, u_mix);\n    alpha *= smoothstep(0.5 - u_sdfgamma, 0.5 + u_sdfgamma, sdfdist);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_patternscale_a;\nuniform float u_tex_y_a;\nuniform vec2 u_patternscale_b;\nuniform float u_tex_y_b;\nuniform vec2 u_gl_units_to_pixels;\nuniform mediump float u_width;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize mediump float gapwidth\n    #pragma mapbox: initialize lowp float offset\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset;\n \n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist =outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_tex_a = vec2(a_linesofar * u_patternscale_a.x, normal.y * u_patternscale_a.y + u_tex_y_a);\n    v_tex_b = vec2(a_linesofar * u_patternscale_b.x, normal.y * u_patternscale_b.y + u_tex_y_b);\n\n    v_width2 = vec2(outset, inset);\n}\n"},raster:{fragmentSource:"uniform float u_fade_t;\nuniform float u_opacity;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 v_pos0;\nvarying vec2 v_pos1;\n\nuniform float u_brightness_low;\nuniform float u_brightness_high;\n\nuniform float u_saturation_factor;\nuniform float u_contrast_factor;\nuniform vec3 u_spin_weights;\n\nvoid main() {\n\n    // read and cross-fade colors from the main and parent tiles\n    vec4 color0 = texture2D(u_image0, v_pos0);\n    vec4 color1 = texture2D(u_image1, v_pos1);\n    vec4 color = mix(color0, color1, u_fade_t);\n    color.a *= u_opacity;\n    vec3 rgb = color.rgb;\n\n    // spin\n    rgb = vec3(\n        dot(rgb, u_spin_weights.xyz),\n        dot(rgb, u_spin_weights.zxy),\n        dot(rgb, u_spin_weights.yzx));\n\n    // saturation\n    float average = (color.r + color.g + color.b) / 3.0;\n    rgb += (average - rgb) * u_saturation_factor;\n\n    // contrast\n    rgb = (rgb - 0.5) * u_contrast_factor + 0.5;\n\n    // brightness\n    vec3 u_high_vec = vec3(u_brightness_low, u_brightness_low, u_brightness_low);\n    vec3 u_low_vec = vec3(u_brightness_high, u_brightness_high, u_brightness_high);\n\n    gl_FragColor = vec4(mix(u_high_vec, u_low_vec, rgb) * color.a, color.a);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_tl_parent;\nuniform float u_scale_parent;\nuniform float u_buffer_scale;\n\nattribute vec2 a_pos;\nattribute vec2 a_texture_pos;\n\nvarying vec2 v_pos0;\nvarying vec2 v_pos1;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos0 = (((a_texture_pos / 32767.0) - 0.5) / u_buffer_scale ) + 0.5;\n    v_pos1 = (v_pos0 * u_scale_parent) + u_tl_parent;\n}\n"},symbolIcon:{fragmentSource:"uniform sampler2D u_texture;\nuniform sampler2D u_fadetexture;\nuniform lowp float u_opacity;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\n\nvoid main() {\n    lowp float alpha = texture2D(u_fadetexture, v_fade_tex).a * u_opacity;\n    gl_FragColor = texture2D(u_texture, v_tex) * alpha;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_texture_pos;\nattribute vec4 a_data;\n\n\n// matrix is for the vertex position.\nuniform mat4 u_matrix;\n\nuniform mediump float u_zoom;\nuniform bool u_rotate_with_map;\nuniform vec2 u_extrude_scale;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\n\nvoid main() {\n    vec2 a_tex = a_texture_pos.xy;\n    mediump float a_labelminzoom = a_data[0];\n    mediump vec2 a_zoom = a_data.pq;\n    mediump float a_minzoom = a_zoom[0];\n    mediump float a_maxzoom = a_zoom[1];\n\n    // u_zoom is the current zoom level adjusted for the change in font size\n    mediump float z = 2.0 - step(a_minzoom, u_zoom) - (1.0 - step(a_maxzoom, u_zoom));\n\n    vec2 extrude = u_extrude_scale * (a_offset / 64.0);\n    if (u_rotate_with_map) {\n        gl_Position = u_matrix * vec4(a_pos + extrude, 0, 1);\n        gl_Position.z += z * gl_Position.w;\n    } else {\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n    }\n\n    v_tex = a_tex / u_texsize;\n    v_fade_tex = vec2(a_labelminzoom / 255.0, 0.0);\n}\n"},symbolSDF:{fragmentSource:"uniform sampler2D u_texture;\nuniform sampler2D u_fadetexture;\nuniform lowp vec4 u_color;\nuniform lowp float u_opacity;\nuniform lowp float u_buffer;\nuniform lowp float u_gamma;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\nvarying float v_gamma_scale;\n\nvoid main() {\n    lowp float dist = texture2D(u_texture, v_tex).a;\n    lowp float fade_alpha = texture2D(u_fadetexture, v_fade_tex).a;\n    lowp float gamma = u_gamma * v_gamma_scale;\n    lowp float alpha = smoothstep(u_buffer - gamma, u_buffer + gamma, dist) * fade_alpha;\n\n    gl_FragColor = u_color * (alpha * u_opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"const float PI = 3.141592653589793;\n\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_texture_pos;\nattribute vec4 a_data;\n\n\n// matrix is for the vertex position.\nuniform mat4 u_matrix;\n\nuniform mediump float u_zoom;\nuniform bool u_rotate_with_map;\nuniform bool u_pitch_with_map;\nuniform mediump float u_pitch;\nuniform mediump float u_bearing;\nuniform mediump float u_aspect_ratio;\nuniform vec2 u_extrude_scale;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\nvarying float v_gamma_scale;\n\nvoid main() {\n    vec2 a_tex = a_texture_pos.xy;\n    mediump float a_labelminzoom = a_data[0];\n    mediump vec2 a_zoom = a_data.pq;\n    mediump float a_minzoom = a_zoom[0];\n    mediump float a_maxzoom = a_zoom[1];\n\n    // u_zoom is the current zoom level adjusted for the change in font size\n    mediump float z = 2.0 - step(a_minzoom, u_zoom) - (1.0 - step(a_maxzoom, u_zoom));\n\n    // pitch-alignment: map\n    // rotation-alignment: map | viewport\n    if (u_pitch_with_map) {\n        lowp float angle = u_rotate_with_map ? (a_data[1] / 256.0 * 2.0 * PI) : u_bearing;\n        lowp float asin = sin(angle);\n        lowp float acos = cos(angle);\n        mat2 RotationMatrix = mat2(acos, asin, -1.0 * asin, acos);\n        vec2 offset = RotationMatrix * a_offset;\n        vec2 extrude = u_extrude_scale * (offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos + extrude, 0, 1);\n        gl_Position.z += z * gl_Position.w;\n    // pitch-alignment: viewport\n    // rotation-alignment: map\n    } else if (u_rotate_with_map) {\n        // foreshortening factor to apply on pitched maps\n        // as a label goes from horizontal <=> vertical in angle\n        // it goes from 0% foreshortening to up to around 70% foreshortening\n        lowp float pitchfactor = 1.0 - cos(u_pitch * sin(u_pitch * 0.75));\n\n        lowp float lineangle = a_data[1] / 256.0 * 2.0 * PI;\n\n        // use the lineangle to position points a,b along the line\n        // project the points and calculate the label angle in projected space\n        // this calculation allows labels to be rendered unskewed on pitched maps\n        vec4 a = u_matrix * vec4(a_pos, 0, 1);\n        vec4 b = u_matrix * vec4(a_pos + vec2(cos(lineangle),sin(lineangle)), 0, 1);\n        lowp float angle = atan((b[1]/b[3] - a[1]/a[3])/u_aspect_ratio, b[0]/b[3] - a[0]/a[3]);\n        lowp float asin = sin(angle);\n        lowp float acos = cos(angle);\n        mat2 RotationMatrix = mat2(acos, -1.0 * asin, asin, acos);\n\n        vec2 offset = RotationMatrix * (vec2((1.0-pitchfactor)+(pitchfactor*cos(angle*2.0)), 1.0) * a_offset);\n        vec2 extrude = u_extrude_scale * (offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n        gl_Position.z += z * gl_Position.w;\n    // pitch-alignment: viewport\n    // rotation-alignment: viewport\n    } else {\n        vec2 extrude = u_extrude_scale * (a_offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n    }\n\n    v_gamma_scale = gl_Position.w;\n\n    v_tex = a_tex / u_texsize;\n    v_fade_tex = vec2(a_labelminzoom / 255.0, 0.0);\n}\n"}}},{path:194}],39:[function(t,e,n){"use strict";var r=function(){this.boundProgram=null,this.boundVertexBuffer=null,this.boundVertexBuffer2=null,this.boundElementBuffer=null,this.boundVertexOffset=null,this.vao=null};r.prototype.bind=function(t,e,n,r,i,o){void 0===t.extVertexArrayObject&&(t.extVertexArrayObject=t.getExtension("OES_vertex_array_object"));var a=!this.vao||this.boundProgram!==e||this.boundVertexBuffer!==n||this.boundVertexBuffer2!==i||this.boundElementBuffer!==r||this.boundVertexOffset!==o;!t.extVertexArrayObject||a?(this.freshBind(t,e,n,r,i,o),this.gl=t):t.extVertexArrayObject.bindVertexArrayOES(this.vao)},r.prototype.freshBind=function(t,e,n,r,i,o){var a,s=e.numAttributes;if(t.extVertexArrayObject)this.vao&&this.destroy(),this.vao=t.extVertexArrayObject.createVertexArrayOES(),t.extVertexArrayObject.bindVertexArrayOES(this.vao),a=0,this.boundProgram=e,this.boundVertexBuffer=n,this.boundVertexBuffer2=i,this.boundElementBuffer=r,this.boundVertexOffset=o;else{a=t.currentNumAttributes||0;for(var u=s;u<a;u++)t.disableVertexAttribArray(u)}for(var l=a;l<s;l++)t.enableVertexAttribArray(l);n.bind(t),n.setVertexAttribPointers(t,e,o),i&&(i.bind(t),i.setVertexAttribPointers(t,e,o)),r&&r.bind(t),t.currentNumAttributes=s},r.prototype.destroy=function(){this.vao&&(this.gl.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)},e.exports=r},{}],40:[function(t,e,n){"use strict";var r=t("./image_source"),o=t("../util/window"),a=function(t){function i(e,n,r,i){t.call(this,e,n,r,i),this.options=n,this.animate=!n.hasOwnProperty("animate")||n.animate}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.load=function(){if(this.canvas=this.canvas||o.document.getElementById(this.options.canvas),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions(this.canvas))return this.fire("error",new Error("Canvas dimensions cannot be less than or equal to zero."));var t;this.play=function(){t=this.map.style.animationLoop.set(1/0),this.map._rerender()},this.pause=function(){this.map.style.animationLoop.cancel(t)},this._finishLoading()},i.prototype.getCanvas=function(){return this.canvas},i.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.canvas&&(this.animate&&this.play(),this.setCoordinates(this.coordinates)))},i.prototype.prepare=function(){var t=!1;this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||this.tile&&this._prepareImage(this.map.painter.gl,this.canvas,t)},i.prototype.serialize=function(){return{type:"canvas",canvas:this.canvas,coordinates:this.coordinates}},i.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var n=e[t];if(isNaN(n)||n<=0)return!0}return!1},i}(r);e.exports=a},{"../util/window":112,"./image_source":44}],41:[function(t,n,r){"use strict";function resolveURL(t){var e=a.document.createElement("a");return e.href=t,e.href}var i=t("../util/evented"),o=t("../util/util"),a=t("../util/window"),s=t("../data/extent"),u=function(t){function e(e,n,r,i){t.call(this),n=n||{},this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this.dispatcher=r,this.setEventedParent(i),this._data=n.data,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type);var a=s/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*a,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*a,extent:s,maxZoom:this.maxzoom},superclusterOptions:{maxZoom:Math.min(n.clusterMaxZoom,this.maxzoom-1)||this.maxzoom-1,extent:s,radius:(n.clusterRadius||50)*a,log:!1}},n.workerOptions)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;this.fire("dataloading",{dataType:"source"}),this._updateWorkerData(function(e){return e?void t.fire("error",{error:e}):(t.fire("data",{dataType:"source"}),void t.fire("source.load"))})},e.prototype.onAdd=function(t){this.load(),this.map=t},e.prototype.setData=function(t){var e=this;return this._data=t,this.fire("dataloading",{dataType:"source"}),this._updateWorkerData(function(t){return t?e.fire("error",{error:t}):void e.fire("data",{dataType:"source"})}),this},e.prototype._updateWorkerData=function(t){var e=this,n=o.extend({},this.workerOptions),r=this._data;"string"==typeof r?n.url=resolveURL(r):n.data=JSON.stringify(r),this.workerID=this.dispatcher.send(this.type+".loadData",n,function(n){e._loaded=!0,t(n)})},e.prototype.loadTile=function(t,e){var n=this,r=t.coord.z>this.maxzoom?Math.pow(2,t.coord.z-this.maxzoom):1,i={type:this.type,uid:t.uid,coord:t.coord,zoom:t.coord.z,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,overscaling:r,angle:this.map.transform.angle,pitch:this.map.transform.pitch,showCollisionBoxes:this.map.showCollisionBoxes};t.workerID=this.dispatcher.send("loadTile",i,function(r,i){if(t.unloadVectorData(),!t.aborted)return r?e(r):(t.loadVectorData(i,n.map.painter),t.redoWhenDone&&(t.redoWhenDone=!1,t.redoPlacement(n)),e(null))},this.workerID)},e.prototype.abortTile=function(t){t.aborted=!0},e.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},function(){},t.workerID)},e.prototype.onRemove=function(){this.dispatcher.broadcast("removeSource",{type:this.type,source:this.id},function(){})},e.prototype.serialize=function(){return{type:this.type,data:this._data}},e}(i);n.exports=u},{"../data/extent":11,"../util/evented":118,"../util/util":129,"../util/window":112}],42:[function(t,e,n){"use strict";var i=t("../util/ajax"),o=t("geojson-rewind"),a=t("./geojson_wrapper"),s=t("vt-pbf"),u=t("supercluster"),l=t("geojson-vt"),c=t("./vector_tile_worker_source"),p=function(t){function r(e,n,r){t.call(this,e,n),r&&(this.loadGeoJSON=r),this._geoJSONIndexes={}}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype.loadVectorData=function(t,e){var n=t.source,r=t.coord;if(!this._geoJSONIndexes[n])return e(null,null);var i=this._geoJSONIndexes[n].getTile(Math.min(r.z,t.maxZoom),r.x,r.y);if(!i)return e(null,null);var o=new a(i.features);o.name="_geojsonTileLayer";var u=s({layers:{_geojsonTileLayer:o}});0===u.byteOffset&&u.byteLength===u.buffer.byteLength||(u=new Uint8Array(u)),o.rawData=u.buffer,e(null,o)},r.prototype.loadData=function(t,e){var n=function(n,r){var i=this;return n?e(n):"object"!=typeof r?e(new Error("Input data is not a valid GeoJSON object.")):(o(r,!0),void this._indexData(r,t,function(n,r){return n?e(n):(i._geoJSONIndexes[t.source]=r,void e(null))}))}.bind(this);this.loadGeoJSON(t,n)},r.prototype.loadGeoJSON=function(t,e){if(t.url)i.getJSON(t.url,e);else{if("string"!=typeof t.data)return e(new Error("Input data is not a valid GeoJSON object."));try{return e(null,JSON.parse(t.data))}catch(t){return e(new Error("Input data is not a valid GeoJSON object."))}}},r.prototype.removeSource=function(t){this._geoJSONIndexes[t.source]&&delete this._geoJSONIndexes[t.source]},r.prototype._indexData=function(t,e,n){try{e.cluster?n(null,u(e.superclusterOptions).load(t.features)):n(null,l(t,e.geojsonVtOptions))}catch(t){return n(t)}},r}(c);e.exports=p},{"../util/ajax":109,"./geojson_wrapper":43,"./vector_tile_worker_source":55,"geojson-rewind":140,"geojson-vt":144,supercluster:201,"vt-pbf":210}],43:[function(t,e,n){"use strict";var r=t("point-geometry"),i=t("vector-tile").VectorTileFeature,o=t("../data/extent"),a=function(t){var e=this;if(this.type=t.type,1===t.type){this.rawGeometry=[];for(var n=0;n<t.geometry.length;n++)e.rawGeometry.push([t.geometry[n]])}else this.rawGeometry=t.geometry;this.properties=t.tags,this.extent=o};a.prototype.loadGeometry=function(){var t=this,e=this.rawGeometry;this.geometry=[];for(var n=0;n<e.length;n++){for(var i=e[n],o=[],a=0;a<i.length;a++)o.push(new r(i[a][0],i[a][1]));t.geometry.push(o)}return this.geometry},a.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,n=-(1/0),r=1/0,i=-(1/0),o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var u=a[s];e=Math.min(e,u.x),n=Math.max(n,u.x),r=Math.min(r,u.y),i=Math.max(i,u.y)}return[e,r,n,i]},a.prototype.toGeoJSON=function(){i.prototype.toGeoJSON.call(this)};var s=function(t){this.features=t,this.length=t.length,this.extent=o};s.prototype.feature=function(t){return new a(this.features[t])},e.exports=s},{"../data/extent":11,"point-geometry":197,"vector-tile":206}],44:[function(t,n,r){"use strict";var i=t("../util/util"),o=t("../util/window"),a=t("./tile_coord"),s=t("../geo/lng_lat"),u=t("point-geometry"),l=t("../util/evented"),c=t("../util/ajax"),p=t("../data/extent"),h=t("../data/raster_bounds_array"),f=t("../data/buffer"),d=t("../render/vertex_array_object"),m=function(t){function e(e,n,r,i){t.call(this),this.id=e,this.dispatcher=r,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.setEventedParent(i),this.options=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;this.fire("dataloading",{dataType:"source"}),this.url=this.options.url,c.getImage(this.options.url,function(e,n){return e?t.fire("error",{error:e}):(t.image=n,void t._finishLoading())})},e.prototype._finishLoading=function(){this.fire("source.load"),this.map&&this.setCoordinates(this.coordinates)},e.prototype.onAdd=function(t){this.load(),this.map=t,this.image&&this.setCoordinates(this.coordinates)},e.prototype.setCoordinates=function(t){this.coordinates=t;var e=this.map,n=t.map(function(t){return e.transform.locationCoordinate(s.convert(t)).zoomTo(0)}),r=this.centerCoord=i.getCoordinatesCenter(n);return r.column=Math.round(r.column),r.row=Math.round(r.row),this.minzoom=this.maxzoom=r.zoom,this.coord=new a(r.zoom,r.column,r.row),this._tileCoords=n.map(function(t){var e=t.zoomTo(r.zoom);return new u(Math.round((e.column-r.column)*p),Math.round((e.row-r.row)*p))}),this.fire("data",{dataType:"source"}),this},e.prototype._setTile=function(t){this.tile=t;var e=32767,n=new h;n.emplaceBack(this._tileCoords[0].x,this._tileCoords[0].y,0,0),n.emplaceBack(this._tileCoords[1].x,this._tileCoords[1].y,e,0),n.emplaceBack(this._tileCoords[3].x,this._tileCoords[3].y,0,e),n.emplaceBack(this._tileCoords[2].x,this._tileCoords[2].y,e,e),this.tile.buckets={},this.tile.boundsBuffer=f.fromStructArray(n,f.BufferType.VERTEX),this.tile.boundsVAO=new d},e.prototype.prepare=function(){this.tile&&this.image&&this._prepareImage(this.map.painter.gl,this.image)},e.prototype._prepareImage=function(t,e,n){"loaded"!==this.tile.state?(this.tile.state="loaded",this.tile.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.tile.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)):n?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e):(e instanceof o.HTMLVideoElement||e instanceof o.ImageData||e instanceof o.HTMLCanvasElement)&&(t.bindTexture(t.TEXTURE_2D,this.tile.texture),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,e))},e.prototype.loadTile=function(t,e){this.coord&&this.coord.toString()===t.coord.toString()?(this._setTile(t),e(null)):(t.state="errored",e(null))},e.prototype.serialize=function(){return{type:"image",urls:this.url,coordinates:this.coordinates}},e}(l);n.exports=m},{"../data/buffer":8,"../data/extent":11,"../data/raster_bounds_array":16,"../geo/lng_lat":19,"../render/vertex_array_object":39,"../util/ajax":109,"../util/evented":118,"../util/util":129,"../util/window":112,"./tile_coord":53,"point-geometry":197}],45:[function(t,e,n){"use strict";var r=t("../util/util"),i=t("../util/ajax"),o=t("../util/browser"),a=t("../util/mapbox").normalizeSourceURL;e.exports=function(t,e){var n=function(t,n){if(t)return e(t);var i=r.pick(n,["tiles","minzoom","maxzoom","attribution"]);n.vector_layers&&(i.vectorLayers=n.vector_layers,i.vectorLayerIds=i.vectorLayers.map(function(t){return t.id})),e(null,i)};t.url?i.getJSON(a(t.url),n):o.frame(n.bind(null,null,t))}},{"../util/ajax":109,"../util/browser":110,"../util/mapbox":125,"../util/util":129}],46:[function(t,e,n){"use strict";var r=t("../data/extent");e.exports=function(t,e,n){return e*(r/(t.tileSize*Math.pow(2,n-t.coord.z)))}},{"../data/extent":11}],47:[function(t,e,n){"use strict";function sortTilesIn(t,e){var n=t.coord,r=e.coord;return n.z-r.z||n.y-r.y||n.w-r.w||n.x-r.x}function mergeRenderedFeatureLayers(t){for(var e=t[0]||{},n=1;n<t.length;n++){var r=t[n];for(var i in r){var o=r[i],a=e[i];if(void 0===a)a=e[i]=o;else for(var s=0;s<o.length;s++)a.push(o[s])}}return e}var r=t("./tile_coord");n.rendered=function(t,e,n,r,i,o){var a=t.tilesIn(n);a.sort(sortTilesIn);for(var s=[],u=0;u<a.length;u++){var l=a[u];l.tile.featureIndex&&s.push(l.tile.featureIndex.query({queryGeometry:l.queryGeometry,scale:l.scale,tileSize:l.tile.tileSize,bearing:o,params:r},e))}return mergeRenderedFeatureLayers(s)},n.source=function(t,e){for(var n=t.getRenderableIds().map(function(e){return t.getTileByID(e)}),i=[],o={},a=0;a<n.length;a++){var s=n[a],u=new r(Math.min(s.sourceMaxZoom,s.coord.z),s.coord.x,s.coord.y,0).id;o[u]||(o[u]=!0,s.querySourceFeatures(i,e))}return i}},{"./tile_coord":53}],48:[function(e,n,r){"use strict";var o=e("../util/util"),a=e("../util/ajax"),s=e("../util/evented"),u=e("./load_tilejson"),l=e("../util/mapbox").normalizeTileURL,c=function(e){function t(t,n,r,i){e.call(this),this.id=t,this.dispatcher=r,this.setEventedParent(i),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this.options=n,o.extend(this,o.pick(n,["url","scheme","tileSize"]))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.load=function(){var t=this;this.fire("dataloading",{dataType:"source"}),u(this.options,function(e,n){return e?t.fire("error",e):(o.extend(t,n),t.fire("data",{dataType:"source"}),void t.fire("source.load"))})},t.prototype.onAdd=function(t){this.load(),this.map=t},t.prototype.serialize=function(){return{type:"raster",url:this.url,tileSize:this.tileSize,tiles:this.tiles}},t.prototype.loadTile=function(t,e){function i(n,r){if(delete t.request,t.aborted)return this.state="unloaded",e(null);if(n)return this.state="errored",e(n);t.setExpiryData(r),delete r.cacheControl,delete r.expires;var i=this.map.painter.gl;t.texture=this.map.painter.getTileTexture(r.width),t.texture?(i.bindTexture(i.TEXTURE_2D,t.texture),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,r)):(t.texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,t.texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,r),t.texture.size=r.width),i.generateMipmap(i.TEXTURE_2D),t.state="loaded",e(null)}var n=l(t.coord.url(this.tiles,null,this.scheme),this.url,this.tileSize);t.request=a.getImage(n,i.bind(this))},t.prototype.abortTile=function(t){t.request&&(t.request.abort(),delete t.request)},t.prototype.unloadTile=function(t){t.texture&&this.map.painter.saveTileTexture(t.texture)},t}(s);n.exports=c},{"../util/ajax":109,"../util/evented":118,"../util/mapbox":125,"../util/util":129,"./load_tilejson":45}],49:[function(t,e,n){"use strict";var r=t("../util/ajax"),i=t("../util/window"),o=[],a=!1,s=null;e.exports.registerForPluginAvailability=function(t){s?t(s):o.push(t)},e.exports.errorCallback=null,e.exports.setRTLTextPlugin=function(t,n){if(a)throw new Error("setRTLTextPlugin cannot be called multiple times.");a=!0,e.exports.errorCallback=n,r.getArrayBuffer(t,function(t,e){if(t)n(t);else{s=i.URL.createObjectURL(new i.Blob([e.data]),{type:"text/javascript"});for(var r=0,a=o;r<a.length;r+=1){(0,a[r])(s)}}})}},{"../util/ajax":109,"../util/window":112}],50:[function(t,e,n){"use strict";var r=t("../util/util"),i={vector:t("../source/vector_tile_source"),raster:t("../source/raster_tile_source"),geojson:t("../source/geojson_source"),video:t("../source/video_source"),image:t("../source/image_source"),canvas:t("../source/canvas_source")};n.create=function(t,e,n,o){if(e=new i[e.type](t,e,n,o),e.id!==t)throw new Error("Expected Source id to be "+t+" instead of "+e.id);return r.bindAll(["load","abort","unload","serialize","prepare"],e),e},n.getType=function(t){return i[t]},n.setType=function(t,e){i[t]=e}},{"../source/canvas_source":40,"../source/geojson_source":41,"../source/image_source":44,"../source/raster_tile_source":48,"../source/vector_tile_source":54,"../source/video_source":56,"../util/util":129}],51:[function(e,n,r){"use strict";function coordinateToTilePoint(t,e,n){var r=n.zoomTo(Math.min(t.z,e));return{x:(r.column-(t.x+t.w*Math.pow(2,t.z)))*p,y:(r.row-t.y)*p}}function compareKeyZoom(t,e){return t%32-e%32}function isRasterType(t){return"raster"===t||"image"===t||"video"===t}var i=e("./source"),o=e("./tile"),a=e("../util/evented"),s=e("./tile_coord"),u=e("../util/lru_cache"),l=e("../geo/coordinate"),c=e("../util/util"),p=e("../data/extent"),h=function(e){function t(t,n,r){e.call(this),this.id=t,this.dispatcher=r,this.on("source.load",function(){this._sourceLoaded=!0}),this.on("error",function(){this._sourceErrored=!0}),this.on("data",function(t){this._sourceLoaded&&"source"===t.dataType&&(this.reload(),this.transform&&this.update(this.transform))}),this._source=i.create(t,n,r,this),this._tiles={},this._cache=new u(0,this.unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._isIdRenderable=this._isIdRenderable.bind(this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.onAdd=function(t){this.map=t,this._source&&this._source.onAdd&&this._source.onAdd(t)},t.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t)},t.prototype.loaded=function(){var t=this;if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;for(var e in this._tiles){var n=t._tiles[e];if("loaded"!==n.state&&"errored"!==n.state)return!1}return!0},t.prototype.getSource=function(){return this._source},t.prototype.loadTile=function(t,e){return this._source.loadTile(t,e)},t.prototype.unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t)},t.prototype.abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t)},t.prototype.serialize=function(){return this._source.serialize()},t.prototype.prepare=function(){if(this._sourceLoaded&&this._source.prepare)return this._source.prepare()},t.prototype.getIds=function(){return Object.keys(this._tiles).map(Number).sort(compareKeyZoom)},t.prototype.getRenderableIds=function(){return this.getIds().filter(this._isIdRenderable)},t.prototype._isIdRenderable=function(t){return this._tiles[t].hasData()&&!this._coveredTiles[t]},t.prototype.reload=function(){var t=this;this._cache.reset();for(var e in this._tiles)t.reloadTile(e,"reloading")},t.prototype.reloadTile=function(t,e){var n=this._tiles[t];"loading"!==n.state&&(n.state=e),this.loadTile(n,this._tileLoaded.bind(this,n,t))},t.prototype._tileLoaded=function(t,e,n){return n?(t.state="errored",void this._source.fire("error",{tile:t,error:n})):(t.sourceCache=this,t.timeAdded=(new Date).getTime(),this._setTileReloadTimer(e,t),this._source.fire("data",{tile:t,coord:t.coord,dataType:"tile"}),void(this.map&&(this.map.painter.tileExtentVAO.vao=null)))},t.prototype.getTile=function(t){return this.getTileByID(t.id)},t.prototype.getTileByID=function(t){return this._tiles[t]},t.prototype.getZoom=function(t){return t.zoom+t.scaleZoom(t.tileSize/this._source.tileSize)},t.prototype.findLoadedChildren=function(t,e,n){var r=this,i=!1;for(var o in this._tiles){var a=r._tiles[o];if(!(n[o]||!a.hasData()||a.coord.z<=t.z||a.coord.z>e)){var s=Math.pow(2,Math.min(a.coord.z,r._source.maxzoom)-Math.min(t.z,r._source.maxzoom));if(Math.floor(a.coord.x/s)===t.x&&Math.floor(a.coord.y/s)===t.y)for(n[o]=!0,i=!0;a&&a.coord.z-1>t.z;){var u=a.coord.parent(r._source.maxzoom).id;(a=r._tiles[u])&&a.hasData()&&(delete n[o],n[u]=!0)}}}return i},t.prototype.findLoadedParent=function(t,e,n){for(var r=this,i=t.z-1;i>=e;i--){t=t.parent(r._source.maxzoom);var o=r._tiles[t.id];if(o&&o.hasData())return n[t.id]=!0,o;if(r._cache.has(t.id))return n[t.id]=!0,r._cache.get(t.id)}},t.prototype.updateCacheSize=function(t){var e=Math.ceil(t.width/t.tileSize)+1,n=Math.ceil(t.height/t.tileSize)+1,r=e*n;this._cache.setMaxSize(Math.floor(5*r))},t.prototype.update=function(e){var n=this;if(this._sourceLoaded){var r,i,o,a;this.updateCacheSize(e);var u=(this._source.roundZoom?Math.round:Math.floor)(this.getZoom(e)),l=Math.max(u-t.maxOverzooming,this._source.minzoom),p=Math.max(u+t.maxUnderzooming,this._source.minzoom),h={};this._coveredTiles={};var f;for(f=this.used?this._source.coord?[this._source.coord]:e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}):[],r=0;r<f.length;r++)i=f[r],o=n.addTile(i),h[i.id]=!0,o.hasData()||n.findLoadedChildren(i,p,h)||(a=n.findLoadedParent(i,l,h))&&n.addTile(a.coord);var d={};if(isRasterType(this._source.type))for(var m=Object.keys(h),y=0;y<m.length;y++){var g=m[y];i=s.fromID(g),(o=n._tiles[g])&&(void 0===o.fadeEndTime||o.fadeEndTime>=Date.now())&&(n.findLoadedChildren(i,p,h)&&(h[g]=!0),(a=n.findLoadedParent(i,l,d))&&n.addTile(a.coord))}var v;for(v in d)h[v]||(n._coveredTiles[v]=!0);for(v in d)h[v]=!0;var _=c.keysDifference(this._tiles,h);for(r=0;r<_.length;r++)n.removeTile(+_[r]);this.transform=e}},t.prototype.addTile=function(t){var e=this._tiles[t.id];if(e)return e;var n=t.wrapped();if(e=this._tiles[n.id],e||(e=this._cache.get(n.id))&&(e.redoPlacement(this._source),this._cacheTimers[n.id]&&(clearTimeout(this._cacheTimers[n.id]),this._cacheTimers[n.id]=void 0,this._setTileReloadTimer(n.id,e))),!e){var r=t.z,i=r>this._source.maxzoom?Math.pow(2,r-this._source.maxzoom):1;e=new o(n,this._source.tileSize*i,this._source.maxzoom),this.loadTile(e,this._tileLoaded.bind(this,e,t.id))}return e.uses++,this._tiles[t.id]=e,this._source.fire("dataloading",{tile:e,coord:e.coord,dataType:"tile"}),e},t.prototype._setTileReloadTimer=function(t,e){var n=this,r=e.getExpiry();r&&(this._timers[t]=setTimeout(function(){n.reloadTile(t,"expired"),n._timers[t]=void 0},r-(new Date).getTime()))},t.prototype._setCacheInvalidationTimer=function(t,e){var n=this,r=e.getExpiry();r&&(this._cacheTimers[t]=setTimeout(function(){n._cache.remove(t),n._cacheTimers[t]=void 0},r-(new Date).getTime()))},t.prototype.removeTile=function(t){var e=this._tiles[t];if(e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),this._timers[t]=void 0),this._source.fire("data",{tile:e,coord:e.coord,dataType:"tile"}),!(e.uses>0)))if(e.hasData()){var n=e.coord.wrapped().id;this._cache.add(n,e),this._setCacheInvalidationTimer(n,e)}else e.aborted=!0,this.abortTile(e),this.unloadTile(e)},t.prototype.clearTiles=function(){var t=this;for(var e in this._tiles)t.removeTile(e);this._cache.reset()},t.prototype.tilesIn=function(t){for(var e=this,n={},r=this.getIds(),i=1/0,o=1/0,a=-(1/0),u=-(1/0),c=t[0].zoom,h=0;h<t.length;h++){var f=t[h];i=Math.min(i,f.column),o=Math.min(o,f.row),a=Math.max(a,f.column),u=Math.max(u,f.row)}for(var d=0;d<r.length;d++){var m=e._tiles[r[d]],y=s.fromID(r[d]),g=[coordinateToTilePoint(y,m.sourceMaxZoom,new l(i,o,c)),coordinateToTilePoint(y,m.sourceMaxZoom,new l(a,u,c))];if(g[0].x<p&&g[0].y<p&&g[1].x>=0&&g[1].y>=0){for(var v=[],_=0;_<t.length;_++)v.push(coordinateToTilePoint(y,m.sourceMaxZoom,t[_]));var x=n[m.coord.id];void 0===x&&(x=n[m.coord.id]={tile:m,coord:y,queryGeometry:[],scale:Math.pow(2,e.transform.zoom-m.coord.z)}),x.queryGeometry.push(v)}}var b=[];for(var w in n)b.push(n[w]);return b},t.prototype.redoPlacement=function(){for(var t=this,e=this.getIds(),n=0;n<e.length;n++){t.getTileByID(e[n]).redoPlacement(t._source)}},t.prototype.getVisibleCoordinates=function(){for(var t=this,e=this.getRenderableIds().map(s.fromID),n=0,r=e;n<r.length;n+=1){var i=r[n];i.posMatrix=t.transform.calculatePosMatrix(i,t._source.maxzoom)}return e},t}(a);h.maxOverzooming=10,h.maxUnderzooming=3,n.exports=h},{"../data/extent":11,"../geo/coordinate":18,"../util/evented":118,"../util/lru_cache":124,"../util/util":129,"./source":50,"./tile":52,"./tile_coord":53}],52:[function(t,e,n){"use strict";var r=t("../util/util"),i=t("../data/bucket"),o=t("../data/feature_index"),a=t("vector-tile"),s=t("pbf"),u=t("../util/vectortile_to_geojson"),l=t("feature-filter"),c=t("../symbol/collision_tile"),p=t("../symbol/collision_box"),h=t("../symbol/symbol_instances"),f=t("../symbol/symbol_quads"),d=function(t,e,n){this.coord=t,this.uid=r.uniqueId(),this.uses=0,this.tileSize=e,this.sourceMaxZoom=n,this.buckets={},this.expires=null,this.cacheControl=null,this.state="loading"};d.prototype.registerFadeDuration=function(t,e){var n=e+this.timeAdded;n<Date.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n,t.set(this.fadeEndTime-Date.now()))},d.prototype.loadVectorData=function(t,e){this.hasData()&&this.unloadVectorData(e),this.state="loaded",t&&(t.rawTileData&&(this.rawTileData=t.rawTileData),this.collisionBoxArray=new p(t.collisionBoxArray),this.collisionTile=new c(t.collisionTile,this.collisionBoxArray),this.symbolInstancesArray=new h(t.symbolInstancesArray),this.symbolQuadsArray=new f(t.symbolQuadsArray),this.featureIndex=new o(t.featureIndex,this.rawTileData,this.collisionTile),this.buckets=i.deserialize(t.buckets,e.style))},d.prototype.reloadSymbolData=function(t,e){var n=this;if("unloaded"!==this.state){this.collisionTile=new c(t.collisionTile,this.collisionBoxArray),this.featureIndex.setCollisionTile(this.collisionTile);for(var o in this.buckets){var a=n.buckets[o];"symbol"===a.layers[0].type&&(a.destroy(),delete n.buckets[o])}r.extend(this.buckets,i.deserialize(t.buckets,e))}},d.prototype.unloadVectorData=function(){var t=this;for(var e in this.buckets)t.buckets[e].destroy();this.buckets={},this.collisionBoxArray=null,this.symbolQuadsArray=null,this.symbolInstancesArray=null,this.collisionTile=null,this.featureIndex=null,this.state="unloaded"},d.prototype.redoPlacement=function(t){var e=this;if("vector"===t.type||"geojson"===t.type)return"loaded"!==this.state?void(this.redoWhenDone=!0):void(this.collisionTile&&(this.state="reloading",t.dispatcher.send("redoPlacement",{type:t.type,uid:this.uid,source:t.id,angle:t.map.transform.angle,pitch:t.map.transform.pitch,showCollisionBoxes:t.map.showCollisionBoxes},function(n,r){e.reloadSymbolData(r,t.map.style),t.fire("data",{tile:e,coord:e.coord,dataType:"tile"}),t.map&&(t.map.painter.tileExtentVAO.vao=null),e.state="loaded",e.redoWhenDone&&(e.redoWhenDone=!1,e.redoPlacement(t))},this.workerID)))},d.prototype.getBucket=function(t){return this.buckets[t.id]},d.prototype.querySourceFeatures=function(t,e){var n=this;if(this.rawTileData){this.vtLayers||(this.vtLayers=new a.VectorTile(new s(this.rawTileData)).layers);var r=this.vtLayers._geojsonTileLayer||this.vtLayers[e.sourceLayer];if(r)for(var i=l(e&&e.filter),o={z:this.coord.z,x:this.coord.x,y:this.coord.y},c=0;c<r.length;c++){var p=r.feature(c);if(i(p)){var h=new u(p,n.coord.z,n.coord.x,n.coord.y);h.tile=o,t.push(h)}}}},d.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},d.prototype.setExpiryData=function(t){t.cacheControl&&(this.cacheControl=t.cacheControl),t.expires&&(this.expires=t.expires)},d.prototype.getExpiry=function(){if(this.cacheControl){var t=r.parseCacheControl(this.cacheControl);if(t["max-age"])return this.timeAdded+1e3*t["max-age"]}else if(this.expires)return new Date(this.expires).getTime()},e.exports=d},{"../data/bucket":2,"../data/feature_index":12,"../symbol/collision_box":78,"../symbol/collision_tile":80,"../symbol/symbol_instances":89,"../symbol/symbol_quads":90,"../util/util":129,"../util/vectortile_to_geojson":130,"feature-filter":138,pbf:196,"vector-tile":206}],53:[function(t,n,r){"use strict";function edge(t,e){if(t.row>e.row){var n=t;t=e,e=n}return{x0:t.column,y0:t.row,x1:e.column,y1:e.row,dx:e.column-t.column,dy:e.row-t.row}}function scanSpans(t,e,n,r,i){var o=Math.max(n,Math.floor(e.y0)),a=Math.min(r,Math.ceil(e.y1));if(t.x0===e.x0&&t.y0===e.y0?t.x0+e.dy/t.dy*t.dx<e.x1:t.x1-e.dy/t.dy*t.dx<e.x0){var s=t;t=e,e=s}for(var u=t.dx/t.dy,l=e.dx/e.dy,c=t.dx>0,p=e.dx<0,h=o;h<a;h++){var f=u*Math.max(0,Math.min(t.dy,h+c-t.y0))+t.x0,d=l*Math.max(0,Math.min(e.dy,h+p-e.y0))+e.x0;i(Math.floor(d),Math.ceil(f),h)}}function scanTriangle(t,e,n,r,i,o){var a,s=edge(t,e),u=edge(e,n),l=edge(n,t);s.dy>u.dy&&(a=s,s=u,u=a),s.dy>l.dy&&(a=s,s=l,l=a),u.dy>l.dy&&(a=u,u=l,l=a),s.dy&&scanSpans(l,s,r,i,o),u.dy&&scanSpans(l,u,r,i,o)}function getQuadkey(t,e,n){for(var r,i="",o=t;o>0;o--)r=1<<o-1,i+=(e&r?1:0)+(n&r?2:0);return i}var i=t("whoots-js"),o=t("../geo/coordinate"),a=function(t,e,n,r){isNaN(r)&&(r=0),this.z=+t,this.x=+e,this.y=+n,this.w=+r,(r*=2)<0&&(r=r*-1-1);var i=1<<this.z;this.id=32*(i*i*r+i*this.y+this.x)+this.z,this.posMatrix=null};a.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y},a.prototype.toCoordinate=function(t){var e=Math.min(this.z,void 0===t?this.z:t),n=Math.pow(2,e),r=this.y;return new o(this.x+n*this.w,r,e)},a.prototype.url=function(t,e,n){var r=i.getTileBBox(this.x,this.y,this.z),o=getQuadkey(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",Math.min(this.z,e||this.z)).replace("{x}",this.x).replace("{y}","tms"===n?Math.pow(2,this.z)-this.y-1:this.y).replace("{quadkey}",o).replace("{bbox-epsg-3857}",r)},a.prototype.parent=function(t){return 0===this.z?null:this.z>t?new a(this.z-1,this.x,this.y,this.w):new a(this.z-1,Math.floor(this.x/2),Math.floor(this.y/2),this.w)},a.prototype.wrapped=function(){return new a(this.z,this.x,this.y,0)},a.prototype.children=function(t){if(this.z>=t)return[new a(this.z+1,this.x,this.y,this.w)];var e=this.z+1,n=2*this.x,r=2*this.y;return[new a(e,n,r,this.w),new a(e,n+1,r,this.w),new a(e,n,r+1,this.w),new a(e,n+1,r+1,this.w)]},a.cover=function(t,n,r,i){function e(t,e,n){var u,l,c,p;if(n>=0&&n<=o)for(u=t;u<e;u++)l=Math.floor(u/o),c=(u%o+o)%o,0!==l&&i!==!0||(p=new a(r,c,n,l),s[p.id]=p)}void 0===i&&(i=!0);var o=1<<t,s={};return scanTriangle(n[0],n[1],n[2],0,o,e),scanTriangle(n[2],n[3],n[0],0,o,e),Object.keys(s).map(function(t){return s[t]})},a.fromID=function(t){var e=t%32,n=1<<e,r=(t-e)/32,i=r%n,o=(r-i)/n%n,s=Math.floor(r/(n*n));return s%2!=0&&(s=s*-1-1),s/=2,new a(e,i,o,s)},n.exports=a},{"../geo/coordinate":18,"whoots-js":215}],54:[function(e,n,r){"use strict";var o=e("../util/evented"),a=e("../util/util"),s=e("./load_tilejson"),u=e("../util/mapbox").normalizeTileURL,l=function(e){function t(t,n,r,i){if(e.call(this),this.id=t,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,a.extend(this,a.pick(n,["url","scheme","tileSize"])),this._options=a.extend({type:"vector"},n),512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(i)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.load=function(){var t=this;this.fire("dataloading",{dataType:"source"}),s(this._options,function(e,n){return e?void t.fire("error",e):(a.extend(t,n),t.fire("data",{dataType:"source"}),void t.fire("source.load"))})},t.prototype.onAdd=function(t){this.load(),this.map=t},t.prototype.serialize=function(){return a.extend({},this._options)},t.prototype.loadTile=function(t,e){function i(n,r){if(!t.aborted){if(n)return e(n);t.setExpiryData(r),t.loadVectorData(r,this.map.painter),t.redoWhenDone&&(t.redoWhenDone=!1,t.redoPlacement(this)),e(null),t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)}}var n=t.coord.z>this.maxzoom?Math.pow(2,t.coord.z-this.maxzoom):1,r={url:u(t.coord.url(this.tiles,this.maxzoom,this.scheme),this.url),uid:t.uid,coord:t.coord,zoom:t.coord.z,tileSize:this.tileSize*n,type:this.type,source:this.id,overscaling:n,angle:this.map.transform.angle,pitch:this.map.transform.pitch,showCollisionBoxes:this.map.showCollisionBoxes};t.workerID&&"expired"!==t.state?"loading"===t.state?t.reloadCallback=e:this.dispatcher.send("reloadTile",r,i.bind(this),t.workerID):t.workerID=this.dispatcher.send("loadTile",r,i.bind(this))},t.prototype.abortTile=function(t){this.dispatcher.send("abortTile",{uid:t.uid,type:this.type,source:this.id},null,t.workerID)},t.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},null,t.workerID)},t}(o);n.exports=l},{"../util/evented":118,"../util/mapbox":125,"../util/util":129,"./load_tilejson":45}],55:[function(e,n,r){"use strict";var i=e("../util/ajax"),o=e("vector-tile"),a=e("pbf"),s=e("./worker_tile"),u=e("../util/util"),l=function(t,e,n){this.actor=t,this.layerIndex=e,n&&(this.loadVectorData=n),this.loading={},this.loaded={}};l.prototype.loadTile=function(e,n){function t(t,e){return delete this.loading[r][i],t?n(t):e?(o.vectorTile=e,o.parse(e,this.layerIndex,this.actor,function(t,r,i){if(t)return n(t);var o={};e.expires&&(o.expires=e.expires),e.cacheControl&&(o.cacheControl=e.cacheControl),n(null,u.extend({rawTileData:e.rawData},r,o),i)}),this.loaded[r]=this.loaded[r]||{},void(this.loaded[r][i]=o)):n(null,null)}var r=e.source,i=e.uid;this.loading[r]||(this.loading[r]={});var o=this.loading[r][i]=new s(e);o.abort=this.loadVectorData(e,t.bind(this))},l.prototype.reloadTile=function(e,n){function t(t,e){if(this.reloadCallback){var r=this.reloadCallback;delete this.reloadCallback,this.parse(this.vectorTile,o.layerIndex,o.actor,r)}n(t,e)}var r=this.loaded[e.source],i=e.uid,o=this;if(r&&r[i]){var a=r[i];"parsing"===a.status?a.reloadCallback=n:"done"===a.status&&a.parse(a.vectorTile,this.layerIndex,this.actor,t.bind(a))}},l.prototype.abortTile=function(t){var e=this.loading[t.source],n=t.uid;e&&e[n]&&e[n].abort&&(e[n].abort(),delete e[n])},l.prototype.removeTile=function(t){var e=this.loaded[t.source],n=t.uid;e&&e[n]&&delete e[n]},l.prototype.loadVectorData=function(e,n){function t(t,e){if(t)return n(t);var r=new o.VectorTile(new a(e.data));r.rawData=e.data,r.cacheControl=e.cacheControl,r.expires=e.expires,n(t,r)}var r=i.getArrayBuffer(e.url,t.bind(this));return function(){r.abort()}},l.prototype.redoPlacement=function(t,e){var n=this.loaded[t.source],r=this.loading[t.source],i=t.uid;if(n&&n[i]){var o=n[i],a=o.redoPlacement(t.angle,t.pitch,t.showCollisionBoxes);a.result&&e(null,a.result,a.transferables)}else r&&r[i]&&(r[i].angle=t.angle)},n.exports=l},{"../util/ajax":109,"../util/util":129,"./worker_tile":58,pbf:196,"vector-tile":206}],56:[function(t,n,r){"use strict";var i=t("../util/ajax"),o=t("./image_source"),a=function(t){function e(e,n,r,i){t.call(this,e,n,r,i),this.roundZoom=!0,this.type="video",this.options=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this,e=this.options;this.urls=e.urls,i.getVideo(e.urls,function(e,n){if(e)return t.fire("error",{error:e});t.video=n,t.video.loop=!0;var r;t.video.addEventListener("playing",function(){r=t.map.style.animationLoop.set(1/0),t.map._rerender()}),t.video.addEventListener("pause",function(){t.map.style.animationLoop.cancel(r)}),t.map&&t.video.play(),t._finishLoading()})},e.prototype.getVideo=function(){return this.video},e.prototype.onAdd=function(t){this.map||(this.load(),this.map=t,this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},e.prototype.prepare=function(){!this.tile||this.video.readyState<2||this._prepareImage(this.map.painter.gl,this.video)},e.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},e}(o);n.exports=a},{"../util/ajax":109,"./image_source":44}],57:[function(t,e,n){"use strict";var r=t("../util/actor"),i=t("../style/style_layer_index"),o=t("./vector_tile_worker_source"),a=t("./geojson_worker_source"),s=t("./rtl_text_plugin"),u=function(t){var e=this;this.self=t,this.actor=new r(t,this),this.layerIndexes={},this.workerSourceTypes={vector:o,geojson:a},this.workerSources={},this.self.registerWorkerSource=function(t,n){if(e.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');e.workerSourceTypes[t]=n},this.self.registerRTLTextPlugin=function(t){if(s.applyArabicShaping||s.processBidirectionalText)throw new Error("RTL text plugin already registered.");s.applyArabicShaping=t.applyArabicShaping,s.processBidirectionalText=t.processBidirectionalText}};u.prototype.setLayers=function(t,e){this.getLayerIndex(t).replace(e)},u.prototype.updateLayers=function(t,e){this.getLayerIndex(t).update(e.layers,e.removedIds,e.symbolOrder)},u.prototype.loadTile=function(t,e,n){this.getWorkerSource(t,e.type).loadTile(e,n)},u.prototype.reloadTile=function(t,e,n){this.getWorkerSource(t,e.type).reloadTile(e,n)},u.prototype.abortTile=function(t,e){this.getWorkerSource(t,e.type).abortTile(e)},u.prototype.removeTile=function(t,e){this.getWorkerSource(t,e.type).removeTile(e)},u.prototype.removeSource=function(t,e){var n=this.getWorkerSource(t,e.type);void 0!==n.removeSource&&n.removeSource(e)},u.prototype.redoPlacement=function(t,e,n){this.getWorkerSource(t,e.type).redoPlacement(e,n)},u.prototype.loadWorkerSource=function(t,e,n){try{this.self.importScripts(e.url),n()}catch(t){n(t)}},u.prototype.loadRTLTextPlugin=function(t,e,n){try{s.applyArabicShaping||s.processBidirectionalText||this.self.importScripts(e)}catch(t){n(t)}},u.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new i),e},u.prototype.getWorkerSource=function(t,e){var n=this;if(this.workerSources[t]||(this.workerSources[t]={}),!this.workerSources[t][e]){var r={send:function(e,r,i,o){n.actor.send(e,r,i,o,t)}};this.workerSources[t][e]=new this.workerSourceTypes[e](r,this.getLayerIndex(t))}return this.workerSources[t][e]},e.exports=function(t){return new u(t)}},{"../style/style_layer_index":71,"../util/actor":108,"./geojson_worker_source":42,"./rtl_text_plugin":49,"./vector_tile_worker_source":55}],58:[function(t,e,n){"use strict";function recalculateLayers(t,e){for(var n=0,r=t.layers;n<r.length;n+=1){r[n].recalculate(e)}}function serializeBuckets(t,e){return t.filter(function(t){return!t.isEmpty()}).map(function(t){return t.serialize(e)})}var r=t("../data/feature_index"),i=t("../symbol/collision_tile"),o=t("../symbol/collision_box"),a=t("../util/dictionary_coder"),s=t("../util/util"),u=t("../symbol/symbol_instances"),l=t("../symbol/symbol_quads"),c=function(t){this.coord=t.coord,this.uid=t.uid,this.zoom=t.zoom,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=t.overscaling,this.angle=t.angle,this.pitch=t.pitch,this.showCollisionBoxes=t.showCollisionBoxes};c.prototype.parse=function(t,e,n,c){var p=this;t.layers||(t={layers:{_geojsonTileLayer:t}}),this.status="parsing",this.data=t,this.collisionBoxArray=new o,this.symbolInstancesArray=new u,this.symbolQuadsArray=new l;var h=new a(Object.keys(t.layers).sort()),f=new r(this.coord,this.overscaling);f.bucketLayerIDs={};var d={},m=0,y={featureIndex:f,iconDependencies:{},glyphDependencies:{}},g=e.familiesBySource[this.source];for(var v in g){var _=t.layers[v];if(_){1===_.version&&s.warnOnce('Vector tile source "'+p.source+'" layer "'+v+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var x=h.encode(v),b=[],w=0;w<_.length;w++){var S=_.feature(w);S.index=w,S.sourceLayerIndex=x,b.push(S)}for(var T=0,E=g[v];T<E.length;T+=1){var A=E[T],P=A[0];if(!(P.minzoom&&p.zoom<P.minzoom||P.maxzoom&&p.zoom>=P.maxzoom||P.layout&&"none"===P.layout.visibility)){for(var C=0,M=A;C<M.length;C+=1){M[C].recalculate(p.zoom)}(d[P.id]=P.createBucket({index:m,layers:A,zoom:p.zoom,overscaling:p.overscaling,collisionBoxArray:p.collisionBoxArray,symbolQuadsArray:p.symbolQuadsArray,symbolInstancesArray:p.symbolInstancesArray})).populate(b,y),f.bucketLayerIDs[m]=A.map(function(t){return t.id}),m++}}}}var k=function(t){p.status="done";var e=[];c(null,{buckets:serializeBuckets(s.values(d),e),featureIndex:f.serialize(e),collisionTile:t.serialize(e),collisionBoxArray:p.collisionBoxArray.serialize(),symbolInstancesArray:p.symbolInstancesArray.serialize(),symbolQuadsArray:p.symbolQuadsArray.serialize()},e)};this.symbolBuckets=[];for(var z=e.symbolOrder.length-1;z>=0;z--){var I=d[e.symbolOrder[z]];I&&p.symbolBuckets.push(I)}if(0===this.symbolBuckets.length)return k(new i(this.angle,this.pitch,this.collisionBoxArray));var L=0,O=Object.keys(y.iconDependencies),D=s.mapObject(y.glyphDependencies,function(t){return Object.keys(t).map(Number)}),R=function(t){if(t)return c(t);if(2===++L){for(var e=new i(p.angle,p.pitch,p.collisionBoxArray),n=0,r=p.symbolBuckets;n<r.length;n+=1){var o=r[n];recalculateLayers(o,p.zoom),o.prepare(D,O),o.place(e,p.showCollisionBoxes)}k(e)}};Object.keys(D).length?n.send("getGlyphs",{uid:this.uid,stacks:D},function(t,e){D=e,R(t)}):R(),O.length?n.send("getIcons",{icons:O},function(t,e){O=e,R(t)}):R()},c.prototype.redoPlacement=function(t,e,n){var r=this;if(this.angle=t,this.pitch=e,"done"!==this.status)return{};for(var o=new i(this.angle,this.pitch,this.collisionBoxArray),a=0,s=this.symbolBuckets;a<s.length;a+=1){var u=s[a];recalculateLayers(u,r.zoom),u.place(o,n)}var l=[];return{result:{buckets:serializeBuckets(this.symbolBuckets,l),collisionTile:o.serialize(l)},transferables:l}},e.exports=c},{"../data/feature_index":12,"../symbol/collision_box":78,"../symbol/collision_tile":80,"../symbol/symbol_instances":89,"../symbol/symbol_quads":90,"../util/dictionary_coder":115,"../util/util":129}],59:[function(t,e,n){"use strict";var r=function(){this.n=0,this.times=[]};r.prototype.stopped=function(){return this.times=this.times.filter(function(t){return t.time>=(new Date).getTime()}),!this.times.length},r.prototype.set=function(t){return this.times.push({id:this.n,time:t+(new Date).getTime()}),this.n++},r.prototype.cancel=function(t){this.times=this.times.filter(function(e){return e.id!==t})},e.exports=r},{}],60:[function(t,e,n){"use strict";var r=t("../util/evented"),o=t("../util/ajax"),a=t("../util/browser"),s=t("../util/mapbox").normalizeSpriteURL,u=function(){this.x=0,this.y=0,this.width=0,this.height=0,this.pixelRatio=1,this.sdf=!1},l=function(t){function i(e,n){var r=this;t.call(this),this.base=e,this.retina=a.devicePixelRatio>1,this.setEventedParent(n);var i=this.retina?"@2x":"";o.getJSON(s(e,i,".json"),function(t,e){return t?void r.fire("error",{error:t}):(r.data=e,void(r.imgData&&r.fire("data",{dataType:"style"})))}),o.getImage(s(e,i,".png"),function(t,e){if(t)return void r.fire("error",{error:t});r.imgData=a.getImageData(e);for(var n=0;n<r.imgData.length;n+=4){var i=r.imgData[n+3]/255;r.imgData[n+0]*=i,r.imgData[n+1]*=i,r.imgData[n+2]*=i}r.width=e.width,r.data&&r.fire("data",{dataType:"style"})})}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.toJSON=function(){return this.base},i.prototype.loaded=function(){return!(!this.data||!this.imgData)},i.prototype.resize=function(){var t=this;if(a.devicePixelRatio>1!==this.retina){var e=new i(this.base);e.on("data",function(){t.data=e.data,t.imgData=e.imgData,t.width=e.width,t.retina=e.retina})}},i.prototype.getSpritePosition=function(t){if(!this.loaded())return new u;var e=this.data&&this.data[t];return e&&this.imgData?e:new u},i}(r);e.exports=l},{"../util/ajax":109,"../util/browser":110,"../util/evented":118,"../util/mapbox":125}],61:[function(t,e,n){"use strict";var r=t("./style_spec"),o=t("../util/util"),a=t("../util/evented"),s=t("./validate_style"),u=t("./style_declaration"),l=t("./style_transition"),c="-transition",p=function(t){function i(e){t.call(this),this.properties=["anchor","color","position","intensity"],this._specifications=r.light,this.set(e)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.set=function(t){var e=this;if(!this._validate(s.light,t)){this._declarations={},this._transitions={},this._transitionOptions={},this.calculated={},t=o.extend({anchor:this._specifications.anchor.default,color:this._specifications.color.default,position:this._specifications.position.default,intensity:this._specifications.intensity.default},t);for(var n=0,r=this.properties;n<r.length;n+=1){var i=r[n];e._declarations[i]=new u(e._specifications[i],t[i])}return this}},i.prototype.getLight=function(){return{anchor:this.getLightProperty("anchor"),color:this.getLightProperty("color"),position:this.getLightProperty("position"),intensity:this.getLightProperty("intensity")}},i.prototype.getLightProperty=function(t){return o.endsWith(t,c)?this._transitionOptions[t]:this._declarations[t]&&this._declarations[t].value},i.prototype.getLightValue=function(t,e){if("position"===t){var n=this._transitions[t].calculate(e),r=o.sphericalToCartesian(n);return{x:r[0],y:r[1],z:r[2]}}return this._transitions[t].calculate(e)},i.prototype.setLight=function(t){var e=this;if(!this._validate(s.light,t))for(var n in t){var r=t[n];o.endsWith(n,c)?e._transitionOptions[n]=r:null===r||void 0===r?delete e._declarations[n]:e._declarations[n]=new u(e._specifications[n],r)}},i.prototype.recalculate=function(t){var e=this;for(var n in this._declarations)e.calculated[n]=e.getLightValue(n,{zoom:t})},i.prototype._applyLightDeclaration=function(t,e,n,r,i){var a=n.transition?this._transitions[t]:void 0,s=this._specifications[t];if(null!==e&&void 0!==e||(e=new u(s,s.default)),!a||a.declaration.json!==e.json){var p=o.extend({duration:300,delay:0},r,this.getLightProperty(t+c)),h=this._transitions[t]=new l(s,e,a,p);h.instant()||(h.loopID=i.set(h.endTime-Date.now())),a&&i.cancel(a.loopID)}},i.prototype.updateLightTransitions=function(t,e,n){var r,i=this;for(r in this._declarations)i._applyLightDeclaration(r,i._declarations[r],t,e,n)},i.prototype._validate=function(t,e){return s.emitErrors(this,t.call(s,o.extend({value:e,style:{glyphs:!0,sprite:!0},styleSpec:r})))},i}(a);e.exports=p},{"../util/evented":118,"../util/util":129,"./style_declaration":64,"./style_spec":72,"./style_transition":73,"./validate_style":74}],62:[function(t,e,n){"use strict";var i=t("csscolorparser").parseCSSColor,o=t("../util/util"),a=t("mapbox-gl-function"),s={};e.exports=function r(t){if(t&&a.isFunctionDefinition(t))return t.stops?o.extend({},t,{stops:t.stops.map(function(t){return[t[0],r(t[1])]})}):t;if("string"==typeof t){if(!s[t]){var e=i(t);if(!e)throw new Error("Invalid color "+t);s[t]=[e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3]]}return s[t]}if(Array.isArray(t))return t;throw new Error("Invalid color "+t)}},{"../util/util":129,csscolorparser:135,"mapbox-gl-function":164}],63:[function(e,n,r){"use strict";var i=e("../util/evented"),o=e("./style_layer"),a=e("./image_sprite"),s=e("./light"),u=e("../symbol/glyph_source"),l=e("../symbol/sprite_atlas"),c=e("../render/line_atlas"),p=e("../util/util"),h=e("../util/ajax"),f=e("../util/mapbox"),d=e("../util/browser"),m=e("../util/dispatcher"),y=e("./animation_loop"),g=e("./validate_style"),v=e("../source/source"),_=e("../source/query_features"),x=e("../source/source_cache"),b=e("./style_spec"),w=e("mapbox-gl-function"),S=e("../global_worker_pool"),T=e("mapbox-gl-style-spec/lib/deref"),E=e("mapbox-gl-style-spec/lib/diff"),A=e("../source/rtl_text_plugin"),P=p.pick(E.operations,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition"]),C=p.pick(E.operations,["setCenter","setZoom","setBearing","setPitch"]),M=function(e){function t(t,n,r){var i=this;e.call(this),this.map=n,this.animationLoop=n&&n.animationLoop||new y,this.dispatcher=new m(S(),this),this.spriteAtlas=new l(1024,1024),this.lineAtlas=new c(256,512),this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory={},this._loaded=!1,p.bindAll(["_redoPlacement"],this),this._resetUpdates(),r=p.extend({validate:"string"!=typeof t||!f.isMapboxURL(t)},r),this.setEventedParent(n),this.fire("dataloading",{dataType:"style"});var o=this;A.registerForPluginAvailability(function(t){o.dispatcher.broadcast("loadRTLTextPlugin",t,A.errorCallback);for(var e in o.sourceCaches)o.sourceCaches[e].reload()});var s=function(t,e){if(t)return void i.fire("error",{error:t});if(!r.validate||!g.emitErrors(i,g(e))){i._loaded=!0,i.stylesheet=e,i.updateClasses();for(var n in e.sources)i.addSource(n,e.sources[n],r);e.sprite&&(i.sprite=new a(e.sprite,i)),i.glyphSource=new u(e.glyphs),i._resolve(),i.fire("data",{dataType:"style"}),i.fire("style.load")}};"string"==typeof t?h.getJSON(f.normalizeStyleURL(t),s):d.frame(s.bind(this,null,t)),this.on("source.load",function(t){var e=i.sourceCaches[t.sourceId].getSource();if(e&&e.vectorLayerIds)for(var n in i._layers){var r=i._layers[n];r.source===e.id&&i._validateLayer(r)}})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._validateLayer=function(t){var e=this.sourceCaches[t.source];if(t.sourceLayer&&e){var n=e.getSource();("geojson"===n.type||n.vectorLayerIds&&n.vectorLayerIds.indexOf(t.sourceLayer)===-1)&&this.fire("error",{error:new Error('Source layer "'+t.sourceLayer+'" does not exist on source "'+n.id+'" as specified by style layer "'+t.id+'"')})}},t.prototype.loaded=function(){var t=this;if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var e in this.sourceCaches)if(!t.sourceCaches[e].loaded())return!1;return!(this.sprite&&!this.sprite.loaded())},t.prototype._resolve=function(){var t=this,e=T(this.stylesheet.layers);this._order=e.map(function(t){return t.id}),this._layers={};for(var n=0,r=e;n<r.length;n+=1){var i=r[n];i=o.create(i),i.setEventedParent(t,{layer:{id:i.id}}),t._layers[i.id]=i}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new s(this.stylesheet.light)},t.prototype._serializeLayers=function(t){var e=this;return t.map(function(t){return e._layers[t].serialize()})},t.prototype._applyClasses=function(t,e){var n=this;if(this._loaded){t=t||[],e=e||{transition:!0};var r=this.stylesheet.transition||{},i=this._updatedAllPaintProps?this._layers:this._updatedPaintProps;for(var o in i){var a=n._layers[o],s=n._updatedPaintProps[o];if(n._updatedAllPaintProps||s.all)a.updatePaintTransitions(t,e,r,n.animationLoop,n.zoomHistory);else for(var u in s)n._layers[o].updatePaintTransition(u,t,e,r,n.animationLoop,n.zoomHistory)}this.light.updateLightTransitions(e,r,this.animationLoop)}},t.prototype._recalculate=function(t){var e=this;if(this._loaded){for(var n in this.sourceCaches)e.sourceCaches[n].used=!1;this._updateZoomHistory(t);for(var r=0,i=this._order;r<i.length;r+=1){var o=i[r],a=e._layers[o];a.recalculate(t),!a.isHidden(t)&&a.source&&(e.sourceCaches[a.source].used=!0)}this.light.recalculate(t);Math.floor(this.z)!==Math.floor(t)&&this.animationLoop.set(300),this.z=t}},t.prototype._updateZoomHistory=function(t){var e=this.zoomHistory;void 0===e.lastIntegerZoom&&(e.lastIntegerZoom=Math.floor(t),e.lastIntegerZoomTime=0,e.lastZoom=t),Math.floor(e.lastZoom)<Math.floor(t)?(e.lastIntegerZoom=Math.floor(t),e.lastIntegerZoomTime=Date.now()):Math.floor(e.lastZoom)>Math.floor(t)&&(e.lastIntegerZoom=Math.floor(t+1),e.lastIntegerZoomTime=Date.now()),e.lastZoom=t},t.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},t.prototype.update=function(t,e){var n=this;if(this._changed){var r=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);(r.length||i.length||this._updatedSymbolOrder)&&this._updateWorkerLayers(r,i);for(var o in this._updatedSources){var a=n._updatedSources[o];"reload"===a?n._reloadSource(o):"clear"===a&&n._clearSource(o)}this._applyClasses(t,e),this._resetUpdates(),this.fire("data",{dataType:"style"})}},t.prototype._updateWorkerLayers=function(t,e){var n=this,r=this._updatedSymbolOrder?this._order.filter(function(t){return"symbol"===n._layers[t].type}):null;this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e,symbolOrder:r})},t.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSymbolOrder=!1,this._updatedSources={},this._updatedPaintProps={},this._updatedAllPaintProps=!1},t.prototype.setState=function(t){var e=this;if(this._checkLoaded(),g.emitErrors(this,g(t)))return!1;t=p.extend({},t),t.layers=T(t.layers);var n=E(this.serialize(),t).filter(function(t){return!(t.command in C)});if(0===n.length)return!1;var r=n.filter(function(t){return!(t.command in P)});if(r.length>0)throw new Error("Unimplemented: "+r.map(function(t){return t.command}).join(", ")+".");return n.forEach(function(t){"setTransition"!==t.command&&e[t.command].apply(e,t.args)}),this.stylesheet=t,!0},t.prototype.addSource=function(t,e,n){if(this._checkLoaded(),void 0!==this.sourceCaches[t])throw new Error("There is already a source with this ID");if(!e.type)throw new Error("The type property must be defined, but the only the following properties were given: "+Object.keys(e)+".");if(!(["vector","raster","geojson","video","image","canvas"].indexOf(e.type)>=0&&this._validate(g.source,"sources."+t,e,null,n))){var r=this.sourceCaches[t]=new x(t,e,this.dispatcher);r.style=this,r.setEventedParent(this,function(){return{isSourceLoaded:r.loaded(),source:r.serialize(),sourceId:t}}),r.onAdd(this.map),this._changed=!0}},t.prototype.removeSource=function(t){if(this._checkLoaded(),void 0===this.sourceCaches[t])throw new Error("There is no source with this ID");var e=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],e.setEventedParent(null),e.clearTiles(),e.onRemove&&e.onRemove(this.map),this._changed=!0},t.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},t.prototype.addLayer=function(t,e,n){this._checkLoaded();var r=t.id;if("object"==typeof t.source&&(this.addSource(r,t.source),t=p.extend(t,{source:r})),!this._validate(g.layer,"layers."+r,t,{arrayIndex:-1},n)){var i=o.create(t);this._validateLayer(i),i.setEventedParent(this,{layer:{id:r}});var a=e?this._order.indexOf(e):this._order.length;if(this._order.splice(a,0,r),this._layers[r]=i,this._removedLayers[r]&&i.source){var s=this._removedLayers[r];delete this._removedLayers[r],this._updatedSources[i.source]=s.type!==i.type?"clear":"reload"}this._updateLayer(i),"symbol"===i.type&&(this._updatedSymbolOrder=!0),this.updateClasses(r)}},t.prototype.moveLayer=function(t,e){this._checkLoaded(),this._changed=!0;var n=this._layers[t];if(!n)return void this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be moved.")});var r=this._order.indexOf(t);this._order.splice(r,1);var i=e?this._order.indexOf(e):this._order.length;this._order.splice(i,0,t),"symbol"===n.type&&(this._updatedSymbolOrder=!0,n.source&&!this._updatedSources[n.source]&&(this._updatedSources[n.source]="reload"))},t.prototype.removeLayer=function(t){this._checkLoaded();var e=this._layers[t];if(!e)return void this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be removed.")});e.setEventedParent(null);var n=this._order.indexOf(t);this._order.splice(n,1),"symbol"===e.type&&(this._updatedSymbolOrder=!0),this._changed=!0,this._removedLayers[t]=e,delete this._layers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t]},t.prototype.getLayer=function(t){return this._layers[t]},t.prototype.setLayerZoomRange=function(t,e,n){this._checkLoaded();var r=this.getLayer(t);return r?void(r.minzoom===e&&r.maxzoom===n||(null!=e&&(r.minzoom=e),null!=n&&(r.maxzoom=n),this._updateLayer(r))):void this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot have zoom extent.")})},t.prototype.setFilter=function(t,e){this._checkLoaded();var n=this.getLayer(t);return n?void(null!==e&&void 0!==e&&this._validate(g.filter,"layers."+n.id+".filter",e)||p.deepEqual(n.filter,e)||(n.filter=p.clone(e),this._updateLayer(n))):void this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be filtered.")})},t.prototype.getFilter=function(t){return p.clone(this.getLayer(t).filter)},t.prototype.setLayoutProperty=function(t,e,n){this._checkLoaded();var r=this.getLayer(t);return r?void(p.deepEqual(r.getLayoutProperty(e),n)||(r.setLayoutProperty(e,n),this._updateLayer(r))):void this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be styled.")})},t.prototype.getLayoutProperty=function(t,e){return this.getLayer(t).getLayoutProperty(e)},t.prototype.setPaintProperty=function(t,e,n,r){this._checkLoaded();var i=this.getLayer(t);if(!i)return void this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be styled.")});if(!p.deepEqual(i.getPaintProperty(e,r),n)){var o=i.isPaintValueFeatureConstant(e);i.setPaintProperty(e,n,r);!(n&&w.isFunctionDefinition(n)&&"$zoom"!==n.property&&void 0!==n.property)&&o||this._updateLayer(i),this.updateClasses(t,e)}},t.prototype.getPaintProperty=function(t,e,n){return this.getLayer(t).getPaintProperty(e,n)},t.prototype.getTransition=function(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},t.prototype.updateClasses=function(t,e){if(this._changed=!0,t){var n=this._updatedPaintProps;n[t]||(n[t]={}),n[t][e||"all"]=!0}else this._updatedAllPaintProps=!0},t.prototype.serialize=function(){var t=this;return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:p.mapObject(this.sourceCaches,function(t){return t.serialize()}),layers:this._order.map(function(e){return t._layers[e].serialize()})},function(t){return void 0!==t})},t.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&(this._updatedSources[t.source]="reload"),this._changed=!0},t.prototype._flattenRenderedFeatures=function(t){for(var e=this,n=[],r=this._order.length-1;r>=0;r--)for(var i=e._order[r],o=0,a=t;o<a.length;o+=1){var s=a[o],u=s[i];if(u)for(var l=0,c=u;l<c.length;l+=1){var p=c[l];n.push(p)}}return n},t.prototype.queryRenderedFeatures=function(t,e,n,r){var i=this;e&&e.filter&&this._validate(g.filter,"queryRenderedFeatures.filter",e.filter);var o={};if(e&&e.layers)for(var a=0,s=e.layers;a<s.length;a+=1){var u=s[a],l=i._layers[u];if(!l)return void i.fire("error",{error:"The layer '"+u+"' does not exist in the map's style and cannot be queried for features."});o[l.source]=!0}var c=[];for(var p in this.sourceCaches)if(!e.layers||o[p]){var h=_.rendered(i.sourceCaches[p],i._layers,t,e,n,r);c.push(h)}return this._flattenRenderedFeatures(c)},t.prototype.querySourceFeatures=function(t,e){e&&e.filter&&this._validate(g.filter,"querySourceFeatures.filter",e.filter);var n=this.sourceCaches[t];return n?_.source(n,e):[]},t.prototype.addSourceType=function(t,e,n){return v.getType(t)?n(new Error('A source type called "'+t+'" already exists.')):(v.setType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},n):n(null,null))},t.prototype.getLight=function(){return this.light.getLight()},t.prototype.setLight=function(t,e){this._checkLoaded();var n=this.light.getLight(),r=!1;for(var i in t)if(!p.deepEqual(t[i],n[i])){r=!0;break}if(r){var o=this.stylesheet.transition||{};this.light.setLight(t),this.light.updateLightTransitions(e||{transition:!0},o,this.animationLoop)}},t.prototype._validate=function(t,e,n,r,i){return(!i||i.validate!==!1)&&g.emitErrors(this,t.call(g,p.extend({key:e,style:this.serialize(),value:n,styleSpec:b},r)))},t.prototype._remove=function(){var t=this;for(var e in this.sourceCaches)t.sourceCaches[e].clearTiles();this.dispatcher.remove()},t.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles()},t.prototype._reloadSource=function(t){this.sourceCaches[t].reload()},t.prototype._updateSources=function(t){var e=this;for(var n in this.sourceCaches)e.sourceCaches[n].update(t)},t.prototype._redoPlacement=function(){var t=this;for(var e in this.sourceCaches)t.sourceCaches[e].redoPlacement()},t.prototype.getIcons=function(t,e,n){var r=this,i=function(){r.spriteAtlas.setSprite(r.sprite),r.spriteAtlas.addIcons(e.icons,n)};this.sprite.loaded()?i():this.sprite.on("data",i)},t.prototype.getGlyphs=function(t,e,n){function i(t,e,r){t&&console.error(t),s[r]=e,0===--a&&n(null,s)}var r=this,o=e.stacks,a=Object.keys(o).length,s={};for(var u in o)r.glyphSource.getSimpleGlyphs(u,o[u],e.uid,i)},t}(i);n.exports=M},{"../global_worker_pool":22,"../render/line_atlas":35,"../source/query_features":47,"../source/rtl_text_plugin":49,"../source/source":50,"../source/source_cache":51,"../symbol/glyph_source":83,"../symbol/sprite_atlas":88,"../util/ajax":109,"../util/browser":110,"../util/dispatcher":116,"../util/evented":118,"../util/mapbox":125,"../util/util":129,"./animation_loop":59,"./image_sprite":60,"./light":61,"./style_layer":65,"./style_spec":72,"./validate_style":74,"mapbox-gl-function":164,"mapbox-gl-style-spec/lib/deref":165,"mapbox-gl-style-spec/lib/diff":166}],64:[function(t,e,n){"use strict";var r=t("mapbox-gl-function"),i=t("./parse_color"),o=t("../util/util"),a=function(t,e){var n=this;this.value=o.clone(e),this.isFunction=r.isFunctionDefinition(e),this.json=JSON.stringify(this.value),this.minimum=t.minimum,this.isColor="color"===t.type;var a=this.isColor&&this.value?i(this.value):e,s=t.default;if(s&&"color"===t.type&&(s=i(s)),this.function=r[t.function||"piecewise-constant"](a,s),this.isFeatureConstant=this.function.isFeatureConstant,this.isZoomConstant=this.function.isZoomConstant,!this.isFeatureConstant&&!this.isZoomConstant){this.stopZoomLevels=[];for(var u=[],l=0,c=this.value.stops;l<c.length;l+=1){var p=c[l],h=p[0].zoom;n.stopZoomLevels.indexOf(h)<0&&(n.stopZoomLevels.push(h),u.push([h,u.length]))}this.functionInterpolationT=r.interpolated({stops:u,base:e.base,colorSpace:e.colorSpace})}};a.prototype.calculate=function(t,e){var n=this.function(t&&t.zoom,e||{});return this.isColor&&n?i(n):void 0!==this.minimum&&n<this.minimum?this.minimum:n},a.prototype.calculateInterpolationT=function(t,e){return this.functionInterpolationT(t&&t.zoom,e||{})},e.exports=a},{"../util/util":129,"./parse_color":62,"mapbox-gl-function":164}],65:[function(t,e,n){"use strict";function getDeclarationValue(t){return t.value}var r=t("../util/util"),o=t("./style_transition"),a=t("./style_declaration"),s=t("./style_spec"),u=t("./validate_style"),l=t("./parse_color"),c=t("../util/evented"),p="-transition",h=function(t){function i(e){var n=this;t.call(this),this.id=e.id,this.metadata=e.metadata,this.type=e.type,this.source=e.source,this.sourceLayer=e["source-layer"],this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this.filter=e.filter,this.paint={},this.layout={},this._paintSpecifications=s["paint_"+this.type],this._layoutSpecifications=s["layout_"+this.type],this._paintTransitions={},this._paintTransitionOptions={},this._paintDeclarations={},this._layoutDeclarations={},this._layoutFunctions={};var r,i,o={validate:!1};for(var a in e){var u=a.match(/^paint(?:\.(.*))?$/);if(u){var l=u[1]||"";for(r in e[a])n.setPaintProperty(r,e[a][r],l,o)}}for(i in e.layout)n.setLayoutProperty(i,e.layout[i],o);for(r in this._paintSpecifications)n.paint[r]=n.getPaintValue(r);for(i in this._layoutSpecifications)n._updateLayoutValue(i)}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.setLayoutProperty=function(t,e,n){if(null==e)delete this._layoutDeclarations[t];else{var r="layers."+this.id+".layout."+t;if(this._validate(u.layoutProperty,r,t,e,n))return;this._layoutDeclarations[t]=new a(this._layoutSpecifications[t],e)}this._updateLayoutValue(t)},i.prototype.getLayoutProperty=function(t){return this._layoutDeclarations[t]&&this._layoutDeclarations[t].value},i.prototype.getLayoutValue=function(t,e,n){var r=this._layoutSpecifications[t],i=this._layoutDeclarations[t];return i?i.calculate(e,n):r.default},i.prototype.setPaintProperty=function(t,e,n,i){var o="layers."+this.id+(n?'["paint.'+n+'"].':".paint.")+t;if(r.endsWith(t,p))if(this._paintTransitionOptions[n||""]||(this._paintTransitionOptions[n||""]={}),null===e||void 0===e)delete this._paintTransitionOptions[n||""][t];else{if(this._validate(u.paintProperty,o,t,e,i))return;this._paintTransitionOptions[n||""][t]=e}else if(this._paintDeclarations[n||""]||(this._paintDeclarations[n||""]={}),null===e||void 0===e)delete this._paintDeclarations[n||""][t];else{if(this._validate(u.paintProperty,o,t,e,i))return;this._paintDeclarations[n||""][t]=new a(this._paintSpecifications[t],e)}},i.prototype.getPaintProperty=function(t,e){return e=e||"",r.endsWith(t,p)?this._paintTransitionOptions[e]&&this._paintTransitionOptions[e][t]:this._paintDeclarations[e]&&this._paintDeclarations[e][t]&&this._paintDeclarations[e][t].value},i.prototype.getPaintValue=function(t,e,n){var r=this._paintSpecifications[t],i=this._paintTransitions[t];return i?i.calculate(e,n):"color"===r.type&&r.default?l(r.default):r.default},i.prototype.getPaintValueStopZoomLevels=function(t){var e=this._paintTransitions[t];return e?e.declaration.stopZoomLevels:[]},i.prototype.getPaintInterpolationT=function(t,e){return this._paintTransitions[t].declaration.calculateInterpolationT(e)},i.prototype.isPaintValueFeatureConstant=function(t){var e=this._paintTransitions[t];return!e||e.declaration.isFeatureConstant},i.prototype.isLayoutValueFeatureConstant=function(t){var e=this._layoutDeclarations[t];return!e||e.isFeatureConstant},i.prototype.isPaintValueZoomConstant=function(t){var e=this._paintTransitions[t];return!e||e.declaration.isZoomConstant},i.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.layout.visibility},i.prototype.updatePaintTransitions=function(t,e,n,i,o){for(var a=this,s=r.extend({},this._paintDeclarations[""]),u=0;u<t.length;u++)r.extend(s,a._paintDeclarations[t[u]]);var l;for(l in s)a._applyPaintDeclaration(l,s[l],e,n,i,o);for(l in this._paintTransitions)l in s||a._applyPaintDeclaration(l,null,e,n,i,o)},i.prototype.updatePaintTransition=function(t,e,n,r,i,o){for(var a=this,s=this._paintDeclarations[""][t],u=0;u<e.length;u++){var l=a._paintDeclarations[e[u]];l&&l[t]&&(s=l[t])}this._applyPaintDeclaration(t,s,n,r,i,o)},i.prototype.recalculate=function(t){var e=this;for(var n in this._paintTransitions)e.paint[n]=e.getPaintValue(n,{zoom:t});for(var r in this._layoutFunctions)e.layout[r]=e.getLayoutValue(r,{zoom:t})},i.prototype.serialize=function(){var t=this,e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:r.mapObject(this._layoutDeclarations,getDeclarationValue)};for(var n in this._paintDeclarations){e[""===n?"paint":"paint."+n]=r.mapObject(t._paintDeclarations[n],getDeclarationValue)}return r.filterObject(e,function(t,e){return void 0!==t&&!("layout"===e&&!Object.keys(t).length)})},i.prototype._applyPaintDeclaration=function(t,e,n,i,s,u){var l=n.transition?this._paintTransitions[t]:void 0,c=this._paintSpecifications[t];if(null!==e&&void 0!==e||(e=new a(c,c.default)),!l||l.declaration.json!==e.json){var h=r.extend({duration:300,delay:0},i,this.getPaintProperty(t+p)),f=this._paintTransitions[t]=new o(c,e,l,h,u);f.instant()||(f.loopID=s.set(f.endTime-Date.now())),l&&s.cancel(l.loopID)}},i.prototype._updateLayoutValue=function(t){var e=this._layoutDeclarations[t];e&&e.isFunction?this._layoutFunctions[t]=!0:(delete this._layoutFunctions[t],this.layout[t]=this.getLayoutValue(t))},i.prototype._validate=function(t,e,n,r,i){return(!i||i.validate!==!1)&&u.emitErrors(this,t.call(u,{key:e,layerType:this.type,objectKey:n,value:r,styleSpec:s,style:{glyphs:!0,sprite:!0}}))},i}(c);e.exports=h;var f={circle:t("./style_layer/circle_style_layer"),fill:t("./style_layer/fill_style_layer"),"fill-extrusion":t("./style_layer/fill_extrusion_style_layer"),line:t("./style_layer/line_style_layer"),symbol:t("./style_layer/symbol_style_layer")};h.create=function(t){return new(f[t.type]||h)(t)}},{"../util/evented":118,"../util/util":129,"./parse_color":62,"./style_declaration":64,"./style_layer/circle_style_layer":66,"./style_layer/fill_extrusion_style_layer":67,"./style_layer/fill_style_layer":68,"./style_layer/line_style_layer":69,"./style_layer/symbol_style_layer":70,"./style_spec":72,"./style_transition":73,"./validate_style":74}],66:[function(e,n,r){"use strict";var i=e("../style_layer"),o=e("../../data/bucket/circle_bucket"),a=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.createBucket=function(t){return new o(t)},t}(i);n.exports=a},{"../../data/bucket/circle_bucket":3,"../style_layer":65}],67:[function(t,n,r){"use strict";var i=t("../style_layer"),o=t("../../data/bucket/fill_extrusion_bucket"),a=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPaintValue=function(e,n,r){var i=t.prototype.getPaintValue.call(this,e,n,r);return"fill-extrusion-color"===e&&i&&(i[3]=1),i},e.prototype.createBucket=function(t){return new o(t)},e}(i);n.exports=a},{"../../data/bucket/fill_extrusion_bucket":5,"../style_layer":65}],68:[function(t,e,n){"use strict";var r=t("../style_layer"),i=t("../../data/bucket/fill_bucket"),a=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.getPaintValue=function(e,n,r){var i=this;if("fill-outline-color"===e){if(void 0===this.getPaintProperty("fill-outline-color"))return t.prototype.getPaintValue.call(this,"fill-color",n,r);for(var o=this._paintTransitions["fill-outline-color"];o;){if(!(o&&o.declaration&&o.declaration.value))return t.prototype.getPaintValue.call(i,"fill-color",n,r);o=o.oldTransition}}return t.prototype.getPaintValue.call(this,e,n,r)},o.prototype.getPaintValueStopZoomLevels=function(e){return"fill-outline-color"===e&&void 0===this.getPaintProperty("fill-outline-color")?t.prototype.getPaintValueStopZoomLevels.call(this,"fill-color"):t.prototype.getPaintValueStopZoomLevels.call(this,e)},o.prototype.getPaintInterpolationT=function(e,n){return"fill-outline-color"===e&&void 0===this.getPaintProperty("fill-outline-color")?t.prototype.getPaintInterpolationT.call(this,"fill-color",n):t.prototype.getPaintInterpolationT.call(this,e,n)},o.prototype.isPaintValueFeatureConstant=function(e){return"fill-outline-color"===e&&void 0===this.getPaintProperty("fill-outline-color")?t.prototype.isPaintValueFeatureConstant.call(this,"fill-color"):t.prototype.isPaintValueFeatureConstant.call(this,e)},o.prototype.isPaintValueZoomConstant=function(e){return"fill-outline-color"===e&&void 0===this.getPaintProperty("fill-outline-color")?t.prototype.isPaintValueZoomConstant.call(this,"fill-color"):t.prototype.isPaintValueZoomConstant.call(this,e)},o.prototype.createBucket=function(t){return new i(t)},o}(r);e.exports=a},{"../../data/bucket/fill_bucket":4,"../style_layer":65}],69:[function(e,n,r){"use strict";var i=e("../style_layer"),o=e("../../data/bucket/line_bucket"),a=e("../../util/util"),s=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getPaintValue=function(t,n,r){var i=e.prototype.getPaintValue.call(this,t,n,r);if(i&&"line-dasharray"===t){var o=this.getPaintValue("line-width",a.extend({},n,{zoom:Math.floor(n.zoom)}),r);i.fromScale*=o,i.toScale*=o}return i},t.prototype.createBucket=function(t){return new o(t)},t}(i);n.exports=s},{"../../data/bucket/line_bucket":6,"../../util/util":129,"../style_layer":65}],70:[function(t,n,r){"use strict";var i=t("../style_layer"),o=t("../../data/bucket/symbol_bucket"),a=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getLayoutValue=function(e,n,r){var i=t.prototype.getLayoutValue.call(this,e,n,r);if("auto"!==i)return i;switch(e){case"text-rotation-alignment":case"icon-rotation-alignment":return"line"===this.getLayoutValue("symbol-placement",n,r)?"map":"viewport";case"text-pitch-alignment":return this.getLayoutValue("text-rotation-alignment",n,r);default:return i}},e.prototype.createBucket=function(t){return new o(t)},e}(i);n.exports=a},{"../../data/bucket/symbol_bucket":7,"../style_layer":65}],71:[function(t,e,n){"use strict";var r=t("./style_layer"),i=t("../util/util"),o=t("feature-filter"),a=t("mapbox-gl-style-spec/lib/group_by_layout"),s=function(t){t&&this.replace(t)};s.prototype.replace=function(t){var e=this;this.symbolOrder=[];for(var n=0,r=t;n<r.length;n+=1){var i=r[n];"symbol"===i.type&&e.symbolOrder.push(i.id)}this._layerConfigs={},this._layers={},this.update(t,[])},s.prototype.update=function(t,e,n){for(var s=this,u=0,l=t;u<l.length;u+=1){var c=l[u];s._layerConfigs[c.id]=c;var p=s._layers[c.id]=r.create(c);p.updatePaintTransitions({},{transition:!1}),p.filter=o(p.filter)}for(var h=0,f=e;h<f.length;h+=1){var d=f[h];delete s._layerConfigs[d],delete s._layers[d]}n&&(this.symbolOrder=n),this.familiesBySource={};for(var m=a(i.values(this._layerConfigs)),y=0,g=m;y<g.length;y+=1){var v=g[y],_=v.map(function(t){return s._layers[t.id]}),x=_[0];if(!x.layout||"none"!==x.layout.visibility){var b=x.source||"",w=s.familiesBySource[b];w||(w=s.familiesBySource[b]={});var S=x.sourceLayer||"_geojsonTileLayer",T=w[S];T||(T=w[S]=[]),T.push(_)}}},e.exports=s},{"../util/util":129,"./style_layer":65,"feature-filter":138,"mapbox-gl-style-spec/lib/group_by_layout":168}],72:[function(t,e,n){"use strict";e.exports=t("mapbox-gl-style-spec/reference/latest.min")},{"mapbox-gl-style-spec/reference/latest.min":191}],73:[function(t,e,n){"use strict";function interpZoomTransitioned(t,e,n){if(void 0!==t&&void 0!==e)return{from:t.to,fromScale:t.toScale,to:e.to,toScale:e.toScale,t:n}}var r=t("../util/util"),i=t("../util/interpolate"),o={lastIntegerZoom:0,lastIntegerZoomTime:0,lastZoom:0},a=function(t,e,n,r,a){this.declaration=e,this.startTime=this.endTime=(new Date).getTime(),this.oldTransition=n,this.duration=r.duration||0,this.delay=r.delay||0,this.zoomTransitioned="piecewise-constant"===t.function&&t.transition,this.interp=this.zoomTransitioned?interpZoomTransitioned:i[t.type],this.zoomHistory=a||o,this.instant()||(this.endTime=this.startTime+this.duration+this.delay),n&&n.endTime<=this.startTime&&delete n.oldTransition};a.prototype.instant=function(){return!this.oldTransition||!this.interp||0===this.duration&&0===this.delay},a.prototype.calculate=function(t,e,n){var i=this._calculateTargetValue(t,e);if(this.instant())return i;if((n=n||Date.now())>=this.endTime)return i;var o=this.oldTransition.calculate(t,e,this.startTime),a=r.easeCubicInOut((n-this.startTime-this.delay)/this.duration);return this.interp(o,i,a)},a.prototype._calculateTargetValue=function(t,e){if(!this.zoomTransitioned)return this.declaration.calculate(t,e);var n=t.zoom,r=this.zoomHistory.lastIntegerZoom,o=n>r?2:.5,a=this.declaration.calculate({zoom:n>r?n-1:n+1},e),s=this.declaration.calculate({zoom:n},e),u=Math.min((Date.now()-this.zoomHistory.lastIntegerZoomTime)/this.duration,1),l=Math.abs(n-r),c=i(u,1,l);return void 0!==a&&void 0!==s?{from:a,fromScale:o,to:s,toScale:1,t:c}:void 0},e.exports=a},{"../util/interpolate":121,"../util/util":129}],74:[function(t,e,n){"use strict";e.exports=t("mapbox-gl-style-spec/lib/validate_style.min"),e.exports.emitErrors=function(t,e){if(e&&e.length){for(var n=0;n<e.length;n++)t.fire("error",{error:new Error(e[n].message)});return!0}return!1}},{"mapbox-gl-style-spec/lib/validate_style.min":190}],75:[function(t,e,n){"use strict";var r=t("point-geometry"),i=function(t){function o(e,n,r,i){t.call(this,e,n),this.angle=r,void 0!==i&&(this.segment=i)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.clone=function(){return new o(this.x,this.y,this.angle,this.segment)},o}(r);e.exports=i},{"point-geometry":197}],76:[function(t,e,n){"use strict";function checkMaxAngle(t,e,n,r,i){if(void 0===e.segment)return!0;for(var o=e,a=e.segment+1,s=0;s>-n/2;){if(--a<0)return!1;s-=t[a].dist(o),o=t[a]}s+=t[a].dist(t[a+1]),a++;for(var u=[],l=0;s<n/2;){var c=t[a-1],p=t[a],h=t[a+1];if(!h)return!1;var f=c.angleTo(p)-p.angleTo(h);for(f=Math.abs((f+3*Math.PI)%(2*Math.PI)-Math.PI),u.push({distance:s,angleDelta:f}),l+=f;s-u[0].distance>r;)l-=u.shift().angleDelta;if(l>i)return!1;a++,s+=p.dist(h)}return!0}e.exports=checkMaxAngle},{}],77:[function(t,e,n){"use strict";function clipLine(t,e,n,i,o){for(var a=[],s=0;s<t.length;s++)for(var u,l=t[s],c=0;c<l.length-1;c++){var p=l[c],h=l[c+1];p.x<e&&h.x<e||(p.x<e?p=new r(e,p.y+(h.y-p.y)*((e-p.x)/(h.x-p.x)))._round():h.x<e&&(h=new r(e,p.y+(h.y-p.y)*((e-p.x)/(h.x-p.x)))._round()),p.y<n&&h.y<n||(p.y<n?p=new r(p.x+(h.x-p.x)*((n-p.y)/(h.y-p.y)),n)._round():h.y<n&&(h=new r(p.x+(h.x-p.x)*((n-p.y)/(h.y-p.y)),n)._round()),p.x>=i&&h.x>=i||(p.x>=i?p=new r(i,p.y+(h.y-p.y)*((i-p.x)/(h.x-p.x)))._round():h.x>=i&&(h=new r(i,p.y+(h.y-p.y)*((i-p.x)/(h.x-p.x)))._round()),p.y>=o&&h.y>=o||(p.y>=o?p=new r(p.x+(h.x-p.x)*((o-p.y)/(h.y-p.y)),o)._round():h.y>=o&&(h=new r(p.x+(h.x-p.x)*((o-p.y)/(h.y-p.y)),o)._round()),u&&p.equals(u[u.length-1])||(u=[p],a.push(u)),u.push(h)))))}return a}var r=t("point-geometry");e.exports=clipLine},{"point-geometry":197}],78:[function(t,e,n){"use strict";var r=t("../util/struct_array"),i=t("point-geometry"),o=r({members:[{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Float32",name:"maxScale"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"bbox0"},{type:"Int16",name:"bbox1"},{type:"Int16",name:"bbox2"},{type:"Int16",name:"bbox3"},{type:"Float32",name:"placementScale"}]});Object.defineProperty(o.prototype.StructType.prototype,"anchorPoint",{get:function(){return new i(this.anchorPointX,this.anchorPointY)}}),e.exports=o},{"../util/struct_array":127,"point-geometry":197}],79:[function(t,e,n){"use strict";var r=function(t,e,n,r,i,o,a,s,u,l,c){var p=a.top*s-u,h=a.bottom*s+u,f=a.left*s-u,d=a.right*s+u;if(this.boxStartIndex=t.length,l){var m=h-p,y=d-f;if(m>0)if(m=Math.max(10*s,m),c){var g=e[n.segment+1].sub(e[n.segment])._unit()._mult(y),v=[n.sub(g),n.add(g)];this._addLineCollisionBoxes(t,v,n,0,y,m,r,i,o)}else this._addLineCollisionBoxes(t,e,n,n.segment,y,m,r,i,o)}else t.emplaceBack(n.x,n.y,f,p,d,h,1/0,r,i,o,0,0,0,0,0);this.boxEndIndex=t.length};r.prototype._addLineCollisionBoxes=function(t,e,n,r,i,o,a,s,u){var l=o/2,c=Math.floor(i/l),p=-o/2,h=this.boxes,f=n,d=r+1,m=p;do{if(--d<0)return h;m-=e[d].dist(f),f=e[d]}while(m>-i/2);for(var y=e[d].dist(e[d+1]),g=0;g<c;g++){for(var v=-i/2+g*l;m+y<v;){if(m+=y,++d+1>=e.length)return h;y=e[d].dist(e[d+1])}var _=v-m,x=e[d],b=e[d+1],w=b.sub(x)._unit()._mult(_)._add(x)._round(),S=Math.max(Math.abs(v-p)-l/2,0),T=i/2/S;t.emplaceBack(w.x,w.y,-o/2,-o/2,o/2,o/2,T,a,s,u,0,0,0,0,0)}return h},e.exports=r},{}],80:[function(t,e,n){"use strict";var r=t("point-geometry"),i=t("../data/extent"),o=t("grid-index"),a=t("../util/intersection_tests"),s=function(t,e,n){if("object"==typeof t){var r=t;n=e,t=r.angle,e=r.pitch,this.grid=new o(r.grid),this.ignoredGrid=new o(r.ignoredGrid)}else this.grid=new o(i,12,6),this.ignoredGrid=new o(i,12,0);this.minScale=.5,this.maxScale=2,this.angle=t,this.pitch=e;var a=Math.sin(t),s=Math.cos(t);if(this.rotationMatrix=[s,-a,a,s],this.reverseRotationMatrix=[s,a,-a,s],this.yStretch=1/Math.cos(e/180*Math.PI),this.yStretch=Math.pow(this.yStretch,1.3),this.collisionBoxArray=n,0===n.length){n.emplaceBack();var u=32767;n.emplaceBack(0,0,0,-u,0,u,u,0,0,0,0,0,0,0,0,0),n.emplaceBack(i,0,0,-u,0,u,u,0,0,0,0,0,0,0,0,0),n.emplaceBack(0,0,-u,0,u,0,u,0,0,0,0,0,0,0,0,0),n.emplaceBack(0,i,-u,0,u,0,u,0,0,0,0,0,0,0,0,0)}this.tempCollisionBox=n.get(0),this.edges=[n.get(1),n.get(2),n.get(3),n.get(4)]};s.prototype.serialize=function(t){var e=this.grid.toArrayBuffer(),n=this.ignoredGrid.toArrayBuffer();return t&&(t.push(e),t.push(n)),{angle:this.angle,pitch:this.pitch,grid:e,ignoredGrid:n}},s.prototype.placeCollisionFeature=function(t,e,n){for(var i=this,o=this.collisionBoxArray,a=this.minScale,s=this.rotationMatrix,u=this.yStretch,l=t.boxStartIndex;l<t.boxEndIndex;l++){var c=o.get(l),p=c.anchorPoint._matMult(s),h=p.x,f=p.y,d=h+c.x1,m=f+c.y1*u,y=h+c.x2,g=f+c.y2*u;if(c.bbox0=d,c.bbox1=m,c.bbox2=y,c.bbox3=g,!e)for(var v=i.grid.query(d,m,y,g),_=0;_<v.length;_++){var x=o.get(v[_]),b=x.anchorPoint._matMult(s);if((a=i.getPlacementScale(a,p,c,b,x))>=i.maxScale)return a}if(n){var w;if(i.angle){var S=i.reverseRotationMatrix,T=new r(c.x1,c.y1).matMult(S),E=new r(c.x2,c.y1).matMult(S),A=new r(c.x1,c.y2).matMult(S),P=new r(c.x2,c.y2).matMult(S);w=i.tempCollisionBox,w.anchorPointX=c.anchorPoint.x,w.anchorPointY=c.anchorPoint.y,w.x1=Math.min(T.x,E.x,A.x,P.x),w.y1=Math.min(T.y,E.x,A.x,P.x),w.x2=Math.max(T.x,E.x,A.x,P.x),w.y2=Math.max(T.y,E.x,A.x,P.x),w.maxScale=c.maxScale}else w=c;for(var C=0;C<this.edges.length;C++){var M=i.edges[C];if((a=i.getPlacementScale(a,c.anchorPoint,w,M.anchorPoint,M))>=i.maxScale)return a}}}return a},s.prototype.queryRenderedSymbols=function(t,e){var n={},i=[];if(0===t.length||0===this.grid.length&&0===this.ignoredGrid.length)return i;for(var o=this.collisionBoxArray,s=this.rotationMatrix,u=this.yStretch,l=[],c=1/0,p=1/0,h=-(1/0),f=-(1/0),d=0;d<t.length;d++)for(var m=t[d],y=0;y<m.length;y++){var g=m[y].matMult(s);c=Math.min(c,g.x),p=Math.min(p,g.y),h=Math.max(h,g.x),f=Math.max(f,g.y),l.push(g)}for(var v=this.grid.query(c,p,h,f),_=this.ignoredGrid.query(c,p,h,f),x=0;x<_.length;x++)v.push(_[x]);for(var b=Math.pow(2,Math.ceil(Math.log(e)/Math.LN2*10)/10),w=0;w<v.length;w++){var S=o.get(v[w]),T=S.sourceLayerIndex,E=S.featureIndex;if(void 0===n[T]&&(n[T]={}),!n[T][E]&&!(b<S.placementScale||b>S.maxScale)){var A=S.anchorPoint.matMult(s),P=A.x+S.x1/e,C=A.y+S.y1/e*u,M=A.x+S.x2/e,k=A.y+S.y2/e*u,z=[new r(P,C),new r(M,C),new r(M,k),new r(P,k)];a.polygonIntersectsPolygon(l,z)&&(n[T][E]=!0,i.push(v[w]))}}return i},s.prototype.getPlacementScale=function(t,e,n,r,i){var o=e.x-r.x,a=e.y-r.y,s=(i.x1-n.x2)/o,u=(i.x2-n.x1)/o,l=(i.y1-n.y2)*this.yStretch/a,c=(i.y2-n.y1)*this.yStretch/a;(isNaN(s)||isNaN(u))&&(s=u=1),(isNaN(l)||isNaN(c))&&(l=c=1);var p=Math.min(Math.max(s,u),Math.max(l,c)),h=i.maxScale,f=n.maxScale;return p>h&&(p=h),p>f&&(p=f),p>t&&p>=i.placementScale&&(t=p),t},s.prototype.insertCollisionFeature=function(t,e,n){for(var r=this,i=n?this.ignoredGrid:this.grid,o=this.collisionBoxArray,a=t.boxStartIndex;a<t.boxEndIndex;a++){var s=o.get(a);s.placementScale=e,e<r.maxScale&&i.insert(a,s.bbox0,s.bbox1,s.bbox2,s.bbox3)}},e.exports=s},{"../data/extent":11,"../util/intersection_tests":122,"grid-index":149,"point-geometry":197}],81:[function(t,e,n){"use strict";function getAnchors(t,e,n,r,i,o,a,s,u){var l=r?.6*o*a:0,c=Math.max(r?r.right-r.left:0,i?i.right-i.left:0),p=0===t[0].x||t[0].x===u||0===t[0].y||t[0].y===u;e-c*a<e/4&&(e=c*a+e/4);var h=2*o;return resample(t,p?e/2*s%e:(c/2+h)*a*s%e,e,l,n,c*a,p,!1,u)}function resample(t,e,n,a,s,u,l,c,p){for(var h=u/2,f=0,d=0;d<t.length-1;d++)f+=t[d].dist(t[d+1]);for(var m=0,y=e-n,g=[],v=0;v<t.length-1;v++){for(var _=t[v],x=t[v+1],b=_.dist(x),w=x.angleTo(_);y+n<m+b;){y+=n;var S=(y-m)/b,T=r(_.x,x.x,S),E=r(_.y,x.y,S);if(T>=0&&T<p&&E>=0&&E<p&&y-h>=0&&y+h<=f){var A=new i(T,E,w,v)._round();a&&!o(t,A,u,a,s)||g.push(A)}}m+=b}return c||g.length||l||(g=resample(t,m/2,n,a,s,u,l,!0,p)),g}var r=t("../util/interpolate"),i=t("../symbol/anchor"),o=t("./check_max_angle");e.exports=getAnchors},{"../symbol/anchor":75,"../util/interpolate":121,"./check_max_angle":76}],82:[function(t,e,n){"use strict";var r=t("shelf-pack"),i=t("../util/util"),o=4,a=128,s=2048,u=function(){this.width=a,this.height=a,this.bin=new r(this.width,this.height),this.index={},this.ids={},this.data=new Uint8Array(this.width*this.height)};u.prototype.getGlyphs=function(){var t,e,n,r={};for(var i in this.ids)t=i.split("#"),e=t[0],n=t[1],r[e]||(r[e]=[]),r[e].push(n);return r},u.prototype.getRects=function(){var t,e,n,r=this,i={};for(var o in this.ids)t=o.split("#"),e=t[0],n=t[1],i[e]||(i[e]={}),i[e][n]=r.index[o];return i},u.prototype.addGlyph=function(t,e,n,r){var o=this;if(!n)return null;var a=e+"#"+n.id;if(this.index[a])return this.ids[a].indexOf(t)<0&&this.ids[a].push(t),this.index[a];if(!n.bitmap)return null;var s=n.width+2*r,u=n.height+2*r,l=1,c=s+2*l,p=u+2*l;c+=4-c%4,p+=4-p%4;var h=this.bin.packOne(c,p);if(h||(this.resize(),h=this.bin.packOne(c,p)),!h)return i.warnOnce("glyph bitmap overflow"),null;this.index[a]=h,this.ids[a]=[t];for(var f=this.data,d=n.bitmap,m=0;m<u;m++)for(var y=o.width*(h.y+m+l)+h.x+l,g=s*m,v=0;v<s;v++)f[y+v]=d[g+v];return this.dirty=!0,h},u.prototype.resize=function(){var t=this,e=this.width,n=this.height;if(!(e>=s||n>=s)){this.texture&&(this.gl&&this.gl.deleteTexture(this.texture),this.texture=null),this.width*=o,this.height*=o,this.bin.resize(this.width,this.height);for(var r=new ArrayBuffer(this.width*this.height),i=0;i<n;i++){var a=new Uint8Array(t.data.buffer,n*i,e);new Uint8Array(r,n*i*o,e).set(a)}this.data=new Uint8Array(r)}},u.prototype.bind=function(t){this.gl=t,this.texture?t.bindTexture(t.TEXTURE_2D,this.texture):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,this.width,this.height,0,t.ALPHA,t.UNSIGNED_BYTE,null))},u.prototype.updateTexture=function(t){this.bind(t),this.dirty&&(t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.ALPHA,t.UNSIGNED_BYTE,this.data),this.dirty=!1)},e.exports=u},{"../util/util":129,"shelf-pack":200}],83:[function(t,e,n){"use strict";function glyphUrl(t,e,n,r){return r=r||"abc",n.replace("{s}",r[t.length%r.length]).replace("{fontstack}",t).replace("{range}",e)}var r=t("../util/mapbox").normalizeGlyphsURL,i=t("../util/ajax"),o=t("../util/verticalize_punctuation"),a=t("../util/glyphs"),s=t("../symbol/glyph_atlas"),u=t("pbf"),l=function(t,e,n){var r=1;this.advance=t.advance,this.left=t.left-n-r,this.top=t.top+n+r,this.rect=e},c=function(t){this.url=t&&r(t),this.atlases={},this.stacks={},this.loading={}};c.prototype.getSimpleGlyphs=function(t,e,n,r){var i=this;void 0===this.stacks[t]&&(this.stacks[t]={}),void 0===this.atlases[t]&&(this.atlases[t]=new s);for(var a={},u=this.stacks[t],c=this.atlases[t],p=3,h={},f=0,d=function(e){var r=Math.floor(e/256);if(u[r]){var i=u[r].glyphs[e],o=c.addGlyph(n,t,i,p);i&&(a[e]=new l(i,o,p))}else void 0===h[r]&&(h[r]=[],f++),h[r].push(e)},m=0;m<e.length;m++){var y=e[m],g=String.fromCharCode(y);d(y),o.lookup[g]&&d(o.lookup[g].charCodeAt(0))}f||r(void 0,a,t);var v=function(e,o,s){if(!e)for(var u=i.stacks[t][o]=s.stacks[0],d=0;d<h[o].length;d++){var m=h[o][d],y=u.glyphs[m],g=c.addGlyph(n,t,y,p);y&&(a[m]=new l(y,g,p))}--f||r(void 0,a,t)};for(var _ in h)i.loadRange(t,_,v)},c.prototype.loadRange=function(t,e,n){if(256*e>65535)return n("glyphs > 65535 not supported");void 0===this.loading[t]&&(this.loading[t]={});var r=this.loading[t];if(r[e])r[e].push(n);else{r[e]=[n];var o=256*e+"-"+(256*e+255),s=glyphUrl(t,o,this.url);i.getArrayBuffer(s,function(t,n){for(var i=!t&&new a(new u(n.data)),o=0;o<r[e].length;o++)r[e][o](t,e,i);delete r[e]})}},c.prototype.getGlyphAtlas=function(t){return this.atlases[t]},e.exports=c},{"../symbol/glyph_atlas":82,"../util/ajax":109,"../util/glyphs":120,"../util/mapbox":125,"../util/verticalize_punctuation":131,pbf:196}],84:[function(t,e,n){"use strict";e.exports=function(e){function t(t){s.push(e[t]),u++}function r(t,e,n){var r=a[t];return delete a[t],a[e]=r,s[r].geometry[0].pop(),s[r].geometry[0]=s[r].geometry[0].concat(n[0]),r}function n(t,e,n){var r=i[e];return delete i[e],i[t]=r,s[r].geometry[0].shift(),s[r].geometry[0]=n[0].concat(s[r].geometry[0]),r}function o(t,e,n){var r=n?e[0][e[0].length-1]:e[0][0];return t+":"+r.x+":"+r.y}for(var i={},a={},s=[],u=0,l=0;l<e.length;l++){var c=e[l],p=c.geometry,h=c.text;if(h){var f=o(h,p),d=o(h,p,!0);if(f in a&&d in i&&a[f]!==i[d]){var m=n(f,d,p),y=r(f,d,s[m].geometry);delete i[f],delete a[d],a[o(h,s[y].geometry,!0)]=y,s[m].geometry=null}else f in a?r(f,d,p):d in i?n(f,d,p):(t(l),i[f]=u-1,a[d]=u-1)}else t(l)}return s.filter(function(t){return t.geometry})}},{}],85:[function(t,e,n){"use strict";function SymbolQuad(t,e,n,r,i,o,a,s,u,l,c){this.anchorPoint=t,this.tl=e,this.tr=n,this.bl=r,this.br=i,this.tex=o,this.anchorAngle=a,this.glyphAngle=s,this.minScale=u,this.maxScale=l,this.writingMode=c}function getIconQuads(t,e,n,o,a,s,u,l,c){var p,h,f,d,m=e.image.rect,y=a.layout,g=1,v=e.left-g,_=v+m.w/e.image.pixelRatio,x=e.top-g,b=x+m.h/e.image.pixelRatio;if("none"!==y["icon-text-fit"]&&u){var w=_-v,S=b-x,T=y["text-size"]/24,E=u.left*T,A=u.right*T,P=u.top*T,C=u.bottom*T,M=A-E,k=C-P,z=y["icon-text-fit-padding"][0],I=y["icon-text-fit-padding"][1],L=y["icon-text-fit-padding"][2],O=y["icon-text-fit-padding"][3],D="width"===y["icon-text-fit"]?.5*(k-S):0,R="height"===y["icon-text-fit"]?.5*(M-w):0,B="width"===y["icon-text-fit"]||"both"===y["icon-text-fit"]?M:w,j="height"===y["icon-text-fit"]||"both"===y["icon-text-fit"]?k:S;p=new r(E+R-O,P+D-z),h=new r(E+R+I+B,P+D-z),f=new r(E+R+I+B,P+D+L+j),d=new r(E+R-O,P+D+L+j)}else p=new r(v,x),h=new r(_,x),f=new r(_,b),d=new r(v,b);var F=a.getLayoutValue("icon-rotate",l,c)*Math.PI/180;if(s){var N=o[t.segment];if(t.y===N.y&&t.x===N.x&&t.segment+1<o.length){var U=o[t.segment+1];F+=Math.atan2(t.y-U.y,t.x-U.x)+Math.PI}else F+=Math.atan2(t.y-N.y,t.x-N.x)}if(F){var V=Math.sin(F),q=Math.cos(F),G=[q,-V,V,q];p=p.matMult(G),h=h.matMult(G),d=d.matMult(G),f=f.matMult(G)}return[new SymbolQuad(new r(t.x,t.y),p,h,d,f,e.image.rect,0,0,i,1/0)]}function getGlyphQuads(t,e,n,o,a,s){for(var u=a.layout["text-rotate"]*Math.PI/180,l=a.layout["text-keep-upright"],c=e.positionedGlyphs,p=[],h=0;h<c.length;h++){var f=c[h],d=f.glyph;if(d){var m=d.rect;if(m){var y,g=(f.x+d.advance/2)*n,v=i;s?(y=[],v=getSegmentGlyphs(y,t,g,o,t.segment,!0),l&&(v=Math.min(v,getSegmentGlyphs(y,t,g,o,t.segment,!1)))):y=[{anchorPoint:new r(t.x,t.y),offset:0,angle:0,maxScale:1/0,minScale:i}];var _=f.x+d.left,x=f.y-d.top,b=_+m.w,w=x+m.h,S=new r(f.x,d.advance/2),T=new r(_,x),E=new r(b,x),A=new r(_,w),P=new r(b,w);0!==f.angle&&(T._sub(S)._rotate(f.angle)._add(S),E._sub(S)._rotate(f.angle)._add(S),A._sub(S)._rotate(f.angle)._add(S),P._sub(S)._rotate(f.angle)._add(S));for(var C=0;C<y.length;C++){var M=y[C],k=T,z=E,I=A,L=P;if(u){var O=Math.sin(u),D=Math.cos(u),R=[D,-O,O,D];k=k.matMult(R),z=z.matMult(R),I=I.matMult(R),L=L.matMult(R)}var B=Math.max(M.minScale,v),j=(t.angle+M.offset+2*Math.PI)%(2*Math.PI),F=(M.angle+M.offset+2*Math.PI)%(2*Math.PI);p.push(new SymbolQuad(M.anchorPoint,k,z,I,L,m,j,F,B,M.maxScale,e.writingMode))}}}}return p}function getSegmentGlyphs(t,e,n,o,a,s){var u=!s;n<0&&(s=!s),s&&a++;var l=new r(e.x,e.y),c=o[a],p=1/0;n=Math.abs(n);for(var h=i;;){var f=l.dist(c),d=n/f,m=Math.atan2(c.y-l.y,c.x-l.x);if(s||(m+=Math.PI),t.push({anchorPoint:l,offset:u?Math.PI:0,minScale:d,maxScale:p,angle:(m+2*Math.PI)%(2*Math.PI)}),d<=h)break;for(l=c;l.equals(c);)if(a+=s?1:-1,!(c=o[a]))return d;var y=c.sub(l)._unit();l=l.sub(y._mult(f)),p=d}return h}var r=t("point-geometry");e.exports={getIconQuads:getIconQuads,getGlyphQuads:getGlyphQuads,SymbolQuad:SymbolQuad};var i=.5},{"point-geometry":197}],86:[function(t,e,n){"use strict";var r=t("../util/token");e.exports=function(t,e){var n=r(t.properties,e["text-field"]);if(n){n=n.toString();var i=e["text-transform"];return"uppercase"===i?n=n.toLocaleUpperCase():"lowercase"===i&&(n=n.toLocaleLowerCase()),n}}},{"../util/token":128}],87:[function(t,e,n){"use strict";function PositionedGlyph(t,e,n,r,i){this.codePoint=t,this.x=e,this.y=n,this.glyph=r||null,this.angle=i}function Shaping(t,e,n,r,i,o,a){this.positionedGlyphs=t,this.text=e,this.top=n,this.bottom=r,this.left=i,this.right=o,this.writingMode=a}function breakLines(t,e){for(var n=[],r=0,i=0,o=e;i<o.length;i+=1){var a=o[i];n.push(t.substring(r,a)),r=a}return r<t.length&&n.push(t.substring(r,t.length)),n}function shapeText(t,e,n,r,s,u,l,c,p,h,f){var d=t.trim();f===a.vertical&&(d=i(d));var m,y=[],g=new Shaping(y,d,p[1],p[1],p[0],p[0],f);return m=o.processBidirectionalText?o.processBidirectionalText(d,determineLineBreaks(d,c,n,e)):breakLines(d,determineLineBreaks(d,c,n,e)),shapeLines(g,e,m,r,s,u,l,p,f,c,h),!!y.length&&g}function determineAverageLineWidth(t,e,n,r){var i=0;for(var o in t){var a=r[t.charCodeAt(o)];a&&(i+=a.advance+e)}return i/Math.max(1,Math.ceil(i/n))}function calculateBadness(t,e,n,r){var i=Math.pow(t-e,2);return r?t<e?i/2:2*i:i+Math.abs(n)*n}function calculatePenalty(t,e){var n=0;return 10===t&&(n-=1e4),40!==t&&65288!==t||(n+=50),41!==e&&65289!==e||(n+=50),n}function evaluateBreak(t,e,n,r,i,o){for(var a=null,s=calculateBadness(e,n,i,o),u=0,l=r;u<l.length;u+=1){var c=l[u],p=e-c.x,h=calculateBadness(p,n,i,o)+c.badness;h<=s&&(a=c,s=h)}return{index:t,x:e,priorBreak:a,badness:s}}function leastBadBreaks(t){return t?leastBadBreaks(t.priorBreak).concat(t.index):[]}function determineLineBreaks(t,e,n,i){if(!n)return[];if(!t)return[];for(var o=[],a=determineAverageLineWidth(t,e,n,i),l=0,c=0;c<t.length;c++){var p=t.charCodeAt(c),h=i[p];h&&!s[p]&&(l+=h.advance+e),c<t.length-1&&(u[p]||r.charAllowsIdeographicBreaking(p))&&o.push(evaluateBreak(c+1,l,a,o,calculatePenalty(p,t.charCodeAt(c+1)),!1))}return leastBadBreaks(evaluateBreak(t.length,l,a,o,0,!0))}function shapeLines(t,e,n,i,o,s,u,l,c,p,h){var f=-17,d=0,m=f,y=0,g=t.positionedGlyphs;for(var v in n){var _=n[v].trim();if(_.length){for(var x=g.length,b=0;b<_.length;b++){var w=_.charCodeAt(b),S=e[w];S&&(r.charHasUprightVerticalOrientation(w)&&c!==a.horizontal?(g.push(new PositionedGlyph(w,d,0,S,-Math.PI/2)),d+=h+p):(g.push(new PositionedGlyph(w,d,m,S,0)),d+=S.advance+p))}if(g.length!==x){var T=d-p;y=Math.max(T,y),justifyLine(g,e,x,g.length-1,u)}d=0,m+=i}else m+=i}align(g,u,o,s,y,i,n.length,l);var E=n.length*i;t.top+=-s*E,t.bottom=t.top+E,t.left+=-o*y,t.right=t.left+y}function justifyLine(t,e,n,r,i){if(i)for(var o=e[t[r].codePoint].advance,a=(t[r].x+o)*i,s=n;s<=r;s++)t[s].x-=a}function align(t,e,n,r,i,o,a,s){for(var u=(e-n)*i+s[0],l=(-r*a+.5)*o+s[1],c=0;c<t.length;c++)t[c].x+=u,t[c].y+=l}function shapeIcon(t,e){if(!t||!t.rect)return null;var n=e[0],r=e[1],i=n-t.width/2,o=i+t.width,a=r-t.height/2;return new PositionedIcon(t,a,a+t.height,i,o)}function PositionedIcon(t,e,n,r,i){this.image=t,this.top=e,this.bottom=n,this.left=r,this.right=i}var r=t("../util/script_detection"),i=t("../util/verticalize_punctuation"),o=t("../source/rtl_text_plugin"),a={horizontal:1,vertical:2};e.exports={shapeText:shapeText,shapeIcon:shapeIcon,WritingMode:a};var s={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},u={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0}},{"../source/rtl_text_plugin":49,"../util/script_detection":126,"../util/verticalize_punctuation":131}],88:[function(t,e,n){"use strict";function copyBitmap(t,e,n,r,i,o,a,s,u,l,c){var p,h,f=r*e+n,d=s*o+a;if(c)for(d-=o,h=-1;h<=l;h++,f=((h+l)%l+r)*e+n,d+=o)for(p=-1;p<=u;p++)i[d+p]=t[f+(p+u)%u];else for(h=0;h<l;h++,f+=e,d+=o)for(p=0;p<u;p++)i[d+p]=t[f+p]}var r=t("shelf-pack"),i=t("../util/browser"),o=t("../util/util"),a=function(t,e,n,r,i){this.rect=t,this.width=e,this.height=n,this.sdf=r,this.pixelRatio=i},s=function(t,e){this.width=t,this.height=e,this.bin=new r(t,e),this.images={},this.data=!1,this.texture=0,this.filter=0,this.pixelRatio=1,this.dirty=!0};s.prototype.allocateImage=function(t,e){t/=this.pixelRatio,e/=this.pixelRatio;var n=2,r=t+n+(4-(t+n)%4),i=e+n+(4-(e+n)%4),a=this.bin.packOne(r,i);return a?a:(o.warnOnce("SpriteAtlas out of space."),null)},s.prototype.getImage=function(t,e){if(this.images[t])return this.images[t];if(!this.sprite)return null;var n=this.sprite.getSpritePosition(t);if(!n.width||!n.height)return null;var r=this.allocateImage(n.width,n.height);if(!r)return null;var i=new a(r,n.width/n.pixelRatio,n.height/n.pixelRatio,n.sdf,n.pixelRatio/this.pixelRatio);return this.images[t]=i,this.copy(r,n,e),i},s.prototype.getPosition=function(t,e){var n=this.getImage(t,e),r=n&&n.rect;if(!r)return null;var i=n.width*n.pixelRatio,o=n.height*n.pixelRatio,a=1;return{size:[n.width,n.height],tl:[(r.x+a)/this.width,(r.y+a)/this.height],br:[(r.x+a+i)/this.width,(r.y+a+o)/this.height]}},s.prototype.allocate=function(){var t=this;if(!this.data){var e=Math.floor(this.width*this.pixelRatio),n=Math.floor(this.height*this.pixelRatio);this.data=new Uint32Array(e*n);for(var r=0;r<this.data.length;r++)t.data[r]=0}},s.prototype.copy=function(t,e,n){if(this.sprite.imgData){var r=new Uint32Array(this.sprite.imgData.buffer);this.allocate();var i=this.data,o=1;copyBitmap(r,this.sprite.width,e.x,e.y,i,this.width*this.pixelRatio,(t.x+o)*this.pixelRatio,(t.y+o)*this.pixelRatio,e.width,e.height,n),this.dirty=!0}},s.prototype.setSprite=function(t){t&&(this.pixelRatio=i.devicePixelRatio>1?2:1,this.canvas&&(this.canvas.width=this.width*this.pixelRatio,this.canvas.height=this.height*this.pixelRatio)),this.sprite=t},s.prototype.addIcons=function(t,e){for(var n=this,r=0;r<t.length;r++)n.getImage(t[r]);e(null,this.images)},s.prototype.bind=function(t,e){var n=!1;this.texture?t.bindTexture(t.TEXTURE_2D,this.texture):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),n=!0);var r=e?t.LINEAR:t.NEAREST;r!==this.filter&&(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,r),this.filter=r),this.dirty&&(this.allocate(),n?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width*this.pixelRatio,this.height*this.pixelRatio,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(this.data.buffer)):t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width*this.pixelRatio,this.height*this.pixelRatio,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(this.data.buffer)),this.dirty=!1)},e.exports=s},{"../util/browser":110,"../util/util":129,"shelf-pack":200}],89:[function(t,e,n){"use strict";var r=t("../util/struct_array"),i=t("point-geometry"),o=r({members:[{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"glyphQuadStartIndex"},{type:"Uint16",name:"glyphQuadEndIndex"},{type:"Uint16",name:"iconQuadStartIndex"},{type:"Uint16",name:"iconQuadEndIndex"},{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int8",name:"index"},{type:"Uint8",name:"writingModes"}]});Object.defineProperty(o.prototype.StructType.prototype,"anchorPoint",{get:function(){return new i(this.anchorPointX,this.anchorPointY)}}),e.exports=o},{"../util/struct_array":127,"point-geometry":197}],90:[function(t,e,n){"use strict";var r=t("../util/struct_array"),i=t("point-geometry"),o=t("./quads").SymbolQuad,a=r({members:[{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Float32",name:"tlX"},{type:"Float32",name:"tlY"},{type:"Float32",name:"trX"},{type:"Float32",name:"trY"},{type:"Float32",name:"blX"},{type:"Float32",name:"blY"},{type:"Float32",name:"brX"},{type:"Float32",name:"brY"},{type:"Int16",name:"texH"},{type:"Int16",name:"texW"},{type:"Int16",name:"texX"},{type:"Int16",name:"texY"},{type:"Float32",name:"anchorAngle"},{type:"Float32",name:"glyphAngle"},{type:"Float32",name:"maxScale"},{type:"Float32",name:"minScale"},{type:"Uint8",name:"writingMode"}]});Object.defineProperty(a.prototype.StructType.prototype,"anchorPoint",{get:function(){return new i(this.anchorPointX,this.anchorPointY)}}),Object.defineProperty(a.prototype.StructType.prototype,"SymbolQuad",{get:function(){return new o(this.anchorPoint,new i(this.tlX,this.tlY),new i(this.trX,this.trY),new i(this.blX,this.blY),new i(this.brX,this.brY),{x:this.texX,y:this.texY,h:this.texH,w:this.texW,height:this.texH,width:this.texW},this.anchorAngle,this.glyphAngle,this.minScale,this.maxScale,this.writingMode)}}),e.exports=a},{"../util/struct_array":127,"./quads":85,"point-geometry":197}],91:[function(t,e,p){"use strict";var y=t("../util/dom"),g=t("point-geometry"),_={scrollZoom:t("./handler/scroll_zoom"),boxZoom:t("./handler/box_zoom"),dragRotate:t("./handler/drag_rotate"),dragPan:t("./handler/drag_pan"),keyboard:t("./handler/keyboard"),doubleClickZoom:t("./handler/dblclick_zoom"),touchZoomRotate:t("./handler/touch_zoom_rotate")};e.exports=function(t,e){function n(t){h("mouseout",t)}function o(e){t.stop(),w=y.mousePos(p,e),h("mousedown",e),b=!0}function r(e){var n=t.dragRotate&&t.dragRotate.isActive();x&&!n&&h("contextmenu",x),x=null,b=!1,h("mouseup",e)}function a(e){if(!(t.dragPan&&t.dragPan.isActive()||t.dragRotate&&t.dragRotate.isActive())){for(var n=e.toElement||e.target;n&&n!==p;)n=n.parentNode;n===p&&h("mousemove",e)}}function u(e){t.stop(),f("touchstart",e),!e.touches||e.touches.length>1||(S?(clearTimeout(S),S=null,h("dblclick",e)):S=setTimeout(l,300))}function i(t){f("touchmove",t)}function c(t){f("touchend",t)}function d(t){f("touchcancel",t)}function l(){S=null}function s(t){y.mousePos(p,t).equals(w)&&h("click",t)}function v(t){h("dblclick",t),t.preventDefault()}function m(e){var n=t.dragRotate&&t.dragRotate.isActive();b||n?b&&(x=e):h("contextmenu",e),e.preventDefault()}function h(e,n){var r=y.mousePos(p,n);return t.fire(e,{lngLat:t.unproject(r),point:r,originalEvent:n})}function f(e,n){var r=y.touchPos(p,n),i=r.reduce(function(t,e,n,r){return t.add(e.div(r.length))},new g(0,0));return t.fire(e,{lngLat:t.unproject(i),point:i,lngLats:r.map(function(e){return t.unproject(e)},this),points:r,originalEvent:n})}var p=t.getCanvasContainer(),x=null,b=!1,w=null,S=null;for(var T in _)t[T]=new _[T](t,e),e.interactive&&e[T]&&t[T].enable(e[T]);p.addEventListener("mouseout",n,!1),p.addEventListener("mousedown",o,!1),p.addEventListener("mouseup",r,!1),p.addEventListener("mousemove",a,!1),p.addEventListener("touchstart",u,!1),p.addEventListener("touchend",c,!1),p.addEventListener("touchmove",i,!1),p.addEventListener("touchcancel",d,!1),p.addEventListener("click",s,!1),p.addEventListener("dblclick",v,!1),p.addEventListener("contextmenu",m,!1)}},{"../util/dom":117,"./handler/box_zoom":97,"./handler/dblclick_zoom":98,"./handler/drag_pan":99,"./handler/drag_rotate":100,"./handler/keyboard":101,"./handler/scroll_zoom":102,"./handler/touch_zoom_rotate":103,"point-geometry":197}],92:[function(t,a,s){"use strict";var u=t("../util/util"),l=t("../util/interpolate"),c=t("../util/browser"),p=t("../geo/lng_lat"),h=t("../geo/lng_lat_bounds"),f=t("point-geometry"),d=t("../util/evented"),m=function(t){function i(e,n){t.call(this),this.moving=!1,this.transform=e,this._bearingSnap=n.bearingSnap}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.getCenter=function(){return this.transform.center},i.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e),this},i.prototype.panBy=function(t,e,n){return this.panTo(this.transform.center,u.extend({offset:f.convert(t).mult(-1)},e),n),this},i.prototype.panTo=function(t,e,n){return this.easeTo(u.extend({center:t},e),n)},i.prototype.getZoom=function(){return this.transform.zoom},i.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},i.prototype.zoomTo=function(t,e,n){return this.easeTo(u.extend({zoom:t},e),n)},i.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},i.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},i.prototype.getBearing=function(){return this.transform.bearing},i.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},i.prototype.rotateTo=function(t,e,n){return this.easeTo(u.extend({bearing:t},e),n)},i.prototype.resetNorth=function(t,e){return this.rotateTo(0,u.extend({duration:1e3},t),e),this},i.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},i.prototype.getPitch=function(){return this.transform.pitch},i.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},i.prototype.fitBounds=function(t,e,n){e=u.extend({padding:0,offset:[0,0],maxZoom:this.getMaxZoom()},e),t=h.convert(t);var r=f.convert(e.offset),i=this.transform,o=i.project(t.getNorthWest()),a=i.project(t.getSouthEast()),s=a.sub(o),l=(i.width-2*e.padding-2*Math.abs(r.x))/s.x,c=(i.height-2*e.padding-2*Math.abs(r.y))/s.y;return e.center=i.unproject(o.add(a).div(2)),e.zoom=Math.min(i.scaleZoom(i.scale*Math.min(l,c)),e.maxZoom),e.bearing=0,e.linear?this.easeTo(e,n):this.flyTo(e,n)},i.prototype.jumpTo=function(t,e){this.stop();var n=this.transform,r=!1,i=!1,o=!1;return"zoom"in t&&n.zoom!==+t.zoom&&(r=!0,n.zoom=+t.zoom),"center"in t&&(n.center=p.convert(t.center)),"bearing"in t&&n.bearing!==+t.bearing&&(i=!0,n.bearing=+t.bearing),"pitch"in t&&n.pitch!==+t.pitch&&(o=!0,n.pitch=+t.pitch),this.fire("movestart",e).fire("move",e),r&&this.fire("zoomstart",e).fire("zoom",e).fire("zoomend",e),i&&this.fire("rotate",e),o&&this.fire("pitch",e),this.fire("moveend",e)},i.prototype.easeTo=function(t,e){var n=this;this.stop(),t=u.extend({offset:[0,0],duration:500,easing:u.ease},t);var r,i,o=this.transform,a=f.convert(t.offset),s=this.getZoom(),c=this.getBearing(),h=this.getPitch(),d="zoom"in t?+t.zoom:s,m="bearing"in t?this._normalizeBearing(t.bearing,c):c,y="pitch"in t?+t.pitch:h;"center"in t?(r=p.convert(t.center),i=o.centerPoint.add(a)):"around"in t?(r=p.convert(t.around),i=o.locationPoint(r)):(i=o.centerPoint.add(a),r=o.pointLocation(i));var g=o.locationPoint(r);return t.animate===!1&&(t.duration=0),this.zooming=d!==s,this.rotating=c!==m,this.pitching=y!==h,t.smoothEasing&&0!==t.duration&&(t.easing=this._smoothOutEasing(t.duration)),t.noMoveStart||(this.moving=!0,this.fire("movestart",e)),this.zooming&&this.fire("zoomstart",e),clearTimeout(this._onEaseEnd),this._ease(function(t){this.zooming&&(o.zoom=l(s,d,t)),this.rotating&&(o.bearing=l(c,m,t)),this.pitching&&(o.pitch=l(h,y,t)),o.setLocationAtPoint(r,g.add(i.sub(g)._mult(t))),this.fire("move",e),this.zooming&&this.fire("zoom",e),this.rotating&&this.fire("rotate",e),this.pitching&&this.fire("pitch",e)},function(){t.delayEndEvents?n._onEaseEnd=setTimeout(n._easeToEnd.bind(n,e),t.delayEndEvents):n._easeToEnd(e)},t),this},i.prototype._easeToEnd=function(t){var e=this.zooming;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,e&&this.fire("zoomend",t),this.fire("moveend",t)},i.prototype.flyTo=function(t,i){function e(t){var e=(T*T-S*S+(t?-1:1)*C*C*E*E)/(2*(t?T:S)*C*E);return Math.log(Math.sqrt(e*e+1)-e)}function o(t){return(Math.exp(t)-Math.exp(-t))/2}function n(t){return(Math.exp(t)+Math.exp(-t))/2}function r(t){return o(t)/n(t)}this.stop(),t=u.extend({offset:[0,0],speed:1.2,curve:1.42,easing:u.ease},t);var a=this.transform,s=f.convert(t.offset),c=this.getZoom(),h=this.getBearing(),d=this.getPitch(),m="center"in t?p.convert(t.center):this.getCenter(),y="zoom"in t?+t.zoom:c,g="bearing"in t?this._normalizeBearing(t.bearing,h):h,v="pitch"in t?+t.pitch:d;Math.abs(a.center.lng)+Math.abs(m.lng)>180&&(a.center.lng>0&&m.lng<0?m.lng+=360:a.center.lng<0&&m.lng>0&&(m.lng-=360));var _=a.zoomScale(y-c),x=a.point,b="center"in t?a.project(m).sub(s.div(_)):x,w=t.curve,S=Math.max(a.width,a.height),T=S/_,E=b.sub(x).mag();if("minZoom"in t){var A=u.clamp(Math.min(t.minZoom,c,y),a.minZoom,a.maxZoom),P=S/a.zoomScale(A-c);w=Math.sqrt(P/E*2)}var C=w*w,M=e(0),k=function(t){return n(M)/n(M+w*t)},z=function(t){return S*((n(M)*r(M+w*t)-o(M))/C)/E},I=(e(1)-M)/w;if(Math.abs(E)<1e-6){if(Math.abs(S-T)<1e-6)return this.easeTo(t);var L=T<S?-1:1;I=Math.abs(Math.log(T/S))/w,z=function(){return 0},k=function(t){return Math.exp(L*w*t)}}if("duration"in t)t.duration=+t.duration;else{var O="screenSpeed"in t?+t.screenSpeed/w:+t.speed;t.duration=1e3*I/O}return this.moving=!0,this.zooming=!0,h!==g&&(this.rotating=!0),d!==v&&(this.pitching=!0),this.fire("movestart",i),this.fire("zoomstart",i),this._ease(function(t){var e=t*I,n=z(e),r=1/k(e);a.zoom=c+a.scaleZoom(r),a.center=a.unproject(x.add(b.sub(x).mult(n)).mult(r)),this.rotating&&(a.bearing=l(h,g,t)),this.pitching&&(a.pitch=l(d,v,t)),this.fire("move",i),this.fire("zoom",i),this.rotating&&this.fire("rotate",i),this.pitching&&this.fire("pitch",i)},function(){this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,this.fire("zoomend",i),this.fire("moveend",i)},t),this},i.prototype.isEasing=function(){return!!this._abortFn},i.prototype.isMoving=function(){return this.moving},i.prototype.stop=function(){return this._abortFn&&(this._abortFn(),this._finishEase()),this},i.prototype._ease=function(t,e,n){this._finishFn=e,this._abortFn=c.timed(function(e){t.call(this,n.easing(e)),1===e&&this._finishEase()},n.animate===!1?0:n.duration,this)},i.prototype._finishEase=function(){delete this._abortFn;var t=this._finishFn;delete this._finishFn,t.call(this)},i.prototype._normalizeBearing=function(t,e){t=u.wrap(t,-180,180);var n=Math.abs(t-e);return Math.abs(t-360-e)<n&&(t-=360),Math.abs(t+360-e)<n&&(t+=360),t},i.prototype._smoothOutEasing=function(t){var e=u.ease;if(this._prevEase){var n=this._prevEase,r=(Date.now()-n.start)/n.duration,i=n.easing(r+.01)-n.easing(r),o=.27/Math.sqrt(i*i+1e-4)*.01,a=Math.sqrt(.0729-o*o);e=u.bezier(o,a,.25,1)}return this._prevEase={start:(new Date).getTime(),duration:t,easing:e},e},i}(d);a.exports=m},{"../geo/lng_lat":19,"../geo/lng_lat_bounds":20,"../util/browser":110,"../util/evented":118,"../util/interpolate":121,"../util/util":129,"point-geometry":197}],93:[function(t,e,n){"use strict";var r=t("../../util/dom"),i=t("../../util/util"),o=function(t){this.options=t,i.bindAll(["_updateEditLink","_updateData","_updateCompact"],this)};o.prototype.getDefaultPosition=function(){return"bottom-right"},o.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),e&&this._container.classList.add("compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("data",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},o.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map.off("data",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0},o.prototype._updateEditLink=function(){if(this._editLink||(this._editLink=this._container.querySelector(".mapbox-improve-map")),this._editLink){var t=this._map.getCenter();this._editLink.href="https://www.mapbox.com/map-feedback/#/"+t.lng+"/"+t.lat+"/"+Math.round(this._map.getZoom()+1)}},o.prototype._updateData=function(t){"source"===t.dataType&&(this._updateAttributions(),this._updateEditLink())},o.prototype._updateAttributions=function(){if(this._map.style){var t=[],e=this._map.style.sourceCaches;for(var n in e){var r=e[n].getSource();r.attribution&&t.indexOf(r.attribution)<0&&t.push(r.attribution)}t.sort(function(t,e){return t.length-e.length}),t=t.filter(function(e,n){for(var r=n+1;r<t.length;r++)if(t[r].indexOf(e)>=0)return!1;return!0}),this._container.innerHTML=t.join(" | "),this._editLink=null}},o.prototype._updateCompact=function(){var t=this._map.getCanvasContainer().offsetWidth<=640;this._container.classList[t?"add":"remove"]("compact")},e.exports=o},{"../../util/dom":117,"../../util/util":129}],94:[function(t,e,n){"use strict";function checkGeolocationSupport(t){void 0!==r?t(r):void 0!==s.navigator.permissions?s.navigator.permissions.query({name:"geolocation"}).then(function(e){r="denied"!==e.state,t(r)}):(r=!!s.navigator.geolocation,t(r))}var r,i=t("../../util/evented"),a=t("../../util/dom"),s=t("../../util/window"),u=t("../../util/util"),l={enableHighAccuracy:!1,timeout:6e3},c="mapboxgl-ctrl",p=function(t){function o(e){t.call(this),this.options=e||{},u.bindAll(["_onSuccess","_onError","_finish","_setupUI"],this)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.onAdd=function(t){return this._map=t,this._container=a.create("div",c+" "+c+"-group"),checkGeolocationSupport(this._setupUI),this._container},o.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map=void 0},o.prototype._onSuccess=function(t){this._map.jumpTo({center:[t.coords.longitude,t.coords.latitude],zoom:17,bearing:0,pitch:0}),this.fire("geolocate",t),this._finish()},o.prototype._onError=function(t){this.fire("error",t),this._finish()},o.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},o.prototype._setupUI=function(t){t!==!1&&(this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this._geolocateButton=a.create("button",c+"-icon "+c+"-geolocate",this._container),this._geolocateButton.type="button",this._geolocateButton.setAttribute("aria-label","Geolocate"),this.options.watchPosition&&this._geolocateButton.setAttribute("aria-pressed",!1),this._geolocateButton.addEventListener("click",this._onClickGeolocate.bind(this)))},o.prototype._onClickGeolocate=function(){var t=u.extend(l,this.options&&this.options.positionOptions||{});this.options.watchPosition?void 0!==this._geolocationWatchID?(this._geolocateButton.classList.remove("watching"),this._geolocateButton.setAttribute("aria-pressed",!1),s.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0):(this._geolocateButton.classList.add("watching"),this._geolocateButton.setAttribute("aria-pressed",!0),this._geolocationWatchID=s.navigator.geolocation.watchPosition(this._onSuccess,this._onError,t)):(s.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,t),this._timeoutId=setTimeout(this._finish,1e4))},o}(i);e.exports=p},{"../../util/dom":117,"../../util/evented":118,"../../util/util":129,"../../util/window":112}],95:[function(t,e,n){"use strict";function copyMouseEvent(t){return new i.MouseEvent(t.type,{button:2,buttons:2,bubbles:!0,cancelable:!0,detail:t.detail,view:t.view,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,movementX:t.movementX,movementY:t.movementY,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey})}var r=t("../../util/dom"),i=t("../../util/window"),o=t("../../util/util"),a="mapboxgl-ctrl",s=function(){o.bindAll(["_rotateCompassArrow"],this)};s.prototype._rotateCompassArrow=function(){var t="rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassArrow.style.transform=t},s.prototype.onAdd=function(t){return this._map=t,this._container=r.create("div",a+" "+a+"-group",t.getContainer()),this._container.addEventListener("contextmenu",this._onContextMenu.bind(this)),this._zoomInButton=this._createButton(a+"-icon "+a+"-zoom-in","Zoom In",t.zoomIn.bind(t)),this._zoomOutButton=this._createButton(a+"-icon "+a+"-zoom-out","Zoom Out",t.zoomOut.bind(t)),this._compass=this._createButton(a+"-icon "+a+"-compass","Reset North",t.resetNorth.bind(t)),this._compassArrow=r.create("span","arrow",this._compass),this._compass.addEventListener("mousedown",this._onCompassDown.bind(this)),this._onCompassMove=this._onCompassMove.bind(this),this._onCompassUp=this._onCompassUp.bind(this),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._container},s.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map.off("rotate",this._rotateCompassArrow),this._map=void 0},s.prototype._onContextMenu=function(t){t.preventDefault()},s.prototype._onCompassDown=function(t){0===t.button&&(r.disableDrag(),i.document.addEventListener("mousemove",this._onCompassMove),i.document.addEventListener("mouseup",this._onCompassUp),this._map.getCanvasContainer().dispatchEvent(copyMouseEvent(t)),t.stopPropagation())},s.prototype._onCompassMove=function(t){0===t.button&&(this._map.getCanvasContainer().dispatchEvent(copyMouseEvent(t)),t.stopPropagation())},s.prototype._onCompassUp=function(t){0===t.button&&(i.document.removeEventListener("mousemove",this._onCompassMove),i.document.removeEventListener("mouseup",this._onCompassUp),r.enableDrag(),this._map.getCanvasContainer().dispatchEvent(copyMouseEvent(t)),t.stopPropagation())},s.prototype._createButton=function(t,e,n){var i=r.create("button",t,this._container);return i.type="button",i.setAttribute("aria-label",e),i.addEventListener("click",function(){n()}),i},e.exports=s},{"../../util/dom":117,"../../util/util":129,"../../util/window":112}],96:[function(t,e,n){"use strict";function updateScale(t,e,n){var r=n&&n.maxWidth||100,i=t._container.clientHeight/2,o=getDistance(t.unproject([0,i]),t.unproject([r,i]));if(n&&"imperial"===n.unit){var a=3.2808*o;if(a>5280){setScale(e,r,a/5280,"mi")}else setScale(e,r,a,"ft")}else setScale(e,r,o,"m")}function setScale(t,e,n,r){var i=getRoundNum(n),o=i/n;"m"===r&&i>=1e3&&(i/=1e3,r="km"),t.style.width=e*o+"px",t.innerHTML=i+r}function getDistance(t,e){var n=Math.PI/180,r=t.lat*n,i=e.lat*n,o=Math.sin(r)*Math.sin(i)+Math.cos(r)*Math.cos(i)*Math.cos((e.lng-t.lng)*n);return 6371e3*Math.acos(Math.min(o,1))}function getRoundNum(t){var e=Math.pow(10,(""+Math.floor(t)).length-1),n=t/e;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1,e*n}var r=t("../../util/dom"),i=t("../../util/util"),o=function(t){this.options=t,i.bindAll(["_onMove"],this)};o.prototype.getDefaultPosition=function(){return"bottom-left"},o.prototype._onMove=function(){updateScale(this._map,this._container,this.options)},o.prototype.onAdd=function(t){return this._map=t,this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},o.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map.off("move",this._onMove),this._map=void 0},e.exports=o},{"../../util/dom":117,"../../util/util":129}],97:[function(t,e,n){"use strict";var r=t("../../util/dom"),i=t("../../geo/lng_lat_bounds"),o=t("../../util/util"),a=t("../../util/window"),s=function(t){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),o.bindAll(["_onMouseDown","_onMouseMove","_onMouseUp","_onKeyDown"],this)};s.prototype.isEnabled=function(){return!!this._enabled},s.prototype.isActive=function(){return!!this._active},s.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("mousedown",this._onMouseDown,!1),this._enabled=!0)},s.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("mousedown",this._onMouseDown),this._enabled=!1)},s.prototype._onMouseDown=function(t){t.shiftKey&&0===t.button&&(a.document.addEventListener("mousemove",this._onMouseMove,!1),a.document.addEventListener("keydown",this._onKeyDown,!1),a.document.addEventListener("mouseup",this._onMouseUp,!1),r.disableDrag(),this._startPos=r.mousePos(this._el,t),this._active=!0)},s.prototype._onMouseMove=function(t){var e=this._startPos,n=r.mousePos(this._el,t);this._box||(this._box=r.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));var i=Math.min(e.x,n.x),o=Math.max(e.x,n.x),a=Math.min(e.y,n.y),s=Math.max(e.y,n.y);r.setTransform(this._box,"translate("+i+"px,"+a+"px)"),this._box.style.width=o-i+"px",this._box.style.height=s-a+"px"},s.prototype._onMouseUp=function(t){if(0===t.button){var e=this._startPos,n=r.mousePos(this._el,t),o=(new i).extend(this._map.unproject(e)).extend(this._map.unproject(n));this._finish(),e.x===n.x&&e.y===n.y?this._fireEvent("boxzoomcancel",t):this._map.fitBounds(o,{linear:!0}).fire("boxzoomend",{originalEvent:t,boxZoomBounds:o})}},s.prototype._onKeyDown=function(t){27===t.keyCode&&(this._finish(),this._fireEvent("boxzoomcancel",t))},s.prototype._finish=function(){this._active=!1,a.document.removeEventListener("mousemove",this._onMouseMove,!1),a.document.removeEventListener("keydown",this._onKeyDown,!1),a.document.removeEventListener("mouseup",this._onMouseUp,!1),this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.parentNode.removeChild(this._box),this._box=null),r.enableDrag()},s.prototype._fireEvent=function(t,e){return this._map.fire(t,{originalEvent:e})},e.exports=s},{"../../geo/lng_lat_bounds":20,"../../util/dom":117,"../../util/util":129,"../../util/window":112}],98:[function(t,e,n){"use strict";var r=function(t){this._map=t,this._onDblClick=this._onDblClick.bind(this)};r.prototype.isEnabled=function(){return!!this._enabled},r.prototype.enable=function(){this.isEnabled()||(this._map.on("dblclick",this._onDblClick),this._enabled=!0)},r.prototype.disable=function(){this.isEnabled()&&(this._map.off("dblclick",this._onDblClick),this._enabled=!1)},r.prototype._onDblClick=function(t){this._map.zoomTo(this._map.getZoom()+(t.originalEvent.shiftKey?-1:1),{around:t.lngLat},t)},e.exports=r},{}],99:[function(t,e,n){"use strict";var r=t("../../util/dom"),i=t("../../util/util"),o=t("../../util/window"),a=.3,s=i.bezier(0,0,a,1),u=1400,l=function(t){this._map=t,this._el=t.getCanvasContainer(),i.bindAll(["_onDown","_onMove","_onUp","_onTouchEnd","_onMouseUp"],this)};l.prototype.isEnabled=function(){return!!this._enabled},l.prototype.isActive=function(){return!!this._active},l.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("mousedown",this._onDown),this._el.addEventListener("touchstart",this._onDown),this._enabled=!0)},l.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("mousedown",this._onDown),this._el.removeEventListener("touchstart",this._onDown),this._enabled=!1)},l.prototype._onDown=function(t){this._ignoreEvent(t)||this.isActive()||(t.touches?(o.document.addEventListener("touchmove",this._onMove),o.document.addEventListener("touchend",this._onTouchEnd)):(o.document.addEventListener("mousemove",this._onMove),o.document.addEventListener("mouseup",this._onMouseUp)),this._active=!1,this._startPos=this._pos=r.mousePos(this._el,t),this._inertia=[[Date.now(),this._pos]])},l.prototype._onMove=function(t){if(!this._ignoreEvent(t)){this.isActive()||(this._active=!0,this._fireEvent("dragstart",t),this._fireEvent("movestart",t));var e=r.mousePos(this._el,t),n=this._map;n.stop(),this._drainInertiaBuffer(),this._inertia.push([Date.now(),e]),n.transform.setLocationAtPoint(n.transform.pointLocation(this._pos),e),this._fireEvent("drag",t),this._fireEvent("move",t),this._pos=e,t.preventDefault()}},l.prototype._onUp=function(t){var e=this;if(this.isActive()){this._active=!1,this._fireEvent("dragend",t),this._drainInertiaBuffer();var n=function(){return e._fireEvent("moveend",t)},r=this._inertia;if(r.length<2)return void n();var i=r[r.length-1],o=r[0],l=i[1].sub(o[1]),c=(i[0]-o[0])/1e3;if(0===c||i[1].equals(o[1]))return void n();var p=l.mult(a/c),h=p.mag();h>u&&(h=u,p._unit()._mult(h));var f=h/(2500*a),d=p.mult(-f/2);this._map.panBy(d,{duration:1e3*f,easing:s,noMoveStart:!0},{originalEvent:t})}},l.prototype._onMouseUp=function(t){this._ignoreEvent(t)||(this._onUp(t),o.document.removeEventListener("mousemove",this._onMove),o.document.removeEventListener("mouseup",this._onMouseUp))},l.prototype._onTouchEnd=function(t){this._ignoreEvent(t)||(this._onUp(t),o.document.removeEventListener("touchmove",this._onMove),o.document.removeEventListener("touchend",this._onTouchEnd))},l.prototype._fireEvent=function(t,e){return this._map.fire(t,{originalEvent:e})},l.prototype._ignoreEvent=function(t){var e=this._map;return!(!e.boxZoom||!e.boxZoom.isActive())||!(!e.dragRotate||!e.dragRotate.isActive())||(t.touches?t.touches.length>1:!!t.ctrlKey||("mousemove"===t.type?t.buttons&!1:0!==t.button))},l.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=Date.now(),n=160;t.length>0&&e-t[0][0]>n;)t.shift()},e.exports=l},{"../../util/dom":117,"../../util/util":129,"../../util/window":112}],100:[function(t,e,n){"use strict";var r=t("../../util/dom"),i=t("../../util/util"),o=t("../../util/window"),a=.25,s=i.bezier(0,0,a,1),u=180,l=function(t,e){this._map=t,this._el=t.getCanvasContainer(),this._bearingSnap=e.bearingSnap,this._pitchWithRotate=e.pitchWithRotate!==!1,i.bindAll(["_onDown","_onMove","_onUp"],this)};l.prototype.isEnabled=function(){return!!this._enabled},l.prototype.isActive=function(){return!!this._active},l.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("mousedown",this._onDown),this._enabled=!0)},l.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("mousedown",this._onDown),this._enabled=!1)},l.prototype._onDown=function(t){this._ignoreEvent(t)||this.isActive()||(o.document.addEventListener("mousemove",this._onMove),o.document.addEventListener("mouseup",this._onUp),this._active=!1,this._inertia=[[Date.now(),this._map.getBearing()]],this._startPos=this._pos=r.mousePos(this._el,t),this._center=this._map.transform.centerPoint,t.preventDefault())},l.prototype._onMove=function(t){if(!this._ignoreEvent(t)){this.isActive()||(this._active=!0,this._fireEvent("rotatestart",t),this._fireEvent("movestart",t));var e=this._map;e.stop();var n=this._pos,i=r.mousePos(this._el,t),o=.8*(n.x-i.x),a=(n.y-i.y)*-.5,s=e.getBearing()-o,u=e.getPitch()-a,l=this._inertia,c=l[l.length-1];this._drainInertiaBuffer(),l.push([Date.now(),e._normalizeBearing(s,c[1])]),e.transform.bearing=s,this._pitchWithRotate&&(e.transform.pitch=u),this._fireEvent("rotate",t),this._fireEvent("move",t),this._pos=i}},l.prototype._onUp=function(t){var e=this;if(!this._ignoreEvent(t)&&(o.document.removeEventListener("mousemove",this._onMove),o.document.removeEventListener("mouseup",this._onUp),this.isActive())){this._active=!1,this._fireEvent("rotateend",t),this._drainInertiaBuffer();var n=this._map,r=n.getBearing(),i=this._inertia,l=function(){Math.abs(r)<e._bearingSnap?n.resetNorth({noMoveStart:!0},{originalEvent:t}):e._fireEvent("moveend",t)};if(i.length<2)return void l();var c=i[0],p=i[i.length-1],h=i[i.length-2],f=n._normalizeBearing(r,h[1]),d=p[1]-c[1],m=d<0?-1:1,y=(p[0]-c[0])/1e3;if(0===d||0===y)return void l();var g=Math.abs(d*(a/y));g>u&&(g=u);var v=g/(720*a);f+=m*g*(v/2),Math.abs(n._normalizeBearing(f,0))<this._bearingSnap&&(f=n._normalizeBearing(0,f)),n.rotateTo(f,{duration:1e3*v,easing:s,noMoveStart:!0},{originalEvent:t})}},l.prototype._fireEvent=function(t,e){return this._map.fire(t,{originalEvent:e})},l.prototype._ignoreEvent=function(t){var e=this._map;if(e.boxZoom&&e.boxZoom.isActive())return!0;if(e.dragPan&&e.dragPan.isActive())return!0;if(t.touches)return t.touches.length>1;var n=t.ctrlKey?1:2,r=t.ctrlKey?0:2,i=t.button;return"undefined"!=typeof InstallTrigger&&2===t.button&&t.ctrlKey&&o.navigator.platform.toUpperCase().indexOf("MAC")>=0&&(i=0),"mousemove"===t.type?t.buttons&0===n:i!==r},l.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=Date.now(),n=160;t.length>0&&e-t[0][0]>n;)t.shift()},e.exports=l},{"../../util/dom":117,"../../util/util":129,"../../util/window":112}],101:[function(t,e,n){"use strict";function easeOut(t){return t*(2-t)}var r=100,i=function(t){this._map=t,this._el=t.getCanvasContainer(),this._onKeyDown=this._onKeyDown.bind(this)};i.prototype.isEnabled=function(){return!!this._enabled},i.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("keydown",this._onKeyDown,!1),this._enabled=!0)},i.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("keydown",this._onKeyDown),this._enabled=!1)},i.prototype._onKeyDown=function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e=0,n=0,i=0,o=0,a=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?n=-1:(t.preventDefault(),o=-1);break;case 39:t.shiftKey?n=1:(t.preventDefault(),o=1);break;case 38:t.shiftKey?i=1:(t.preventDefault(),a=-1);break;case 40:t.shiftKey?i=-1:(a=1,t.preventDefault())}var s=this._map,u=s.getZoom(),l={duration:300,delayEndEvents:500,easing:easeOut,zoom:e?Math.round(u)+e*(t.shiftKey?2:1):u,bearing:s.getBearing()+15*n,pitch:s.getPitch()+10*i,offset:[-o*r,-a*r],center:s.getCenter()};s.easeTo(l,{originalEvent:t})}},e.exports=i},{}],102:[function(t,e,n){"use strict";var r=t("../../util/dom"),i=t("../../util/util"),o=t("../../util/browser"),a=t("../../util/window"),s=a.navigator.userAgent.toLowerCase(),u=s.indexOf("firefox")!==-1,l=s.indexOf("safari")!==-1&&s.indexOf("chrom")===-1,c=function(t){this._map=t,this._el=t.getCanvasContainer(),i.bindAll(["_onWheel","_onTimeout"],this)};c.prototype.isEnabled=function(){return!!this._enabled},c.prototype.enable=function(t){this.isEnabled()||(this._el.addEventListener("wheel",this._onWheel,!1),this._el.addEventListener("mousewheel",this._onWheel,!1),this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},c.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("wheel",this._onWheel),this._el.removeEventListener("mousewheel",this._onWheel),this._enabled=!1)},c.prototype._onWheel=function(t){var e;"wheel"===t.type?(e=t.deltaY,u&&t.deltaMode===a.WheelEvent.DOM_DELTA_PIXEL&&(e/=o.devicePixelRatio),t.deltaMode===a.WheelEvent.DOM_DELTA_LINE&&(e*=40)):"mousewheel"===t.type&&(e=-t.wheelDeltaY,l&&(e/=3));var n=o.now(),i=n-(this._time||0);this._pos=r.mousePos(this._el,t),this._time=n,0!==e&&e%4.000244140625==0?this._type="wheel":0!==e&&Math.abs(e)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=e,this._timeout=setTimeout(this._onTimeout,40)):this._type||(this._type=Math.abs(i*e)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,e+=this._lastValue)),t.shiftKey&&e&&(e/=4),this._type&&this._zoom(-e,t),t.preventDefault()},c.prototype._onTimeout=function(){this._type="wheel",this._zoom(-this._lastValue)},c.prototype._zoom=function(t,e){if(0!==t){var n=this._map,r=2/(1+Math.exp(-Math.abs(t/100)));t<0&&0!==r&&(r=1/r);var i=n.ease?n.ease.to:n.transform.scale,o=n.transform.scaleZoom(i*r);n.zoomTo(o,{duration:"wheel"===this._type?200:0,around:this._aroundCenter?n.getCenter():n.unproject(this._pos),delayEndEvents:200,smoothEasing:!0},{originalEvent:e})}},e.exports=c},{"../../util/browser":110,"../../util/dom":117,"../../util/util":129,"../../util/window":112}],103:[function(t,e,n){"use strict";var r=t("../../util/dom"),i=t("../../util/util"),o=t("../../util/window"),a=.15,s=i.bezier(0,0,a,1),u=2.5,l=function(t){this._map=t,this._el=t.getCanvasContainer(),i.bindAll(["_onStart","_onMove","_onEnd"],this)};l.prototype.isEnabled=function(){return!!this._enabled},l.prototype.enable=function(t){this.isEnabled()||(this._el.addEventListener("touchstart",this._onStart,!1),this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},l.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("touchstart",this._onStart),this._enabled=!1)},l.prototype.disableRotation=function(){this._rotationDisabled=!0},l.prototype.enableRotation=function(){this._rotationDisabled=!1},l.prototype._onStart=function(t){if(2===t.touches.length){var e=r.mousePos(this._el,t.touches[0]),n=r.mousePos(this._el,t.touches[1]);this._startVec=e.sub(n),this._startScale=this._map.transform.scale,this._startBearing=this._map.transform.bearing,this._gestureIntent=void 0,this._inertia=[],o.document.addEventListener("touchmove",this._onMove,!1),o.document.addEventListener("touchend",this._onEnd,!1)}},l.prototype._onMove=function(t){if(2===t.touches.length){var e=r.mousePos(this._el,t.touches[0]),n=r.mousePos(this._el,t.touches[1]),i=e.add(n).div(2),o=e.sub(n),a=o.mag()/this._startVec.mag(),s=this._rotationDisabled?0:180*o.angleWith(this._startVec)/Math.PI,u=this._map;if(this._gestureIntent){var l={duration:0,around:u.unproject(i)};"rotate"===this._gestureIntent&&(l.bearing=this._startBearing+s),"zoom"!==this._gestureIntent&&"rotate"!==this._gestureIntent||(l.zoom=u.transform.scaleZoom(this._startScale*a)),u.stop(),this._drainInertiaBuffer(),this._inertia.push([Date.now(),a,i]),u.easeTo(l,{originalEvent:t})}else{var c=Math.abs(1-a)>.15;Math.abs(s)>4?this._gestureIntent="rotate":c&&(this._gestureIntent="zoom"),this._gestureIntent&&(this._startVec=o,this._startScale=u.transform.scale,this._startBearing=u.transform.bearing)}t.preventDefault()}},l.prototype._onEnd=function(t){o.document.removeEventListener("touchmove",this._onMove),o.document.removeEventListener("touchend",this._onEnd),this._drainInertiaBuffer();var e=this._inertia,n=this._map;if(e.length<2)return void n.snapToNorth({},{originalEvent:t});var r=e[e.length-1],i=e[0],l=n.transform.scaleZoom(this._startScale*r[1]),c=n.transform.scaleZoom(this._startScale*i[1]),p=l-c,h=(r[0]-i[0])/1e3,f=r[2];if(0===h||l===c)return void n.snapToNorth({},{originalEvent:t});var d=p*a/h;Math.abs(d)>u&&(d=d>0?u:-u);var m=1e3*Math.abs(d/(12*a)),y=l+d*m/2e3;y<0&&(y=0),n.easeTo({zoom:y,duration:m,easing:s,around:this._aroundCenter?n.getCenter():n.unproject(f)},{originalEvent:t})},l.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=Date.now(),n=160;t.length>2&&e-t[0][0]>n;)t.shift()},e.exports=l},{"../../util/dom":117,"../../util/util":129,"../../util/window":112}],104:[function(t,e,n){"use strict";var r=t("../util/util"),i=t("../util/window"),o=function(){r.bindAll(["_onHashChange","_updateHash"],this)};o.prototype.addTo=function(t){return this._map=t,i.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},o.prototype.remove=function(){return i.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),delete this._map,this},o.prototype._onHashChange=function(){var t=i.location.hash.replace("#","").split("/");return t.length>=3&&(this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:+(t[3]||0),pitch:+(t[4]||0)}),!0)},o.prototype._updateHash=function(){var t=this._map.getCenter(),e=this._map.getZoom(),n=this._map.getBearing(),r=this._map.getPitch(),o=Math.max(0,Math.ceil(Math.log(e)/Math.LN2)),a="#"+Math.round(100*e)/100+"/"+t.lat.toFixed(o)+"/"+t.lng.toFixed(o);(n||r)&&(a+="/"+Math.round(10*n)/10),r&&(a+="/"+Math.round(r)),i.history.replaceState("","",a)},e.exports=o},{"../util/util":129,"../util/window":112}],105:[function(n,r,i){"use strict";function removeNode(t){t.parentNode&&t.parentNode.removeChild(t)}var o=n("../util/util"),a=n("../util/browser"),s=n("../util/window"),u=n("../util/dom"),l=n("../style/style"),c=n("../style/animation_loop"),p=n("../render/painter"),h=n("../geo/transform"),f=n("./hash"),d=n("./bind_handlers"),m=n("./camera"),y=n("../geo/lng_lat"),g=n("../geo/lng_lat_bounds"),v=n("point-geometry"),_=n("./control/attribution_control"),x=n("mapbox-gl-supported"),b=0,w=20,S={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:b,maxZoom:w,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,bearingSnap:7,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0},T=function(t){function e(e){var n=this;e=o.extend({},S,e);var r=new h(e.minZoom,e.maxZoom,e.renderWorldCopies);if(t.call(this,r,e),this._interactive=e.interactive,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,"string"==typeof e.container){if(this._container=s.document.getElementById(e.container),!this._container)throw new Error("Container '"+e.container+"' not found.")}else this._container=e.container;this.animationLoop=new c,e.maxBounds&&this.setMaxBounds(e.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored","_update","_render","_onData","_onDataLoading"],this),this._setupContainer(),this._setupPainter(),this.on("move",this._update.bind(this,!1)),this.on("zoom",this._update.bind(this,!0)),this.on("moveend",function(){n.animationLoop.set(300),n._rerender()}),void 0!==s&&(s.addEventListener("online",this._onWindowOnline,!1),s.addEventListener("resize",this._onWindowResize,!1)),d(this,e),this._hash=e.hash&&(new f).addTo(this),this._hash&&this._hash._onHashChange()||this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),this._classes=[],this.resize(),e.classes&&this.setClasses(e.classes),e.style&&this.setStyle(e.style),e.attributionControl&&this.addControl(new _),this.on("style.load",function(){this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this.style.update(this._classes,{transition:!1})}),this.on("data",this._onData),this.on("dataloading",this._onDataLoading)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={showTileBoundaries:{},showCollisionBoxes:{},showOverdrawInspector:{},repaint:{},vertices:{}};return e.prototype.addControl=function(t,e){void 0===e&&t.getDefaultPosition&&(e=t.getDefaultPosition()),void 0===e&&(e="top-right");var n=t.onAdd(this),r=this._controlPositions[e];return e.indexOf("bottom")!==-1?r.insertBefore(n,r.firstChild):r.appendChild(n),this},e.prototype.removeControl=function(t){return t.onRemove(this),this},e.prototype.addClass=function(t,e){return o.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Mapbox GL JS."),this._classes.indexOf(t)>=0||""===t?this:(this._classes.push(t),this._classOptions=e,this.style&&this.style.updateClasses(),this._update(!0))},e.prototype.removeClass=function(t,e){o.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Mapbox GL JS.");var n=this._classes.indexOf(t);return n<0||""===t?this:(this._classes.splice(n,1),this._classOptions=e,this.style&&this.style.updateClasses(),this._update(!0))},e.prototype.setClasses=function(t,e){o.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Mapbox GL JS.");for(var n={},r=0;r<t.length;r++)""!==t[r]&&(n[t[r]]=!0);return this._classes=Object.keys(n),this._classOptions=e,this.style&&this.style.updateClasses(),this._update(!0)},e.prototype.hasClass=function(t){return o.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Mapbox GL JS."),this._classes.indexOf(t)>=0},e.prototype.getClasses=function(){return o.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Mapbox GL JS."),this._classes},e.prototype.resize=function(){var t=this._containerDimensions(),e=t[0],n=t[1];this._resizeCanvas(e,n),this.transform.resize(e,n),this.painter.resize(e,n);var r=this.painter.gl,i=r.getParameter(r.MAX_RENDERBUFFER_SIZE)/2;return(this._canvas.width>i||this._canvas.height>i)&&o.warnOnce("Map is larger than maximum size supported by this system ("+i+"px by "+i+"px)."),this.fire("movestart").fire("move").fire("resize").fire("moveend")},e.prototype.getBounds=function(){var t=new g(this.transform.pointLocation(new v(0,this.transform.height)),this.transform.pointLocation(new v(this.transform.width,0)));return(this.transform.angle||this.transform.pitch)&&(t.extend(this.transform.pointLocation(new v(this.transform.size.x,0))),t.extend(this.transform.pointLocation(new v(0,this.transform.size.y)))),t},e.prototype.setMaxBounds=function(t){if(t){var e=g.convert(t);this.transform.lngRange=[e.getWest(),e.getEast()],this.transform.latRange=[e.getSouth(),e.getNorth()],this.transform._constrain(),this._update()}else null!==t&&void 0!==t||(this.transform.lngRange=[],this.transform.latRange=[],this._update());return this},e.prototype.setMinZoom=function(t){if((t=null===t||void 0===t?b:t)>=b&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between "+b+" and the current maxZoom, inclusive")},e.prototype.getMinZoom=function(){return this.transform.minZoom},e.prototype.setMaxZoom=function(t){if((t=null===t||void 0===t?w:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},e.prototype.getMaxZoom=function(){return this.transform.maxZoom},e.prototype.project=function(t){return this.transform.locationPoint(y.convert(t))},e.prototype.unproject=function(t){return this.transform.pointLocation(v.convert(t))},e.prototype.queryRenderedFeatures=function(){function t(t){return t instanceof v||Array.isArray(t)}var e,n={};return 2===arguments.length?(e=arguments[0],n=arguments[1]):1===arguments.length&&t(arguments[0])?e=arguments[0]:1===arguments.length&&(n=arguments[0]),this.style.queryRenderedFeatures(this._makeQueryGeometry(e),n,this.transform.zoom,this.transform.angle)},e.prototype._makeQueryGeometry=function(t){var e=this;void 0===t&&(t=[v.convert([0,0]),v.convert([this.transform.width,this.transform.height])]);var n;if(t instanceof v||"number"==typeof t[0])n=[v.convert(t)];else{var r=[v.convert(t[0]),v.convert(t[1])];n=[r[0],new v(r[1].x,r[0].y),r[1],new v(r[0].x,r[1].y),r[0]]}return n=n.map(function(t){return e.transform.pointCoordinate(t)})},e.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},e.prototype.setStyle=function(t,e){if((!e||e.diff!==!1)&&this.style&&t&&!(t instanceof l)&&"string"!=typeof t)try{return this.style.setState(t)&&this._update(!0),this}catch(t){o.warnOnce("Unable to perform style diff: "+(t.message||t.error||t)+".  Rebuilding the style from scratch.")}return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.off("rotate",this.style._redoPlacement),this.off("pitch",this.style._redoPlacement)),t?(this.style=t instanceof l?t:new l(t,this),this.style.setEventedParent(this,{style:this.style}),this.on("rotate",this.style._redoPlacement),this.on("pitch",this.style._redoPlacement),this):(this.style=null,this)},e.prototype.getStyle=function(){if(this.style)return this.style.serialize()},e.prototype.addSource=function(t,e){return this.style.addSource(t,e),this._update(!0),this},e.prototype.isSourceLoaded=function(t){var e=this.style&&this.style.sourceCaches[t];return void 0===e?void this.fire("error",{error:new Error("There is no source with ID '"+t+"'")}):e.loaded()},e.prototype.addSourceType=function(t,e,n){return this.style.addSourceType(t,e,n)},e.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0),this},e.prototype.getSource=function(t){return this.style.getSource(t)},e.prototype.addLayer=function(t,e){return this.style.addLayer(t,e),this._update(!0),this},e.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0),this},e.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0),this},e.prototype.getLayer=function(t){return this.style.getLayer(t)},e.prototype.setFilter=function(t,e){return this.style.setFilter(t,e),this._update(!0),this},e.prototype.setLayerZoomRange=function(t,e,n){return this.style.setLayerZoomRange(t,e,n),this._update(!0),this},e.prototype.getFilter=function(t){return this.style.getFilter(t)},e.prototype.setPaintProperty=function(t,e,n,r){return this.style.setPaintProperty(t,e,n,r),this._update(!0),this},e.prototype.getPaintProperty=function(t,e,n){return this.style.getPaintProperty(t,e,n)},e.prototype.setLayoutProperty=function(t,e,n){return this.style.setLayoutProperty(t,e,n),this._update(!0),this},e.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},e.prototype.setLight=function(t){return this.style.setLight(t),this._update(!0),this},e.prototype.getLight=function(){return this.style.getLight()},e.prototype.getContainer=function(){return this._container},e.prototype.getCanvasContainer=function(){return this._canvasContainer},e.prototype.getCanvas=function(){return this._canvas},e.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.offsetWidth||400,e=this._container.offsetHeight||300),[t,e]},e.prototype._setupContainer=function(){var t=this._container;t.classList.add("mapboxgl-map");var e=this._canvasContainer=u.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=u.create("canvas","mapboxgl-canvas",e),this._canvas.style.position="absolute",this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",0),this._canvas.setAttribute("aria-label","Map");var n=this._containerDimensions();this._resizeCanvas(n[0],n[1]);var r=this._controlContainer=u.create("div","mapboxgl-control-container",t),i=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(t){i[t]=u.create("div","mapboxgl-ctrl-"+t,r)})},e.prototype._resizeCanvas=function(t,e){var n=s.devicePixelRatio||1;this._canvas.width=n*t,this._canvas.height=n*e,this._canvas.style.width=t+"px",this._canvas.style.height=e+"px"},e.prototype._setupPainter=function(){var t=o.extend({failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer},x.webGLContextAttributes),e=this._canvas.getContext("webgl",t)||this._canvas.getContext("experimental-webgl",t);return e?void(this.painter=new p(e,this.transform)):void this.fire("error",{error:new Error("Failed to initialize WebGL")})},e.prototype._contextLost=function(t){t.preventDefault(),this._frameId&&a.cancelFrame(this._frameId),this.fire("webglcontextlost",{originalEvent:t})},e.prototype._contextRestored=function(t){this._setupPainter(),this.resize(),this._update(),this.fire("webglcontextrestored",{originalEvent:t})},e.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!(!this.style||!this.style.loaded())},e.prototype._update=function(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this._rerender(),this):this},e.prototype._render=function(){return this.style&&this._styleDirty&&(this._styleDirty=!1,this.style.update(this._classes,this._classOptions),this._classOptions=null,this.style._recalculate(this.transform.zoom)),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.rotating,zooming:this.zooming}),this.fire("render"),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire("load")),this._frameId=null,this.animationLoop.stopped()||(this._styleDirty=!0),(this._sourcesDirty||this._repaint||this._styleDirty)&&this._rerender(),this},e.prototype.remove=function(){this._hash&&this._hash.remove(),a.cancelFrame(this._frameId),this.setStyle(null),void 0!==s&&s.removeEventListener("resize",this._onWindowResize,!1);var t=this.painter.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),removeNode(this._canvasContainer),removeNode(this._controlContainer),this._container.classList.remove("mapboxgl-map"),this.fire("remove")},e.prototype._rerender=function(){this.style&&!this._frameId&&(this._frameId=a.frame(this._render))},e.prototype._onWindowOnline=function(){this._update()},e.prototype._onWindowResize=function(){this._trackResize&&this.stop().resize()._update()},n.showTileBoundaries.get=function(){return!!this._showTileBoundaries},n.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},n.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},n.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,this.style._redoPlacement())},n.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},n.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},n.repaint.get=function(){return!!this._repaint},n.repaint.set=function(t){this._repaint=t,this._update()},n.vertices.get=function(){return!!this._vertices},n.vertices.set=function(t){this._vertices=t,this._update()},e.prototype._onData=function(t){this._update("style"===t.dataType),this.fire(t.dataType+"data",t)},e.prototype._onDataLoading=function(t){this.fire(t.dataType+"dataloading",t)},Object.defineProperties(e.prototype,n),e}(m);r.exports=T},{"../geo/lng_lat":19,"../geo/lng_lat_bounds":20,"../geo/transform":21,"../render/painter":36,"../style/animation_loop":59,"../style/style":63,"../util/browser":110,"../util/dom":117,"../util/util":129,"../util/window":112,"./bind_handlers":91,"./camera":92,"./control/attribution_control":93,"./hash":104,"mapbox-gl-supported":193,"point-geometry":197}],106:[function(t,e,n){"use strict";var r=t("../util/dom"),i=t("../geo/lng_lat"),o=t("point-geometry"),a=function(t,e){this._offset=o.convert(e&&e.offset||[0,0]),this._update=this._update.bind(this),this._onMapClick=this._onMapClick.bind(this),t||(t=r.create("div")),t.classList.add("mapboxgl-marker"),this._element=t,this._popup=null};a.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this._update(),this._map.on("click",this._onMapClick),this},a.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map=null),r.remove(this._element),this._popup&&this._popup.remove(),this},a.prototype.getLngLat=function(){return this._lngLat},a.prototype.setLngLat=function(t){return this._lngLat=i.convert(t),this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},a.prototype.getElement=function(){return this._element},a.prototype.setPopup=function(t){return this._popup&&(this._popup.remove(),this._popup=null),t&&(this._popup=t,this._popup.setLngLat(this._lngLat)),this},a.prototype._onMapClick=function(t){var e=t.originalEvent.target,n=this._element;this._popup&&(e===n||n.contains(e))&&this.togglePopup()},a.prototype.getPopup=function(){return this._popup},a.prototype.togglePopup=function(){var t=this._popup;t&&(t.isOpen()?t.remove():t.addTo(this._map))},a.prototype._update=function(t){if(this._map){var e=this._map.project(this._lngLat)._add(this._offset);t&&"moveend"!==t.type||(e=e.round()),r.setTransform(this._element,"translate("+e.x+"px, "+e.y+"px)")}},e.exports=a},{"../geo/lng_lat":19,"../util/dom":117,"point-geometry":197}],107:[function(t,e,n){"use strict";function normalizeOffset(t){if(t){if("number"==typeof t){var e=Math.round(Math.sqrt(.5*Math.pow(t,2)));return{top:new u(0,t),"top-left":new u(e,e),"top-right":new u(-e,e),bottom:new u(0,-t),"bottom-left":new u(e,-e),"bottom-right":new u(-e,-e),left:new u(t,0),right:new u(-t,0)}}if(isPointLike(t)){var n=u.convert(t);return{top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{top:u.convert(t.top||[0,0]),"top-left":u.convert(t["top-left"]||[0,0]),"top-right":u.convert(t["top-right"]||[0,0]),bottom:u.convert(t.bottom||[0,0]),"bottom-left":u.convert(t["bottom-left"]||[0,0]),"bottom-right":u.convert(t["bottom-right"]||[0,0]),left:u.convert(t.left||[0,0]),right:u.convert(t.right||[0,0])}}return normalizeOffset(new u(0,0))}function isPointLike(t){return t instanceof u||Array.isArray(t)}var r=t("../util/util"),i=t("../util/evented"),a=t("../util/dom"),s=t("../geo/lng_lat"),u=t("point-geometry"),l=t("../util/window"),c={closeButton:!0,closeOnClick:!0},p=function(t){function o(e){t.call(this),this.options=r.extend(Object.create(c),e),r.bindAll(["_update","_onClickClose"],this)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.addTo=function(t){return this._map=t,this._map.on("move",this._update),this.options.closeOnClick&&this._map.on("click",this._onClickClose),this._update(),this},o.prototype.isOpen=function(){return!!this._map},o.prototype.remove=function(){return this._content&&this._content.parentNode&&this._content.parentNode.removeChild(this._content),this._container&&(this._container.parentNode.removeChild(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("click",this._onClickClose),delete this._map),this.fire("close"),this},o.prototype.getLngLat=function(){return this._lngLat},o.prototype.setLngLat=function(t){return this._lngLat=s.convert(t),this._update(),this},o.prototype.setText=function(t){return this.setDOMContent(l.document.createTextNode(t))},o.prototype.setHTML=function(t){var e,n=l.document.createDocumentFragment(),r=l.document.createElement("body");for(r.innerHTML=t;e=r.firstChild;)n.appendChild(e);return this.setDOMContent(n)},o.prototype.setDOMContent=function(t){return this._createContent(),this._content.appendChild(t),this._update(),this},o.prototype._createContent=function(){this._content&&this._content.parentNode&&this._content.parentNode.removeChild(this._content),this._content=a.create("div","mapboxgl-popup-content",this._container),this.options.closeButton&&(this._closeButton=a.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClickClose))},o.prototype._update=function(){if(this._map&&this._lngLat&&this._content){this._container||(this._container=a.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=a.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content));var t=this.options.anchor,e=normalizeOffset(this.options.offset),n=this._map.project(this._lngLat).round();if(!t){var r=this._container.offsetWidth,i=this._container.offsetHeight;t=n.y+e.bottom.y<i?["top"]:n.y>this._map.transform.height-i?["bottom"]:[],n.x<r/2?t.push("left"):n.x>this._map.transform.width-r/2&&t.push("right"),t=0===t.length?"bottom":t.join("-")}var o=n.add(e[t]),s={top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},u=this._container.classList;for(var l in s)u.remove("mapboxgl-popup-anchor-"+l);u.add("mapboxgl-popup-anchor-"+t),a.setTransform(this._container,s[t]+" translate("+o.x+"px,"+o.y+"px)")}},o.prototype._onClickClose=function(){this.remove()},o}(i);e.exports=p},{"../geo/lng_lat":19,"../util/dom":117,"../util/evented":118,"../util/util":129,"../util/window":112,"point-geometry":197}],108:[function(t,e,n){"use strict";var r=function(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.callbackID=0,this.receive=this.receive.bind(this),this.target.addEventListener("message",this.receive,!1)};r.prototype.send=function(t,e,n,r,i){var o=n?this.mapId+":"+this.callbackID++:null;n&&(this.callbacks[o]=n),this.target.postMessage({targetMapId:i,sourceMapId:this.mapId,type:t,id:String(o),data:e},r)},r.prototype.receive=function(t){var e,n=this,r=t.data,i=r.id;if(!r.targetMapId||this.mapId===r.targetMapId){var o=function(t,e,r){n.target.postMessage({sourceMapId:n.mapId,type:"<response>",id:String(i),error:t?String(t):null,data:e},r)};if("<response>"===r.type)e=this.callbacks[r.id],delete this.callbacks[r.id],e&&e(r.error||null,r.data);else if(void 0!==r.id&&this.parent[r.type])this.parent[r.type](r.sourceMapId,r.data,o);else if(void 0!==r.id&&this.parent.getWorkerSource){var a=r.type.split("."),s=this.parent.getWorkerSource(r.sourceMapId,a[0]);s[a[1]](r.data,o)}else this.parent[r.type](r.data)}},r.prototype.remove=function(){this.target.removeEventListener("message",this.receive,!1)},e.exports=r},{}],109:[function(t,e,n){"use strict";function sameOrigin(t){var e=r.document.createElement("a");return e.href=t,e.protocol===r.document.location.protocol&&e.host===r.document.location.host}var r=t("./window");n.getJSON=function(t,e){var n=new r.XMLHttpRequest;return n.open("GET",t,!0),n.setRequestHeader("Accept","application/json"),n.onerror=function(t){e(t)},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var t;try{t=JSON.parse(n.response)}catch(t){return e(t)}e(null,t)}else e(new Error(n.statusText))},n.send(),n},n.getArrayBuffer=function(t,e){var n=new r.XMLHttpRequest;return n.open("GET",t,!0),n.responseType="arraybuffer",n.onerror=function(t){e(t)},n.onload=function(){return 0===n.response.byteLength&&200===n.status?e(new Error("http status 200 returned without content.")):void(n.status>=200&&n.status<300&&n.response?e(null,{data:n.response,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):e(new Error(n.statusText)))},n.send(),n},n.getImage=function(t,e){return n.getArrayBuffer(t,function(t,n){if(t)return e(t);var i=new r.Image,o=r.URL||r.webkitURL;i.onload=function(){e(null,i),o.revokeObjectURL(i.src)};var a=new r.Blob([new Uint8Array(n.data)],{type:"image/png"});i.cacheControl=n.cacheControl,i.expires=n.expires,i.src=n.data.byteLength?o.createObjectURL(a):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII="})},n.getVideo=function(t,e){var n=r.document.createElement("video");n.onloadstart=function(){e(null,n)};for(var i=0;i<t.length;i++){var o=r.document.createElement("source");sameOrigin(t[i])||(n.crossOrigin="Anonymous"),o.src=t[i],n.appendChild(o)}return n}},{"./window":112}],110:[function(t,e,n){"use strict";var r=t("./window");e.exports.now=function(){return r.performance&&r.performance.now?r.performance.now.bind(r.performance):Date.now.bind(Date)}();var i=r.requestAnimationFrame||r.mozRequestAnimationFrame||r.webkitRequestAnimationFrame||r.msRequestAnimationFrame;n.frame=function(t){return i(t)};var a=r.cancelAnimationFrame||r.mozCancelAnimationFrame||r.webkitCancelAnimationFrame||r.msCancelAnimationFrame;n.cancelFrame=function(t){a(t)},n.timed=function(t,r,i){function o(u){a||(u=e.exports.now(),u>=s+r?t.call(i,1):(t.call(i,(u-s)/r),n.frame(o)))}if(!r)return t.call(i,1),null;var a=!1,s=e.exports.now();return n.frame(o),function(){a=!0}},n.getImageData=function(t){var e=r.document.createElement("canvas"),n=e.getContext("2d");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height).data},n.supported=t("mapbox-gl-supported"),n.hardwareConcurrency=r.navigator.hardwareConcurrency||4,Object.defineProperty(n,"devicePixelRatio",{get:function(){return r.devicePixelRatio}}),n.supportsWebp=!1;var s=r.document.createElement("img");s.onload=function(){n.supportsWebp=!0},s.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="},{"./window":112,"mapbox-gl-supported":193}],111:[function(t,e,n){"use strict";var r=t("webworkify"),i=t("../window"),o=i.URL.createObjectURL(new r(t("../../source/worker"),{bare:!0}));e.exports=function(){return new i.Worker(o)}},{"../../source/worker":57,"../window":112,webworkify:213}],112:[function(t,e,n){"use strict";e.exports=self},{}],113:[function(t,e,n){"use strict";function compareAreas(t,e){return e.area-t.area}var r=t("quickselect"),i=t("./util").calculateSignedArea;e.exports=function(t,e){var n=t.length;if(n<=1)return[t];for(var o,a,s=[],u=0;u<n;u++){var l=i(t[u]);0!==l&&(t[u].area=Math.abs(l),void 0===a&&(a=l<0),a===l<0?(o&&s.push(o),o=[t[u]]):o.push(t[u]))}if(o&&s.push(o),e>1)for(var c=0;c<s.length;c++)s[c].length<=e||(r(s[c],e,1,s[c].length-1,compareAreas),s[c]=s[c].slice(0,e));return s}},{"./util":129,quickselect:199}],114:[function(t,e,n){"use strict";var r={API_URL:"https://api.mapbox.com",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null};e.exports=r},{}],115:[function(t,e,n){"use strict";var r=function(t){var e=this;this._stringToNumber={},this._numberToString=[];for(var n=0;n<t.length;n++){var r=t[n];e._stringToNumber[r]=n,e._numberToString[n]=r}};r.prototype.encode=function(t){return this._stringToNumber[t]},r.prototype.decode=function(t){return this._numberToString[t]},e.exports=r},{}],116:[function(t,e,n){"use strict";var r=t("./util"),i=t("./actor"),o=function(t,e){var n=this;this.workerPool=t,this.actors=[],this.currentActor=0,this.id=r.uniqueId();for(var o=this.workerPool.acquire(this.id),a=0;a<o.length;a++){var s=o[a],u=new i(s,e,n.id);u.name="Worker "+a,n.actors.push(u)}};o.prototype.broadcast=function(t,e,n){n=n||function(){},r.asyncAll(this.actors,function(n,r){n.send(t,e,r)},n)},o.prototype.send=function(t,e,n,r,i){return("number"!=typeof r||isNaN(r))&&(r=this.currentActor=(this.currentActor+1)%this.actors.length),this.actors[r].send(t,e,n,i),r},o.prototype.remove=function(){this.actors.forEach(function(t){t.remove()}),this.actors=[],this.workerPool.release(this.id)},e.exports=o},{"./actor":108,"./util":129}],117:[function(t,e,n){"use strict";function testProp(t){for(var e=0;e<t.length;e++)if(t[e]in a)return t[e];return t[0]}function suppressClick(t){t.preventDefault(),t.stopPropagation(),i.removeEventListener("click",suppressClick,!0)}var r=t("point-geometry"),i=t("./window");n.create=function(t,e,n){var r=i.document.createElement(t);return e&&(r.className=e),n&&n.appendChild(r),r};var o,a=i.document.documentElement.style,s=testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);n.disableDrag=function(){s&&(o=a[s],a[s]="none")},n.enableDrag=function(){s&&(a[s]=o)};var u=testProp(["transform","WebkitTransform"]);n.setTransform=function(t,e){t.style[u]=e},n.suppressClick=function(){i.addEventListener("click",suppressClick,!0),i.setTimeout(function(){i.removeEventListener("click",suppressClick,!0)},0)},n.mousePos=function(t,e){var n=t.getBoundingClientRect();return e=e.touches?e.touches[0]:e,new r(e.clientX-n.left-t.clientLeft,e.clientY-n.top-t.clientTop)},n.touchPos=function(t,e){for(var n=t.getBoundingClientRect(),i=[],o="touchend"===e.type?e.changedTouches:e.touches,a=0;a<o.length;a++)i.push(new r(o[a].clientX-n.left-t.clientLeft,o[a].clientY-n.top-t.clientTop));return i},n.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)}},{"./window":112,"point-geometry":197}],118:[function(t,e,n){"use strict";var r=t("./util"),i=function(){};i.prototype.on=function(t,e){return this._listeners=this._listeners||{},this._listeners[t]=this._listeners[t]||[],this._listeners[t].push(e),this},i.prototype.off=function(t,e){if(this._listeners&&this._listeners[t]){var n=this._listeners[t].indexOf(e);n!==-1&&this._listeners[t].splice(n,1)}return this},i.prototype.once=function(t,e){var n=this,r=function(i){n.off(t,r),e.call(n,i)};return this.on(t,r),this},i.prototype.fire=function(t,e){var n=this;if(this.listens(t)){e=r.extend({},e,{type:t,target:this});for(var i=this._listeners&&this._listeners[t]?this._listeners[t].slice():[],o=0;o<i.length;o++)i[o].call(n,e);this._eventedParent&&this._eventedParent.fire(t,r.extend({},e,this._eventedParentData))}else r.endsWith(t,"error")&&console.error(e&&e.error||e||"Empty error event");return this},i.prototype.listens=function(t){return this._listeners&&this._listeners[t]||this._eventedParent&&this._eventedParent.listens(t)},i.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData="function"==typeof e?e():e,this},e.exports=i},{"./util":129}],119:[function(t,e,n){"use strict";function compareMax(t,e){return e.max-t.max}function Cell(t,e,n,r){this.p=new i(t,e),this.h=n,this.d=pointToPolygonDist(this.p,r),this.max=this.d+this.h*Math.SQRT2}function pointToPolygonDist(t,e){for(var n=!1,r=1/0,i=0;i<e.length;i++)for(var a=e[i],s=0,u=a.length,l=u-1;s<u;l=s++){var c=a[s],p=a[l];c.y>t.y!=p.y>t.y&&t.x<(p.x-c.x)*(t.y-c.y)/(p.y-c.y)+c.x&&(n=!n),r=Math.min(r,o(t,c,p))}return(n?1:-1)*Math.sqrt(r)}function getCentroidCell(t){for(var e=0,n=0,r=0,i=t[0],o=0,a=i.length,s=a-1;o<a;s=o++){var u=i[o],l=i[s],c=u.x*l.y-l.x*u.y;n+=(u.x+l.x)*c,r+=(u.y+l.y)*c,e+=3*c}return new Cell(n/e,r/e,0,t)}var r=t("tinyqueue"),i=t("point-geometry"),o=t("./intersection_tests").distToSegmentSquared;e.exports=function(t,e,n){e=e||1;for(var i,o,a,s,u=t[0],l=0;l<u.length;l++){var c=u[l];(!l||c.x<i)&&(i=c.x),(!l||c.y<o)&&(o=c.y),(!l||c.x>a)&&(a=c.x),(!l||c.y>s)&&(s=c.y)}for(var p=a-i,h=s-o,f=Math.min(p,h),d=f/2,m=new r(null,compareMax),y=i;y<a;y+=f)for(var g=o;g<s;g+=f)m.push(new Cell(y+d,g+d,d,t));for(var v=getCentroidCell(t),_=m.length;m.length;){var x=m.pop();x.d>v.d&&(v=x,n&&console.log("found best %d after %d probes",Math.round(1e4*x.d)/1e4,_)),x.max-v.d<=e||(d=x.h/2,m.push(new Cell(x.p.x-d,x.p.y-d,d,t)),m.push(new Cell(x.p.x+d,x.p.y-d,d,t)),m.push(new Cell(x.p.x-d,x.p.y+d,d,t)),m.push(new Cell(x.p.x+d,x.p.y+d,d,t)),_+=4)}return n&&(console.log("num probes: "+_),console.log("best distance: "+v.d)),v.p}},{"./intersection_tests":122,"point-geometry":197,tinyqueue:202}],120:[function(t,e,n){"use strict";function Glyphs(t,e){this.stacks=t.readFields(readFontstacks,[],e)}function readFontstacks(t,e,n){if(1===t){var r=n.readMessage(readFontstack,{glyphs:{}});e.push(r)}}function readFontstack(t,e,n){if(1===t)e.name=n.readString();else if(2===t)e.range=n.readString();else if(3===t){var r=n.readMessage(readGlyph,{});e.glyphs[r.id]=r}}function readGlyph(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}e.exports=Glyphs},{}],121:[function(t,e,n){"use strict";function interpolate(t,e,n){return t*(1-n)+e*n}e.exports=interpolate,interpolate.number=interpolate,interpolate.vec2=function(t,e,n){return[interpolate(t[0],e[0],n),interpolate(t[1],e[1],n)]},interpolate.color=function(t,e,n){return[interpolate(t[0],e[0],n),interpolate(t[1],e[1],n),interpolate(t[2],e[2],n),interpolate(t[3],e[3],n)]},interpolate.array=function(t,e,n){return t.map(function(t,r){return interpolate(t,e[r],n)})}},{}],122:[function(t,e,n){"use strict";function polygonIntersectsPolygon(t,e){for(var n=0;n<t.length;n++)if(polygonContainsPoint(e,t[n]))return!0;for(var r=0;r<e.length;r++)if(polygonContainsPoint(t,e[r]))return!0;return!!lineIntersectsLine(t,e)}function multiPolygonIntersectsBufferedMultiPoint(t,e,n){for(var r=0;r<t.length;r++)for(var i=t[r],o=0;o<e.length;o++)for(var a=e[o],s=0;s<a.length;s++){var u=a[s];if(polygonContainsPoint(i,u))return!0;if(pointIntersectsBufferedLine(u,i,n))return!0}return!1}function multiPolygonIntersectsMultiPolygon(t,e){if(1===t.length&&1===t[0].length)return multiPolygonContainsPoint(e,t[0][0]);for(var n=0;n<e.length;n++)for(var r=e[n],i=0;i<r.length;i++)if(multiPolygonContainsPoint(t,r[i]))return!0;for(var o=0;o<t.length;o++){for(var a=t[o],s=0;s<a.length;s++)if(multiPolygonContainsPoint(e,a[s]))return!0;for(var u=0;u<e.length;u++)if(lineIntersectsLine(a,e[u]))return!0}return!1}function multiPolygonIntersectsBufferedMultiLine(t,e,n){for(var r=0;r<e.length;r++)for(var i=e[r],o=0;o<t.length;o++){var a=t[o];if(a.length>=3)for(var s=0;s<i.length;s++)if(polygonContainsPoint(a,i[s]))return!0;if(lineIntersectsBufferedLine(a,i,n))return!0}return!1}function lineIntersectsBufferedLine(t,e,n){if(t.length>1){if(lineIntersectsLine(t,e))return!0;for(var r=0;r<e.length;r++)if(pointIntersectsBufferedLine(e[r],t,n))return!0}for(var i=0;i<t.length;i++)if(pointIntersectsBufferedLine(t[i],e,n))return!0;return!1}function lineIntersectsLine(t,e){if(0===t.length||0===e.length)return!1;for(var n=0;n<t.length-1;n++)for(var r=t[n],i=t[n+1],o=0;o<e.length-1;o++){var a=e[o],s=e[o+1];if(lineSegmentIntersectsLineSegment(r,i,a,s))return!0}return!1}function lineSegmentIntersectsLineSegment(t,e,n,i){return r(t,n,i)!==r(e,n,i)&&r(t,e,n)!==r(t,e,i)}function pointIntersectsBufferedLine(t,e,n){var r=n*n;if(1===e.length)return t.distSqr(e[0])<r;for(var i=1;i<e.length;i++){if(distToSegmentSquared(t,e[i-1],e[i])<r)return!0}return!1}function distToSegmentSquared(t,e,n){var r=e.distSqr(n);if(0===r)return t.distSqr(e);var i=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/r;return i<0?t.distSqr(e):i>1?t.distSqr(n):t.distSqr(n.sub(e)._mult(i)._add(e))}function multiPolygonContainsPoint(t,e){for(var n,r,i,o=!1,a=0;a<t.length;a++){n=t[a];for(var s=0,u=n.length-1;s<n.length;u=s++)r=n[s],i=n[u],r.y>e.y!=i.y>e.y&&e.x<(i.x-r.x)*(e.y-r.y)/(i.y-r.y)+r.x&&(o=!o)}return o}function polygonContainsPoint(t,e){for(var n=!1,r=0,i=t.length-1;r<t.length;i=r++){var o=t[r],a=t[i];o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(n=!n)}return n}var r=t("./util").isCounterClockwise;e.exports={multiPolygonIntersectsBufferedMultiPoint:multiPolygonIntersectsBufferedMultiPoint,multiPolygonIntersectsMultiPolygon:multiPolygonIntersectsMultiPolygon,multiPolygonIntersectsBufferedMultiLine:multiPolygonIntersectsBufferedMultiLine,polygonIntersectsPolygon:polygonIntersectsPolygon,distToSegmentSquared:distToSegmentSquared}},{"./util":129}],123:[function(t,e,n){"use strict";var r={"Latin-1 Supplement":function(t){return t>=128&&t<=255},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};e.exports=r},{}],124:[function(t,e,n){"use strict";var r=function(t,e){this.max=t,this.onRemove=e,this.reset()};r.prototype.reset=function(){var t=this;for(var e in this.data)t.onRemove(t.data[e]);return this.data={},this.order=[],this},r.prototype.add=function(t,e){if(this.has(t))this.order.splice(this.order.indexOf(t),1),this.data[t]=e,this.order.push(t);else if(this.data[t]=e,this.order.push(t),this.order.length>this.max){var n=this.get(this.order[0]);n&&this.onRemove(n)}return this},r.prototype.has=function(t){return t in this.data},r.prototype.keys=function(){return this.order},r.prototype.get=function(t){if(!this.has(t))return null;var e=this.data[t];return delete this.data[t],this.order.splice(this.order.indexOf(t),1),e},r.prototype.remove=function(t){if(!this.has(t))return this;var e=this.data[t];return delete this.data[t],this.onRemove(e),this.order.splice(this.order.indexOf(t),1),this},r.prototype.setMaxSize=function(t){var e=this;for(this.max=t;this.order.length>this.max;){var n=e.get(e.order[0]);n&&e.onRemove(n)}return this},e.exports=r},{}],125:[function(t,e,n){"use strict";function makeAPIURL(t,e){var n=parseUrl(r.API_URL);if(t.protocol=n.protocol,t.authority=n.authority,!r.REQUIRE_ACCESS_TOKEN)return formatUrl(t);if(!(e=e||r.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+o);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+o);return t.params.push("access_token="+e),formatUrl(t)}function isMapboxURL(t){return 0===t.indexOf("mapbox:")}function replaceTempAccessToken(t){for(var e=0;e<t.length;e++)0===t[e].indexOf("access_token=tk.")&&(t[e]="access_token="+(r.ACCESS_TOKEN||""))}function parseUrl(t){var e=t.match(s);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function formatUrl(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}var r=t("./config"),i=t("./browser"),o="See https://www.mapbox.com/developers/api/#access-tokens";n.isMapboxURL=isMapboxURL,n.normalizeStyleURL=function(t,e){if(!isMapboxURL(t))return t;var n=parseUrl(t);return n.path="/styles/v1"+n.path,makeAPIURL(n,e)},n.normalizeGlyphsURL=function(t,e){if(!isMapboxURL(t))return t;var n=parseUrl(t);return n.path="/fonts/v1"+n.path,makeAPIURL(n,e)},n.normalizeSourceURL=function(t,e){if(!isMapboxURL(t))return t;var n=parseUrl(t);return n.path="/v4/"+n.authority+".json",n.params.push("secure"),makeAPIURL(n,e)},n.normalizeSpriteURL=function(t,e,n,r){var i=parseUrl(t);return isMapboxURL(t)?(i.path="/styles/v1"+i.path+"/sprite"+e+n,makeAPIURL(i,r)):(i.path+=""+e+n,formatUrl(i))};var a=/(\.(png|jpg)\d*)(?=$)/;n.normalizeTileURL=function(t,e,n){if(!e||!isMapboxURL(e))return t;var r=parseUrl(t),o=i.devicePixelRatio>=2||512===n?"@2x":"",s=i.supportsWebp?".webp":"$1";return r.path=r.path.replace(a,""+o+s),replaceTempAccessToken(r.params),formatUrl(r)};var s=/^(\w+):\/\/([^\/?]+)(\/[^?]+)?\??(.+)?/},{"./browser":110,"./config":114}],126:[function(t,e,n){"use strict";var r=t("./is_char_in_unicode_block");e.exports.allowsIdeographicBreaking=function(t){for(var e=0,r=t;e<r.length;e+=1){var i=r[e];if(!n.charAllowsIdeographicBreaking(i.charCodeAt(0)))return!1}return!0},e.exports.allowsVerticalWritingMode=function(t){for(var e=0,r=t;e<r.length;e+=1){var i=r[e];if(n.charHasUprightVerticalOrientation(i.charCodeAt(0)))return!0}return!1},e.exports.charAllowsIdeographicBreaking=function(t){return!!(!(t<11904)&&(r["Bopomofo Extended"](t)||r.Bopomofo(t)||r["CJK Compatibility Forms"](t)||r["CJK Compatibility Ideographs"](t)||r["CJK Compatibility"](t)||r["CJK Radicals Supplement"](t)||r["CJK Strokes"](t)||r["CJK Symbols and Punctuation"](t)||r["CJK Unified Ideographs Extension A"](t)||r["CJK Unified Ideographs"](t)||r["Enclosed CJK Letters and Months"](t)||r["Halfwidth and Fullwidth Forms"](t)||r.Hiragana(t)||r["Ideographic Description Characters"](t)||r["Kangxi Radicals"](t)||r["Katakana Phonetic Extensions"](t)||r.Katakana(t)||r["Vertical Forms"](t)||r["Yi Radicals"](t)||r["Yi Syllables"](t)))},n.charHasUprightVerticalOrientation=function(t){return!!(746===t||747===t||!(t<4352)&&(r["Bopomofo Extended"](t)||r.Bopomofo(t)||r["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||r["CJK Compatibility Ideographs"](t)||r["CJK Compatibility"](t)||r["CJK Radicals Supplement"](t)||r["CJK Strokes"](t)||!(!r["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||r["CJK Unified Ideographs Extension A"](t)||r["CJK Unified Ideographs"](t)||r["Enclosed CJK Letters and Months"](t)||r["Hangul Compatibility Jamo"](t)||r["Hangul Jamo Extended-A"](t)||r["Hangul Jamo Extended-B"](t)||r["Hangul Jamo"](t)||r["Hangul Syllables"](t)||r.Hiragana(t)||r["Ideographic Description Characters"](t)||r.Kanbun(t)||r["Kangxi Radicals"](t)||r["Katakana Phonetic Extensions"](t)||r.Katakana(t)&&12540!==t||!(!r["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!r["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||r["Unified Canadian Aboriginal Syllabics"](t)||r["Unified Canadian Aboriginal Syllabics Extended"](t)||r["Vertical Forms"](t)||r["Yijing Hexagram Symbols"](t)||r["Yi Syllables"](t)||r["Yi Radicals"](t)))},n.charHasNeutralVerticalOrientation=function(t){return!!(r["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||r["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||r["Letterlike Symbols"](t)||r["Number Forms"](t)||r["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||r["Control Pictures"](t)&&9251!==t||r["Optical Character Recognition"](t)||r["Enclosed Alphanumerics"](t)||r["Geometric Shapes"](t)||r["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||r["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||r["CJK Symbols and Punctuation"](t)||r.Katakana(t)||r["Private Use Area"](t)||r["CJK Compatibility Forms"](t)||r["Small Form Variants"](t)||r["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)},n.charHasRotatedVerticalOrientation=function(t){return!(n.charHasUprightVerticalOrientation(t)||n.charHasNeutralVerticalOrientation(t))}},{"./is_char_in_unicode_block":123}],127:[function(t,e,n){"use strict";function createStructArrayType(t){var e=JSON.stringify(t);if(a[e])return a[e];var n=void 0===t.alignment?1:t.alignment,r=0,s=0,u=["Uint8"],l=t.members.map(function(t){u.indexOf(t.type)<0&&u.push(t.type);var e=sizeOf(t.type),i=r=align(r,Math.max(n,e)),o=t.components||1;return s=Math.max(s,e),r+=e*o,{name:t.name,type:t.type,components:o,offset:i}}),c=align(r,Math.max(s,n)),p=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(i);p.prototype.alignment=n,p.prototype.size=c;for(var h=0,f=l;h<f.length;h+=1)for(var d=f[h],m=0;m<d.components;m++){var y=d.name+(1===d.components?"":m);Object.defineProperty(p.prototype,y,{get:createGetter(d,m),set:createSetter(d,m)})}var g=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(o);return g.prototype.members=l,g.prototype.StructType=p,g.prototype.bytesPerElement=c,g.prototype.emplaceBack=createEmplaceBack(l,c),g.prototype._usedTypes=u,a[e]=g,g}function align(t,e){return Math.ceil(t/e)*e}function sizeOf(t){return r[t].BYTES_PER_ELEMENT}function getArrayViewName(t){return t.toLowerCase()}function createEmplaceBack(t,e){for(var n=[],r=[],i="var i = this.length;\nthis.resize(this.length + 1);\n",o=0,a=t;o<a.length;o+=1){var s=a[o],u=sizeOf(s.type);n.indexOf(u)<0&&(n.push(u),i+="var o"+u.toFixed(0)+" = i * "+(e/u).toFixed(0)+";\n");for(var l=0;l<s.components;l++){var c="v"+r.length,p="o"+u.toFixed(0)+" + "+(s.offset/u+l).toFixed(0);i+="this."+getArrayViewName(s.type)+"["+p+"] = "+c+";\n",r.push(c)}}return i+="return i;",new Function(r.toString(),i)}function createMemberComponentString(t,e){var n="this._pos"+sizeOf(t.type).toFixed(0),r=(t.offset/sizeOf(t.type)+e).toFixed(0),i=n+" + "+r;return"this._structArray."+getArrayViewName(t.type)+"["+i+"]"}function createGetter(t,e){return new Function("return "+createMemberComponentString(t,e)+";")}function createSetter(t,e){return new Function("x",createMemberComponentString(t,e)+" = x;")}e.exports=createStructArrayType;var r={Int8:Int8Array,Uint8:Uint8Array,Uint8Clamped:Uint8ClampedArray,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array,Float64:Float64Array},i=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},o=function(t){this.isTransferred=!1,void 0!==t?(this.arrayBuffer=t.arrayBuffer,this.length=t.length,this.capacity=this.arrayBuffer.byteLength/this.bytesPerElement,this._refreshViews()):(this.capacity=-1,this.resize(0))};o.serialize=function(){return{members:this.prototype.members,alignment:this.prototype.StructType.prototype.alignment,bytesPerElement:this.prototype.bytesPerElement}},o.prototype.serialize=function(t){return this._trim(),t&&(this.isTransferred=!0,t.push(this.arrayBuffer)),{length:this.length,arrayBuffer:this.arrayBuffer}},o.prototype.get=function(t){return new this.StructType(this,t)},o.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},o.prototype.resize=function(t){if(this.length=t,t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},o.prototype._refreshViews=function(){for(var t=this,e=0,n=this._usedTypes;e<n.length;e+=1){var i=n[e];t[getArrayViewName(i)]=new r[i](t.arrayBuffer)}},o.prototype.toArray=function(t,e){for(var n=this,r=[],i=t;i<e;i++){var o=n.get(i);r.push(o)}return r};var a={}},{}],128:[function(t,e,n){"use strict";function resolveTokens(t,e){return e.replace(/{([^{}]+)}/g,function(e,n){return n in t?t[n]:""})}e.exports=resolveTokens},{}],129:[function(t,e,n){"use strict";var r=t("@mapbox/unitbezier"),i=t("../geo/coordinate");t("point-geometry");n.easeCubicInOut=function(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)},n.bezier=function(t,e,n,i){var o=new r(t,e,n,i);return function(t){return o.solve(t)}},n.ease=n.bezier(.25,.1,.25,1),n.clamp=function(t,e,n){return Math.min(n,Math.max(e,t))},n.wrap=function(t,e,n){var r=n-e,i=((t-e)%r+r)%r+e;return i===e?n:i},n.asyncAll=function(t,e,n){if(!t.length)return n(null,[]);var r=t.length,i=new Array(t.length),o=null;t.forEach(function(t,a){e(t,function(t,e){t&&(o=t),i[a]=e,0==--r&&n(o,i)})})},n.values=function(t){var e=[];for(var n in t)e.push(t[n]);return e},n.keysDifference=function(t,e){var n=[];for(var r in t)r in e||n.push(r);return n},n.extend=function(t,e,n,r){for(var i=arguments,o=1;o<arguments.length;o++){var a=i[o];for(var s in a)t[s]=a[s]}return t},n.pick=function(t,e){for(var n={},r=0;r<e.length;r++){var i=e[r];i in t&&(n[i]=t[i])}return n};var o=1;n.uniqueId=function(){return o++},n.bindAll=function(t,e){t.forEach(function(t){e[t]&&(e[t]=e[t].bind(e))})},n.getCoordinatesCenter=function(t){for(var e=1/0,n=1/0,r=-(1/0),o=-(1/0),a=0;a<t.length;a++)e=Math.min(e,t[a].column),n=Math.min(n,t[a].row),r=Math.max(r,t[a].column),o=Math.max(o,t[a].row);var s=r-e,u=o-n,l=Math.max(s,u);return new i((e+r)/2,(n+o)/2,0).zoomTo(Math.floor(-Math.log(l)/Math.LN2))},n.endsWith=function(t,e){return t.indexOf(e,t.length-e.length)!==-1},n.mapObject=function(t,e,n){var r=this,i={};for(var o in t)i[o]=e.call(n||r,t[o],o,t);return i},n.filterObject=function(t,e,n){var r=this,i={};for(var o in t)e.call(n||r,t[o],o,t)&&(i[o]=t[o]);return i},n.deepEqual=function(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(!n.deepEqual(t[r],e[r]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var i in t)if(!n.deepEqual(t[i],e[i]))return!1;return!0}return t===e},n.clone=function(t){return Array.isArray(t)?t.map(n.clone):"object"==typeof t&&t?n.mapObject(t,n.clone):t},n.arraysIntersect=function(t,e){for(var n=0;n<t.length;n++)if(e.indexOf(t[n])>=0)return!0;return!1};var a={};n.warnOnce=function(t){a[t]||("undefined"!=typeof console&&console.warn(t),a[t]=!0)},n.isCounterClockwise=function(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)},n.calculateSignedArea=function(t){for(var e,n,r=0,i=0,o=t.length,a=o-1;i<o;a=i++)e=t[i],n=t[a],r+=(n.x-e.x)*(e.y+n.y);return r},n.isClosedPolygon=function(t){if(t.length<4)return!1;var e=t[0],r=t[t.length-1];return!(Math.abs(e.x-r.x)>0||Math.abs(e.y-r.y)>0)&&Math.abs(n.calculateSignedArea(t))>.01},n.sphericalToCartesian=function(t){var e=t[0],n=t[1],r=t[2];return n+=90,n*=Math.PI/180,r*=Math.PI/180,[e*Math.cos(n)*Math.sin(r),e*Math.sin(n)*Math.sin(r),e*Math.cos(r)]},n.parseCacheControl=function(t){var e=/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,n={};if(t.replace(e,function(t,e,r,i){var o=r||i;return n[e]=!o||o.toLowerCase(),""}),n["max-age"]){var r=parseInt(n["max-age"],10);isNaN(r)?delete n["max-age"]:n["max-age"]=r}return n}},{"../geo/coordinate":18,"@mapbox/unitbezier":134,"point-geometry":197}],130:[function(t,e,n){"use strict";var r=function(t,e,n,r){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=n,t._y=r,this.properties=t.properties,null!=t.id&&(this.id=t.id)},i={geometry:{}};i.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},i.geometry.set=function(t){this._geometry=t},r.prototype.toJSON=function(){var t=this,e={geometry:this.geometry};for(var n in this)"_geometry"!==n&&"_vectorTileFeature"!==n&&(e[n]=t[n]);return e},Object.defineProperties(r.prototype,i),e.exports=r},{}],131:[function(t,e,n){"use strict";var r=t("./script_detection");e.exports=function(t){for(var n="",i=0;i<t.length;i++){var o=t.charCodeAt(i+1)||null,a=t.charCodeAt(i-1)||null;n+=(!o||!r.charHasRotatedVerticalOrientation(o)||e.exports.lookup[t[i+1]])&&(!a||!r.charHasRotatedVerticalOrientation(a)||e.exports.lookup[t[i-1]])&&e.exports.lookup[t[i]]?e.exports.lookup[t[i]]:t[i]}return n},e.exports.lookup={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"}},{"./script_detection":126}],132:[function(t,e,n){"use strict";var r=t("./web_worker"),i=function(){this.active={}};i.prototype.acquire=function(e){var n=this;if(!this.workers){var i=t("../mapbox-gl").workerCount;for(this.workers=[];this.workers.length<i;)n.workers.push(new r)}return this.active[e]=!0,this.workers.slice()},i.prototype.release=function(t){delete this.active[t],0===Object.keys(this.active).length&&(this.workers.forEach(function(t){t.terminate()}),this.workers=null)},e.exports=i},{"../mapbox-gl":24,"./web_worker":111}],133:[function(e,n,r){!function(e,i){"object"==typeof r&&void 0!==n?n.exports=i():"function"==typeof t&&t.amd?t(i):e.glMatrix=i()}(this,function(){"use strict";function t(){var t=new Float32Array(3);return t[0]=0,t[1]=0,t[2]=0,t}function r(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t}function n(){var t=new Float32Array(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function e(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t}function a(){var t=new Float32Array(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function o(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+o*s,t[1]=i*u+a*s,t[2]=r*-s+o*u,t[3]=i*-s+a*u,t}function u(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],u=n[1];return t[0]=r*s,t[1]=i*s,t[2]=o*u,t[3]=a*u,t}function i(){var t=new Float32Array(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function c(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function f(){var t=new Float32Array(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function v(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function s(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],p=e[9],h=e[10],f=e[11],d=e[12],m=e[13],y=e[14],g=e[15],v=n*s-r*a,_=n*u-i*a,x=n*l-o*a,b=r*u-i*s,w=r*l-o*s,S=i*l-o*u,T=c*m-p*d,E=c*y-h*d,A=c*g-f*d,P=p*y-h*m,C=p*g-f*m,M=h*g-f*y,k=v*M-_*C+x*P+b*A-w*E+S*T;return k?(k=1/k,t[0]=(s*M-u*C+l*P)*k,t[1]=(i*C-r*M-o*P)*k,t[2]=(m*S-y*w+g*b)*k,t[3]=(h*w-p*S-f*b)*k,t[4]=(u*A-a*M-l*E)*k,t[5]=(n*M-i*A+o*E)*k,t[6]=(y*x-d*S-g*_)*k,t[7]=(c*S-h*x+f*_)*k,t[8]=(a*C-s*A+l*T)*k,t[9]=(r*A-n*C-o*T)*k,t[10]=(d*w-m*x+g*v)*k,t[11]=(p*x-c*w-f*v)*k,t[12]=(s*E-a*P-u*T)*k,t[13]=(n*P-r*E+i*T)*k,t[14]=(m*_-d*b-y*v)*k,t[15]=(c*b-p*_+h*v)*k,t):null}function l(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],p=e[8],h=e[9],f=e[10],d=e[11],m=e[12],y=e[13],g=e[14],v=e[15],_=n[0],x=n[1],b=n[2],w=n[3];return t[0]=_*r+x*s+b*p+w*m,t[1]=_*i+x*u+b*h+w*y,t[2]=_*o+x*l+b*f+w*g,t[3]=_*a+x*c+b*d+w*v,_=n[4],x=n[5],b=n[6],w=n[7],t[4]=_*r+x*s+b*p+w*m,t[5]=_*i+x*u+b*h+w*y,t[6]=_*o+x*l+b*f+w*g,t[7]=_*a+x*c+b*d+w*v,_=n[8],x=n[9],b=n[10],w=n[11],t[8]=_*r+x*s+b*p+w*m,t[9]=_*i+x*u+b*h+w*y,t[10]=_*o+x*l+b*f+w*g,t[11]=_*a+x*c+b*d+w*v,_=n[12],x=n[13],b=n[14],w=n[15],t[12]=_*r+x*s+b*p+w*m,t[13]=_*i+x*u+b*h+w*y,t[14]=_*o+x*l+b*f+w*g,t[15]=_*a+x*c+b*d+w*v,t}function M(t,e,n){var r,i,o,a,s,u,l,c,p,h,f,d,m=n[0],y=n[1],g=n[2];return e===t?(t[12]=e[0]*m+e[4]*y+e[8]*g+e[12],t[13]=e[1]*m+e[5]*y+e[9]*g+e[13],t[14]=e[2]*m+e[6]*y+e[10]*g+e[14],t[15]=e[3]*m+e[7]*y+e[11]*g+e[15]):(r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],p=e[8],h=e[9],f=e[10],d=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=p,t[9]=h,t[10]=f,t[11]=d,t[12]=r*m+s*y+p*g+e[12],t[13]=i*m+u*y+h*g+e[13],t[14]=o*m+l*y+f*g+e[14],t[15]=a*m+c*y+d*g+e[15]),t}function h(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function m(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],l=e[8],c=e[9],p=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+l*r,t[5]=a*i+c*r,t[6]=s*i+p*r,t[7]=u*i+h*r,t[8]=l*i-o*r,t[9]=c*i-a*r,t[10]=p*i-s*r,t[11]=h*i-u*r,t}function y(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],l=e[4],c=e[5],p=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+l*r,t[1]=a*i+c*r,t[2]=s*i+p*r,t[3]=u*i+h*r,t[4]=l*i-o*r,t[5]=c*i-a*r,t[6]=p*i-s*r,t[7]=h*i-u*r,t}function d(t,e,n,r,i){var o=1/Math.tan(e/2),a=1/(r-i);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+r)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*r*a,t[15]=0,t}function p(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(a+o)*l,t[15]=1,t}return t(),n(),{vec3:{transformMat3:r},vec4:{transformMat4:e},mat2:{create:a,rotate:o,scale:u},mat3:{create:i,fromRotation:c},mat4:{create:f,identity:v,translate:M,scale:h,multiply:l,perspective:d,rotateX:m,rotateZ:y,invert:s,ortho:p}}})},{}],134:[function(t,e,n){function UnitBezier(t,e,n,r){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=n,this.p2y=r}e.exports=UnitBezier,UnitBezier.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},UnitBezier.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},UnitBezier.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},UnitBezier.prototype.solveCurveX=function(t,e){void 0===e&&(e=1e-6);var n,r,i,o,a;for(i=t,a=0;a<8;a++){if(o=this.sampleCurveX(i)-t,Math.abs(o)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if(n=0,r=1,(i=t)<n)return n;if(i>r)return r;for(;n<r;){if(o=this.sampleCurveX(i),Math.abs(o-t)<e)return i;t>o?n=i:r=i,i=.5*(r-n)+n}return i},UnitBezier.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}},{}],135:[function(t,e,n){function clamp_css_byte(t){return t=Math.round(t),t<0?0:t>255?255:t}function clamp_css_float(t){return t<0?0:t>1?1:t}function parse_css_int(t){return clamp_css_byte("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function parse_css_float(t){return clamp_css_float("%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))}function css_hue_to_rgb(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}function parseCSSColor(t){var e=t.replace(/ /g,"").toLowerCase();if(e in r)return r[e].slice();if("#"===e[0]){if(4===e.length){var n=parseInt(e.substr(1),16);return n>=0&&n<=4095?[(3840&n)>>4|(3840&n)>>8,240&n|(240&n)>>4,15&n|(15&n)<<4,1]:null}if(7===e.length){var n=parseInt(e.substr(1),16);return n>=0&&n<=16777215?[(16711680&n)>>16,(65280&n)>>8,255&n,1]:null}return null}var i=e.indexOf("("),o=e.indexOf(")");if(i!==-1&&o+1===e.length){var a=e.substr(0,i),s=e.substr(i+1,o-(i+1)).split(","),u=1;switch(a){case"rgba":if(4!==s.length)return null;u=parse_css_float(s.pop());case"rgb":return 3!==s.length?null:[parse_css_int(s[0]),parse_css_int(s[1]),parse_css_int(s[2]),u];case"hsla":if(4!==s.length)return null;u=parse_css_float(s.pop());case"hsl":if(3!==s.length)return null;var l=(parseFloat(s[0])%360+360)%360/360,c=parse_css_float(s[1]),p=parse_css_float(s[2]),h=p<=.5?p*(c+1):p+c-p*c,f=2*p-h;return[clamp_css_byte(255*css_hue_to_rgb(f,h,l+1/3)),clamp_css_byte(255*css_hue_to_rgb(f,h,l)),clamp_css_byte(255*css_hue_to_rgb(f,h,l-1/3)),u];default:return null}}return null}var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};try{n.parseCSSColor=parseCSSColor}catch(t){}},{}],136:[function(t,e,n){"use strict";function earcut(t,e,n){n=n||2;var r=e&&e.length,i=r?e[0]*n:t.length,o=linkedList(t,0,i,n,!0),a=[];if(!o)return a;var s,u,l,c,p,h,f;if(r&&(o=eliminateHoles(t,e,o,n)),t.length>80*n){s=l=t[0],u=c=t[1];for(var d=n;d<i;d+=n)p=t[d],h=t[d+1],p<s&&(s=p),h<u&&(u=h),p>l&&(l=p),h>c&&(c=h);f=Math.max(l-s,c-u)}return earcutLinked(o,a,n,s,u,f),a}function linkedList(t,e,n,r,i){var o,a;if(i===signedArea(t,e,n,r)>0)for(o=e;o<n;o+=r)a=insertNode(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=insertNode(o,t[o],t[o+1],a);return a&&equals(a,a.next)&&(removeNode(a),a=a.next),a}function filterPoints(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!equals(r,r.next)&&0!==area(r.prev,r,r.next))r=r.next;else{if(removeNode(r),(r=e=r.prev)===r.next)return null;n=!0}}while(n||r!==e);return e}function earcutLinked(t,e,n,r,i,o,a){if(t){!a&&o&&indexCurve(t,r,i,o);for(var s,u,l=t;t.prev!==t.next;)if(s=t.prev,u=t.next,o?isEarHashed(t,r,i,o):isEar(t))e.push(s.i/n),e.push(t.i/n),e.push(u.i/n),removeNode(t),t=u.next,l=u.next;else if((t=u)===l){a?1===a?(t=cureLocalIntersections(t,e,n),earcutLinked(t,e,n,r,i,o,2)):2===a&&splitEarcut(t,e,n,r,i,o):earcutLinked(filterPoints(t),e,n,r,i,o,1);break}}}function isEar(t){var e=t.prev,n=t,r=t.next;if(area(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(pointInTriangle(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&area(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function isEarHashed(t,e,n,r){var i=t.prev,o=t,a=t.next;if(area(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,u=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,l=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,c=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,p=zOrder(s,u,e,n,r),h=zOrder(l,c,e,n,r),f=t.nextZ;f&&f.z<=h;){if(f!==t.prev&&f!==t.next&&pointInTriangle(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&area(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(f=t.prevZ;f&&f.z>=p;){if(f!==t.prev&&f!==t.next&&pointInTriangle(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&area(f.prev,f,f.next)>=0)return!1;f=f.prevZ}return!0}function cureLocalIntersections(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!equals(i,o)&&intersects(i,r,r.next,o)&&locallyInside(i,o)&&locallyInside(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),removeNode(r),removeNode(r.next),r=t=o),r=r.next}while(r!==t);return r}function splitEarcut(t,e,n,r,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&isValidDiagonal(a,s)){var u=splitPolygon(a,s);return a=filterPoints(a,a.next),u=filterPoints(u,u.next),earcutLinked(a,e,n,r,i,o),void earcutLinked(u,e,n,r,i,o)}s=s.next}a=a.next}while(a!==t)}function eliminateHoles(t,e,n,r){var i,o,a,s,u,l=[];for(i=0,o=e.length;i<o;i++)a=e[i]*r,s=i<o-1?e[i+1]*r:t.length,u=linkedList(t,a,s,r,!1),u===u.next&&(u.steiner=!0),l.push(getLeftmost(u));for(l.sort(compareX),i=0;i<l.length;i++)eliminateHole(l[i],n),n=filterPoints(n,n.next);return n}function compareX(t,e){return t.x-e.x}function eliminateHole(t,e){if(e=findHoleBridge(t,e)){var n=splitPolygon(e,t);filterPoints(n,n.next)}}function findHoleBridge(t,e){var n,r=e,i=t.x,o=t.y,a=-(1/0);do{if(o<=r.y&&o>=r.next.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n.prev;var u,l=n,c=n.x,p=n.y,h=1/0;for(r=n.next;r!==l;)i>=r.x&&r.x>=c&&pointInTriangle(o<p?i:a,o,c,p,o<p?a:i,o,r.x,r.y)&&((u=Math.abs(o-r.y)/(i-r.x))<h||u===h&&r.x>n.x)&&locallyInside(r,t)&&(n=r,h=u),r=r.next;return n}function indexCurve(t,e,n,r){var i=t;do{null===i.z&&(i.z=zOrder(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,sortLinked(i)}function sortLinked(t){var e,n,r,i,o,a,s,u,l=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<l&&(s++,r=r.nextZ);e++);for(u=l;s>0||u>0&&r;)0===s?(i=r,r=r.nextZ,u--):0!==u&&r?n.z<=r.z?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--):(i=n,n=n.nextZ,s--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(a>1);return t}function zOrder(t,e,n,r,i){return t=32767*(t-n)/i,e=32767*(e-r)/i,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1}function getLeftmost(t){var e=t,n=t;do{e.x<n.x&&(n=e),e=e.next}while(e!==t);return n}function pointInTriangle(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function isValidDiagonal(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!intersectsPolygon(t,e)&&locallyInside(t,e)&&locallyInside(e,t)&&middleInside(t,e)}function area(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function equals(t,e){return t.x===e.x&&t.y===e.y}function intersects(t,e,n,r){return!!(equals(t,e)&&equals(n,r)||equals(t,r)&&equals(n,e))||area(t,e,n)>0!=area(t,e,r)>0&&area(n,r,t)>0!=area(n,r,e)>0}function intersectsPolygon(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&intersects(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function locallyInside(t,e){return area(t.prev,t,t.next)<0?area(t,e,t.next)>=0&&area(t,t.prev,e)>=0:area(t,e,t.prev)<0||area(t,t.next,e)<0}function middleInside(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}function splitPolygon(t,e){var n=new Node(t.i,t.x,t.y),r=new Node(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function insertNode(t,e,n,r){var i=new Node(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function removeNode(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Node(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}e.exports=earcut,earcut.deviation=function(t,e,n,r){var i=e&&e.length,o=i?e[0]*n:t.length,a=Math.abs(signedArea(t,0,o,n));if(i)for(var s=0,u=e.length;s<u;s++){var l=e[s]*n,c=s<u-1?e[s+1]*n:t.length;a-=Math.abs(signedArea(t,l,c,n))}var p=0;for(s=0;s<r.length;s+=3){var h=r[s]*n,f=r[s+1]*n,d=r[s+2]*n;p+=Math.abs((t[h]-t[d])*(t[f+1]-t[h+1])-(t[h]-t[f])*(t[d+1]-t[h+1]))}return 0===a&&0===p?0:Math.abs((p-a)/a)},earcut.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n}},{}],137:[function(t,e,n){function sss(t){var e,n,r,u,l,c;switch(typeof t){case"object":if(null===t)return null;if(i(t)){for(r="[",n=t.length-1,e=0;e<n;e++)r+=sss(t[e])+",";return n>-1&&(r+=sss(t[e])),r+"]"}for(u=o(t).sort(),n=u.length,r="{",l=u[e=0],c=n>0&&void 0!==t[l];e<n;)c?(r+='"'+l.replace(a,s)+'":'+sss(t[l]),l=u[++e],(c=e<n&&void 0!==t[l])&&(r+=",")):(l=u[++e],c=e<n&&void 0!==t[l]);return r+"}";case"undefined":return null;case"string":return'"'+t.replace(a,s)+'"';default:return t}}var r={}.toString,i=Array.isArray||function(t){return"[object Array]"===r.call(t)},o=Object.keys||function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e},a=/[\u0000-\u001f"\\]/g,s=function(t){var e=t.charCodeAt(0);switch(e){case 34:return'\\"';case 92:return"\\\\";case 12:return"\\f";case 10:return"\\n";case 13:return"\\r";case 9:return"\\t";case 8:return"\\b";default:return e>15?"\\u00"+e.toString(16):"\\u000"+e.toString(16)}};e.exports=function(t){if(void 0!==t)return""+sss(t)},e.exports.stringSearch=a,e.exports.stringReplace=s},{}],138:[function(t,e,n){"use strict";function createFilter(t){return new Function("f","var p = (f && f.properties || {}); return "+compile(t))}function compile(t){if(!t)return"true";var e=t[0];return t.length<=1?"any"===e?"false":"true":"("+("=="===e?compileComparisonOp(t[1],t[2],"===",!1):"!="===e?compileComparisonOp(t[1],t[2],"!==",!1):"<"===e||">"===e||"<="===e||">="===e?compileComparisonOp(t[1],t[2],e,!0):"any"===e?compileLogicalOp(t.slice(1),"||"):"all"===e?compileLogicalOp(t.slice(1),"&&"):"none"===e?compileNegation(compileLogicalOp(t.slice(1),"||")):"in"===e?compileInOp(t[1],t.slice(2)):"!in"===e?compileNegation(compileInOp(t[1],t.slice(2))):"has"===e?compileHasOp(t[1]):"!has"===e?compileNegation(compileHasOp([t[1]])):"true")+")"}function compilePropertyReference(t){return"$type"===t?"f.type":"$id"===t?"f.id":"p["+JSON.stringify(t)+"]"}function compileComparisonOp(t,e,n,i){var o=compilePropertyReference(t),a="$type"===t?r.indexOf(e):JSON.stringify(e);return(i?"typeof "+o+"=== typeof "+a+"&&":"")+o+n+a}function compileLogicalOp(t,e){return t.map(compile).join(e)}function compileInOp(t,e){"$type"===t&&(e=e.map(function(t){return r.indexOf(t)}));var n=JSON.stringify(e.sort(compare)),i=compilePropertyReference(t);return e.length<=200?n+".indexOf("+i+") !== -1":"function(v, a, i, j) {while (i <= j) { var m = (i + j) >> 1;    if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;}return false; }("+i+", "+n+",0,"+(e.length-1)+")"}function compileHasOp(t){return JSON.stringify(t)+" in p"}function compileNegation(t){return"!("+t+")"}function compare(t,e){return t<e?-1:t>e?1:0}e.exports=createFilter;var r=["Unknown","Point","LineString","Polygon"]},{}],139:[function(t,e,n){function geometry(t){if("Polygon"===t.type)return polygonArea(t.coordinates);if("MultiPolygon"===t.type){for(var e=0,n=0;n<t.coordinates.length;n++)e+=polygonArea(t.coordinates[n]);return e}return null}function polygonArea(t){var e=0;if(t&&t.length>0){e+=Math.abs(ringArea(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(ringArea(t[n]))}return e}function ringArea(t){var e=0;if(t.length>2){for(var n,i,o=0;o<t.length-1;o++)n=t[o],i=t[o+1],e+=rad(i[0]-n[0])*(2+Math.sin(rad(n[1]))+Math.sin(rad(i[1])));e=e*r.RADIUS*r.RADIUS/2}return e}function rad(t){return t*Math.PI/180}var r=t("wgs84");e.exports.geometry=geometry,e.exports.ring=ringArea},{wgs84:214}],140:[function(t,e,n){function rewind(t,e){switch(t&&t.type||null){case"FeatureCollection":return t.features=t.features.map(curryOuter(rewind,e)),t;case"Feature":return t.geometry=rewind(t.geometry,e),t;case"Polygon":case"MultiPolygon":return correct(t,e);default:return t}}function curryOuter(t,e){return function(n){return t(n,e)}}function correct(t,e){return"Polygon"===t.type?t.coordinates=correctRings(t.coordinates,e):"MultiPolygon"===t.type&&(t.coordinates=t.coordinates.map(curryOuter(correctRings,e))),t}function correctRings(t,e){e=!!e,t[0]=wind(t[0],!e);for(var n=1;n<t.length;n++)t[n]=wind(t[n],e);return t}function wind(t,e){return cw(t)===e?t:t.reverse()}function cw(t){return r.ring(t)>=0}var r=t("geojson-area");e.exports=rewind},{"geojson-area":139}],141:[function(t,e,n){"use strict";function clip(t,e,n,i,o,a,s,u){if(n/=e,i/=e,s>=n&&u<=i)return t;if(s>i||u<n)return null;for(var l=[],c=0;c<t.length;c++){var p,h,f=t[c],d=f.geometry,m=f.type;if(p=f.min[o],h=f.max[o],p>=n&&h<=i)l.push(f);else if(!(p>i||h<n)){var y=1===m?clipPoints(d,n,i,o):clipGeometry(d,n,i,o,a,3===m);y.length&&l.push(r(f.tags,m,y,f.id))}}return l.length?l:null}function clipPoints(t,e,n,r){for(var i=[],o=0;o<t.length;o++){var a=t[o],s=a[r];s>=e&&s<=n&&i.push(a)}return i}function clipGeometry(t,e,n,r,i,o){for(var a=[],s=0;s<t.length;s++){var u,l,c,p=0,h=0,f=null,d=t[s],m=d.area,y=d.dist,g=d.outer,v=d.length,_=[];for(l=0;l<v-1;l++)u=f||d[l],f=d[l+1],p=h||u[r],h=f[r],p<e?h>n?(_.push(i(u,f,e),i(u,f,n)),o||(_=newSlice(a,_,m,y,g))):h>=e&&_.push(i(u,f,e)):p>n?h<e?(_.push(i(u,f,n),i(u,f,e)),o||(_=newSlice(a,_,m,y,g))):h<=n&&_.push(i(u,f,n)):(_.push(u),h<e?(_.push(i(u,f,e)),o||(_=newSlice(a,_,m,y,g))):h>n&&(_.push(i(u,f,n)),o||(_=newSlice(a,_,m,y,g))));u=d[v-1],p=u[r],p>=e&&p<=n&&_.push(u),c=_[_.length-1],o&&c&&(_[0][0]!==c[0]||_[0][1]!==c[1])&&_.push(_[0]),newSlice(a,_,m,y,g)}return a}function newSlice(t,e,n,r,i){return e.length&&(e.area=n,e.dist=r,void 0!==i&&(e.outer=i),t.push(e)),[]}e.exports=clip;var r=t("./feature")},{"./feature":143}],142:[function(t,e,n){"use strict";function convert(t,e){var n=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)convertFeature(n,t.features[r],e);else"Feature"===t.type?convertFeature(n,t,e):convertFeature(n,{geometry:t},e);return n}function convertFeature(t,e,n){if(null!==e.geometry){var r,o,a,s,u=e.geometry,l=u.type,c=u.coordinates,p=e.properties,h=e.id;if("Point"===l)t.push(i(p,1,[projectPoint(c)],h));else if("MultiPoint"===l)t.push(i(p,1,project(c),h));else if("LineString"===l)t.push(i(p,2,[project(c,n)],h));else if("MultiLineString"===l||"Polygon"===l){for(a=[],r=0;r<c.length;r++)s=project(c[r],n),"Polygon"===l&&(s.outer=0===r),a.push(s);t.push(i(p,"Polygon"===l?3:2,a,h))}else if("MultiPolygon"===l){for(a=[],r=0;r<c.length;r++)for(o=0;o<c[r].length;o++)s=project(c[r][o],n),s.outer=0===o,a.push(s);t.push(i(p,3,a,h))}else{if("GeometryCollection"!==l)throw new Error("Input data is not a valid GeoJSON object.");for(r=0;r<u.geometries.length;r++)convertFeature(t,{geometry:u.geometries[r],properties:p},n)}}}function project(t,e){for(var n=[],i=0;i<t.length;i++)n.push(projectPoint(t[i]));return e&&(r(n,e),calcSize(n)),n}function projectPoint(t){var e=Math.sin(t[1]*Math.PI/180),n=t[0]/360+.5,r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r=r<0?0:r>1?1:r,[n,r,0]}function calcSize(t){for(var e,n,r=0,i=0,o=0;o<t.length-1;o++)e=n||t[o],n=t[o+1],r+=e[0]*n[1]-n[0]*e[1],i+=Math.abs(n[0]-e[0])+Math.abs(n[1]-e[1]);t.area=Math.abs(r/2),t.dist=i}e.exports=convert;var r=t("./simplify"),i=t("./feature")},{"./feature":143,"./simplify":145}],143:[function(t,e,n){"use strict";function createFeature(t,e,n,r){var i={id:r||null,type:e,geometry:n,tags:t||null,min:[1/0,1/0],max:[-(1/0),-(1/0)]};return calcBBox(i),i}function calcBBox(t){var e=t.geometry,n=t.min,r=t.max;if(1===t.type)calcRingBBox(n,r,e);else for(var i=0;i<e.length;i++)calcRingBBox(n,r,e[i]);return t}function calcRingBBox(t,e,n){for(var r,i=0;i<n.length;i++)r=n[i],t[0]=Math.min(r[0],t[0]),e[0]=Math.max(r[0],e[0]),t[1]=Math.min(r[1],t[1]),e[1]=Math.max(r[1],e[1])}e.exports=createFeature},{}],144:[function(t,e,n){"use strict";function geojsonvt(t,e){return new GeoJSONVT(t,e)}function GeoJSONVT(t,e){e=this.options=extend(Object.create(this.options),e);var n=e.debug;n&&console.time("preprocess data");var i=1<<e.maxZoom,o=r(t,e.tolerance/(i*e.extent));this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),o=a(o,e.buffer/e.extent,intersectX),o.length&&this.splitTile(o,0,0,0),n&&(o.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function toID(t,e,n){return 32*((1<<t)*n+e)+t}function intersectX(t,e,n){return[n,(n-t[0])*(e[1]-t[1])/(e[0]-t[0])+t[1],1]}function intersectY(t,e,n){return[(n-t[1])*(e[0]-t[0])/(e[1]-t[1])+t[0],n,1]}function extend(t,e){for(var n in e)t[n]=e[n];return t}function isClippedSquare(t,e,n){var r=t.source;if(1!==r.length)return!1;var o=r[0];if(3!==o.type||o.geometry.length>1)return!1;var a=o.geometry[0].length;if(5!==a)return!1;for(var s=0;s<a;s++){var u=i.point(o.geometry[0][s],e,t.z2,t.x,t.y);if(u[0]!==-n&&u[0]!==e+n||u[1]!==-n&&u[1]!==e+n)return!1}return!0}e.exports=geojsonvt;var r=t("./convert"),i=t("./transform"),o=t("./clip"),a=t("./wrap"),s=t("./tile");GeoJSONVT.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,solidChildren:!1,tolerance:3,extent:4096,buffer:64,debug:0},GeoJSONVT.prototype.splitTile=function(t,e,n,r,i,a,u){for(var l=[t,e,n,r],c=this.options,p=c.debug,h=null;l.length;){r=l.pop(),n=l.pop(),e=l.pop(),t=l.pop();var f=1<<e,d=toID(e,n,r),m=this.tiles[d],y=e===c.maxZoom?0:c.tolerance/(f*c.extent);if(!m&&(p>1&&console.time("creation"),m=this.tiles[d]=s(t,f,n,r,y,e===c.maxZoom),this.tileCoords.push({z:e,x:n,y:r}),p)){p>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,n,r,m.numFeatures,m.numPoints,m.numSimplified),console.timeEnd("creation"));var g="z"+e;this.stats[g]=(this.stats[g]||0)+1,this.total++}if(m.source=t,i){if(e===c.maxZoom||e===i)continue;var v=1<<i-e;if(n!==Math.floor(a/v)||r!==Math.floor(u/v))continue}else if(e===c.indexMaxZoom||m.numPoints<=c.indexMaxPoints)continue;if(c.solidChildren||!isClippedSquare(m,c.extent,c.buffer)){m.source=null,p>1&&console.time("clipping");var _,x,b,w,S,T,E=.5*c.buffer/c.extent,A=.5-E,P=.5+E,C=1+E;_=x=b=w=null,S=o(t,f,n-E,n+P,0,intersectX,m.min[0],m.max[0]),T=o(t,f,n+A,n+C,0,intersectX,m.min[0],m.max[0]),S&&(_=o(S,f,r-E,r+P,1,intersectY,m.min[1],m.max[1]),x=o(S,f,r+A,r+C,1,intersectY,m.min[1],m.max[1])),T&&(b=o(T,f,r-E,r+P,1,intersectY,m.min[1],m.max[1]),w=o(T,f,r+A,r+C,1,intersectY,m.min[1],m.max[1])),p>1&&console.timeEnd("clipping"),t.length&&(l.push(_||[],e+1,2*n,2*r),l.push(x||[],e+1,2*n,2*r+1),l.push(b||[],e+1,2*n+1,2*r),l.push(w||[],e+1,2*n+1,2*r+1))}else i&&(h=e)}return h},GeoJSONVT.prototype.getTile=function(t,e,n){var r=this.options,o=r.extent,a=r.debug,s=1<<t;e=(e%s+s)%s;var u=toID(t,e,n);if(this.tiles[u])return i.tile(this.tiles[u],o);a>1&&console.log("drilling down to z%d-%d-%d",t,e,n);for(var l,c=t,p=e,h=n;!l&&c>0;)c--,p=Math.floor(p/2),h=Math.floor(h/2),l=this.tiles[toID(c,p,h)];if(!l||!l.source)return null;if(a>1&&console.log("found parent tile z%d-%d-%d",c,p,h),isClippedSquare(l,o,r.buffer))return i.tile(l,o);a>1&&console.time("drilling down");var f=this.splitTile(l.source,c,p,h,t,e,n);if(a>1&&console.timeEnd("drilling down"),null!==f){var d=1<<t-f;u=toID(f,Math.floor(e/d),Math.floor(n/d))}return this.tiles[u]?i.tile(this.tiles[u],o):null}},{"./clip":141,"./convert":142,"./tile":146,"./transform":147,"./wrap":148}],145:[function(t,e,n){"use strict";function simplify(t,e){var n,r,i,o,a=e*e,s=t.length,u=0,l=s-1,c=[];for(t[u][2]=1,t[l][2]=1;l;){for(r=0,n=u+1;n<l;n++)(i=getSqSegDist(t[n],t[u],t[l]))>r&&(o=n,r=i);r>a?(t[o][2]=r,c.push(u),c.push(o),u=o):(l=c.pop(),u=c.pop())}}function getSqSegDist(t,e,n){var r=e[0],i=e[1],o=n[0],a=n[1],s=t[0],u=t[1],l=o-r,c=a-i;if(0!==l||0!==c){var p=((s-r)*l+(u-i)*c)/(l*l+c*c);p>1?(r=o,i=a):p>0&&(r+=l*p,i+=c*p)}return l=s-r,c=u-i,l*l+c*c}e.exports=simplify},{}],146:[function(t,e,n){"use strict";function createTile(t,e,n,r,i,o){for(var a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z2:e,transformed:!1,min:[2,1],max:[-1,0]},s=0;s<t.length;s++){a.numFeatures++,addFeature(a,t[s],i,o);var u=t[s].min,l=t[s].max;u[0]<a.min[0]&&(a.min[0]=u[0]),u[1]<a.min[1]&&(a.min[1]=u[1]),l[0]>a.max[0]&&(a.max[0]=l[0]),l[1]>a.max[1]&&(a.max[1]=l[1])}return a}function addFeature(t,e,n,r){var i,o,a,s,u=e.geometry,l=e.type,c=[],p=n*n;if(1===l)for(i=0;i<u.length;i++)c.push(u[i]),t.numPoints++,t.numSimplified++;else for(i=0;i<u.length;i++)if(a=u[i],r||!(2===l&&a.dist<n||3===l&&a.area<p)){var h=[];for(o=0;o<a.length;o++)s=a[o],(r||s[2]>p)&&(h.push(s),t.numSimplified++),t.numPoints++;3===l&&rewind(h,a.outer),c.push(h)}else t.numPoints+=a.length;if(c.length){var f={geometry:c,type:l,tags:e.tags||null};null!==e.id&&(f.id=e.id),t.features.push(f)}}function rewind(t,e){signedArea(t)<0===e&&t.reverse()}function signedArea(t){for(var e,n,r=0,i=0,o=t.length,a=o-1;i<o;a=i++)e=t[i],n=t[a],r+=(n[0]-e[0])*(e[1]+n[1]);return r}e.exports=createTile},{}],147:[function(t,e,n){"use strict";function transformTile(t,e){if(t.transformed)return t;var n,r,i,o=t.z2,a=t.x,s=t.y;for(n=0;n<t.features.length;n++){var u=t.features[n],l=u.geometry;if(1===u.type)for(r=0;r<l.length;r++)l[r]=transformPoint(l[r],e,o,a,s);else for(r=0;r<l.length;r++){var c=l[r];for(i=0;i<c.length;i++)c[i]=transformPoint(c[i],e,o,a,s)}}return t.transformed=!0,t}function transformPoint(t,e,n,r,i){return[Math.round(e*(t[0]*n-r)),Math.round(e*(t[1]*n-i))]}n.tile=transformTile,n.point=transformPoint},{}],148:[function(t,e,n){"use strict";function wrap(t,e,n){var i=t,o=r(t,1,-1-e,e,0,n,-1,2),a=r(t,1,1-e,2+e,0,n,-1,2);return(o||a)&&(i=r(t,1,-e,1+e,0,n,-1,2)||[],o&&(i=shiftFeatureCoords(o,1).concat(i)),a&&(i=i.concat(shiftFeatureCoords(a,-1)))),i}function shiftFeatureCoords(t,e){for(var n=[],r=0;r<t.length;r++){var o,a=t[r],s=a.type;if(1===s)o=shiftCoords(a.geometry,e);else{o=[];for(var u=0;u<a.geometry.length;u++)o.push(shiftCoords(a.geometry[u],e))}n.push(i(a.tags,s,o,a.id))}return n}function shiftCoords(t,e){var n=[];n.area=t.area,n.dist=t.dist;for(var r=0;r<t.length;r++)n.push([t[r][0]+e,t[r][1],t[r][2]]);return n}var r=t("./clip"),i=t("./feature");e.exports=wrap},{"./clip":141,"./feature":143}],149:[function(t,e,n){"use strict";function GridIndex(t,e,n){var i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var o=new Int32Array(this.arrayBuffer);t=o[0],e=o[1],n=o[2],this.d=e+2*n;for(var a=0;a<this.d*this.d;a++){var s=o[r+a],u=o[r+a+1];i.push(s===u?null:o.subarray(s,u))}var l=o[r+i.length],c=o[r+i.length+1];this.keys=o.subarray(l,c),this.bboxes=o.subarray(c),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var p=0;p<this.d*this.d;p++)i.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var h=n/e*t;this.min=-h,this.max=t+h}e.exports=GridIndex;var r=3;GridIndex.prototype.insert=function(t,e,n,r,i){this._forEachCell(e,n,r,i,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)},GridIndex.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},GridIndex.prototype._insertCell=function(t,e,n,r,i,o){this.cells[i].push(o)},GridIndex.prototype.query=function(t,e,n,r){var i=this.min,o=this.max;if(t<=i&&e<=i&&o<=n&&o<=r)return Array.prototype.slice.call(this.keys);var a=[],s={};return this._forEachCell(t,e,n,r,this._queryCell,a,s),a},GridIndex.prototype._queryCell=function(t,e,n,r,i,o,a){var s=this.cells[i];if(null!==s)for(var u=this.keys,l=this.bboxes,c=0;c<s.length;c++){var p=s[c];if(void 0===a[p]){var h=4*p;t<=l[h+2]&&e<=l[h+3]&&n>=l[h+0]&&r>=l[h+1]?(a[p]=!0,o.push(u[p])):a[p]=!1}}},GridIndex.prototype._forEachCell=function(t,e,n,r,i,o,a){for(var s=this._convertToCellCoord(t),u=this._convertToCellCoord(e),l=this._convertToCellCoord(n),c=this._convertToCellCoord(r),p=s;p<=l;p++)for(var h=u;h<=c;h++){var f=this.d*h+p;if(i.call(this,t,e,n,r,f,o,a))return}},GridIndex.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},GridIndex.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=r+this.cells.length+1+1,n=0,i=0;i<this.cells.length;i++)n+=this.cells[i].length;var o=new Int32Array(e+n+this.keys.length+this.bboxes.length);o[0]=this.extent,o[1]=this.n,o[2]=this.padding;for(var a=e,s=0;s<t.length;s++){var u=t[s];o[r+s]=a,o.set(u,a),a+=u.length}return o[r+t.length]=a,o.set(this.keys,a),a+=this.keys.length,o[r+t.length+1]=a,o.set(this.bboxes,a),a+=this.bboxes.length,o.buffer}},{}],150:[function(t,e,n){n.read=function(t,e,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,l=u>>1,c=-7,p=n?i-1:0,h=n?-1:1,f=t[e+p];for(p+=h,o=f&(1<<-c)-1,f>>=-c,c+=s;c>0;o=256*o+t[e+p],p+=h,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=r;c>0;a=256*a+t[e+p],p+=h,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,r),o-=l}return(f?-1:1)*a*Math.pow(2,o-r)},n.write=function(t,e,n,r,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,p=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,d=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),e+=a+p>=1?h/u:h*Math.pow(2,1-p),e*u>=2&&(a++,u/=2),a+p>=c?(s=0,a=c):a+p>=1?(s=(e*u-1)*Math.pow(2,i),a+=p):(s=e*Math.pow(2,p-1)*Math.pow(2,i),a=0));i>=8;t[n+f]=255&s,f+=d,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;t[n+f]=255&a,f+=d,a/=256,l-=8);t[n+f-d]|=128*m}},{}],151:[function(t,e,n){"use strict";function kdbush(t,e,n,r,i){return new KDBush(t,e,n,r,i)}function KDBush(t,e,n,i,o){e=e||defaultGetX,n=n||defaultGetY,o=o||Array,this.nodeSize=i||64,this.points=t,this.ids=new o(t.length),this.coords=new o(2*t.length);for(var a=0;a<t.length;a++)this.ids[a]=a,this.coords[2*a]=e(t[a]),this.coords[2*a+1]=n(t[a]);r(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function defaultGetX(t){return t[0]}function defaultGetY(t){return t[1]}var r=t("./sort"),i=t("./range"),o=t("./within");e.exports=kdbush,KDBush.prototype={range:function(t,e,n,r){return i(this.ids,this.coords,t,e,n,r,this.nodeSize)},within:function(t,e,n){return o(this.ids,this.coords,t,e,n,this.nodeSize)}}},{"./range":152,"./sort":153,"./within":154}],152:[function(t,e,n){"use strict";function range(t,e,n,r,i,o,a){for(var s,u,l=[0,t.length-1,0],c=[];l.length;){var p=l.pop(),h=l.pop(),f=l.pop();if(h-f<=a)for(var d=f;d<=h;d++)s=e[2*d],u=e[2*d+1],s>=n&&s<=i&&u>=r&&u<=o&&c.push(t[d]);else{var m=Math.floor((f+h)/2);s=e[2*m],u=e[2*m+1],s>=n&&s<=i&&u>=r&&u<=o&&c.push(t[m]);var y=(p+1)%2;(0===p?n<=s:r<=u)&&(l.push(f),l.push(m-1),l.push(y)),(0===p?i>=s:o>=u)&&(l.push(m+1),l.push(h),l.push(y))}}return c}e.exports=range},{}],153:[function(t,e,n){"use strict";function sortKD(t,e,n,r,i,o){if(!(i-r<=n)){var a=Math.floor((r+i)/2);select(t,e,a,r,i,o%2),sortKD(t,e,n,r,a-1,o+1),sortKD(t,e,n,a+1,i,o+1)}}function select(t,e,n,r,i,o){for(;i>r;){if(i-r>600){var a=i-r+1,s=n-r+1,u=Math.log(a),l=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*l*(a-l)/a)*(s-a/2<0?-1:1);select(t,e,n,Math.max(r,Math.floor(n-s*l/a+c)),Math.min(i,Math.floor(n+(a-s)*l/a+c)),o)}var p=e[2*n+o],h=r,f=i;for(swapItem(t,e,r,n),e[2*i+o]>p&&swapItem(t,e,r,i);h<f;){for(swapItem(t,e,h,f),h++,f--;e[2*h+o]<p;)h++;for(;e[2*f+o]>p;)f--}e[2*r+o]===p?swapItem(t,e,r,f):(f++,swapItem(t,e,f,i)),f<=n&&(r=f+1),n<=f&&(i=f-1)}}function swapItem(t,e,n,r){swap(t,n,r),swap(e,2*n,2*r),swap(e,2*n+1,2*r+1)}function swap(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}e.exports=sortKD},{}],154:[function(t,e,n){"use strict";function within(t,e,n,r,i,o){for(var a=[0,t.length-1,0],s=[],u=i*i;a.length;){var l=a.pop(),c=a.pop(),p=a.pop();if(c-p<=o)for(var h=p;h<=c;h++)sqDist(e[2*h],e[2*h+1],n,r)<=u&&s.push(t[h]);else{var f=Math.floor((p+c)/2),d=e[2*f],m=e[2*f+1];sqDist(d,m,n,r)<=u&&s.push(t[f]);var y=(l+1)%2;(0===l?n-i<=d:r-i<=m)&&(a.push(p),a.push(f-1),a.push(y)),(0===l?n+i>=d:r+i>=m)&&(a.push(f+1),a.push(c),a.push(y))}}return s}function sqDist(t,e,n,r){var i=t-n,o=e-r;return i*i+o*o}e.exports=within},{}],155:[function(t,e,n){function isObjectLike(t){return!!t&&"object"==typeof t}function arraySome(t,e){for(var n=-1,r=t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function baseIsEqual(t,e,n,r,i,o){return t===e||(null==t||null==e||!isObject(t)&&!isObjectLike(e)?t!==t&&e!==e:baseIsEqualDeep(t,e,baseIsEqual,n,r,i,o))}function baseIsEqualDeep(t,e,n,o,u,l,c){var p=r(t),f=r(e),d=s,m=s;p||(d=g.call(t),d==a?d=h:d!=h&&(p=i(t))),f||(m=g.call(e),m==a?m=h:m!=h&&(f=i(e)));var v=d==h,_=m==h,x=d==m;if(x&&!p&&!v)return equalByTag(t,e,d);if(!u){var b=v&&y.call(t,"__wrapped__"),w=_&&y.call(e,"__wrapped__");if(b||w)return n(b?t.value():t,w?e.value():e,o,u,l,c)}if(!x)return!1;l||(l=[]),c||(c=[]);for(var S=l.length;S--;)if(l[S]==t)return c[S]==e;l.push(t),c.push(e);var T=(p?equalArrays:equalObjects)(t,e,n,o,u,l,c);return l.pop(),c.pop(),T}function equalArrays(t,e,n,r,i,o,a){var s=-1,u=t.length,l=e.length;if(u!=l&&!(i&&l>u))return!1;for(;++s<u;){var c=t[s],p=e[s],h=r?r(i?p:c,i?c:p,s):void 0;if(void 0!==h){if(h)continue;return!1}if(i){if(!arraySome(e,function(t){return c===t||n(c,t,r,i,o,a)}))return!1}else if(c!==p&&!n(c,p,r,i,o,a))return!1}return!0}function equalByTag(t,e,n){switch(n){case u:case l:return+t==+e;case c:return t.name==e.name&&t.message==e.message;case p:return t!=+t?e!=+e:t==+e;case f:case d:return t==e+""}return!1}function equalObjects(t,e,n,r,i,a,s){var u=o(t),l=u.length;if(l!=o(e).length&&!i)return!1;for(var c=l;c--;){var p=u[c];if(!(i?p in e:y.call(e,p)))return!1}for(var h=i;++c<l;){p=u[c];var f=t[p],d=e[p],m=r?r(i?d:f,i?f:d,p):void 0;if(!(void 0===m?n(f,d,r,i,a,s):m))return!1;h||(h="constructor"==p)}if(!h){var g=t.constructor,v=e.constructor;if(g!=v&&"constructor"in t&&"constructor"in e&&!("function"==typeof g&&g instanceof g&&"function"==typeof v&&v instanceof v))return!1}return!0}function isObject(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}var r=t("lodash.isarray"),i=t("lodash.istypedarray"),o=t("lodash.keys"),a="[object Arguments]",s="[object Array]",u="[object Boolean]",l="[object Date]",c="[object Error]",p="[object Number]",h="[object Object]",f="[object RegExp]",d="[object String]",m=Object.prototype,y=m.hasOwnProperty,g=m.toString;e.exports=baseIsEqual},{"lodash.isarray":159,"lodash.istypedarray":161,"lodash.keys":162}],156:[function(t,e,n){function bindCallback(t,e,n){if("function"!=typeof t)return identity;if(void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,r,i){return t.call(e,n,r,i)};case 4:return function(n,r,i,o){return t.call(e,n,r,i,o)};case 5:return function(n,r,i,o,a){return t.call(e,n,r,i,o,a)}}return function(){return t.apply(e,arguments)}}function identity(t){return t}e.exports=bindCallback},{}],157:[function(t,e,n){function isObjectLike(t){return!!t&&"object"==typeof t}function getNative(t,e){var n=null==t?void 0:t[e];return isNative(n)?n:void 0}function isFunction(t){return isObject(t)&&u.call(t)==r}function isObject(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function isNative(t){return null!=t&&(isFunction(t)?l.test(a.call(t)):isObjectLike(t)&&i.test(t))}var r="[object Function]",i=/^\[object .+?Constructor\]$/,o=Object.prototype,a=Function.prototype.toString,s=o.hasOwnProperty,u=o.toString,l=RegExp("^"+a.call(s).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=getNative},{}],158:[function(t,e,n){function isArguments(t){return isArrayLikeObject(t)&&u.call(t,"callee")&&(!c.call(t,"callee")||l.call(t)==i)}function isArrayLike(t){return null!=t&&isLength(t.length)&&!isFunction(t)}function isArrayLikeObject(t){return isObjectLike(t)&&isArrayLike(t)}function isFunction(t){var e=isObject(t)?l.call(t):"";return e==o||e==a}function isLength(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=r}function isObject(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function isObjectLike(t){return!!t&&"object"==typeof t}var r=9007199254740991,i="[object Arguments]",o="[object Function]",a="[object GeneratorFunction]",s=Object.prototype,u=s.hasOwnProperty,l=s.toString,c=s.propertyIsEnumerable;e.exports=isArguments},{}],159:[function(t,e,n){function isObjectLike(t){return!!t&&"object"==typeof t}function getNative(t,e){var n=null==t?void 0:t[e];return isNative(n)?n:void 0}function isLength(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=h}function isFunction(t){return isObject(t)&&l.call(t)==i}function isObject(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function isNative(t){return null!=t&&(isFunction(t)?c.test(s.call(t)):isObjectLike(t)&&o.test(t))}var r="[object Array]",i="[object Function]",o=/^\[object .+?Constructor\]$/,a=Object.prototype,s=Function.prototype.toString,u=a.hasOwnProperty,l=a.toString,c=RegExp("^"+s.call(u).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),p=getNative(Array,"isArray"),h=9007199254740991,f=p||function(t){return isObjectLike(t)&&isLength(t.length)&&l.call(t)==r};e.exports=f},{}],160:[function(t,e,n){function isEqual(t,e,n,o){n="function"==typeof n?i(n,o,3):void 0;var a=n?n(t,e):void 0;return void 0===a?r(t,e,n):!!a}var r=t("lodash._baseisequal"),i=t("lodash._bindcallback");e.exports=isEqual},{"lodash._baseisequal":155,"lodash._bindcallback":156}],161:[function(t,e,n){function isLength(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=r}function isObjectLike(t){return!!t&&"object"==typeof t}function isTypedArray(t){return isObjectLike(t)&&isLength(t.length)&&!!i[a.call(t)]}var r=9007199254740991,i={};i["[object Float32Array]"]=i["[object Float64Array]"]=i["[object Int8Array]"]=i["[object Int16Array]"]=i["[object Int32Array]"]=i["[object Uint8Array]"]=i["[object Uint8ClampedArray]"]=i["[object Uint16Array]"]=i["[object Uint32Array]"]=!0,i["[object Arguments]"]=i["[object Array]"]=i["[object ArrayBuffer]"]=i["[object Boolean]"]=i["[object DataView]"]=i["[object Date]"]=i["[object Error]"]=i["[object Function]"]=i["[object Map]"]=i["[object Number]"]=i["[object Object]"]=i["[object RegExp]"]=i["[object Set]"]=i["[object String]"]=i["[object WeakMap]"]=!1;var o=Object.prototype,a=o.toString;e.exports=isTypedArray},{}],162:[function(t,e,n){function baseProperty(t){return function(e){return null==e?void 0:e[t]}}function isArrayLike(t){return null!=t&&isLength(p(t))}function isIndex(t,e){return t="number"==typeof t||a.test(t)?+t:-1,e=null==e?c:e,t>-1&&t%1==0&&t<e}function isLength(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=c}function shimKeys(t){for(var e=keysIn(t),n=e.length,r=n&&t.length,a=!!r&&isLength(r)&&(o(t)||i(t)),s=-1,l=[];++s<n;){var c=e[s];(a&&isIndex(c,r)||u.call(t,c))&&l.push(c)}return l}function isObject(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function keysIn(t){if(null==t)return[];isObject(t)||(t=Object(t));var e=t.length;e=e&&isLength(e)&&(o(t)||i(t))&&e||0;for(var n=t.constructor,r=-1,a="function"==typeof n&&n.prototype===t,s=Array(e),l=e>0;++r<e;)s[r]=r+"";for(var c in t)l&&isIndex(c,e)||"constructor"==c&&(a||!u.call(t,c))||s.push(c);return s}var r=t("lodash._getnative"),i=t("lodash.isarguments"),o=t("lodash.isarray"),a=/^\d+$/,s=Object.prototype,u=s.hasOwnProperty,l=r(Object,"keys"),c=9007199254740991,p=baseProperty("length"),h=l?function(t){var e=null==t?void 0:t.constructor;return"function"==typeof e&&e.prototype===t||"function"!=typeof t&&isArrayLike(t)?shimKeys(t):isObject(t)?l(t):[]}:shimKeys;e.exports=h},{"lodash._getnative":157,"lodash.isarguments":158,"lodash.isarray":159}],163:[function(t,e,n){function xyz2lab(t){return t>l?Math.pow(t,1/3):t/u+a}function lab2xyz(t){return t>s?t*t*t:u*(t-a)}function xyz2rgb(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function rgb2xyz(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function rgbToLab(t){var e=rgb2xyz(t[0]),n=rgb2xyz(t[1]),a=rgb2xyz(t[2]),s=xyz2lab((.4124564*e+.3575761*n+.1804375*a)/r),u=xyz2lab((.2126729*e+.7151522*n+.072175*a)/i);return[116*u-16,500*(s-u),200*(u-xyz2lab((.0193339*e+.119192*n+.9503041*a)/o)),t[3]]}function labToRgb(t){var e=(t[0]+16)/116,n=isNaN(t[1])?e:e+t[1]/500,a=isNaN(t[2])?e:e-t[2]/200;return e=i*lab2xyz(e),n=r*lab2xyz(n),a=o*lab2xyz(a),[xyz2rgb(3.2404542*n-1.5371385*e-.4985314*a),xyz2rgb(-.969266*n+1.8760108*e+.041556*a),xyz2rgb(.0556434*n-.2040259*e+1.0572252*a),t[3]]}function rgbToHcl(t){var e=rgbToLab(t),n=e[0],r=e[1],i=e[2],o=Math.atan2(i,r)*p;return[o<0?o+360:o,Math.sqrt(r*r+i*i),n,t[3]]}function hclToRgb(t){var e=t[0]*c,n=t[1];return labToRgb([t[2],Math.cos(e)*n,Math.sin(e)*n,t[3]])}var r=.95047,i=1,o=1.08883,a=4/29,s=6/29,u=3*s*s,l=s*s*s,c=Math.PI/180,p=180/Math.PI;e.exports={lab:{forward:rgbToLab,reverse:labToRgb},hcl:{forward:rgbToHcl,reverse:hclToRgb}}},{}],164:[function(t,e,n){"use strict";function identityFunction(t){return t}function createFunction(t,e){var n;if(isFunctionDefinition(t)){var i,o=t.stops&&"object"==typeof t.stops[0][0],a=o||void 0!==t.property,s=o||!a,u=t.stops&&typeof(o?t.stops[0][0].property:t.stops[0][0]),l=t.type||e||("string"===u?"categorical":"exponential");if("exponential"===l)i=evaluateExponentialFunction;else if("interval"===l)i=evaluateIntervalFunction;else if("categorical"===l)i=evaluateCategoricalFunction;else{if("identity"!==l)throw new Error('Unknown function type "'+l+'"');i=evaluateIdentityFunction}var c;if(t.colorSpace&&"rgb"!==t.colorSpace){if(!r[t.colorSpace])throw new Error("Unknown color space: "+t.colorSpace);var p=r[t.colorSpace];t=JSON.parse(JSON.stringify(t));for(var h=0;h<t.stops.length;h++)t.stops[h]=[t.stops[h][0],p.forward(t.stops[h][1])];c=p.reverse}else c=identityFunction;if(o){var f={},d=[];for(h=0;h<t.stops.length;h++){var m=t.stops[h];void 0===f[m[0].zoom]&&(f[m[0].zoom]={zoom:m[0].zoom,type:t.type,property:t.property,stops:[]}),f[m[0].zoom].stops.push([m[0].value,m[1]])}for(var y in f)d.push([f[y].zoom,createFunction(f[y])]);n=function(e,n){return c(evaluateExponentialFunction({stops:d,base:t.base},e)(e,n))},n.isFeatureConstant=!1,n.isZoomConstant=!1}else s?(n=function(e){return c(i(t,e))},n.isFeatureConstant=!0,n.isZoomConstant=!1):(n=function(e,n){return c(i(t,n[t.property]))},n.isFeatureConstant=!1,n.isZoomConstant=!0)}else n=function(){return t},n.isFeatureConstant=!0,n.isZoomConstant=!0;return n}function evaluateCategoricalFunction(t,e){for(var n=0;n<t.stops.length;n++)if(e===t.stops[n][0])return t.stops[n][1];return t.stops[0][1]}function evaluateIntervalFunction(t,e){for(var n=0;n<t.stops.length&&!(e<t.stops[n][0]);n++);return t.stops[Math.max(n-1,0)][1]}function evaluateExponentialFunction(t,e){for(var n=void 0!==t.base?t.base:1,r=0;!(r>=t.stops.length)&&!(e<=t.stops[r][0]);)r++;return 0===r?t.stops[r][1]:r===t.stops.length?t.stops[r-1][1]:interpolate(e,n,t.stops[r-1][0],t.stops[r][0],t.stops[r-1][1],t.stops[r][1])}function evaluateIdentityFunction(t,e){return e}function interpolate(t,e,n,r,i,o){return"function"==typeof i?function(){return interpolate(t,e,n,r,i.apply(void 0,arguments),o.apply(void 0,arguments))}:i.length?interpolateArray(t,e,n,r,i,o):interpolateNumber(t,e,n,r,i,o)}function interpolateNumber(t,e,n,r,i,o){var a,s=r-n,u=t-n;return a=1===e?u/s:(Math.pow(e,u)-1)/(Math.pow(e,s)-1),i*(1-a)+o*a}function interpolateArray(t,e,n,r,i,o){for(var a=[],s=0;s<i.length;s++)a[s]=interpolateNumber(t,e,n,r,i[s],o[s]);return a}function isFunctionDefinition(t){return"object"==typeof t&&(t.stops||"identity"===t.type)}var r=t("./color_spaces");e.exports.isFunctionDefinition=isFunctionDefinition,e.exports.interpolated=function(t){return createFunction(t,"exponential")},e.exports["piecewise-constant"]=function(t){return createFunction(t,"interval")}},{"./color_spaces":163}],165:[function(t,e,n){"use strict";function deref(t,e){var n={};for(var i in t)"ref"!==i&&(n[i]=t[i]);return r.forEach(function(t){t in e&&(n[t]=e[t])}),n}function derefLayers(t){t=t.slice();var e,n=Object.create(null);for(e=0;e<t.length;e++)n[t[e].id]=t[e];for(e=0;e<t.length;e++)"ref"in t[e]&&(t[e]=deref(t[e],n[t[e].ref]));return t}var r=t("./util/ref_properties");e.exports=derefLayers},{"./util/ref_properties":171}],166:[function(t,e,n){"use strict";function diffSources(t,e,n,o){t=t||{},e=e||{};var a;for(a in t)t.hasOwnProperty(a)&&(e.hasOwnProperty(a)||(n.push({command:i.removeSource,args:[a]}),o[a]=!0));for(a in e)e.hasOwnProperty(a)&&(t.hasOwnProperty(a)?r(t[a],e[a])||(n.push({command:i.removeSource,args:[a]}),n.push({command:i.addSource,args:[a,e[a]]}),o[a]=!0):n.push({command:i.addSource,args:[a,e[a]]}))}function diffLayerPropertyChanges(t,e,n,i,o,a){t=t||{},e=e||{};var s;for(s in t)t.hasOwnProperty(s)&&(r(t[s],e[s])||n.push({command:a,args:[i,s,e[s],o]}));for(s in e)e.hasOwnProperty(s)&&!t.hasOwnProperty(s)&&(r(t[s],e[s])||n.push({command:a,args:[i,s,e[s],o]}))}function pluckId(t){return t.id}function indexById(t,e){return t[e.id]=e,t}function diffLayers(t,e,n){t=t||[],e=e||[];var o,a,s,u,l,c,p,h=t.map(pluckId),f=e.map(pluckId),d=t.reduce(indexById,{}),m=e.reduce(indexById,{}),y=h.slice(),g=Object.create(null);for(o=0,a=0;o<h.length;o++)s=h[o],m.hasOwnProperty(s)?a++:(n.push({command:i.removeLayer,args:[s]}),y.splice(y.indexOf(s,a),1));for(o=0,a=0;o<f.length;o++)s=f[f.length-1-o],y[y.length-1-o]!==s&&(d.hasOwnProperty(s)?(n.push({command:i.removeLayer,args:[s]}),y.splice(y.lastIndexOf(s,y.length-a),1)):a++,c=y[y.length-o],n.push({command:i.addLayer,args:[m[s],c]}),y.splice(y.length-o,0,s),g[s]=!0);for(o=0;o<f.length;o++)if(s=f[o],u=d[s],l=m[s],!g[s]&&!r(u,l))if(r(u.source,l.source)&&r(u["source-layer"],l["source-layer"])&&r(u.type,l.type)){diffLayerPropertyChanges(u.layout,l.layout,n,s,null,i.setLayoutProperty),diffLayerPropertyChanges(u.paint,l.paint,n,s,null,i.setPaintProperty),r(u.filter,l.filter)||n.push({command:i.setFilter,args:[s,l.filter]}),r(u.minzoom,l.minzoom)&&r(u.maxzoom,l.maxzoom)||n.push({command:i.setLayerZoomRange,args:[s,l.minzoom,l.maxzoom]});for(p in u)u.hasOwnProperty(p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?diffLayerPropertyChanges(u[p],l[p],n,s,p.slice(6),i.setPaintProperty):r(u[p],l[p])||n.push({command:i.setLayerProperty,args:[s,p,l[p]]}));for(p in l)l.hasOwnProperty(p)&&!u.hasOwnProperty(p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?diffLayerPropertyChanges(u[p],l[p],n,s,p.slice(6),i.setPaintProperty):r(u[p],l[p])||n.push({command:i.setLayerProperty,args:[s,p,l[p]]}))}else n.push({command:i.removeLayer,args:[s]}),c=y[y.lastIndexOf(s)+1],n.push({command:i.addLayer,args:[l,c]})}function diffStyles(t,e){if(!t)return[{command:i.setStyle,args:[e]}];var n=[];try{if(!r(t.version,e.version))return[{command:i.setStyle,args:[e]}];r(t.center,e.center)||n.push({command:i.setCenter,args:[e.center]}),r(t.zoom,e.zoom)||n.push({command:i.setZoom,args:[e.zoom]}),r(t.bearing,e.bearing)||n.push({command:i.setBearing,args:[e.bearing]}),r(t.pitch,e.pitch)||n.push({command:i.setPitch,args:[e.pitch]}),r(t.sprite,e.sprite)||n.push({command:i.setSprite,args:[e.sprite]}),r(t.glyphs,e.glyphs)||n.push({command:i.setGlyphs,args:[e.glyphs]}),r(t.transition,e.transition)||n.push({command:i.setTransition,args:[e.transition]}),r(t.light,e.light)||n.push({command:i.setLight,args:[e.light]});var o={},a=[];diffSources(t.sources,e.sources,a,o);var s=[];t.layers&&t.layers.forEach(function(t){o[t.source]?n.push({command:i.removeLayer,args:[t.id]}):s.push(t)}),n=n.concat(a),diffLayers(s,e.layers,n)}catch(t){console.warn("Unable to compute style diff:",t),n=[{command:i.setStyle,args:[e]}]}return n}var r=t("lodash.isequal"),i={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};e.exports=diffStyles,e.exports.operations=i},{"lodash.isequal":160}],167:[function(t,e,n){"use strict";function ValidationError(t,e){this.message=(t?t+": ":"")+r.apply(r,Array.prototype.slice.call(arguments,2)),null!==e&&void 0!==e&&e.__line__&&(this.line=e.__line__)}var r=t("util").format;e.exports=ValidationError},{util:205}],168:[function(t,e,n){"use strict";function key(t){return i(r.map(function(e){return t[e]}))}function groupByLayout(t){var e,n,r={};for(e=0;e<t.length;e++){n=key(t[e]);var i=r[n];i||(i=r[n]=[]),i.push(t[e])}var o=[];for(n in r)o.push(r[n]);return o}var r=t("./util/ref_properties"),i=t("fast-stable-stringify");e.exports=groupByLayout},{"./util/ref_properties":171,"fast-stable-stringify":137}],169:[function(t,e,n){"use strict";e.exports=function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]=n[r]}return t}},{}],170:[function(t,e,n){"use strict";e.exports=function(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}},{}],171:[function(t,e,n){"use strict";e.exports=["type","source","source-layer","minzoom","maxzoom","filter","layout"]},{}],172:[function(t,e,n){"use strict";e.exports=function(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}},{}],173:[function(t,e,n){"use strict";var r=t("../error/validation_error"),i=t("../util/get_type"),o=t("../util/extend");e.exports=function(e){var n=t("./validate_function"),a=t("./validate_object"),s={"*":function(){return[]},array:t("./validate_array"),boolean:t("./validate_boolean"),number:t("./validate_number"),color:t("./validate_color"),constants:t("./validate_constants"),enum:t("./validate_enum"),filter:t("./validate_filter"),function:t("./validate_function"),layer:t("./validate_layer"),object:t("./validate_object"),source:t("./validate_source"),light:t("./validate_light"),string:t("./validate_string")},u=e.value,l=e.valueSpec,c=e.key,p=e.styleSpec,h=e.style;if("string"===i(u)&&"@"===u[0]){if(p.$version>7)return[new r(c,u,"constants have been deprecated as of v8")];if(!(u in h.constants))return[new r(c,u,'constant "%s" not found',u)];e=o({},e,{value:h.constants[u]})}return l.function&&"object"===i(u)?n(e):l.type&&s[l.type]?s[l.type](e):a(o({},e,{valueSpec:l.type?p[l.type]:l}))}},{"../error/validation_error":167,"../util/extend":169,"../util/get_type":170,"./validate_array":174,"./validate_boolean":175,"./validate_color":176,"./validate_constants":177,"./validate_enum":178,"./validate_filter":179,"./validate_function":180,"./validate_layer":182,"./validate_light":184,"./validate_number":185,"./validate_object":186,"./validate_source":188,"./validate_string":189}],174:[function(t,e,n){"use strict";var r=t("../util/get_type"),i=t("./validate"),o=t("../error/validation_error");e.exports=function(t){var e=t.value,n=t.valueSpec,a=t.style,s=t.styleSpec,u=t.key,l=t.arrayElementValidator||i;if("array"!==r(e))return[new o(u,e,"array expected, %s found",r(e))];if(n.length&&e.length!==n.length)return[new o(u,e,"array length %d expected, length %d found",n.length,e.length)];if(n["min-length"]&&e.length<n["min-length"])return[new o(u,e,"array length at least %d expected, length %d found",n["min-length"],e.length)];var c={type:n.value};s.$version<7&&(c.function=n.function),"object"===r(n.value)&&(c=n.value);for(var p=[],h=0;h<e.length;h++)p=p.concat(l({array:e,arrayIndex:h,value:e[h],valueSpec:c,style:a,styleSpec:s,key:u+"["+h+"]"}));return p}},{"../error/validation_error":167,"../util/get_type":170,"./validate":173}],175:[function(t,e,n){"use strict";var r=t("../util/get_type"),i=t("../error/validation_error");e.exports=function(t){var e=t.value,n=t.key,o=r(e);return"boolean"!==o?[new i(n,e,"boolean expected, %s found",o)]:[]}},{"../error/validation_error":167,"../util/get_type":170}],176:[function(t,e,n){"use strict";var r=t("../error/validation_error"),i=t("../util/get_type"),o=t("csscolorparser").parseCSSColor;e.exports=function(t){var e=t.key,n=t.value,a=i(n);return"string"!==a?[new r(e,n,"color expected, %s found",a)]:null===o(n)?[new r(e,n,'color expected, "%s" found',n)]:[]}},{"../error/validation_error":167,"../util/get_type":170,csscolorparser:135}],177:[function(t,e,n){"use strict";var r=t("../error/validation_error"),i=t("../util/get_type");e.exports=function(t){var e=t.key,n=t.value;if(t.styleSpec.$version>7)return n?[new r(e,n,"constants have been deprecated as of v8")]:[];var o=i(n);if("object"!==o)return[new r(e,n,"object expected, %s found",o)];var a=[];for(var s in n)"@"!==s[0]&&a.push(new r(e+"."+s,n[s],'constants must start with "@"'));return a}},{"../error/validation_error":167,"../util/get_type":170}],178:[function(t,e,n){"use strict";var r=t("../error/validation_error"),i=t("../util/unbundle_jsonlint");e.exports=function(t){var e=t.key,n=t.value,o=t.valueSpec,a=[];return Array.isArray(o.values)?o.values.indexOf(i(n))===-1&&a.push(new r(e,n,"expected one of [%s], %s found",o.values.join(", "),n)):Object.keys(o.values).indexOf(i(n))===-1&&a.push(new r(e,n,"expected one of [%s], %s found",Object.keys(o.values).join(", "),n)),a}},{"../error/validation_error":167,"../util/unbundle_jsonlint":172}],179:[function(t,n,r){"use strict";var i=t("../error/validation_error"),o=t("./validate_enum"),a=t("../util/get_type"),s=t("../util/unbundle_jsonlint");n.exports=function e(t){var n,r=t.value,u=t.key,l=t.styleSpec,c=[];if("array"!==a(r))return[new i(u,r,"array expected, %s found",a(r))];if(r.length<1)return[new i(u,r,"filter array must have at least 1 element")];switch(c=c.concat(o({key:u+"[0]",value:r[0],valueSpec:l.filter_operator,style:t.style,styleSpec:t.styleSpec})),s(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"==r[1]&&c.push(new i(u,r,'"$type" cannot be use with operator "%s"',r[0]));case"==":case"!=":3!=r.length&&c.push(new i(u,r,'filter array for operator "%s" must have 3 elements',r[0]));case"in":case"!in":r.length>=2&&(n=a(r[1]),"string"!==n?c.push(new i(u+"[1]",r[1],"string expected, %s found",n)):"@"===r[1][0]&&c.push(new i(u+"[1]",r[1],"filter key cannot be a constant")));for(var p=2;p<r.length;p++)n=a(r[p]),"$type"==r[1]?c=c.concat(o({key:u+"["+p+"]",value:r[p],valueSpec:l.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"===n&&"@"===r[p][0]?c.push(new i(u+"["+p+"]",r[p],"filter value cannot be a constant")):"string"!==n&&"number"!==n&&"boolean"!==n&&c.push(new i(u+"["+p+"]",r[p],"string, number, or boolean expected, %s found",n));break;case"any":case"all":case"none":for(p=1;p<r.length;p++)c=c.concat(e({key:u+"["+p+"]",value:r[p],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":n=a(r[1]),2!==r.length?c.push(new i(u,r,'filter array for "%s" operator must have 2 elements',r[0])):"string"!==n?c.push(new i(u+"[1]",r[1],"string expected, %s found",n)):"@"===r[1][0]&&c.push(new i(u+"[1]",r[1],"filter key cannot be a constant"))}return c}},{"../error/validation_error":167,"../util/get_type":170,"../util/unbundle_jsonlint":172,"./validate_enum":178}],180:[function(e,n,i){"use strict";var o=e("../error/validation_error"),s=e("../util/get_type"),u=e("./validate"),l=e("./validate_object"),c=e("./validate_array"),p=e("./validate_number"),h=e("../util/unbundle_jsonlint");n.exports=function(e){function t(t){if("identity"===m)return[new o(t.key,t.value,'identity function may not have a "stops" property')];var e=[],n=t.value;return e=e.concat(c({key:t.key,value:n,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:r})),"array"===s(n)&&0===n.length&&e.push(new o(t.key,n,"array must have at least one stop")),e}function r(t){var e=[],n=t.value,r=t.key;if("array"!==s(n))return[new o(r,n,"array expected, %s found",s(n))];if(2!==n.length)return[new o(r,n,"array length %d expected, length %d found",2,n.length)];if(_){if("object"!==s(n[0]))return[new o(r,n,"object expected, %s found",s(n[0]))];if(void 0===n[0].zoom)return[new o(r,n,"object stop key must have zoom")];if(void 0===n[0].value)return[new o(r,n,"object stop key must have value")];if(f&&f>h(n[0].zoom))return[new o(r,n[0].zoom,"stop zoom values must appear in ascending order")];h(n[0].zoom)!==f&&(f=h(n[0].zoom),i=void 0),e=e.concat(l({key:r+"[0]",value:n[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:p,value:a}}))}else e=e.concat(a({key:r+"[0]",value:n[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec}));return e=e.concat(u({key:r+"[1]",value:n[1],valueSpec:d,style:t.style,styleSpec:t.styleSpec})),"number"===s(n[0])&&"piecewise-constant"===d.function&&n[0]%1!=0&&e.push(new o(r+"[0]",n[0],"zoom level for piecewise-constant functions must be an integer")),e}function a(t){var e=s(t.value),r=h(t.value);if(n){if(e!==n)return[new o(t.key,t.value,"%s stop domain type must match previous stop domain type %s",e,n)]}else n=e,m||"string"!==e||(m="categorical");return"number"!==e&&"string"!==e?[new o(t.key,t.value,"property value must be a number or string")]:"number"!==e&&"categorical"!==m?[new o(t.key,t.value,"number expected, %s found",e)]:"categorical"!==m||"number"!==e||isFinite(r)&&Math.floor(r)===r?"number"===e&&void 0!==i&&r<i?[new o(t.key,t.value,"stop domain values must appear in ascending order")]:(i=r,"categorical"===m&&r in y?[new o(t.key,t.value,"stop domain values must be unique")]:(y[r]=!0,[])):[new o(t.key,t.value,"integer expected, found %s",r)]}var n,i,f,d=e.valueSpec,m=h(e.value.type),y={},g="categorical"!==m&&void 0===e.value.property,v=!g,_="array"===s(e.value.stops)&&"array"===s(e.value.stops[0])&&"object"===s(e.value.stops[0][0]),x=l({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:t}});return"identity"===m||e.value.stops||x.push(new o(e.key,e.value,'missing required property "stops"')),"exponential"===m&&"piecewise-constant"===e.valueSpec.function&&x.push(new o(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(v&&!e.valueSpec["property-function"]?x.push(new o(e.key,e.value,"property functions not supported")):g&&!e.valueSpec["zoom-function"]&&x.push(new o(e.key,e.value,"zoom functions not supported"))),"categorical"!==m&&!_||void 0!==e.value.property||x.push(new o(e.key,e.value,'"property" property is required')),x}},{"../error/validation_error":167,"../util/get_type":170,"../util/unbundle_jsonlint":172,"./validate":173,"./validate_array":174,"./validate_number":185,"./validate_object":186}],181:[function(t,e,n){"use strict";var r=t("../error/validation_error"),i=t("./validate_string");e.exports=function(t){var e=t.value,n=t.key,o=i(t);return o.length?o:(e.indexOf("{fontstack}")===-1&&o.push(new r(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new r(n,e,'"glyphs" url must include a "{range}" token')),o)}},{"../error/validation_error":167,"./validate_string":189}],182:[function(t,e,n){"use strict";var r=t("../error/validation_error"),i=t("../util/unbundle_jsonlint"),o=t("./validate_object"),a=t("./validate_filter"),s=t("./validate_paint_property"),u=t("./validate_layout_property"),l=t("../util/extend");e.exports=function(t){var e=[],n=t.value,c=t.key,p=t.style,h=t.styleSpec;n.type||n.ref||e.push(new r(c,n,'either "type" or "ref" is required'));var f=i(n.type),d=i(n.ref);if(n.id)for(var m=0;m<t.arrayIndex;m++){var y=p.layers[m];i(y.id)===i(n.id)&&e.push(new r(c,n.id,'duplicate layer id "%s", previously used at line %d',n.id,y.id.__line__))}if("ref"in n){["type","source","source-layer","filter","layout"].forEach(function(t){t in n&&e.push(new r(c,n[t],'"%s" is prohibited for ref layers',t))});var g;p.layers.forEach(function(t){t.id==d&&(g=t)}),g?g.ref?e.push(new r(c,n.ref,"ref cannot reference another ref layer")):f=i(g.type):e.push(new r(c,n.ref,'ref layer "%s" not found',d))}else if("background"!==f)if(n.source){var v=p.sources&&p.sources[n.source];v?"vector"==v.type&&"raster"==f?e.push(new r(c,n.source,'layer "%s" requires a raster source',n.id)):"raster"==v.type&&"raster"!=f?e.push(new r(c,n.source,'layer "%s" requires a vector source',n.id)):"vector"!=v.type||n["source-layer"]||e.push(new r(c,n,'layer "%s" must specify a "source-layer"',n.id)):e.push(new r(c,n.source,'source "%s" not found',n.source))}else e.push(new r(c,n,'missing required property "source"'));return e=e.concat(o({key:c,value:n,valueSpec:h.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},filter:a,layout:function(t){return o({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return u(l({layerType:f},t))}}})},paint:function(t){return o({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return s(l({layerType:f},t))}}})}}}))}},{"../error/validation_error":167,"../util/extend":169,"../util/unbundle_jsonlint":172,"./validate_filter":179,"./validate_layout_property":183,"./validate_object":186,"./validate_paint_property":187}],183:[function(t,e,n){"use strict";var r=t("./validate"),i=t("../error/validation_error");e.exports=function(t){var e=t.key,n=t.style,o=t.styleSpec,a=t.value,s=t.objectKey,u=o["layout_"+t.layerType];if(!u)return[];if(t.valueSpec||u[s]){var l=[];return"symbol"===t.layerType&&("icon-image"===s&&n&&!n.sprite?l.push(new i(e,a,'use of "icon-image" requires a style "sprite" property')):"text-field"===s&&n&&!n.glyphs&&l.push(new i(e,a,'use of "text-field" requires a style "glyphs" property'))),l.concat(r({key:t.key,value:a,valueSpec:t.valueSpec||u[s],style:n,styleSpec:o}))}return[new i(e,a,'unknown property "%s"',s)]}},{"../error/validation_error":167,"./validate":173}],184:[function(t,e,n){"use strict";var r=t("../error/validation_error"),i=t("../util/get_type"),o=t("./validate");e.exports=function(t){var e=t.value,n=t.styleSpec,a=n.light,s=t.style,u=[],l=i(e);if(void 0===e)return u;if("object"!==l)return u=u.concat([new r("light",e,"object expected, %s found",l)]);for(var c in e){var p=c.match(/^(.*)-transition$/);u=p&&a[p[1]]&&a[p[1]].transition?u.concat(o({key:c,value:e[c],valueSpec:n.transition,style:s,styleSpec:n})):a[c]?u.concat(o({key:c,value:e[c],valueSpec:a[c],style:s,styleSpec:n})):u.concat([new r(c,e[c],'unknown property "%s"',c)])}return u}},{"../error/validation_error":167,"../util/get_type":170,"./validate":173}],185:[function(t,e,n){"use strict";var r=t("../util/get_type"),i=t("../error/validation_error");e.exports=function(t){var e=t.key,n=t.value,o=t.valueSpec,a=r(n);return"number"!==a?[new i(e,n,"number expected, %s found",a)]:"minimum"in o&&n<o.minimum?[new i(e,n,"%s is less than the minimum value %s",n,o.minimum)]:"maximum"in o&&n>o.maximum?[new i(e,n,"%s is greater than the maximum value %s",n,o.maximum)]:[]}},{"../error/validation_error":167,"../util/get_type":170}],186:[function(t,e,n){"use strict";var r=t("../error/validation_error"),i=t("../util/get_type"),o=t("./validate");e.exports=function(t){var e=t.key,n=t.value,a=t.valueSpec||{},s=t.objectElementValidators||{},u=t.style,l=t.styleSpec,c=[],p=i(n);if("object"!==p)return[new r(e,n,"object expected, %s found",p)];for(var h in n){var f,d=h.split(".")[0],m=a[d]||a["*"];if(s[d])f=s[d];else if(a[d])f=o;else if(s["*"])f=s["*"];else{if(!a["*"]){c.push(new r(e,n[h],'unknown property "%s"',h));continue}f=o}c=c.concat(f({key:(e?e+".":e)+h,value:n[h],valueSpec:m,style:u,styleSpec:l,object:n,objectKey:h}))}for(d in a)a[d].required&&void 0===a[d].default&&void 0===n[d]&&c.push(new r(e,n,'missing required property "%s"',d));return c}},{"../error/validation_error":167,"../util/get_type":170,"./validate":173}],187:[function(t,e,n){"use strict";var r=t("./validate"),i=t("../error/validation_error");e.exports=function(t){var e=t.key,n=t.style,o=t.styleSpec,a=t.value,s=t.objectKey,u=o["paint_"+t.layerType];if(!u)return[];var l=s.match(/^(.*)-transition$/);return l&&u[l[1]]&&u[l[1]].transition?r({key:e,value:a,valueSpec:o.transition,style:n,styleSpec:o}):t.valueSpec||u[s]?r({key:t.key,value:a,valueSpec:t.valueSpec||u[s],style:n,styleSpec:o}):[new i(e,a,'unknown property "%s"',s)]}},{"../error/validation_error":167,"./validate":173}],188:[function(t,e,n){"use strict";var r=t("../error/validation_error"),i=t("../util/unbundle_jsonlint"),o=t("./validate_object"),a=t("./validate_enum");e.exports=function(t){var e=t.value,n=t.key,s=t.styleSpec,u=t.style;if(!e.type)return[new r(n,e,'"type" is required')];switch(i(e.type)){case"vector":case"raster":var l=[];if(l=l.concat(o({key:n,value:e,valueSpec:s.source_tile,style:t.style,styleSpec:s})),"url"in e)for(var c in e)["type","url","tileSize"].indexOf(c)<0&&l.push(new r(n+"."+c,e[c],'a source with a "url" property may not include a "%s" property',c));return l;case"geojson":return o({key:n,value:e,valueSpec:s.source_geojson,style:u,styleSpec:s});case"video":return o({key:n,value:e,valueSpec:s.source_video,style:u,styleSpec:s});case"image":return o({key:n,value:e,valueSpec:s.source_image,style:u,styleSpec:s});case"canvas":return o({key:n,value:e,valueSpec:s.source_canvas,style:u,styleSpec:s});default:return a({key:n+".type",value:e.type,valueSpec:{values:["vector","raster","geojson","video","image","canvas"]},style:u,styleSpec:s})}}},{"../error/validation_error":167,"../util/unbundle_jsonlint":172,"./validate_enum":178,"./validate_object":186}],189:[function(t,e,n){"use strict";var r=t("../util/get_type"),i=t("../error/validation_error");e.exports=function(t){var e=t.value,n=t.key,o=r(e);return"string"!==o?[new i(n,e,"string expected, %s found",o)]:[]}},{"../error/validation_error":167,"../util/get_type":170}],190:[function(t,e,n){"use strict";function validateStyleMin(t,e){e=e||o;var n=[];return n=n.concat(i({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:a,"*":function(){return[]}}})),e.$version>7&&t.constants&&(n=n.concat(r({key:"constants",value:t.constants,style:t,styleSpec:e}))),sortErrors(n)}function sortErrors(t){return[].concat(t).sort(function(t,e){return t.line-e.line})}function wrapCleanErrors(t){return function(){return sortErrors(t.apply(this,arguments))}}var r=t("./validate/validate_constants"),i=t("./validate/validate"),o=t("../reference/latest.min"),a=t("./validate/validate_glyphs_url");validateStyleMin.source=wrapCleanErrors(t("./validate/validate_source")),validateStyleMin.light=wrapCleanErrors(t("./validate/validate_light")),validateStyleMin.layer=wrapCleanErrors(t("./validate/validate_layer")),validateStyleMin.filter=wrapCleanErrors(t("./validate/validate_filter")),validateStyleMin.paintProperty=wrapCleanErrors(t("./validate/validate_paint_property")),validateStyleMin.layoutProperty=wrapCleanErrors(t("./validate/validate_layout_property")),e.exports=validateStyleMin},{"../reference/latest.min":191,"./validate/validate":173,"./validate/validate_constants":177,"./validate/validate_filter":179,"./validate/validate_glyphs_url":181,"./validate/validate_layer":182,"./validate/validate_layout_property":183,"./validate/validate_light":184,"./validate/validate_paint_property":187,"./validate/validate_source":188}],191:[function(t,e,n){e.exports=t("./v8.min.json")},{"./v8.min.json":192}],192:[function(t,e,n){e.exports={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_tile","source_geojson","source_video","source_image","source_canvas"],source_tile:{type:{required:!0,type:"enum",values:{vector:{},raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},buffer:{type:"number",default:128,maximum:512,minimum:0},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_canvas:{type:{required:!0,type:"enum",values:{canvas:{}}},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}},animate:{type:"boolean",default:"true"},canvas:{type:"string",required:!0}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},"fill-extrusion":{},raster:{},background:{}}},metadata:{type:"*"},ref:{type:"string"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"},"paint.*":{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_fill-extrusion","layout_symbol","layout_raster","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_fill:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_circle:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_line:{"line-cap":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{butt:{},round:{},square:{}},default:"butt"},"line-join":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{bevel:{},round:{},miter:{}},default:"miter"},"line-miter-limit":{type:"number",default:2,function:"interpolated","zoom-function":!0,requires:[{"line-join":"miter"}]},"line-round-limit":{type:"number",default:1.05,function:"interpolated","zoom-function":!0,requires:[{"line-join":"round"}]},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_symbol:{"symbol-placement":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{point:{},line:{}},default:"point"},"symbol-spacing":{type:"number",default:250,minimum:1,function:"interpolated","zoom-function":!0,units:"pixels",requires:[{"symbol-placement":"line"}]},"symbol-avoid-edges":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1},"icon-allow-overlap":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image"]},"icon-ignore-placement":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image"]},"icon-optional":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image","text-field"]},"icon-rotation-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"]},"icon-size":{type:"number",default:1,minimum:0,function:"interpolated","zoom-function":!0,requires:["icon-image"]},"icon-text-fit":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"]},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",function:"interpolated","zoom-function":!0,requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}]},"icon-image":{type:"string",function:"piecewise-constant","zoom-function":!0,tokens:!0},"icon-rotate":{type:"number",default:0,period:360,function:"interpolated","zoom-function":!0,"property-function":!0,units:"degrees",requires:["icon-image"]},"icon-padding":{type:"number",default:2,minimum:0,function:"interpolated","zoom-function":!0,units:"pixels",requires:["icon-image"]},"icon-keep-upright":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":"line"}]},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,"property-function":!0,requires:["icon-image"]},"text-pitch-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"]},"text-rotation-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"]},"text-field":{type:"string",function:"piecewise-constant","zoom-function":!0,default:"",tokens:!0},"text-font":{type:"array",value:"string",function:"piecewise-constant","zoom-function":!0,default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"]},"text-size":{type:"number",default:16,minimum:0,units:"pixels",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-line-height":{type:"number",default:1.2,units:"ems",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-letter-spacing":{type:"number",default:0,units:"ems",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-justify":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{left:{},center:{},right:{}},default:"center",requires:["text-field"]},"text-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field"]},"text-max-angle":{type:"number",default:45,units:"degrees",function:"interpolated","zoom-function":!0,requires:["text-field",{"symbol-placement":"line"}]},"text-rotate":{type:"number",default:0,period:360,units:"degrees",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-keep-upright":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":"line"}]},"text-transform":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"]},"text-offset":{type:"array",value:"number",units:"ems",function:"interpolated","zoom-function":!0,length:2,default:[0,0],requires:["text-field"]},"text-allow-overlap":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["text-field"]},"text-ignore-placement":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["text-field"]},"text-optional":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["text-field","icon-image"]},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"}},function_stop:{type:"array",minimum:0,maximum:22,value:["number","color"],length:2},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},transition:!1},position:{type:"array",default:[1.15,210,30],length:3,value:"number",transition:!0,function:"interpolated","zoom-function":!0,"property-function":!1},color:{type:"color",default:"#ffffff",function:"interpolated","zoom-function":!0,"property-function":!1,transition:!0},intensity:{type:"number",default:.5,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!1,transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_fill-extrusion","paint_symbol","paint_raster","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!0},"fill-opacity":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:1,minimum:0,maximum:1,transition:!0},"fill-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-pattern"}]},"fill-outline-color":{type:"color",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}]},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"fill-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["fill-translate"]},"fill-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!1,default:1,minimum:0,maximum:1,transition:!0},"fill-extrusion-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-extrusion-pattern"}]},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"fill-extrusion-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"]},"fill-extrusion-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0},"fill-extrusion-height":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:0,minimum:0,units:"meters",transition:!0},"fill-extrusion-base":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"]}},paint_line:{"line-opacity":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:1,minimum:0,maximum:1,transition:!0},"line-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"line-pattern"}]},"line-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"line-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["line-translate"]},"line-width":{type:"number",default:1,minimum:0,function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"line-gap-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-offset":{type:"number",default:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-dasharray":{type:"array",value:"number",function:"piecewise-constant","zoom-function":!0,minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}]},"line-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"circle-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-blur":{type:"number",default:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"circle-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["circle-translate"]},"circle-pitch-scale":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map"},"circle-stroke-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"circle-stroke-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,transition:!0,requires:["icon-image"]},"icon-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,transition:!0,requires:["icon-image"]},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",function:"interpolated","zoom-function":!0,transition:!0,requires:["icon-image"]},"icon-halo-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",requires:["icon-image"]},"icon-halo-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",requires:["icon-image"]},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",requires:["icon-image"]},"icon-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"]},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,transition:!0,requires:["text-field"]},"text-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,transition:!0,requires:["text-field"]},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",function:"interpolated","zoom-function":!0,transition:!0,requires:["text-field"]},"text-halo-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",requires:["text-field"]},"text-halo-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",requires:["text-field"]},"text-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",requires:["text-field"]},"text-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"]}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,transition:!0},"raster-hue-rotate":{type:"number",default:0,period:360,function:"interpolated","zoom-function":!0,transition:!0,units:"degrees"},"raster-brightness-min":{type:"number",function:"interpolated","zoom-function":!0,default:0,minimum:0,maximum:1,transition:!0},"raster-brightness-max":{type:"number",function:"interpolated","zoom-function":!0,default:1,minimum:0,maximum:1,transition:!0},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,function:"interpolated","zoom-function":!0,transition:!0},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,function:"interpolated","zoom-function":!0,transition:!0},"raster-fade-duration":{type:"number",default:300,minimum:0,function:"interpolated","zoom-function":!0,transition:!0,units:"milliseconds"}},paint_background:{"background-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,transition:!0,requires:[{"!":"background-pattern"}]},"background-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,transition:!0}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}}}},{}],193:[function(t,e,n){"use strict";function isSupported(t){return!!(isBrowser()&&isArraySupported()&&isFunctionSupported()&&isObjectSupported()&&isJSONSupported()&&isWorkerSupported()&&isUint8ClampedArraySupported()&&isWebGLSupportedCached(t&&t.failIfMajorPerformanceCaveat))}function isBrowser(){return"undefined"!=typeof window&&"undefined"!=typeof document}function isArraySupported(){return Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray}function isFunctionSupported(){return Function.prototype&&Function.prototype.bind}function isObjectSupported(){return Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions}function isJSONSupported(){return"JSON"in window&&"parse"in JSON&&"stringify"in JSON}function isWorkerSupported(){return"Worker"in window}function isUint8ClampedArraySupported(){return"Uint8ClampedArray"in window}function isWebGLSupportedCached(t){return void 0===r[t]&&(r[t]=isWebGLSupported(t)),r[t]}function isWebGLSupported(t){var e=document.createElement("canvas"),n=Object.create(isSupported.webGLContextAttributes);return n.failIfMajorPerformanceCaveat=t,e.probablySupportsContext?e.probablySupportsContext("webgl",n)||e.probablySupportsContext("experimental-webgl",n):e.supportsContext?e.supportsContext("webgl",n)||e.supportsContext("experimental-webgl",n):e.getContext("webgl",n)||e.getContext("experimental-webgl",n)}void 0!==e&&e.exports?e.exports=isSupported:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=isSupported);var r={};isSupported.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}},{}],194:[function(t,n,r){(function(t){function normalizeArray(t,e){for(var n=0,r=t.length-1;r>=0;r--){var i=t[r];"."===i?t.splice(r,1):".."===i?(t.splice(r,1),n++):n&&(t.splice(r,1),n--)}if(e)for(;n--;n)t.unshift("..");return t}function filter(t,e){if(t.filter)return t.filter(e);for(var n=[],r=0;r<t.length;r++)e(t[r],r,t)&&n.push(t[r]);return n}var e=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,n=function(t){return e.exec(t).slice(1)};r.resolve=function(){for(var e="",n=!1,r=arguments.length-1;r>=-1&&!n;r--){var i=r>=0?arguments[r]:t.cwd();if("string"!=typeof i)throw new TypeError("Arguments to path.resolve must be strings");i&&(e=i+"/"+e,n="/"===i.charAt(0))}return e=normalizeArray(filter(e.split("/"),function(t){return!!t}),!n).join("/"),(n?"/":"")+e||"."},r.normalize=function(t){var e=r.isAbsolute(t),n="/"===i(t,-1);return t=normalizeArray(filter(t.split("/"),function(t){return!!t}),!e).join("/"),t||e||(t="."),t&&n&&(t+="/"),(e?"/":"")+t},r.isAbsolute=function(t){return"/"===t.charAt(0)},r.join=function(){var t=Array.prototype.slice.call(arguments,0);return r.normalize(filter(t,function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},r.relative=function(t,n){function e(t){for(var e=0;e<t.length&&""===t[e];e++);for(var n=t.length-1;n>=0&&""===t[n];n--);return e>n?[]:t.slice(e,n-e+1)}t=r.resolve(t).substr(1),n=r.resolve(n).substr(1);for(var i=e(t.split("/")),o=e(n.split("/")),a=Math.min(i.length,o.length),s=a,u=0;u<a;u++)if(i[u]!==o[u]){s=u;break}for(var l=[],u=s;u<i.length;u++)l.push("..");return l=l.concat(o.slice(s)),l.join("/")},r.sep="/",r.delimiter=":",r.dirname=function(t){var e=n(t),r=e[0],i=e[1];return r||i?(i&&(i=i.substr(0,i.length-1)),r+i):"."},r.basename=function(t,e){var r=n(t)[2];return e&&r.substr(-1*e.length)===e&&(r=r.substr(0,r.length-e.length)),r},r.extname=function(t){return n(t)[3]};var i="b"==="ab".substr(-1)?function(t,e,n){return t.substr(e,n)}:function(t,e,n){return e<0&&(e=t.length+e),t.substr(e,n)}}).call(this,t("_process"))},{_process:198}],195:[function(t,e,n){"use strict";function Buffer(t){var e;t&&t.length&&(e=t,t=e.length);var n=new Uint8Array(t||0);return e&&n.set(e),n.readUInt32LE=r.readUInt32LE,n.writeUInt32LE=r.writeUInt32LE,n.readInt32LE=r.readInt32LE,n.writeInt32LE=r.writeInt32LE,n.readFloatLE=r.readFloatLE,n.writeFloatLE=r.writeFloatLE,n.readDoubleLE=r.readDoubleLE,n.writeDoubleLE=r.writeDoubleLE,n.toString=r.toString,n.write=r.write,n.slice=r.slice,n.copy=r.copy,n._isBuffer=!0,n}function encodeString(t){for(var e,n,r=t.length,i=[],o=0;o<r;o++){if((e=t.charCodeAt(o))>55295&&e<57344){if(!n){e>56319||o+1===r?i.push(239,191,189):n=e;continue}if(e<56320){i.push(239,191,189),n=e;continue}e=n-55296<<10|e-56320|65536,n=null}else n&&(i.push(239,191,189),n=null);e<128?i.push(e):e<2048?i.push(e>>6|192,63&e|128):e<65536?i.push(e>>12|224,e>>6&63|128,63&e|128):i.push(e>>18|240,e>>12&63|128,e>>6&63|128,63&e|128)}return i}e.exports=Buffer;var r,i,o,a=t("ieee754");r={readUInt32LE:function(t){return(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},writeUInt32LE:function(t,e){this[e]=t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24},readInt32LE:function(t){return(this[t]|this[t+1]<<8|this[t+2]<<16)+(this[t+3]<<24)},readFloatLE:function(t){return a.read(this,t,!0,23,4)},readDoubleLE:function(t){return a.read(this,t,!0,52,8)},writeFloatLE:function(t,e){return a.write(this,t,e,!0,23,4)},writeDoubleLE:function(t,e){return a.write(this,t,e,!0,52,8)},toString:function(t,e,n){var r="",i="";e=e||0,n=Math.min(this.length,n||this.length);for(var o=e;o<n;o++){var a=this[o];a<=127?(r+=decodeURIComponent(i)+String.fromCharCode(a),i=""):i+="%"+a.toString(16)}return r+=decodeURIComponent(i)},write:function(t,e){for(var n=t===i?o:encodeString(t),r=0;r<n.length;r++)this[e+r]=n[r]},slice:function(t,e){return this.subarray(t,e)},copy:function(t,e){e=e||0;for(var n=0;n<this.length;n++)t[e+n]=this[n]}},r.writeInt32LE=r.writeUInt32LE,Buffer.byteLength=function(t){return i=t,o=encodeString(t),o.length},Buffer.isBuffer=function(t){return!(!t||!t._isBuffer)}},{ieee754:150}],196:[function(t,e,n){(function(n){"use strict";function Pbf(t){this.buf=r.isBuffer(t)?t:new r(t||0),this.pos=0,this.length=this.buf.length}function readVarintRemainder(t,e){var n,r=e.buf;if(n=r[e.pos++],t+=268435456*(127&n),n<128)return t;if(n=r[e.pos++],t+=34359738368*(127&n),n<128)return t;if(n=r[e.pos++],t+=4398046511104*(127&n),n<128)return t;if(n=r[e.pos++],t+=562949953421312*(127&n),n<128)return t;if(n=r[e.pos++],t+=72057594037927940*(127&n),n<128)return t;if(n=r[e.pos++],t+=0x8000000000000000*(127&n),n<128)return t;throw new Error("Expected varint not more than 10 bytes")}function writeBigVarint(t,e){e.realloc(10);for(var n=e.pos+10;t>=1;){if(e.pos>=n)throw new Error("Given varint doesn't fit into 10 bytes");var r=255&t;e.buf[e.pos++]=r|(t>=128?128:0),t/=128}}function reallocForRawMessage(t,e,n){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=t;i--)n.buf[i+r]=n.buf[i]}function writePackedVarint(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function writePackedSVarint(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function writePackedFloat(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function writePackedDouble(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function writePackedBoolean(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function writePackedFixed32(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function writePackedSFixed32(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function writePackedFixed64(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function writePackedSFixed64(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}e.exports=Pbf;var r=n.Buffer||t("./buffer");Pbf.Varint=0,Pbf.Fixed64=1,Pbf.Bytes=2,Pbf.Fixed32=5;var i=4294967296,o=1/i,a=Math.pow(2,63);Pbf.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,o=this.pos;t(i,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=this.buf.readUInt32LE(this.pos);return this.pos+=4,t},readSFixed32:function(){var t=this.buf.readInt32LE(this.pos);return this.pos+=4,t},readFixed64:function(){var t=this.buf.readUInt32LE(this.pos)+this.buf.readUInt32LE(this.pos+4)*i;return this.pos+=8,t},readSFixed64:function(){var t=this.buf.readUInt32LE(this.pos)+this.buf.readInt32LE(this.pos+4)*i;return this.pos+=8,t},readFloat:function(){var t=this.buf.readFloatLE(this.pos);return this.pos+=4,t},readDouble:function(){var t=this.buf.readDoubleLE(this.pos);return this.pos+=8,t},readVarint:function(){var t,e,n=this.buf;return e=n[this.pos++],t=127&e,e<128?t:(e=n[this.pos++],t|=(127&e)<<7,e<128?t:(e=n[this.pos++],t|=(127&e)<<14,e<128?t:(e=n[this.pos++],t|=(127&e)<<21,e<128?t:readVarintRemainder(t,this))))},readVarint64:function(){var t=this.pos,e=this.readVarint();if(e<a)return e;for(var n=this.pos-2;255===this.buf[n];)n--;n<t&&(n=t),e=0;for(var r=0;r<n-t+1;r++){var i=127&~this.buf[t+r];e+=r<4?i<<7*r:i*Math.pow(2,7*r)}return-e-1},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.buf.toString("utf8",this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.slice(this.pos,t);return this.pos=t,e},readPackedVarint:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readVarint());return e},readPackedSVarint:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(t){var e=7&t;if(e===Pbf.Varint)for(;this.buf[this.pos++]>127;);else if(e===Pbf.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Pbf.Fixed32)this.pos+=4;else{if(e!==Pbf.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new r(e);this.buf.copy(n),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.slice(0,this.length)},writeFixed32:function(t){this.realloc(4),this.buf.writeUInt32LE(t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),this.buf.writeInt32LE(t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),this.buf.writeInt32LE(t&-1,this.pos),this.buf.writeUInt32LE(Math.floor(t*o),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),this.buf.writeInt32LE(t&-1,this.pos),this.buf.writeInt32LE(Math.floor(t*o),this.pos+4),this.pos+=8},writeVarint:function(t){return t=+t,t>268435455?void writeBigVarint(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),void(t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127)))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t);var e=r.byteLength(t);this.writeVarint(e),this.realloc(e),this.buf.write(t,this.pos),this.pos+=e},writeFloat:function(t){this.realloc(4),this.buf.writeFloatLE(t,this.pos),this.pos+=4},writeDouble:function(t){this.realloc(8),this.buf.writeDoubleLE(t,this.pos),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var r=this.pos-n;r>=128&&reallocForRawMessage(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,n){this.writeTag(t,Pbf.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){this.writeMessage(t,writePackedVarint,e)},writePackedSVarint:function(t,e){this.writeMessage(t,writePackedSVarint,e)},writePackedBoolean:function(t,e){this.writeMessage(t,writePackedBoolean,e)},writePackedFloat:function(t,e){this.writeMessage(t,writePackedFloat,e)},writePackedDouble:function(t,e){this.writeMessage(t,writePackedDouble,e)},writePackedFixed32:function(t,e){this.writeMessage(t,writePackedFixed32,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,writePackedSFixed32,e)},writePackedFixed64:function(t,e){this.writeMessage(t,writePackedFixed64,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,writePackedSFixed64,e)},writeBytesField:function(t,e){this.writeTag(t,Pbf.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Pbf.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Pbf.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Pbf.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Pbf.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Pbf.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Pbf.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Pbf.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Pbf.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Pbf.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}}).call(this,void 0!==r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./buffer":195}],197:[function(t,e,n){"use strict";function Point(t,e){this.x=t,this.y=e}e.exports=Point,Point.prototype={clone:function(){return new Point(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=e*this.x-n*this.y,i=n*this.x+e*this.y;return this.x=r,this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Point.convert=function(t){return t instanceof Point?t:Array.isArray(t)?new Point(t[0],t[1]):t}},{}],198:[function(t,e,n){function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(t){if(r===setTimeout)return setTimeout(t,0);if((r===defaultSetTimout||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}function runClearTimeout(t){if(i===clearTimeout)return clearTimeout(t);if((i===defaultClearTimeout||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{return i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}function cleanUpNextTick(){u&&a&&(u=!1,a.length?s=a.concat(s):l=-1,s.length&&drainQueue())}function drainQueue(){if(!u){var t=runTimeout(cleanUpNextTick);u=!0;for(var e=s.length;e;){for(a=s,s=[];++l<e;)a&&a[l].run();l=-1,e=s.length}a=null,u=!1,runClearTimeout(t)}}function Item(t,e){this.fun=t,this.array=e}function noop(){}var r,i,o=e.exports={};!function(){try{r="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(t){r=defaultSetTimout}try{i="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(t){i=defaultClearTimeout}}();var a,s=[],u=!1,l=-1;o.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.push(new Item(t,e)),1!==s.length||u||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=noop,o.addListener=noop,o.once=noop,o.off=noop,o.removeListener=noop,o.removeAllListeners=noop,o.emit=noop,o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],199:[function(t,e,n){"use strict";function partialSort(t,e,n,r,i){for(n=n||0,r=r||t.length-1,i=i||defaultCompare;r>n;){if(r-n>600){var o=r-n+1,a=e-n+1,s=Math.log(o),u=.5*Math.exp(2*s/3),l=.5*Math.sqrt(s*u*(o-u)/o)*(a-o/2<0?-1:1);partialSort(t,e,Math.max(n,Math.floor(e-a*u/o+l)),Math.min(r,Math.floor(e+(o-a)*u/o+l)),i)}var c=t[e],p=n,h=r;for(swap(t,n,e),i(t[r],c)>0&&swap(t,n,r);p<h;){for(swap(t,p,h),p++,h--;i(t[p],c)<0;)p++;for(;i(t[h],c)>0;)h--}0===i(t[n],c)?swap(t,n,h):(h++,swap(t,h,r)),h<=e&&(n=h+1),e<=h&&(r=h-1)}}function swap(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function defaultCompare(t,e){return t<e?-1:t>e?1:0}e.exports=partialSort},{}],200:[function(e,n,r){!function(e,i){"object"==typeof r&&void 0!==n?n.exports=i():"function"==typeof t&&t.amd?t(i):e.ShelfPack=i()}(this,function(){function t(t,e,n){n=n||{},this.w=t||64,this.h=e||64,this.autoResize=!!n.autoResize,this.shelves=[],this.stats={},this.count=function(t){this.stats[t]=1+(0|this.stats[t])}}function e(t,e,n){this.x=0,this.y=t,this.w=this.free=e,this.h=n}return t.prototype.pack=function(t,e){t=[].concat(t),e=e||{};for(var n,r,i,o=[],a=0;a<t.length;a++)if(n=t[a].w||t[a].width,r=t[a].h||t[a].height,n&&r){if(!(i=this.packOne(n,r)))continue;e.inPlace&&(t[a].x=i.x,t[a].y=i.y),o.push(i)}if(this.shelves.length>0){for(var s=0,u=0,l=0;l<this.shelves.length;l++){var c=this.shelves[l];u+=c.h,s=Math.max(c.w-c.free,s)}this.resize(s,u)}return o},t.prototype.packOne=function(t,n){for(var r,i,o=0,a={shelf:-1,waste:1/0},s=0;s<this.shelves.length;s++){if(r=this.shelves[s],o+=r.h,n===r.h&&t<=r.free)return this.count(n),r.alloc(t,n);n>r.h||t>r.free||n<r.h&&t<=r.free&&(i=r.h-n)<a.waste&&(a.waste=i,a.shelf=s)}if(a.shelf!==-1)return r=this.shelves[a.shelf],this.count(n),r.alloc(t,n);if(n<=this.h-o&&t<=this.w)return r=new e(o,this.w,n),this.shelves.push(r),this.count(n),r.alloc(t,n);if(this.autoResize){var u,l,c,p;return u=l=this.h,c=p=this.w,(c<=u||t>c)&&(p=2*Math.max(t,c)),(u<c||n>u)&&(l=2*Math.max(n,u)),this.resize(p,l),this.packOne(t,n)}return null},t.prototype.clear=function(){this.shelves=[],this.stats={}},t.prototype.resize=function(t,e){this.w=t,this.h=e;for(var n=0;n<this.shelves.length;n++)this.shelves[n].resize(t);return!0},e.prototype.alloc=function(t,e){if(t>this.free||e>this.h)return null;var n=this.x;return this.x+=t,this.free-=t,{x:n,y:this.y,w:t,h:e,width:t,height:e}},e.prototype.resize=function(t){return this.free+=t-this.w,this.w=t,!0},t})},{}],201:[function(t,e,n){"use strict";function supercluster(t){return new SuperCluster(t)}function SuperCluster(t){this.options=extend(Object.create(this.options),t),this.trees=new Array(this.options.maxZoom+1)}function createCluster(t,e,n,r){return{x:t,y:e,zoom:1/0,id:r,numPoints:n}}function createPointCluster(t,e){var n=t.geometry.coordinates;return createCluster(lngX(n[0]),latY(n[1]),1,e)}function getClusterJSON(t){return{type:"Feature",properties:getClusterProperties(t),geometry:{type:"Point",coordinates:[xLng(t.x),yLat(t.y)]}}}function getClusterProperties(t){var e=t.numPoints;return{cluster:!0,point_count:e,point_count_abbreviated:e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e}}function lngX(t){return t/360+.5}function latY(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function xLng(t){return 360*(t-.5)}function yLat(t){var e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function extend(t,e){for(var n in e)t[n]=e[n];return t}function getX(t){return t.x}function getY(t){return t.y}var r=t("kdbush");e.exports=supercluster,SuperCluster.prototype={options:{minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1},load:function(t){var e=this.options.log;e&&console.time("total time");var n="prepare "+t.length+" points";e&&console.time(n),this.points=t;var i=t.map(createPointCluster);e&&console.timeEnd(n);for(var o=this.options.maxZoom;o>=this.options.minZoom;o--){var a=+Date.now();this.trees[o+1]=r(i,getX,getY,this.options.nodeSize,Float32Array),i=this._cluster(i,o),e&&console.log("z%d: %d clusters in %dms",o,i.length,+Date.now()-a)}return this.trees[this.options.minZoom]=r(i,getX,getY,this.options.nodeSize,Float32Array),e&&console.timeEnd("total time"),this},getClusters:function(t,e){for(var n=this.trees[this._limitZoom(e)],r=n.range(lngX(t[0]),latY(t[3]),lngX(t[2]),latY(t[1])),i=[],o=0;o<r.length;o++){var a=n.points[r[o]];i.push(a.id!==-1?this.points[a.id]:getClusterJSON(a))}return i},getTile:function(t,e,n){var r=this.trees[this._limitZoom(t)],i=Math.pow(2,t),o=this.options.extent,a=this.options.radius,s=a/o,u=(n-s)/i,l=(n+1+s)/i,c={features:[]};return this._addTileFeatures(r.range((e-s)/i,u,(e+1+s)/i,l),r.points,e,n,i,c),0===e&&this._addTileFeatures(r.range(1-s/i,u,1,l),r.points,i,n,i,c),e===i-1&&this._addTileFeatures(r.range(0,u,s/i,l),r.points,-1,n,i,c),c.features.length?c:null},_addTileFeatures:function(t,e,n,r,i,o){for(var a=0;a<t.length;a++){var s=e[t[a]];o.features.push({type:1,geometry:[[Math.round(this.options.extent*(s.x*i-n)),Math.round(this.options.extent*(s.y*i-r))]],tags:s.id!==-1?this.points[s.id].properties:getClusterProperties(s)})}},_limitZoom:function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},_cluster:function(t,e){for(var n=[],r=this.options.radius/(this.options.extent*Math.pow(2,e)),i=0;i<t.length;i++){var o=t[i];if(!(o.zoom<=e)){o.zoom=e;for(var a=this.trees[e+1],s=a.within(o.x,o.y,r),u=!1,l=o.numPoints,c=o.x*l,p=o.y*l,h=0;h<s.length;h++){var f=a.points[s[h]];e<f.zoom&&(u=!0,f.zoom=e,c+=f.x*f.numPoints,p+=f.y*f.numPoints,l+=f.numPoints)}n.push(u?createCluster(c/l,p/l,l,-1):o)}}return n}}},{kdbush:151}],202:[function(t,e,n){"use strict";function TinyQueue(t,e){if(!(this instanceof TinyQueue))return new TinyQueue(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||defaultCompare,t)for(var n=Math.floor(this.length/2);n>=0;n--)this._down(n)}function defaultCompare(t,e){return t<e?-1:t>e?1:0}function swap(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}e.exports=TinyQueue,TinyQueue.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){var t=this.data[0];return this.data[0]=this.data[this.length-1],this.length--,this.data.pop(),this._down(0),t},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,n=this.compare;t>0;){var r=Math.floor((t-1)/2);if(!(n(e[t],e[r])<0))break;swap(e,r,t),t=r}},_down:function(t){for(var e=this.data,n=this.compare,r=this.length;;){var i=2*t+1,o=i+1,a=t;if(i<r&&n(e[i],e[a])<0&&(a=i),o<r&&n(e[o],e[a])<0&&(a=o),a===t)return;swap(e,a,t),t=a}}}},{}],203:[function(t,e,n){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],204:[function(t,e,n){e.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],205:[function(e,n,i){(function(n,r){function inspect(t,e){var n={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),isBoolean(e)?n.showHidden=e:e&&i._extend(n,e),isUndefined(n.showHidden)&&(n.showHidden=!1),isUndefined(n.depth)&&(n.depth=2),isUndefined(n.colors)&&(n.colors=!1),isUndefined(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=stylizeWithColor),formatValue(n,t,n.depth)}function stylizeWithColor(t,e){var n=inspect.styles[e];return n?"["+inspect.colors[n][0]+"m"+t+"["+inspect.colors[n][1]+"m":t}function stylizeNoColor(t,e){return t}function arrayToHash(t){var e={};return t.forEach(function(t,n){e[t]=!0}),e}function formatValue(t,e,n){if(t.customInspect&&e&&isFunction(e.inspect)&&e.inspect!==i.inspect&&(!e.constructor||e.constructor.prototype!==e)){var r=e.inspect(n,t);return isString(r)||(r=formatValue(t,r,n)),r}var o=formatPrimitive(t,e);if(o)return o;var a=Object.keys(e),s=arrayToHash(a);if(t.showHidden&&(a=Object.getOwnPropertyNames(e)),isError(e)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return formatError(e);if(0===a.length){if(isFunction(e)){var u=e.name?": "+e.name:"";return t.stylize("[Function"+u+"]","special")}if(isRegExp(e))return t.stylize(RegExp.prototype.toString.call(e),"regexp");if(isDate(e))return t.stylize(Date.prototype.toString.call(e),"date");if(isError(e))return formatError(e)}var l="",c=!1,p=["{","}"];if(isArray(e)&&(c=!0,p=["[","]"]),isFunction(e)){l=" [Function"+(e.name?": "+e.name:"")+"]"}if(isRegExp(e)&&(l=" "+RegExp.prototype.toString.call(e)),isDate(e)&&(l=" "+Date.prototype.toUTCString.call(e)),isError(e)&&(l=" "+formatError(e)),0===a.length&&(!c||0==e.length))return p[0]+l+p[1];if(n<0)return isRegExp(e)?t.stylize(RegExp.prototype.toString.call(e),"regexp"):t.stylize("[Object]","special");t.seen.push(e);var h;return h=c?formatArray(t,e,n,s,a):a.map(function(r){return formatProperty(t,e,n,s,r,c)}),t.seen.pop(),reduceToSingleString(h,l,p)}function formatPrimitive(t,e){if(isUndefined(e))return t.stylize("undefined","undefined");if(isString(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}return isNumber(e)?t.stylize(""+e,"number"):isBoolean(e)?t.stylize(""+e,"boolean"):isNull(e)?t.stylize("null","null"):void 0}function formatError(t){return"["+Error.prototype.toString.call(t)+"]"}function formatArray(t,e,n,r,i){for(var o=[],a=0,s=e.length;a<s;++a)hasOwnProperty(e,String(a))?o.push(formatProperty(t,e,n,r,String(a),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(formatProperty(t,e,n,r,i,!0))}),o}function formatProperty(t,e,n,r,i,o){var a,s,u;if(u=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]},u.get?s=u.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):u.set&&(s=t.stylize("[Setter]","special")),hasOwnProperty(r,i)||(a="["+i+"]"),s||(t.seen.indexOf(u.value)<0?(s=isNull(n)?formatValue(t,u.value,null):formatValue(t,u.value,n-1),s.indexOf("\n")>-1&&(s=o?s.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+s.split("\n").map(function(t){return"   "+t}).join("\n"))):s=t.stylize("[Circular]","special")),isUndefined(a)){if(o&&i.match(/^\d+$/))return s;a=JSON.stringify(""+i),a.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=t.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=t.stylize(a,"string"))}return a+": "+s}function reduceToSingleString(t,e,n){var r=0;return t.reduce(function(t,e){return r++,e.indexOf("\n")>=0&&r++,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1]:n[0]+e+" "+t.join(", ")+" "+n[1]}function isArray(t){return Array.isArray(t)}function isBoolean(t){return"boolean"==typeof t}function isNull(t){return null===t}function isNullOrUndefined(t){return null==t}function isNumber(t){return"number"==typeof t}function isString(t){return"string"==typeof t}function isSymbol(t){return"symbol"==typeof t}function isUndefined(t){return void 0===t}function isRegExp(t){return isObject(t)&&"[object RegExp]"===objectToString(t)}function isObject(t){return"object"==typeof t&&null!==t}function isDate(t){return isObject(t)&&"[object Date]"===objectToString(t)}function isError(t){return isObject(t)&&("[object Error]"===objectToString(t)||t instanceof Error)}function isFunction(t){return"function"==typeof t}function isPrimitive(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t}function objectToString(t){return Object.prototype.toString.call(t)}function pad(t){return t<10?"0"+t.toString(10):t.toString(10)}function timestamp(){var t=new Date,e=[pad(t.getHours()),pad(t.getMinutes()),pad(t.getSeconds())].join(":");return[t.getDate(),u[t.getMonth()],e].join(" ")}function hasOwnProperty(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var o=/%[sdj%]/g;i.format=function(t){if(!isString(t)){for(var e=[],n=0;n<arguments.length;n++)e.push(inspect(arguments[n]));return e.join(" ")}for(var n=1,r=arguments,i=r.length,a=String(t).replace(o,function(t){if("%%"===t)return"%";if(n>=i)return t;switch(t){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(t){return"[Circular]"}default:return t}}),s=r[n];n<i;s=r[++n])a+=isNull(s)||!isObject(s)?" "+s:" "+inspect(s);return a},i.deprecate=function(e,o){function t(){if(!a){if(n.throwDeprecation)throw new Error(o);n.traceDeprecation?console.trace(o):console.error(o),a=!0}return e.apply(this,arguments)}if(isUndefined(r.process))return function(){return i.deprecate(e,o).apply(this,arguments)};if(n.noDeprecation===!0)return e;var a=!1;return t};var a,s={};i.debuglog=function(t){if(isUndefined(a)&&(a=n.env.NODE_DEBUG||""),t=t.toUpperCase(),!s[t])if(new RegExp("\\b"+t+"\\b","i").test(a)){var e=n.pid;s[t]=function(){var n=i.format.apply(i,arguments);console.error("%s %d: %s",t,e,n)}}else s[t]=function(){};return s[t]},i.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},i.isArray=isArray,i.isBoolean=isBoolean,i.isNull=isNull,i.isNullOrUndefined=isNullOrUndefined,i.isNumber=isNumber,i.isString=isString,i.isSymbol=isSymbol,i.isUndefined=isUndefined,i.isRegExp=isRegExp,i.isObject=isObject,i.isDate=isDate,i.isError=isError,i.isFunction=isFunction,i.isPrimitive=isPrimitive,i.isBuffer=e("./support/isBuffer");var u=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];i.log=function(){console.log("%s - %s",timestamp(),i.format.apply(i,arguments))},i.inherits=e("inherits"),i._extend=function(t,e){if(!e||!isObject(e))return t;for(var n=Object.keys(e),r=n.length;r--;)t[n[r]]=e[n[r]];return t}}).call(this,e("_process"),void 0!==r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":204,_process:198,inherits:203}],206:[function(t,e,n){e.exports.VectorTile=t("./lib/vectortile.js"),e.exports.VectorTileFeature=t("./lib/vectortilefeature.js"),e.exports.VectorTileLayer=t("./lib/vectortilelayer.js")},{"./lib/vectortile.js":207,"./lib/vectortilefeature.js":208,"./lib/vectortilelayer.js":209}],207:[function(t,e,n){"use strict";function VectorTile(t,e){this.layers=t.readFields(readTile,{},e)}function readTile(t,e,n){if(3===t){var i=new r(n,n.readVarint()+n.pos);i.length&&(e[i.name]=i)}}var r=t("./vectortilelayer");e.exports=VectorTile},{"./vectortilelayer":209}],208:[function(t,e,n){"use strict";function VectorTileFeature(t,e,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=i,t.readFields(readFeature,this,e)}function readFeature(t,e,n){1==t?e.id=n.readVarint():2==t?readTag(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function readTag(t,e){for(var n=t.readVarint()+t.pos;t.pos<n;){var r=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[r]=i}}function classifyRings(t){var e=t.length;if(e<=1)return[t];for(var n,r,i=[],o=0;o<e;o++){var a=signedArea(t[o]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(n&&i.push(n),n=[t[o]]):n.push(t[o]))}return n&&i.push(n),i}function signedArea(t){for(var e,n,r=0,i=0,o=t.length,a=o-1;i<o;a=i++)e=t[i],n=t[a],r+=(n.x-e.x)*(e.y+n.y);return r}var r=t("point-geometry");e.exports=VectorTileFeature,VectorTileFeature.types=["Unknown","Point","LineString","Polygon"],VectorTileFeature.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,i=1,o=0,a=0,s=0,u=[];t.pos<n;){if(!o){var l=t.readVarint();i=7&l,o=l>>3}if(o--,1===i||2===i)a+=t.readSVarint(),s+=t.readSVarint(),1===i&&(e&&u.push(e),e=[]),e.push(new r(a,s));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&u.push(e),u},VectorTileFeature.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,r=0,i=0,o=0,a=1/0,s=-(1/0),u=1/0,l=-(1/0);t.pos<e;){if(!r){var c=t.readVarint();n=7&c,r=c>>3}if(r--,1===n||2===n)i+=t.readSVarint(),o+=t.readSVarint(),i<a&&(a=i),i>s&&(s=i),o<u&&(u=o),o>l&&(l=o);else if(7!==n)throw new Error("unknown command "+n)}return[a,u,s,l]},VectorTileFeature.prototype.toGeoJSON=function(t,e,n){function i(t){for(var e=0;e<t.length;e++){var n=t[e],r=180-360*(n.y+u)/a;t[e]=[360*(n.x+s)/a-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}var r,o,a=this.extent*Math.pow(2,n),s=this.extent*t,u=this.extent*e,l=this.loadGeometry(),c=VectorTileFeature.types[this.type];switch(this.type){case 1:var p=[];for(r=0;r<l.length;r++)p[r]=l[r][0];l=p,i(l);break;case 2:for(r=0;r<l.length;r++)i(l[r]);break;case 3:for(l=classifyRings(l),r=0;r<l.length;r++)for(o=0;o<l[r].length;o++)i(l[r][o])}1===l.length?l=l[0]:c="Multi"+c;var h={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(h.id=this.id),h}},{"point-geometry":197}],209:[function(t,e,n){"use strict";function VectorTileLayer(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(readLayer,this,e),this.length=this._features.length}function readLayer(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(readValueMessage(n))}function readValueMessage(t){for(var e=null,n=t.readVarint()+t.pos;t.pos<n;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}var r=t("./vectortilefeature.js");e.exports=VectorTileLayer,VectorTileLayer.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new r(this._pbf,e,this.extent,this._keys,this._values)}},{"./vectortilefeature.js":208}],210:[function(t,e,n){function fromVectorTileJs(t){var e=[];for(var n in t.layers)e.push(prepareLayer(t.layers[n]));var o=new r;return i.tile.write({layers:e},o),o.finish()}function fromGeojsonVt(t){var e={};for(var n in t)e[n]=new o(t[n].features),e[n].name=n;return fromVectorTileJs({layers:e})}function prepareLayer(t){for(var e={name:t.name||"",version:t.version||1,extent:t.extent||4096,keys:[],values:[],features:[]},n={},r={},i=0;i<t.length;i++){var o=t.feature(i);o.geometry=encodeGeometry(o.loadGeometry());var a=[];for(var s in o.properties){var u=n[s];void 0===u&&(e.keys.push(s),u=e.keys.length-1,n[s]=u);var l=wrapValue(o.properties[s]),c=r[l.key];void 0===c&&(e.values.push(l),c=e.values.length-1,r[l.key]=c),a.push(u),a.push(c)}o.tags=a,e.features.push(o)}return e}function command(t,e){return(e<<3)+(7&t)}function zigzag(t){return t<<1^t>>31}function encodeGeometry(t){for(var e=[],n=0,r=0,i=t.length,o=0;o<i;o++){var a=t[o];e.push(command(1,1));for(var s=0;s<a.length;s++){1===s&&e.push(command(2,a.length-1));var u=a[s].x-n,l=a[s].y-r;e.push(zigzag(u),zigzag(l)),n+=u,r+=l}}return e}function wrapValue(t){var e,n=typeof t;return"string"===n?e={string_value:t}:"boolean"===n?e={bool_value:t}:"number"===n?e=t%1!=0?{double_value:t}:t<0?{sint_value:t}:{uint_value:t}:(t=JSON.stringify(t),e={string_value:t}),e.key=n+":"+t,e}var r=t("pbf"),i=t("./vector-tile-pb"),o=t("./lib/geojson_wrapper");e.exports=fromVectorTileJs,e.exports.fromVectorTileJs=fromVectorTileJs,e.exports.fromGeojsonVt=fromGeojsonVt,e.exports.GeoJSONWrapper=o},{"./lib/geojson_wrapper":211,"./vector-tile-pb":212,pbf:196}],211:[function(t,e,n){"use strict";function GeoJSONWrapper(t){this.features=t,this.length=t.length}function FeatureWrapper(t){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=4096}var r=t("point-geometry"),i=t("vector-tile").VectorTileFeature;e.exports=GeoJSONWrapper,GeoJSONWrapper.prototype.feature=function(t){return new FeatureWrapper(this.features[t])},FeatureWrapper.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var n=t[e],i=[],o=0;o<n.length;o++)i.push(new r(n[o][0],n[o][1]));this.geometry.push(i)}return this.geometry},FeatureWrapper.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,n=-(1/0),r=1/0,i=-(1/0),o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var u=a[s];e=Math.min(e,u.x),n=Math.max(n,u.x),r=Math.min(r,u.y),i=Math.max(i,u.y)}return[e,r,n,i]},FeatureWrapper.prototype.toGeoJSON=i.prototype.toGeoJSON},{"point-geometry":197,"vector-tile":206}],212:[function(t,e,n){"use strict";function readTile(t,e){return t.readFields(readTileField,{layers:[]},e)}function readTileField(t,e,n){3===t&&e.layers.push(readLayer(n,n.readVarint()+n.pos))}function writeTile(t,e){var n;if(void 0!==t.layers)for(n=0;n<t.layers.length;n++)e.writeMessage(3,writeLayer,t.layers[n])}function readValue(t,e){return t.readFields(readValueField,{},e)}function readValueField(t,e,n){1===t?e.string_value=n.readString():2===t?e.float_value=n.readFloat():3===t?e.double_value=n.readDouble():4===t?e.int_value=n.readVarint():5===t?e.uint_value=n.readVarint():6===t?e.sint_value=n.readSVarint():7===t&&(e.bool_value=n.readBoolean())}function writeValue(t,e){void 0!==t.string_value&&e.writeStringField(1,t.string_value),void 0!==t.float_value&&e.writeFloatField(2,t.float_value),void 0!==t.double_value&&e.writeDoubleField(3,t.double_value),void 0!==t.int_value&&e.writeVarintField(4,t.int_value),void 0!==t.uint_value&&e.writeVarintField(5,t.uint_value),void 0!==t.sint_value&&e.writeSVarintField(6,t.sint_value),void 0!==t.bool_value&&e.writeBooleanField(7,t.bool_value)}function readFeature(t,e){var n=t.readFields(readFeatureField,{},e);return void 0===n.type&&(n.type="Unknown"),n}function readFeatureField(t,e,n){1===t?e.id=n.readVarint():2===t?e.tags=n.readPackedVarint():3===t?e.type=n.readVarint():4===t&&(e.geometry=n.readPackedVarint())}function writeFeature(t,e){void 0!==t.id&&e.writeVarintField(1,t.id),void 0!==t.tags&&e.writePackedVarint(2,t.tags),void 0!==t.type&&e.writeVarintField(3,t.type),void 0!==t.geometry&&e.writePackedVarint(4,t.geometry)}function readLayer(t,e){return t.readFields(readLayerField,{features:[],keys:[],values:[]},e)}function readLayerField(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():2===t?e.features.push(readFeature(n,n.readVarint()+n.pos)):3===t?e.keys.push(n.readString()):4===t?e.values.push(readValue(n,n.readVarint()+n.pos)):5===t&&(e.extent=n.readVarint())}function writeLayer(t,e){void 0!==t.version&&e.writeVarintField(15,t.version),void 0!==t.name&&e.writeStringField(1,t.name);var n;if(void 0!==t.features)for(n=0;n<t.features.length;n++)e.writeMessage(2,writeFeature,t.features[n]);if(void 0!==t.keys)for(n=0;n<t.keys.length;n++)e.writeStringField(3,t.keys[n]);if(void 0!==t.values)for(n=0;n<t.values.length;n++)e.writeMessage(4,writeValue,t.values[n]);void 0!==t.extent&&e.writeVarintField(5,t.extent)}var r=n.tile={read:readTile,write:writeTile};r.GeomType={Unknown:0,Point:1,LineString:2,Polygon:3},r.value={read:readValue,write:writeValue},r.feature={read:readFeature,write:writeFeature},r.layer={read:readLayer,write:writeLayer}},{}],213:[function(e,n,r){var i=arguments[3],o=arguments[4],a=arguments[5],s=JSON.stringify;n.exports=function(e,n){function t(e){y[e]=!0;for(var n in o[e][1]){var r=o[e][1][n];y[r]||t(r)}}for(var r,u=Object.keys(a),l=0,c=u.length;l<c;l++){var p=u[l],h=a[p].exports;if(h===e||h&&h.default===e){r=p;break}}if(!r){r=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var f={},l=0,c=u.length;l<c;l++){var p=u[l];f[p]=p}o[r]=[Function(["require","module","exports"],"("+e+")(self)"),f]}var d=Math.floor(Math.pow(16,8)*Math.random()).toString(16),m={};m[r]=r,o[d]=[Function(["require"],"var f = require("+s(r)+");(f.default ? f.default : f)(self);"),m];var y={};t(d);var g="("+i+")({"+Object.keys(y).map(function(t){return s(t)+":["+o[t][0]+","+s(o[t][1])+"]"}).join(",")+"},{},["+s(d)+"])",v=window.URL||window.webkitURL||window.mozURL||window.msURL,_=new Blob([g],{type:"text/javascript"});if(n&&n.bare)return _;var x=v.createObjectURL(_),b=new Worker(x);return b.objectURL=x,b}},{}],214:[function(t,e,n){e.exports.RADIUS=6378137,e.exports.FLATTENING=1/298.257223563,e.exports.POLAR_RADIUS=6356752.3142},{}],215:[function(e,n,r){!function(e,i){"object"==typeof r&&void 0!==n?i(r):"function"==typeof t&&t.amd?t(["exports"],i):i(e.WhooTS=e.WhooTS||{})}(this,function(e){function t(t,e,n,r,i,a){return a=a||{},t+"?"+["bbox="+o(n,r,i),"format="+(a.format||"image/png"),"service="+(a.service||"WMS"),"version="+(a.version||"1.1.1"),"request="+(a.request||"GetMap"),"srs="+(a.srs||"EPSG:3857"),"width="+(a.width||256),"height="+(a.height||256),"layers="+e].join("&")}function o(t,e,n){e=Math.pow(2,n)-e-1;var i=r(256*t,256*e,n),o=r(256*(t+1),256*(e+1),n);return i[0]+","+i[1]+","+o[0]+","+o[1]}function r(t,e,n){var r=2*Math.PI*6378137/256/Math.pow(2,n);return[t*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}e.getURL=t,e.getTileBBox=o,e.getMercCoords=r,Object.defineProperty(e,"__esModule",{value:!0})})},{}],216:[function(t,e,n){e.exports={version:"0.32.1"}},{}]},{},[24])(24)})}).call(e,n(734).Buffer,n(13))},439:function(t,e,n){"use strict";var r=n(0),i=n(170),o=n(0),a="undefined"!=typeof window?window:this,s=function(){function DevToolsExtension(t,e){var n=this;this.appRef=t,this.ngRedux=e,this.enhancer=function(t){var e;return n.isEnabled()?(a.devToolsExtension.listen(function(t){var r=t.type;"START"===r?e=n.ngRedux.subscribe(function(){o.NgZone.isInAngularZone()||n.appRef.tick()}):"STOP"===r&&e()}),a.devToolsExtension(t)):null}}return DevToolsExtension.prototype.isEnabled=function(){return a&&a.devToolsExtension},DevToolsExtension.decorators=[{type:r.Injectable}],DevToolsExtension.ctorParameters=function(){return[{type:r.ApplicationRef},{type:i.NgRedux}]},DevToolsExtension}();e.DevToolsExtension=s},440:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=e.repeat=function(t,e){return new Array(e+1).join(t)},i=e.pad=function(t,e){return r("0",e-t.toString().length)+t};e.formatTime=function(t){return i(t.getHours(),2)+":"+i(t.getMinutes(),2)+":"+i(t.getSeconds(),2)+"."+i(t.getMilliseconds(),3)},e.timer="undefined"!=typeof performance&&null!==performance&&"function"==typeof performance.now?performance:Date},441:function(t,e,n){"use strict";function compose(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];if(0===e.length)return function(t){return t};if(1===e.length)return e[0];var r=e[e.length-1],i=e.slice(0,-1);return function(){return i.reduceRight(function(t,e){return e(t)},r.apply(void 0,arguments))}}e.a=compose},442:function(t,e,n){"use strict";function createStore(t,e,i){function ensureCanMutateNextListeners(){p===c&&(p=c.slice())}function getState(){return l}function subscribe(t){if("function"!=typeof t)throw new Error("Expected listener to be a function.");var e=!0;return ensureCanMutateNextListeners(),p.push(t),function(){if(e){e=!1,ensureCanMutateNextListeners();var n=p.indexOf(t);p.splice(n,1)}}}function dispatch(t){if(!n.i(r.a)(t))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===t.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(h)throw new Error("Reducers may not dispatch actions.");try{h=!0,l=u(l,t)}finally{h=!1}for(var e=c=p,i=0;i<e.length;i++)e[i]();return t}function replaceReducer(t){if("function"!=typeof t)throw new Error("Expected the nextReducer to be a function.");u=t,dispatch({type:a.INIT})}function observable(){var t,e=subscribe;return t={subscribe:function(t){function observeState(){t.next&&t.next(getState())}if("object"!=typeof t)throw new TypeError("Expected the observer to be an object.");return observeState(),{unsubscribe:e(observeState)}}},t[o.a]=function(){return this},t}var s;if("function"==typeof e&&void 0===i&&(i=e,e=void 0),void 0!==i){if("function"!=typeof i)throw new Error("Expected the enhancer to be a function.");return i(createStore)(t,e)}if("function"!=typeof t)throw new Error("Expected the reducer to be a function.");var u=t,l=e,c=[],p=c,h=!1;return dispatch({type:a.INIT}),s={dispatch:dispatch,subscribe:subscribe,getState:getState,replaceReducer:replaceReducer},s[o.a]=observable,s}var r=n(437),i=n(1070),o=n.n(i);n.d(e,"b",function(){return a}),e.a=createStore;var a={INIT:"@@redux/INIT"}},443:function(t,e,n){"use strict";function isCrushed(){}Object.defineProperty(e,"__esModule",{value:!0});var r=n(442),i=n(816),o=n(815),a=n(814),s=n(441),u=n(444);n.d(e,"createStore",function(){return r.a}),n.d(e,"combineReducers",function(){return i.a}),n.d(e,"bindActionCreators",function(){return o.a}),n.d(e,"applyMiddleware",function(){return a.a}),n.d(e,"compose",function(){return s.a}),"production"!==n.i({ENV:"build"}).NODE_ENV&&"string"==typeof isCrushed.name&&"isCrushed"!==isCrushed.name&&n.i(u.a)("You are currently using minified code outside of NODE_ENV === 'production'. This means that you are running a slower development build of Redux. You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify or DefinePlugin for webpack (http://stackoverflow.com/questions/30030031) to ensure you have the correct code for your production build.")},444:function(t,e,n){"use strict";function warning(t){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(t);try{throw new Error(t)}catch(t){}}e.a=warning},491:function(t,e,n){"use strict";var r=n(0),i=n(27),o=n(88),a=n(30),s=n(651),u=n(21),l=n(20),c=n(89),p=n(186),h={apiKey:"AIzaSyABlDFTj5lUcR9e_I2ZzrB6D26c5FU9mE8",authDomain:"parkabler.firebaseapp.com",databaseURL:"https://parkabler.firebaseio.com",storageBucket:"parkabler.appspot.com"},f=n(671),d=n(683),m=n(435),y=n(80),g=n(672),v=function(){function AppModule(t){this.appRef=t}return AppModule.prototype.hmrOnInit=function(t){console.log("HMR store",t)},AppModule.prototype.hmrOnDestroy=function(t){var e=this.appRef.components.map(function(t){return t.location.nativeElement});t.disposeOldHosts=s.createNewHosts(e),s.removeNgStyles()},AppModule.prototype.hmrAfterDestroy=function(t){t.disposeOldHosts(),delete t.disposeOldHosts},AppModule}();v=__decorate([r.NgModule({imports:[i.BrowserModule,o.HttpModule,a.FormsModule,a.ReactiveFormsModule,g.routing,u.NgReduxModule,c.MaterialModule.forRoot(),p.AngularFireModule.initializeApp(h)],declarations:[f.AppComponent,m.HomeComponent,d.HeaderComponent,d.SpotsListComponent,d.DrawerComponent,d.PlacesComponent,m.TextComponent,m.RulesInfoComponent,d.MapComponent,d.MapGLComponent,d.MapJSComponent,d.MapControlsComponent,d.TutorialComponent,d.TutorialDialogComponent,d.AddSpotComponent,d.AddSpotButtonComponent,d.AddSpotDrawerComponent,d.AddSpotOverlayComponent,d.ReportSpotComponent,d.StepComponent,d.StepperComponent],entryComponents:[d.TutorialDialogComponent],providers:[u.DevToolsExtension,y.GeolocationService,y.SpotsService,y.DistanceService,y.RulesInfoService,y.PlacesService,l.ACTION_PROVIDERS],bootstrap:[f.AppComponent]}),__metadata("design:paramtypes",[r.ApplicationRef])],v),e.AppModule=v},650:function(t,e,n){"use strict";function bootloader(t){"complete"===document.readyState?t():document.addEventListener("DOMContentLoaded",t)}function createNewHosts(t){var e=t.map(function(t){var e=document.createElement(t.tagName),n=e.style.display;return e.style.display="none",t.parentNode.insertBefore(e,t),{currentDisplay:n,newNode:e}});return function(){e.forEach(function(t){t.newNode.style.display=t.currentDisplay,t.newNode=null,t.currentDisplay=null})}}function removeNgStyles(){Array.prototype.slice.call(document.head.querySelectorAll("style"),0).filter(function(t){return t.innerText.indexOf("_ng")!==-1}).map(function(t){return t.remove()})}function getInputValues(){var t=document.querySelectorAll("input");return Array.prototype.slice.call(t).map(function(t){return t.value})}function setInputValues(t){var e=document.querySelectorAll("input");t&&e.length===t.length&&t.forEach(function(t,n){var r=e[n];r.value=t,r.dispatchEvent(new CustomEvent("input",{detail:r.value}))})}function createInputTransfer(){var t=getInputValues();return function(){setInputValues(t)}}e.bootloader=bootloader,e.createNewHosts=createNewHosts,e.removeNgStyles=removeNgStyles,e.getInputValues=getInputValues,e.setInputValues=setInputValues,e.createInputTransfer=createInputTransfer},651:function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}__export(n(650))},662:function(t,e,n){"use strict";var r=n(0),i=n(21),o=n(33),a=s=function(){function AddSpotStepActions(t){this.ngRedux=t}return AddSpotStepActions.prototype.setStep=function(t){switch(t){case o.AddSpotSteps.Location:this.setStepLocation();break;case o.AddSpotSteps.Details:this.setStepDetails();break;case o.AddSpotSteps.Submitted:this.setStepSubmitted();break;default:throw"No step action found for: "+t}},AddSpotStepActions.prototype.setStepLocation=function(){this.ngRedux.dispatch({type:s.SET_STEP_LOCATION})},AddSpotStepActions.prototype.setStepDetails=function(){this.ngRedux.dispatch({type:s.SET_STEP_DETAILS})},AddSpotStepActions.prototype.setStepSubmitted=function(){this.ngRedux.dispatch({type:s.SET_STEP_SUBMITTED})},AddSpotStepActions}();a.SET_STEP_LOCATION="PA/ADDSPOTSTEP/LOCATION",a.SET_STEP_DETAILS="PA/ADDSPOTSTEP/DETAILS",a.SET_STEP_SUBMITTED="PA/ADDSPOTSTEP/SUBMITTED",a=s=__decorate([r.Injectable(),__metadata("design:paramtypes",[i.NgRedux])],a),e.AddSpotStepActions=a;var s},663:function(t,e,n){"use strict";var r=n(0),i=n(21),o=a=function(){function AppModeActions(t){this.ngRedux=t}return AppModeActions.prototype.setModeHome=function(){this.ngRedux.dispatch({type:a.SET_MODE_HOME})},AppModeActions.prototype.setModeAddSpot=function(){this.ngRedux.dispatch({type:a.SET_MODE_ADDSPOT})},AppModeActions.prototype.unsetModeAddSpot=function(){this.ngRedux.dispatch({type:a.SET_MODE_HOME})},AppModeActions}();o.SET_MODE_HOME="PA/MODE/HOME",o.SET_MODE_ADDSPOT="PA/MODE/ADDSPOT",o=a=__decorate([r.Injectable(),__metadata("design:paramtypes",[i.NgRedux])],o),e.AppModeActions=o;var a},664:function(t,e,n){"use strict";var r=n(0),i=n(21),o=a=function(){function DestinationActions(t){this.ngRedux=t}return DestinationActions.prototype.setDestination=function(t){this.ngRedux.dispatch({type:a.SET,payload:t})},DestinationActions}();o.SET="PA/DESTINATION/SET",o=a=__decorate([r.Injectable(),__metadata("design:paramtypes",[i.NgRedux])],o),e.DestinationActions=o;var a},665:function(t,e,n){"use strict";var r=n(0),i=n(21),o=n(80),a=s=function(){function NearbySpotsActions(t,e){this.ngRedux=t,this.distanceService=e}return NearbySpotsActions.prototype.updateNearbySpots=function(t){this.ngRedux.dispatch({type:s.UPDATE,payload:t})},NearbySpotsActions.prototype.getNearbySpots=function(t,e){var n=this;if(t&&e){this.ngRedux.dispatch({type:s.GET});var r=this.distanceService.filterByEuclideanDistance(.2),i=r(t,e);i.length>0&&this.distanceService.getDistance(i,t).then(function(t){return n.spotsWithDistances(i,t)}).then(function(t){return n.updateNearbySpots(t)}).catch(function(t){throw t})}},NearbySpotsActions.prototype.spotsWithDistances=function(t,e){return t.map(function(t,n){return Object.assign({},t,{distanceToDestination:e[n]})})},NearbySpotsActions}();a.GET="PA/NEARBY_SPOTS/GET",a.UPDATE="PA/NEARBY_SPOTS/UPDATE",a=s=__decorate([r.Injectable(),__metadata("design:paramtypes",[i.NgRedux,o.DistanceService])],a),e.NearbySpotsActions=a;var s},666:function(t,e,n){"use strict";var r=n(0),i=n(21),o=n(20),a=s=function(){function PlacesActions(t,e){this.ngRedux=t,this.destinationActions=e}return PlacesActions.prototype.setPlace=function(t){this.ngRedux.dispatch({type:s.SET,payload:t}),this.destinationActions.setDestination({lat:t.geometry.coordinates[1],lng:t.geometry.coordinates[0]})},PlacesActions}();a.SET="PA/PLACES/SET",a=s=__decorate([r.Injectable(),__metadata("design:paramtypes",[i.NgRedux,o.DestinationActions])],a),e.PlacesActions=a;var s},667:function(t,e,n){"use strict";var r=n(0),i=n(21),o=n(33),a=s=function(){function ReportSpotStepActions(t){this.ngRedux=t}return ReportSpotStepActions.prototype.setStep=function(t){switch(t){case o.ReportSpotSteps.Details:this.setStepDetails();break;case o.ReportSpotSteps.Submitted:this.setStepSubmitted();break;default:throw"No step action found for: "+t}},ReportSpotStepActions.prototype.setStepDetails=function(){this.ngRedux.dispatch({type:s.SET_STEP_DETAILS})},ReportSpotStepActions.prototype.setStepSubmitted=function(){this.ngRedux.dispatch({type:s.SET_STEP_SUBMITTED})},ReportSpotStepActions}();a.SET_STEP_DETAILS="PA/REPORTSPOTSTEP/DETAILS",a.SET_STEP_SUBMITTED="PA/REPORTSPOTSTEP/SUBMITTED",a=s=__decorate([r.Injectable(),__metadata("design:paramtypes",[i.NgRedux])],a),e.ReportSpotStepActions=a;var s},668:function(t,e,n){"use strict";var r=n(0),i=n(21),o=n(80),a=s=function(){function SpotsActions(t,e){this.ngRedux=t,this.spotsService=e}return SpotsActions.prototype.getSpots=function(){var t=this;this.ngRedux.dispatch({type:s.GET_SPOTS}),this.spotsService.get().subscribe(function(e){t.updateSpots(e)})},SpotsActions.prototype.updateSpots=function(t){this.ngRedux.dispatch({type:s.UPDATE_SPOTS,payload:t})},SpotsActions.prototype.addSpot=function(t){this.ngRedux.dispatch({type:s.ADD_SPOT,payload:t})},SpotsActions.prototype.removeSpotByKey=function(t){this.ngRedux.dispatch({type:s.REMOVE_SPOT_BY_KEY,payload:t})},SpotsActions.prototype.updateSpot=function(t){this.ngRedux.dispatch({type:s.UPDATE_SPOT,payload:t})},SpotsActions}();a.GET_SPOTS="PA/SPOTS/GET/SPOTS",a.UPDATE_SPOTS="PA/SPOTS/UPDATE/SPOTS",a.ADD_SPOT="PA/SPOTS/ADD/SPOT",a.UPDATE_SPOT="PA/SPOTS/UPDATE/SPOT",a.REMOVE_SPOT_BY_KEY="PA/SPOTS/REMOVE/SPOT",a=s=__decorate([r.Injectable(),__metadata("design:paramtypes",[i.NgRedux,o.SpotsService])],a),e.SpotsActions=a;var s},669:function(t,e,n){"use strict";var r=n(0),i=n(21),o=a=function(){function SpotsListModeActions(t){this.ngRedux=t}return SpotsListModeActions.prototype.setModeOpen=function(){this.ngRedux.dispatch({type:a.SET_MODE_OPEN})},SpotsListModeActions.prototype.setModeClosed=function(){this.ngRedux.dispatch({type:a.SET_MODE_CLOSED})},SpotsListModeActions.prototype.setModeSetExpanded=function(){this.ngRedux.dispatch({type:a.SET_MODE_EXPANDED})},SpotsListModeActions}();o.SET_MODE_OPEN="PA/ADDSPOTMODE/OPEN",o.SET_MODE_CLOSED="PA/ADDSPOTMODE/CLOSED",o.SET_MODE_EXPANDED="PA/ADDSPOTMODE/EXPANDED",o=a=__decorate([r.Injectable(),__metadata("design:paramtypes",[i.NgRedux])],o),e.SpotsListModeActions=o;var a},670:function(t,e,n){"use strict";var r=n(0),i=n(21),o=a=function(){function TutorialActions(t){this.ngRedux=t}return TutorialActions.prototype.open=function(){this.ngRedux.dispatch({type:a.OPEN})},TutorialActions.prototype.close=function(){this.ngRedux.dispatch({type:a.CLOSE})},TutorialActions.prototype.setTab=function(t){this.ngRedux.dispatch({type:a.SET,payload:t})},TutorialActions}();o.OPEN="PA/TUTORIAL/OPEN",o.CLOSE="PA/TUTORIAL/CLOSE",o.SET="PA/TUTORIAL/SET",o=a=__decorate([r.Injectable(),__metadata("design:paramtypes",[i.NgRedux])],o),e.TutorialActions=o;var a},671:function(t,e,n){"use strict";var r=n(0),i=n(21),o=n(718);n(742);var a=function(){function AppComponent(t,e){this.ngRedux=t,this.devTools=e;var n=e.isEnabled()?o.enhancers.concat([e.enhancer()]):o.enhancers;t.configureStore(o.rootReducer,{},o.middleware,n)}return AppComponent}();a=__decorate([r.Component({selector:"pa-app",template:n(789),styles:[n(770)]}),__metadata("design:paramtypes",[i.NgRedux,i.DevToolsExtension])],a),e.AppComponent=a},672:function(t,e,n){"use strict";var r=n(185),i=n(435),o=[{path:"",component:i.HomeComponent},{path:"text",component:i.TextComponent},{path:"rulesinfo",component:i.RulesInfoComponent},{path:"rulesinfo/:id",component:i.RulesInfoComponent},{path:"**",component:i.HomeComponent}];e.routing=r.RouterModule.forRoot(o)},673:function(t,e,n){"use strict";var r=n(0),i=function(){function AddSpotButtonComponent(){this.open=new r.EventEmitter}return AddSpotButtonComponent.prototype.onOpen=function(){this.open.emit()},AddSpotButtonComponent}();__decorate([r.Output(),__metadata("design:type",Object)],i.prototype,"open",void 0),i=__decorate([r.Component({selector:"pa-add-spot-button",template:n(790),styles:[n(771)]})],i),e.AddSpotButtonComponent=i},674:function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}__export(n(673))},675:function(t,e,n){"use strict";var r=n(0),i=function(){function AddSpotDrawerComponent(){this.step=0,this.close=new r.EventEmitter,this.stepChange=new r.EventEmitter}return AddSpotDrawerComponent.prototype.onClose=function(){this.close.emit()},AddSpotDrawerComponent.prototype.onStepChange=function(t){t!==this.step&&this.stepChange.emit(t)},AddSpotDrawerComponent.prototype.onDone=function(t){console.log(t),this.close.emit()},AddSpotDrawerComponent.prototype.changeNumSpots=function(t){console.log(t)},AddSpotDrawerComponent.prototype.changeSpotType=function(t){console.log(t)},AddSpotDrawerComponent.prototype.onLocationSet=function(){console.log("LOCATION SET")},AddSpotDrawerComponent}();__decorate([r.Input(),__metadata("design:type",Boolean)],i.prototype,"opened",void 0),__decorate([r.Input(),__metadata("design:type",Object)],i.prototype,"step",void 0),__decorate([r.Output(),__metadata("design:type",Object)],i.prototype,"close",void 0),__decorate([r.Output(),__metadata("design:type",Object)],i.prototype,"stepChange",void 0),i=__decorate([r.Component({selector:"pa-add-spot-drawer",template:n(791)})],i),e.AddSpotDrawerComponent=i},676:function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}__export(n(675))},677:function(t,e,n){"use strict";var r=n(0),i=n(33),o=n(21),a=n(20),s=n(90),u=function(){function AddSpotComponent(t,e,n){this.ngRedux=t,this.appModeActions=e,this.addSpotStepActions=n,this.addSpotSteps=i.AddSpotSteps}return AddSpotComponent.prototype.ngOnInit=function(){var t=this;this.appMode$.subscribe(function(e){t.isAppMode=e===i.AppModes.AddSpot}),this.addSpotStep$.subscribe(function(e){t.addSpotStep=e})},AddSpotComponent.prototype.onOpenAddSpot=function(){this.appModeActions.setModeAddSpot()},AddSpotComponent.prototype.onCloseAddSpot=function(){this.appModeActions.unsetModeAddSpot()},AddSpotComponent.prototype.onAddSpotStepChange=function(t){this.addSpotStepActions.setStep(t)},AddSpotComponent}();__decorate([o.select(),__metadata("design:type",s.Observable)],u.prototype,"appMode$",void 0),__decorate([o.select(),__metadata("design:type",s.Observable)],u.prototype,"addSpotStep$",void 0),u=__decorate([r.Component({selector:"pa-add-spot",template:n(792),styles:[n(772)]}),__metadata("design:paramtypes",[o.NgRedux,a.AppModeActions,a.AddSpotStepActions])],u),e.AddSpotComponent=u},678:function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}__export(n(674)),__export(n(676)),__export(n(677))},679:function(t,e,n){"use strict";var r=n(0),i=n(432),o=function(){function DrawerComponent(){}return DrawerComponent.prototype.ngOnInit=function(){this.state="closed"},DrawerComponent.prototype.ngOnChanges=function(t){for(var e in t){if("open"!==e)throw"Uncaught change: "+e;var n=t[e].currentValue;this.state=n?"open":"closed"}},DrawerComponent}();__decorate([r.Input(),__metadata("design:type",Boolean)],o.prototype,"open",void 0),o=__decorate([r.Component({selector:"pa-drawer",template:n(793),styles:[n(773)],animations:i.default})],o),e.DrawerComponent=o},680:function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}__export(n(679))},681:function(t,e,n){"use strict";var r=n(0),i=n(89),o=n(27),a=n(20),s=function(){function HeaderComponent(t,e,n){this.mdIconRegistry=t,this.sanitizer=e,this.appModeActions=n,t.addSvgIcon("logo",e.bypassSecurityTrustResourceUrl("img/logo.svg"))}return HeaderComponent.prototype.onClickHome=function(){this.appModeActions.setModeHome()},HeaderComponent}();s=__decorate([r.Component({selector:"pa-header",template:n(794),styles:[n(774)]}),__metadata("design:paramtypes",[i.MdIconRegistry,o.DomSanitizer,a.AppModeActions])],s),e.HeaderComponent=s},682:function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}__export(n(681))},683:function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}__export(n(682)),__export(n(694)),__export(n(698)),__export(n(680)),__export(n(264)),__export(n(704)),__export(n(678)),__export(n(696)),__export(n(700))},684:function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}__export(n(685))},685:function(t,e,n){"use strict";var r=n(0),i=function(){function AddSpotOverlayComponent(){}return AddSpotOverlayComponent}();__decorate([r.Input(),__metadata("design:type",Boolean)],i.prototype,"open",void 0),i=__decorate([r.Component({selector:"pa-map-addspot-overlay",template:n(795),styles:[n(775)]})],i),e.AddSpotOverlayComponent=i},686:function(t,e,n){"use strict";var r=n(0),i=n(21),o=n(1),a=n(33),s=n(80),u=n(20),l=n(438),c=function(){function MapComponent(t,e){this.geoLocation=t,this.destinationActions=e,this.zoom=15,this.mode="street",this.center={lat:-71.06,lng:42.35}}return MapComponent.prototype.ngOnInit=function(){var t=this;this.supportsGL=l.supported(),this.destination$.subscribe(function(e){t.center=e,t.zoom=15}),this.spots$.subscribe(function(e){t.spots=e}),this.addSpotStep$.combineLatest(this.appMode$,function(t,e){return{addSpotStep:t,appMode:e}}).subscribe(function(e){var n=e.addSpotStep,r=e.appMode;t.showAddSpotOverlay=n===a.AddSpotSteps.Location&&r===a.AppModes.AddSpot})},MapComponent.prototype.zoomChange=function(t){this.zoom+=t},MapComponent.prototype.modeChange=function(t){this.mode=t},MapComponent.prototype.recenterChange=function(){var t=this;this.geoLocation.currentLocation().then(function(e){t.center=e,t.zoom=18,t.destinationActions.setDestination(e)}).catch(function(){console.log("Current Location Not found")})},MapComponent}();__decorate([i.select(),__metadata("design:type",o.Observable)],c.prototype,"destination$",void 0),__decorate([i.select(),__metadata("design:type",o.Observable)],c.prototype,"spots$",void 0),__decorate([i.select(),__metadata("design:type",o.Observable)],c.prototype,"addSpotStep$",void 0),__decorate([i.select(),__metadata("design:type",o.Observable)],c.prototype,"appMode$",void 0),c=__decorate([r.Component({selector:"pa-map",template:n(796),styles:[n(776)]}),__metadata("design:paramtypes",[s.GeolocationService,u.DestinationActions])],c),e.MapComponent=c},687:function(t,e,n){"use strict";var r=n(0),i=function(){function BaseMapComponent(){this.initialized=!1}return BaseMapComponent.prototype.ngAfterViewInit=function(){var t=this;this.initializeMap(function(e){t.initialized=e,t.setSpots(t.spots)})},BaseMapComponent.prototype.ngOnChanges=function(t){if(this.initialized)for(var e in t)if("zoom"===e)this.updateZoom(t[e].currentValue);else if("mode"===e)this.setMode(t[e].currentValue);else if("center"===e)this.setCenter(t[e].currentValue);else{if("spots"!==e)throw"Uncaught change: "+e;this.setSpots(t[e].currentValue)}},BaseMapComponent}();__decorate([r.Input(),__metadata("design:type",Number)],i.prototype,"zoom",void 0),__decorate([r.Input(),__metadata("design:type",String)],i.prototype,"mode",void 0),__decorate([r.Input(),__metadata("design:type",Object)],i.prototype,"center",void 0),__decorate([r.Input(),__metadata("design:type",Object)],i.prototype,"spots",void 0),i=__decorate([r.Component({}),__metadata("design:paramtypes",[])],i),e.BaseMapComponent=i},688:function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}__export(n(689))},689:function(t,e,n){"use strict";var r=n(0),i=function(){function MapControlsComponent(){this.zoomChange=new r.EventEmitter,this.modeChange=new r.EventEmitter,this.recenterChange=new r.EventEmitter}return MapControlsComponent.prototype.changeMode=function(t){this.modeChange.emit(t)},MapControlsComponent.prototype.changeZoom=function(t){this.zoomChange.emit(t)},MapControlsComponent.prototype.recenter=function(){this.recenterChange.emit()},MapControlsComponent}();__decorate([r.Output(),__metadata("design:type",Object)],i.prototype,"zoomChange",void 0),__decorate([r.Output(),__metadata("design:type",Object)],i.prototype,"modeChange",void 0),__decorate([r.Output(),__metadata("design:type",Object)],i.prototype,"recenterChange",void 0),i=__decorate([r.Component({selector:"pa-map-controls",template:n(797),styles:[n(777)]}),__metadata("design:paramtypes",[])],i),e.MapControlsComponent=i},690:function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}__export(n(691))},691:function(t,e,n){"use strict";var r=n(0),i=n(264),o=n(33),a=n(438),s=n(752),u=function(t){function MapGLComponent(){return t.call(this)||this}return __extends(MapGLComponent,t),MapGLComponent.prototype.initializeMap=function(t){a.accessToken=o.MapboxAccessTolken;var e=this.MapDiv.nativeElement,n=new a.Map({container:e,style:s,center:[-71.06,42.35],zoom:15});n.getCanvas().style.position="initial",n.on("load",function(){n.addLayer({id:"maine",type:"fill",source:{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-67.13734351262877,45.137451890638886],[-66.96466,44.8097],[-68.03252,44.3252],[-69.06,43.98],[-70.11617,43.68405],[-70.64573401557249,43.090083319667144],[-70.75102474636725,43.08003225358635],[-70.79761105007827,43.21973948828747],[-70.98176001655037,43.36789581966826],[-70.94416541205806,43.46633942318431],[-71.08482,45.3052400000002],[-70.6600225491012,45.46022288673396],[-70.30495378282376,45.914794623389355],[-70.00014034695016,46.69317088478567],[-69.23708614772835,47.44777598732787],[-68.90478084987546,47.184794623394396],[-68.23430497910454,47.35462921812177],[-67.79035274928509,47.066248887716995],[-67.79141211614706,45.702585354182816],[-67.13734351262877,45.137451890638886]]]}}},layout:{},paint:{"fill-color":"#088","fill-opacity":.8}});var e=document.createEvent("HTMLEvents");e.initEvent("resize",!0,!1),document.dispatchEvent(e),t(!0)}),this.map=n},MapGLComponent.prototype.updateZoom=function(t){this.map.zoomTo(t)},MapGLComponent.prototype.setMode=function(t){switch(t){case"satellite":this.map.setPaintProperty("satellite","raster-opacity",1);break;case"street":this.map.setPaintProperty("satellite","raster-opacity",0);break;default:this.map.setPaintProperty("satellite","raster-opacity",0)}},MapGLComponent.prototype.setCenter=function(t){this.map.flyTo({center:[t.lng,t.lat]})},MapGLComponent.prototype.setSpots=function(t){var e=o.convertToGeoJson(t);this.map.getSource("spots").setData(e)},MapGLComponent}(i.BaseMapComponent);__decorate([r.ViewChild("MapDiv"),__metadata("design:type",Object)],u.prototype,"MapDiv",void 0),u=__decorate([r.Component({selector:"pa-map-gl",template:n(798),styles:[n(778)]}),__metadata("design:paramtypes",[])],u),e.MapGLComponent=u},692:function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}__export(n(693))},693:function(t,e,n){"use strict";var r=n(0),i=n(264),o=function(t){function MapJSComponent(){var e=null!==t&&t.apply(this,arguments)||this;return e.markers=[],e}return __extends(MapJSComponent,t),MapJSComponent.prototype.initializeMap=function(){var t=this.googleMapsDiv.nativeElement;this.map=new window.google.maps.Map(t,{zoom:15,zoomControl:!1,mapTypeControl:!1,fullscreenControl:!1,rotateControl:!1,scaleControl:!1,streetViewControl:!1,tilt:0}),this.markerClusterer=new window.MarkerClusterer(this.map,this.markers),this.infoWindow=new window.google.maps.InfoWindow,this.infoWindowTemplate=function(t){return'<div><a md-raised-button color="primary" href="http://maps.google.com/maps?daddr='+t.$lat+","+t.$lng+'" target="_blank"> Navigate </a></div>'}},MapJSComponent.prototype.updateZoom=function(t){function smoothZoom(t,e,n){n!==e&&(window.google.maps.event.addListenerOnce(t,"zoom_changed",function(){smoothZoom(t,e,n+(e>n?1:-1))}),setTimeout(function(){t.setZoom(n)},80))}smoothZoom(this.map,this.map.getZoom()+t,this.map.getZoom())},MapJSComponent.prototype.setMode=function(t){this.map.setMapTypeId(t)},MapJSComponent.prototype.setCenter=function(t){this.map.setCenter(t)},MapJSComponent.prototype.setSpots=function(t){this.markers.forEach(function(e,n){var r=t.find(function(t){return t.key===e.$key});r?e.$lat===r.position.lat&&e.$lng===r.position.lng||(this.markerClusterer.removeMarker(e),e.setPosition({lat:r.position.lat,lng:r.position.lng}),e.$lat=r.position.lat,e.$lng=r.position.lng,this.markerClusterer.addMarker(e)):(this.markerClusterer.removeMarker(e),e.setMap(null),window.google.maps.event.clearInstanceListeners(e),this.markers.splice(n,1))},this),t.forEach(function(t){if(!this.markers.find(function(e){return e.$key===t.key})){var e=new window.google.maps.Marker({position:{lat:t.position.lat,lng:t.position.lng},map:this.map,label:{text:"1",fontSize:"16px",fontWeight:"bold",color:"#FFF"},icon:{path:"M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z",fillColor:"#009688",fillOpacity:.9,strokeColor:"#FFF",strokeWeight:1.5,scale:1,labelOrigin:new window.google.maps.Point(0,-29)},$key:t.key,$lat:t.position.lat,$lng:t.position.lng});e.addListener("click",function(){this.infoWindow.setContent(this.infoWindowTemplate(e)),this.infoWindow.open(this.map,e)}.bind(this)),this.markers.push(e),this.markerClusterer.addMarker(e)}},this)},MapJSComponent}(i.BaseMapComponent);__decorate([r.ViewChild("googleMapsDiv"),__metadata("design:type",Object)],o.prototype,"googleMapsDiv",void 0),o=__decorate([r.Component({selector:"pa-map-js",template:n(799),styles:[n(779)]})],o),e.MapJSComponent=o},694:function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}__export(n(695))},695:function(t,e,n){"use strict";var r=n(0),i=n(30),o=n(80),a=function(){function PlacesComponent(t){this.placesService=t,this.placeUpdate=new r.EventEmitter,this.placesControl=new i.FormControl}return PlacesComponent.prototype.ngOnInit=function(){var t=this;this.placesControl.valueChanges.subscribe(function(e){t.matchingPlaceCollection=t.placesService.getAutocomplete(e)})},PlacesComponent.prototype.selectOption=function(t){this.placeUpdate.emit(t)},PlacesComponent}();__decorate([r.Output(),__metadata("design:type",Object)],a.prototype,"placeUpdate",void 0),a=__decorate([r.Component({selector:"pa-places",template:n(800),styles:[n(780)]}),__metadata("design:paramtypes",[o.PlacesService])],a),e.PlacesComponent=a},696:function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}__export(n(697))},697:function(t,e,n){"use strict";var r=n(0),i=function(){function ReportSpotComponent(){this.close=new r.EventEmitter}return ReportSpotComponent.prototype.onClose=function(){this.close.emit()},ReportSpotComponent.prototype.ngOnChanges=function(t){for(var e in t)if("mode"===e){var n=t[e].previousValue,r=t[e].currentValue;this[n]="previous",this[r]="current"}},ReportSpotComponent.prototype.onStepChange=function(){console.log("StepChanged")},ReportSpotComponent}();__decorate([r.Input(),__metadata("design:type",Boolean)],i.prototype,"opened",void 0),__decorate([r.Output(),__metadata("design:type",Object)],i.prototype,"close",void 0),i=__decorate([r.Component({selector:"pa-report-spot",template:n(801),styles:[n(781)]})],i),e.ReportSpotComponent=i},698:function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}__export(n(699))},699:function(t,e,n){"use strict";var r=n(0),i=function(){function SpotsListComponent(){this.expanded=!1,this.hidden=!1}return Object.defineProperty(SpotsListComponent.prototype,"numSpot",{get:function(){return this.spots?this.spots.length:0},enumerable:!0,configurable:!0}),Object.defineProperty(SpotsListComponent.prototype,"enabled",{get:function(){return this.numSpot>0},enumerable:!0,configurable:!0}),SpotsListComponent.prototype.ngOnInit=function(){},SpotsListComponent.prototype.toggleExapand=function(){this.expanded=!this.expanded},SpotsListComponent.prototype.onReport=function(){this.expanded=!1},SpotsListComponent.prototype.onClickSpot=function(){},SpotsListComponent}();__decorate([r.Input(),__metadata("design:type",Array)],i.prototype,"spots",void 0),i=__decorate([r.Component({selector:"pa-spots-list",template:n(802),styles:[n(782)]}),__metadata("design:paramtypes",[])],i),e.SpotsListComponent=i},700:function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}__export(n(433)),__export(n(703))},701:function(t,e,n){"use strict";var r=n(0);Object.defineProperty(e,"__esModule",{value:!0}),e.default=[r.trigger("stepperSlide",[r.state("active",r.style({transform:"translate3d(0, 0, 0)"})),r.state("previous",r.style({opacity:0,display:"none",position:"absolute",bottom:0,left:0,transform:"translate3d(-100%, 0, 0)",height:"100px"})),r.state("next",r.style({opacity:0,display:"none",position:"absolute",bottom:0,left:0,transform:"translate3d(100%, 0, 0)",height:"100px"})),r.state("inactive",r.style({display:"none"})),r.transition("active => previous",r.animate("500ms ease-in-out")),r.transition("next => active",r.animate("500ms ease-in-out")),r.transition("active => next",r.animate("500ms ease-in-out")),r.transition("previous => active",r.animate("500ms ease-in-out"))])]},702:function(t,e,n){"use strict";var r=n(0),i=n(701),o=function(){function StepComponent(){this.state="inactive",this.nextCopy="Next",this.previousCopy="Back",this.next=new r.EventEmitter,this.previous=new r.EventEmitter}return StepComponent.prototype.onNext=function(){this.next.emit()},StepComponent.prototype.onPrevious=function(){this.previous.emit()},StepComponent}();__decorate([r.Input(),__metadata("design:type",Object)],o.prototype,"state",void 0),__decorate([r.Input(),__metadata("design:type",Object)],o.prototype,"nextCopy",void 0),__decorate([r.Input(),__metadata("design:type",Object)],o.prototype,"previousCopy",void 0),__decorate([r.Output(),__metadata("design:type",Object)],o.prototype,"next",void 0),__decorate([r.Output(),__metadata("design:type",Object)],o.prototype,"previous",void 0),o=__decorate([r.Component({selector:"pa-step",template:n(803),styles:[n(783)],animations:i.default})],o),e.StepComponent=o},703:function(t,e,n){"use strict";var r=n(0),i=n(433),o=function(){function StepperComponent(){this.currentStepIndex=0,this.cancel=new r.EventEmitter,this.done=new r.EventEmitter,this.stepChange=new r.EventEmitter}return StepperComponent.prototype.ngOnChanges=function(t){for(var e in t)"stepIndex"===e&&(this.currentStepIndex=t[e].currentValue,this.setStep())},StepperComponent.prototype.onNext=function(){var t=this.currentStepIndex+1;t<this.steps.length?(this.currentStepIndex=t,this.setStep()):(this.done.emit(),this.reset())},StepperComponent.prototype.onPrevious=function(){var t=this.currentStepIndex-1;t>-1?(this.currentStepIndex=t,this.setStep()):(console.log("cancel"),this.cancel.emit(),this.reset())},StepperComponent.prototype.reset=function(){this.currentStepIndex=0,this.setStep()},StepperComponent.prototype.ngAfterContentInit=function(){var t=this;this.steps.forEach(function(e){e.next.subscribe(function(){return t.onNext()}),e.previous.subscribe(function(){return t.onPrevious()})}),this.setStep()},StepperComponent.prototype.setStep=function(){if(this.steps){var t=this.steps.toArray()[this.currentStepIndex];if(t){t.state="active";var e=this.currentStepIndex+1;e<this.steps.length&&(this.steps.toArray()[e].state="next",e<this.steps.length-1&&(this.steps.toArray()[e+1].state="inactive"));var n=this.currentStepIndex-1;n>-1&&(this.steps.toArray()[n].state="previous",n>0&&(this.steps.toArray()[n-1].state="inactive")),this.stepChange.emit(this.currentStepIndex)}}},StepperComponent}();__decorate([r.ContentChildren(i.StepComponent),__metadata("design:type",r.QueryList)],o.prototype,"steps",void 0),__decorate([r.Input(),__metadata("design:type",Number)],o.prototype,"stepIndex",void 0),__decorate([r.Output(),__metadata("design:type",Object)],o.prototype,"cancel",void 0),__decorate([r.Output(),__metadata("design:type",Object)],o.prototype,"done",void 0),__decorate([r.Output(),__metadata("design:type",Object)],o.prototype,"stepChange",void 0),o=__decorate([r.Component({selector:"pa-stepper",template:n(804),styles:[n(784)]})],o),e.StepperComponent=o},704:function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}__export(n(706)),__export(n(434))},705:function(t,e,n){"use strict";var r=n(0),i=n(89),o=function(){function TutorialDialogComponent(t){this.dialogRef=t}return TutorialDialogComponent}();o=__decorate([r.Component({template:n(805),styles:[n(785)]}),__metadata("design:paramtypes",[i.MdDialogRef])],o),e.TutorialDialogComponent=o},706:function(t,e,n){"use strict";var r=n(0),i=n(21),o=n(89),a=n(434),s=n(90),u=n(20),l=function(){function TutorialComponent(t,e,n){this.dialog=t,this.tutorialActions=e,this.ngRedux=n}return TutorialComponent.prototype.ngOnInit=function(){var t=this;this.tutorial$.subscribe(function(e){e.open?t.openTutorial():t.dialog.closeAll()})},TutorialComponent.prototype.openTutorial=function(){var t=this,e=this.ngRedux.getState().tutorial,n={data:e.tutorial};this.dialogRef=this.dialog.open(a.TutorialDialogComponent,n),this.dialogRef.afterClosed().first().subscribe(function(){t.tutorialActions.close()})},TutorialComponent.prototype.onClickTutorial=function(){this.tutorialActions.open()},TutorialComponent}();__decorate([i.select(),__metadata("design:type",s.Observable)],l.prototype,"tutorial$",void 0),l=__decorate([r.Component({selector:"pa-tutorial",template:n(806)}),__metadata("design:paramtypes",[o.MdDialog,u.TutorialActions,i.NgRedux])],l),e.TutorialComponent=l},707:function(t,e,n){"use strict";var r=n(0),i=n(20),o=n(33),a=n(21),s=n(90),u=function(){function HomeComponent(t,e,n,r){this.placesActions=t,this.spotsActions=e,this.nearbySpotsActions=n,this.reportSpotStepActions=r,this.appModes=o.AppModes}return HomeComponent.prototype.ngOnInit=function(){var t=this;this.spotsActions.getSpots(),this.destination$.combineLatest(this.spots$,function(t,e){return{destination:t,spots:e}}).subscribe(function(e){var n=e.destination,r=e.spots;t.nearbySpotsActions.getNearbySpots(n,r)}),this.appMode$.subscribe(function(e){t.mode=e})},HomeComponent.prototype.onPlaceUpdate=function(t){this.placesActions.setPlace(t)},HomeComponent}();__decorate([a.select(),__metadata("design:type",s.Observable)],u.prototype,"destination$",void 0),__decorate([a.select(),__metadata("design:type",s.Observable)],u.prototype,"spots$",void 0),__decorate([a.select(),__metadata("design:type",s.Observable)],u.prototype,"nearbySpots$",void 0),__decorate([a.select(),__metadata("design:type",s.Observable)],u.prototype,"appMode$",void 0),__decorate([a.select(),__metadata("design:type",s.Observable)],u.prototype,"reportSpotStep$",void 0),u=__decorate([r.Component({selector:"pa-home",template:n(807),styles:[n(786)]}),__metadata("design:paramtypes",[i.PlacesActions,i.SpotsActions,i.NearbySpotsActions,i.ReportSpotStepActions])],u),e.HomeComponent=u},708:function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}__export(n(707))},709:function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}__export(n(710))},710:function(t,e,n){"use strict";var r=n(0),i=n(80),o=n(185),a=n(432),s=function(){function RulesInfoComponent(t,e){this.rulesInfoService=t,this.route=e,this.updateContent=function(){if(this.rules)if(this.rules[this.id])this.title=this.rules[this.id].title,this.content=this.rules[this.id].content,this.isHome=!1;else{this.title="Rules and Regulations",this.content=[],this.isHome=!0;for(var t=0;t<this.rules.length;t++){var e=this.rules[t].title,n=["/rulesinfo",{id:t}];this.content.push({text:e,href:n})}}},this.rules=t.rules,this.title="",this.content=[],this.isHome=!0,this.updateContent()}return RulesInfoComponent.prototype.ngOnInit=function(){var t=this;this.sub=this.route.params.subscribe(function(e){t.id=+e.id,t.updateContent()})},RulesInfoComponent.prototype.ngOnDestroy=function(){this.sub.unsubscribe()},RulesInfoComponent}();s=__decorate([r.Component({selector:"pa-rules-info",template:n(808),styles:[n(787)],animations:a.default}),__metadata("design:paramtypes",[i.RulesInfoService,o.ActivatedRoute])],s),e.RulesInfoComponent=s},711:function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}__export(n(712))},712:function(t,e,n){"use strict";var r=n(0),i=function(){function TextComponent(){}return TextComponent.prototype.ngOnInit=function(){console.log("Hello TextView")},TextComponent}();i=__decorate([r.Component({selector:"pa-text-view",template:n(809),styles:[n(788)]}),__metadata("design:paramtypes",[])],i),e.TextComponent=i},713:function(t,e,n){"use strict";var r=n(0),i=n(33),o=n(21),a=function(){function DistanceService(t){this.ngRedux=t}return DistanceService.prototype.filterByEuclideanDistance=function(t){return function(e,n){return n.filter(function(n){return i.distanceBetween(n.position,e)<t})}},DistanceService.prototype.getDistanceToDestinationFrom=function(t){console.log("TEST");var e=this.ngRedux.getState().destination;return console.log(e),this.getDistance(t,e)},DistanceService.prototype.getDistance=function(t,e){var n=t.map(function(t){return Object.assign({},t.position)});return new Promise(function(t,r){(new window.google.maps.DistanceMatrixService).getDistanceMatrix({origins:n,destinations:[e],travelMode:"WALKING",unitSystem:window.google.maps.UnitSystem.METRIC},function(e,n){"OK"!==n?(alert("Error was: "+n),r(n)):t(e.rows.map(function(t){var e=t.elements,n=e.map(function(t){return"OK"!==t.status?1/0:t.distance.value});return Math.min.apply(Math,n)}))})})},DistanceService}();a=__decorate([r.Injectable(),__metadata("design:paramtypes",[o.NgRedux])],a),e.DistanceService=a},714:function(t,e,n){"use strict";var r=n(0),i=function(){function GeolocationService(){}return GeolocationService.prototype.currentLocation=function(){return new Promise(function(t){window.navigator.geolocation.getCurrentPosition(function(e){t({lat:e.coords.latitude,lng:e.coords.longitude})},function(){console.log("Error: LocationService: currentLocation failed, defaulting to Boston"),t({lat:42.3601,lng:-71.0589})})})},GeolocationService}();i=__decorate([r.Injectable()],i),e.GeolocationService=i},715:function(t,e,n){"use strict";var r=n(0),i=n(33),o=n(88),a=n(90);r.Injectable();var s=function(){function PlacesService(t){this.http=t,this.mapboxAccessTolken=i.MapboxAccessTolken,this.mapboxPlacesAPIUrl="https://api.mapbox.com/geocoding/v5/mapbox.places/"}return PlacesService.prototype.getAutocomplete=function(t,e){var n=new o.URLSearchParams;return n.set("access_token",this.mapboxAccessTolken),n.set("types","address,poi,place"),n.set("autocomplete","true"),n.set("country","us"),e?n.set("proximity",e.lng+","+e.lat):n.set("proximity","-71.059096,42.350530"),this.http.get(this.mapboxPlacesAPIUrl+t+".json",{search:n}).map(this.extractData).catch(this.handleError)},PlacesService.prototype.extractData=function(t){var e=t.json();if(!e)return{};var n=[];return e.features.forEach(function(t){n.push({text:t.text,place_name:t.place_name,properties:t.properties,geometry:t.geometry})}),n},PlacesService.prototype.handleError=function(t){var e;if(t instanceof o.Response){var n=t.json()||"",r=n.error||JSON.stringify(n);e=t.status+" - "+(t.statusText||"")+" "+r}else e=t.message?t.message:t.toString();return console.error(e),a.Observable.throw(e)},PlacesService}();s=__decorate([__param(0,r.Inject(o.Http)),__metadata("design:paramtypes",[o.Http])],s),e.PlacesService=s},716:function(t,e,n){"use strict";var r=n(0),i=n(753),o=function(){function RulesInfoService(){this.rules=i.Boston}return RulesInfoService}();o=__decorate([r.Injectable(),__metadata("design:paramtypes",[])],o),e.RulesInfoService=o},717:function(t,e,n){"use strict";var r=n(0),i=n(186),o=(n(754),function(){function SpotsService(t){this.af=t,this.lastSpots=[],this.spots=t.database.list("spots")}return SpotsService.prototype.get=function(){return this.spots},SpotsService}());o=__decorate([r.Injectable(),__metadata("design:paramtypes",[i.AngularFire])],o),e.SpotsService=o},718:function(t,e,n){"use strict";var r=(n(813),n(729));e.rootReducer=r.rootReducer,e.middleware=[],e.enhancers=[]},719:function(t,e,n){"use strict";function addSpotStepReducer(t,e){switch(void 0===t&&(t=o),e.type){case r.AddSpotStepActions.SET_STEP_LOCATION:return i.AddSpotSteps.Location;case r.AddSpotStepActions.SET_STEP_DETAILS:return i.AddSpotSteps.Details;case r.AddSpotStepActions.SET_STEP_SUBMITTED:return i.AddSpotSteps.Submitted;default:return t}}var r=n(20),i=n(33),o=0;e.addSpotStepReducer=addSpotStepReducer},720:function(t,e,n){"use strict";function appModeReducer(t,e){switch(void 0===t&&(t=o),console.log(e.type),e.type){case r.AppModeActions.SET_MODE_HOME:return i.AppModes.Home;case r.AppModeActions.SET_MODE_ADDSPOT:return i.AppModes.AddSpot;default:return t}}var r=n(20),i=n(33),o=i.AppModes.Home;e.appModeReducer=appModeReducer},721:function(t,e,n){"use strict";function destinationReducer(t,e){switch(void 0===t&&(t=i),e.type){case r.DestinationActions.SET:return Object.assign({},t,e.payload);default:return t}}var r=n(20),i={lat:42.35053,lng:-71.059096};e.destinationReducer=destinationReducer},722:function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}__export(n(721)),__export(n(726)),__export(n(723)),__export(n(728)),__export(n(724)),__export(n(720)),__export(n(719)),__export(n(725)),__export(n(727))},723:function(t,e,n){"use strict";function nearbySpotsReducer(t,e){switch(void 0===t&&(t=i),e.type){case r.NearbySpotsActions.UPDATE:return e.payload.slice();default:return t}}var r=n(20),i=[];e.nearbySpotsReducer=nearbySpotsReducer},724:function(t,e,n){"use strict";function placesReducer(t,e){switch(void 0===t&&(t=i),e.type){case r.PlacesActions.SET:return e.payload;default:return t}}var r=n(20),i=null;e.placesReducer=placesReducer},725:function(t,e,n){"use strict";function reportSpotStepReducer(t,e){switch(void 0===t&&(t=o),e.type){case r.ReportSpotStepActions.SET_STEP_DETAILS:return i.ReportSpotSteps.Details;case r.ReportSpotStepActions.SET_STEP_SUBMITTED:return i.ReportSpotSteps.Submitted;default:return t}}var r=n(20),i=n(33),o=0;e.reportSpotStepReducer=reportSpotStepReducer},726:function(t,e,n){"use strict";function spotsReducer(t,e){switch(void 0===t&&(t=i),e.type){case r.SpotsActions.UPDATE_SPOTS:return e.payload.slice();case r.SpotsActions.ADD_SPOT:return t.concat([e.payload]);case r.SpotsActions.REMOVE_SPOT_BY_KEY:return t.filter(function(t){return t.key!==e.payload});case r.SpotsActions.UPDATE_SPOT:return t.map(function(t){return t.key===e.payload.key?Object.assign({},t,e.payload):t});default:return t}}var r=n(20),i=[];e.spotsReducer=spotsReducer},727:function(t,e,n){"use strict";function spotsListModeReducer(t,e){switch(void 0===t&&(t=i),e.type){case r.SpotsListModeActions.SET_MODE_OPEN:return"open";case r.SpotsListModeActions.SET_MODE_CLOSED:return"closed";case r.SpotsListModeActions.SET_MODE_EXPANDED:return"expanded";default:return t}}var r=n(20),i="closed";e.spotsListModeReducer=spotsListModeReducer},728:function(t,e,n){"use strict";function tutorialReducer(t,e){switch(void 0===t&&(t=i),e.type){case r.TutorialActions.OPEN:return Object.assign({},t,{open:!0});case r.TutorialActions.CLOSE:return Object.assign({},t,{open:!1});case r.TutorialActions.SET:return Object.assign({},t,{tutorial:e.payload});default:return t}}var r=n(20),i={open:!1,tutorial:"intro"};e.tutorialReducer=tutorialReducer},729:function(t,e,n){"use strict";var r=n(443),i=n(722);e.rootReducer=r.combineReducers({destination:i.destinationReducer,spots:i.spotsReducer,nearbySpots:i.nearbySpotsReducer,tutorial:i.tutorialReducer,place:i.placesReducer,appMode:i.appModeReducer,addSpotStep:i.addSpotStepReducer,reportSpotStep:i.reportSpotStepReducer,spotsListMode:i.spotsListModeReducer})},730:function(t,e,n){"use strict";!function(t){t[t.Home=0]="Home",t[t.AddSpot=1]="AddSpot",t[t.ReportSpot=2]="ReportSpot",t[t.SpotsList=3]="SpotsList"}(e.AppModes||(e.AppModes={}));!function(t){t[t.Location=0]="Location",t[t.Details=1]="Details",t[t.Submitted=2]="Submitted"}(e.AddSpotSteps||(e.AddSpotSteps={}));!function(t){t[t.Details=0]="Details",t[t.Submitted=1]="Submitted"}(e.ReportSpotSteps||(e.ReportSpotSteps={}))},731:function(t,e,n){"use strict";function convertToGeoJson(t){if(0===t.length)return{};var e={type:"FeatureCollection",features:[]};return t.forEach(function(t){e.features.push({type:"Feature",geometry:{type:"Point",coordinates:[t.position.lng,t.position.lat]},properties:{numspots:t.numspots,icon:"marker"}})}),e}function distanceBetween(t,e){if(!t||!e)return 0;var n=(e.lat-t.lat)*Math.PI/180,r=(e.lng-t.lng)*Math.PI/180,i=Math.sin(n/2)*Math.sin(n/2)+Math.cos(t.lat*Math.PI/180)*Math.cos(e.lat*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371}e.convertToGeoJson=convertToGeoJson,e.distanceBetween=distanceBetween},732:function(t,e,n){"use strict";e.MapboxAccessTolken="pk.eyJ1IjoiY2hyaXN0aWthZXMiLCJhIjoiY2l6M2htYjB4MDV0aTMycHhvamVzenJwNSJ9.XJpbIPXuOhlu7T9riCD77g"},734:function(t,e,n){"use strict";(function(t){function typedArraySupport(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(t,e){if(kMaxLength()<e)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e),t.__proto__=Buffer.prototype):(null===t&&(t=new Buffer(e)),t.length=e),t}function Buffer(t,e,n){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,t)}return from(this,t,e,n)}function from(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?fromArrayBuffer(t,e,n,r):"string"==typeof e?fromString(t,e,n):fromObject(t,e)}function assertSize(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function alloc(t,e,n,r){return assertSize(e),e<=0?createBuffer(t,e):void 0!==n?"string"==typeof r?createBuffer(t,e).fill(n,r):createBuffer(t,e).fill(n):createBuffer(t,e)}function allocUnsafe(t,e){if(assertSize(e),t=createBuffer(t,e<0?0:0|checked(e)),!Buffer.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function fromString(t,e,n){if("string"==typeof n&&""!==n||(n="utf8"),!Buffer.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|byteLength(e,n);t=createBuffer(t,r);var i=t.write(e,n);return i!==r&&(t=t.slice(0,i)),t}function fromArrayLike(t,e){var n=e.length<0?0:0|checked(e.length);t=createBuffer(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function fromArrayBuffer(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r),Buffer.TYPED_ARRAY_SUPPORT?(t=e,t.__proto__=Buffer.prototype):t=fromArrayLike(t,e),t}function fromObject(t,e){if(Buffer.isBuffer(e)){var n=0|checked(e.length);return t=createBuffer(t,n),0===t.length?t:(e.copy(t,0,0,n),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||isnan(e.length)?createBuffer(t,0):fromArrayLike(t,e);if("Buffer"===e.type&&o(e.data))return fromArrayLike(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(t){if(t>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|t}function SlowBuffer(t){return+t!=t&&(t=0),Buffer.alloc(+t)}function byteLength(t,e){if(Buffer.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return utf8ToBytes(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return base64ToBytes(t).length;default:if(r)return utf8ToBytes(t).length;e=(""+e).toLowerCase(),r=!0}}function slowToString(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if(n>>>=0,e>>>=0,n<=e)return"";for(t||(t="utf8");;)switch(t){case"hex":return hexSlice(this,e,n);case"utf8":case"utf-8":return utf8Slice(this,e,n);case"ascii":return asciiSlice(this,e,n);case"latin1":case"binary":return latin1Slice(this,e,n);case"base64":return base64Slice(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function swap(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function bidirectionalIndexOf(t,e,n,r,i){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof e&&(e=Buffer.from(e,r)),Buffer.isBuffer(e))return 0===e.length?-1:arrayIndexOf(t,e,n,r,i);if("number"==typeof e)return e&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):arrayIndexOf(t,[e],n,r,i);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(t,e,n,r,i){function read(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}var o=1,a=t.length,s=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;o=2,a/=2,s/=2,n/=2}var u;if(i){var l=-1;for(u=n;u<a;u++)if(read(t,u)===read(e,l===-1?0:u-l)){if(l===-1&&(l=u),u-l+1===s)return l*o}else l!==-1&&(u-=u-l),l=-1}else for(n+s>a&&(n=a-s),u=n;u>=0;u--){for(var c=!0,p=0;p<s;p++)if(read(t,u+p)!==read(e,p)){c=!1;break}if(c)return u}return-1}function hexWrite(t,e,n,r){n=Number(n)||0;var i=t.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(e.substr(2*a,2),16);if(isNaN(s))return a;t[n+a]=s}return a}function utf8Write(t,e,n,r){return blitBuffer(utf8ToBytes(e,t.length-n),t,n,r)}function asciiWrite(t,e,n,r){return blitBuffer(asciiToBytes(e),t,n,r)}function latin1Write(t,e,n,r){return asciiWrite(t,e,n,r)}function base64Write(t,e,n,r){return blitBuffer(base64ToBytes(e),t,n,r)}function ucs2Write(t,e,n,r){return blitBuffer(utf16leToBytes(e,t.length-n),t,n,r)}function base64Slice(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function utf8Slice(t,e,n){n=Math.min(t.length,n);for(var r=[],i=e;i<n;){var o=t[i],a=null,s=o>239?4:o>223?3:o>191?2:1;if(i+s<=n){var u,l,c,p;switch(s){case 1:o<128&&(a=o);break;case 2:u=t[i+1],128==(192&u)&&(p=(31&o)<<6|63&u)>127&&(a=p);break;case 3:u=t[i+1],l=t[i+2],128==(192&u)&&128==(192&l)&&(p=(15&o)<<12|(63&u)<<6|63&l)>2047&&(p<55296||p>57343)&&(a=p);break;case 4:u=t[i+1],l=t[i+2],c=t[i+3],128==(192&u)&&128==(192&l)&&128==(192&c)&&(p=(15&o)<<18|(63&u)<<12|(63&l)<<6|63&c)>65535&&p<1114112&&(a=p)}}null===a?(a=65533,s=1):a>65535&&(a-=65536,r.push(a>>>10&1023|55296),a=56320|1023&a),r.push(a),i+=s}return decodeCodePointsArray(r)}function decodeCodePointsArray(t){var e=t.length;if(e<=a)return String.fromCharCode.apply(String,t);for(var n="",r=0;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=a));return n}function asciiSlice(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function latin1Slice(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function hexSlice(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=e;o<n;++o)i+=toHex(t[o]);return i}function utf16leSlice(t,e,n){for(var r=t.slice(e,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function checkOffset(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function checkInt(t,e,n,r,i,o){if(!Buffer.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function objectWriteUInt16(t,e,n,r){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-n,2);i<o;++i)t[n+i]=(e&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function objectWriteUInt32(t,e,n,r){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-n,4);i<o;++i)t[n+i]=e>>>8*(r?i:3-i)&255}function checkIEEE754(t,e,n,r,i,o){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function writeFloat(t,e,n,r,o){return o||checkIEEE754(t,e,n,4,3.4028234663852886e38,-3.4028234663852886e38),i.write(t,e,n,r,23,4),n+4}function writeDouble(t,e,n,r,o){return o||checkIEEE754(t,e,n,8,1.7976931348623157e308,-1.7976931348623157e308),i.write(t,e,n,r,52,8),n+8}function base64clean(t){if(t=stringtrim(t).replace(s,""),t.length<2)return"";for(;t.length%4!=0;)t+="=";return t}function stringtrim(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function toHex(t){return t<16?"0"+t.toString(16):t.toString(16)}function utf8ToBytes(t,e){e=e||1/0;for(var n,r=t.length,i=null,o=[],a=0;a<r;++a){if((n=t.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(e-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function asciiToBytes(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}function utf16leToBytes(t,e){for(var n,r,i,o=[],a=0;a<t.length&&!((e-=2)<0);++a)n=t.charCodeAt(a),r=n>>8,i=n%256,o.push(i),o.push(r);return o}function base64ToBytes(t){return r.toByteArray(base64clean(t))}function blitBuffer(t,e,n,r){for(var i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}function isnan(t){return t!==t}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var r=n(735),i=n(749),o=n(751);e.Buffer=Buffer,e.SlowBuffer=SlowBuffer,e.INSPECT_MAX_BYTES=50,Buffer.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:typedArraySupport(),e.kMaxLength=kMaxLength(),Buffer.poolSize=8192,Buffer._augment=function(t){return t.__proto__=Buffer.prototype,t},Buffer.from=function(t,e,n){return from(null,t,e,n)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0})),Buffer.alloc=function(t,e,n){return alloc(null,t,e,n)},Buffer.allocUnsafe=function(t){return allocUnsafe(null,t)},Buffer.allocUnsafeSlow=function(t){return allocUnsafe(null,t)},Buffer.isBuffer=function(t){return!(null==t||!t._isBuffer)},Buffer.compare=function(t,e){if(!Buffer.isBuffer(t)||!Buffer.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,i=0,o=Math.min(n,r);i<o;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0},Buffer.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(t,e){if(!o(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return Buffer.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=Buffer.allocUnsafe(e),i=0;for(n=0;n<t.length;++n){var a=t[n];if(!Buffer.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,i),i+=a.length}return r},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)swap(this,e,e+1);return this},Buffer.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)swap(this,e,e+3),swap(this,e+1,e+2);return this},Buffer.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)swap(this,e,e+7),swap(this,e+1,e+6),swap(this,e+2,e+5),swap(this,e+3,e+4);return this},Buffer.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?utf8Slice(this,0,t):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(t){if(!Buffer.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===Buffer.compare(this,t)},Buffer.prototype.inspect=function(){var t="",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},Buffer.prototype.compare=function(t,e,n,r,i){if(!Buffer.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),e<0||n>t.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&e>=n)return 0;if(r>=i)return-1;if(e>=n)return 1;if(e>>>=0,n>>>=0,r>>>=0,i>>>=0,this===t)return 0;for(var o=i-r,a=n-e,s=Math.min(o,a),u=this.slice(r,i),l=t.slice(e,n),c=0;c<s;++c)if(u[c]!==l[c]){o=u[c],a=l[c];break}return o<a?-1:a<o?1:0},Buffer.prototype.includes=function(t,e,n){return this.indexOf(t,e,n)!==-1},Buffer.prototype.indexOf=function(t,e,n){return bidirectionalIndexOf(this,t,e,n,!0)},Buffer.prototype.lastIndexOf=function(t,e,n){return bidirectionalIndexOf(this,t,e,n,!1)},Buffer.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-e;if((void 0===n||n>i)&&(n=i),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return hexWrite(this,t,e,n);case"utf8":case"utf-8":return utf8Write(this,t,e,n);case"ascii":return asciiWrite(this,t,e,n);case"latin1":case"binary":return latin1Write(this,t,e,n);case"base64":return base64Write(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var a=4096;Buffer.prototype.slice=function(t,e){var n=this.length;t=~~t,e=void 0===e?n:~~e,t<0?(t+=n)<0&&(t=0):t>n&&(t=n),e<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t);var r;if(Buffer.TYPED_ARRAY_SUPPORT)r=this.subarray(t,e),r.__proto__=Buffer.prototype;else{var i=e-t;r=new Buffer(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+t]}return r},Buffer.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||checkOffset(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return r},Buffer.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||checkOffset(t,e,this.length);for(var r=this[t+--e],i=1;e>0&&(i*=256);)r+=this[t+--e]*i;return r},Buffer.prototype.readUInt8=function(t,e){return e||checkOffset(t,1,this.length),this[t]},Buffer.prototype.readUInt16LE=function(t,e){return e||checkOffset(t,2,this.length),this[t]|this[t+1]<<8},Buffer.prototype.readUInt16BE=function(t,e){return e||checkOffset(t,2,this.length),this[t]<<8|this[t+1]},Buffer.prototype.readUInt32LE=function(t,e){return e||checkOffset(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},Buffer.prototype.readUInt32BE=function(t,e){return e||checkOffset(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},Buffer.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||checkOffset(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*e)),r},Buffer.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||checkOffset(t,e,this.length);for(var r=e,i=1,o=this[t+--r];r>0&&(i*=256);)o+=this[t+--r]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*e)),o},Buffer.prototype.readInt8=function(t,e){return e||checkOffset(t,1,this.length),128&this[t]?(255-this[t]+1)*-1:this[t]},Buffer.prototype.readInt16LE=function(t,e){e||checkOffset(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},Buffer.prototype.readInt16BE=function(t,e){e||checkOffset(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},Buffer.prototype.readInt32LE=function(t,e){return e||checkOffset(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},Buffer.prototype.readInt32BE=function(t,e){return e||checkOffset(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},Buffer.prototype.readFloatLE=function(t,e){return e||checkOffset(t,4,this.length),i.read(this,t,!0,23,4)},Buffer.prototype.readFloatBE=function(t,e){return e||checkOffset(t,4,this.length),i.read(this,t,!1,23,4)},Buffer.prototype.readDoubleLE=function(t,e){return e||checkOffset(t,8,this.length),i.read(this,t,!0,52,8)},Buffer.prototype.readDoubleBE=function(t,e){return e||checkOffset(t,8,this.length),i.read(this,t,!1,52,8)},Buffer.prototype.writeUIntLE=function(t,e,n,r){if(t=+t,e|=0,n|=0,!r){checkInt(this,t,e,n,Math.pow(2,8*n)-1,0)}var i=1,o=0;for(this[e]=255&t;++o<n&&(i*=256);)this[e+o]=t/i&255;return e+n},Buffer.prototype.writeUIntBE=function(t,e,n,r){if(t=+t,e|=0,n|=0,!r){checkInt(this,t,e,n,Math.pow(2,8*n)-1,0)}var i=n-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+n},Buffer.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},Buffer.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):objectWriteUInt16(this,t,e,!0),e+2},Buffer.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):objectWriteUInt16(this,t,e,!1),e+2},Buffer.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):objectWriteUInt32(this,t,e,!0),e+4},Buffer.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):objectWriteUInt32(this,t,e,!1),e+4},Buffer.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);checkInt(this,t,e,n,i-1,-i)}var o=0,a=1,s=0;for(this[e]=255&t;++o<n&&(a*=256);)t<0&&0===s&&0!==this[e+o-1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+n},Buffer.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);checkInt(this,t,e,n,i-1,-i)}var o=n-1,a=1,s=0;for(this[e+o]=255&t;--o>=0&&(a*=256);)t<0&&0===s&&0!==this[e+o+1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+n},Buffer.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},Buffer.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):objectWriteUInt16(this,t,e,!0),e+2},Buffer.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):objectWriteUInt16(this,t,e,!1),e+2},Buffer.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):objectWriteUInt32(this,t,e,!0),e+4},Buffer.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):objectWriteUInt32(this,t,e,!1),e+4},Buffer.prototype.writeFloatLE=function(t,e,n){return writeFloat(this,t,e,!0,n)},Buffer.prototype.writeFloatBE=function(t,e,n){return writeFloat(this,t,e,!1,n)},Buffer.prototype.writeDoubleLE=function(t,e,n){return writeDouble(this,t,e,!0,n)},Buffer.prototype.writeDoubleBE=function(t,e,n){return writeDouble(this,t,e,!1,n)},Buffer.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var i,o=r-n;if(this===t&&n<e&&e<r)for(i=o-1;i>=0;--i)t[i+e]=this[i+n];else if(o<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},Buffer.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!Buffer.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0);var o;if("number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var a=Buffer.isBuffer(t)?t:utf8ToBytes(new Buffer(t,r).toString()),s=a.length;for(o=0;o<n-e;++o)this[o+e]=a[o%s]}return this};var s=/[^+\/0-9A-Za-z-_]/g}).call(e,n(13))},735:function(t,e,n){"use strict";function placeHoldersCount(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===t[e-2]?2:"="===t[e-1]?1:0}function byteLength(t){return 3*t.length/4-placeHoldersCount(t)}function toByteArray(t){var e,n,r,a,s,u,l=t.length;s=placeHoldersCount(t),u=new o(3*l/4-s),r=s>0?l-4:l;var c=0;for(e=0,n=0;e<r;e+=4,n+=3)a=i[t.charCodeAt(e)]<<18|i[t.charCodeAt(e+1)]<<12|i[t.charCodeAt(e+2)]<<6|i[t.charCodeAt(e+3)],u[c++]=a>>16&255,u[c++]=a>>8&255,u[c++]=255&a;return 2===s?(a=i[t.charCodeAt(e)]<<2|i[t.charCodeAt(e+1)]>>4,u[c++]=255&a):1===s&&(a=i[t.charCodeAt(e)]<<10|i[t.charCodeAt(e+1)]<<4|i[t.charCodeAt(e+2)]>>2,u[c++]=a>>8&255,u[c++]=255&a),u}function tripletToBase64(t){return r[t>>18&63]+r[t>>12&63]+r[t>>6&63]+r[63&t]}function encodeChunk(t,e,n){for(var r,i=[],o=e;o<n;o+=3)r=(t[o]<<16)+(t[o+1]<<8)+t[o+2],i.push(tripletToBase64(r));return i.join("")}function fromByteArray(t){for(var e,n=t.length,i=n%3,o="",a=[],s=16383,u=0,l=n-i;u<l;u+=s)a.push(encodeChunk(t,u,u+s>l?l:u+s));return 1===i?(e=t[n-1],o+=r[e>>2],o+=r[e<<4&63],o+="=="):2===i&&(e=(t[n-2]<<8)+t[n-1],o+=r[e>>10],o+=r[e>>4&63],o+=r[e<<2&63],o+="="),a.push(o),a.join("")}e.byteLength=byteLength,e.toByteArray=toByteArray,e.fromByteArray=fromByteArray;for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=a.length;s<u;++s)r[s]=a[s],i[a.charCodeAt(s)]=s;i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},740:function(t,e,n){(function(n){var r,i;!function(n,o){"use strict";r=[],void 0!==(i=function(){return o()}.apply(e,r))&&(t.exports=i)}(0,function(t){"use strict";function inherits(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}function Diff(t,e){Object.defineProperty(this,"kind",{value:t,enumerable:!0}),e&&e.length&&Object.defineProperty(this,"path",{value:e,enumerable:!0})}function DiffEdit(t,e,n){DiffEdit.super_.call(this,"E",t),Object.defineProperty(this,"lhs",{value:e,enumerable:!0}),Object.defineProperty(this,"rhs",{value:n,enumerable:!0})}function DiffNew(t,e){DiffNew.super_.call(this,"N",t),Object.defineProperty(this,"rhs",{value:e,enumerable:!0})}function DiffDeleted(t,e){DiffDeleted.super_.call(this,"D",t),Object.defineProperty(this,"lhs",{value:e,enumerable:!0})}function DiffArray(t,e,n){DiffArray.super_.call(this,"A",t),Object.defineProperty(this,"index",{value:e,enumerable:!0}),Object.defineProperty(this,"item",{value:n,enumerable:!0})}function arrayRemove(t,e,n){var r=t.slice((n||e)+1||t.length);return t.length=e<0?t.length+e:e,t.push.apply(t,r),t}function realTypeOf(t){var e=typeof t;return"object"!==e?e:t===Math?"math":null===t?"null":Array.isArray(t)?"array":"[object Date]"===Object.prototype.toString.call(t)?"date":void 0!==t.toString&&/^\/.*\//.test(t.toString())?"regexp":"object"}function deepDiff(e,n,r,i,o,a,s){o=o||[];var u=o.slice(0);if(void 0!==a){if(i){if("function"==typeof i&&i(u,a))return;if("object"==typeof i){if(i.prefilter&&i.prefilter(u,a))return;if(i.normalize){var l=i.normalize(u,a,e,n);l&&(e=l[0],n=l[1])}}}u.push(a)}"regexp"===realTypeOf(e)&&"regexp"===realTypeOf(n)&&(e=e.toString(),n=n.toString());var c=typeof e,p=typeof n;if("undefined"===c)"undefined"!==p&&r(new DiffNew(u,n));else if("undefined"===p)r(new DiffDeleted(u,e));else if(realTypeOf(e)!==realTypeOf(n))r(new DiffEdit(u,e,n));else if("[object Date]"===Object.prototype.toString.call(e)&&"[object Date]"===Object.prototype.toString.call(n)&&e-n!=0)r(new DiffEdit(u,e,n));else if("object"===c&&null!==e&&null!==n){if(s=s||[],s.indexOf(e)<0){if(s.push(e),Array.isArray(e)){var h;e.length;for(h=0;h<e.length;h++)h>=n.length?r(new DiffArray(u,h,new DiffDeleted(t,e[h]))):deepDiff(e[h],n[h],r,i,u,h,s);for(;h<n.length;)r(new DiffArray(u,h,new DiffNew(t,n[h++])))}else{var f=Object.keys(e),d=Object.keys(n);f.forEach(function(o,a){var l=d.indexOf(o);l>=0?(deepDiff(e[o],n[o],r,i,u,o,s),d=arrayRemove(d,l)):deepDiff(e[o],t,r,i,u,o,s)}),d.forEach(function(e){deepDiff(t,n[e],r,i,u,e,s)})}s.length=s.length-1}}else e!==n&&("number"===c&&isNaN(e)&&isNaN(n)||r(new DiffEdit(u,e,n)))}function accumulateDiff(e,n,r,i){return i=i||[],deepDiff(e,n,function(t){t&&i.push(t)},r),i.length?i:t}function applyArrayChange(t,e,n){if(n.path&&n.path.length){var r,i=t[e],o=n.path.length-1;for(r=0;r<o;r++)i=i[n.path[r]];switch(n.kind){case"A":applyArrayChange(i[n.path[r]],n.index,n.item);break;case"D":delete i[n.path[r]];break;case"E":case"N":i[n.path[r]]=n.rhs}}else switch(n.kind){case"A":applyArrayChange(t[e],n.index,n.item);break;case"D":t=arrayRemove(t,e);break;case"E":case"N":t[e]=n.rhs}return t}function applyChange(t,e,n){if(t&&e&&n&&n.kind){for(var r=t,i=-1,o=n.path?n.path.length-1:0;++i<o;)void 0===r[n.path[i]]&&(r[n.path[i]]="number"==typeof n.path[i]?[]:{}),r=r[n.path[i]];switch(n.kind){case"A":applyArrayChange(n.path?r[n.path[i]]:r,n.index,n.item);break;case"D":delete r[n.path[i]];break;case"E":case"N":r[n.path[i]]=n.rhs}}}function revertArrayChange(t,e,n){if(n.path&&n.path.length){var r,i=t[e],o=n.path.length-1;for(r=0;r<o;r++)i=i[n.path[r]];switch(n.kind){case"A":revertArrayChange(i[n.path[r]],n.index,n.item);break;case"D":i[n.path[r]]=n.lhs;break;case"E":i[n.path[r]]=n.lhs;break;case"N":delete i[n.path[r]]}}else switch(n.kind){case"A":revertArrayChange(t[e],n.index,n.item);break;case"D":t[e]=n.lhs;break;case"E":t[e]=n.lhs;break;case"N":t=arrayRemove(t,e)}return t}function revertChange(t,e,n){if(t&&e&&n&&n.kind){var r,i,o=t;for(i=n.path.length-1,r=0;r<i;r++)void 0===o[n.path[r]]&&(o[n.path[r]]={}),o=o[n.path[r]];switch(n.kind){case"A":revertArrayChange(o[n.path[r]],n.index,n.item);break;case"D":o[n.path[r]]=n.lhs;break;case"E":o[n.path[r]]=n.lhs;break;case"N":delete o[n.path[r]]}}}function applyDiff(t,e,n){if(t&&e){deepDiff(t,e,function(r){n&&!n(t,e,r)||applyChange(t,e,r)})}}var e,r,i=[];return e="object"==typeof n&&n?n:"undefined"!=typeof window?window:{},r=e.DeepDiff,r&&i.push(function(){void 0!==r&&e.DeepDiff===accumulateDiff&&(e.DeepDiff=r,r=t)}),inherits(DiffEdit,Diff),inherits(DiffNew,Diff),inherits(DiffDeleted,Diff),inherits(DiffArray,Diff),Object.defineProperties(accumulateDiff,{diff:{value:accumulateDiff,enumerable:!0},observableDiff:{value:deepDiff,enumerable:!0},applyDiff:{value:applyDiff,enumerable:!0},applyChange:{value:applyChange,enumerable:!0},revertChange:{value:revertChange,enumerable:!0},isConflict:{value:function(){return void 0!==r},enumerable:!0},noConflict:{value:function(){return i&&(i.forEach(function(t){t()}),i=null),accumulateDiff},enumerable:!0}}),accumulateDiff})}).call(e,n(13))},742:function(t,e){},749:function(t,e){e.read=function(t,e,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,l=u>>1,c=-7,p=n?i-1:0,h=n?-1:1,f=t[e+p];for(p+=h,o=f&(1<<-c)-1,f>>=-c,c+=s;c>0;o=256*o+t[e+p],p+=h,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=r;c>0;a=256*a+t[e+p],p+=h,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,r),o-=l}return(f?-1:1)*a*Math.pow(2,o-r)},e.write=function(t,e,n,r,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,p=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,d=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),e+=a+p>=1?h/u:h*Math.pow(2,1-p),e*u>=2&&(a++,u/=2),a+p>=c?(s=0,a=c):a+p>=1?(s=(e*u-1)*Math.pow(2,i),a+=p):(s=e*Math.pow(2,p-1)*Math.pow(2,i),a=0));i>=8;t[n+f]=255&s,f+=d,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;t[n+f]=255&a,f+=d,a/=256,l-=8);t[n+f-d]|=128*m}},751:function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},752:function(t,e){t.exports={version:8,name:"Basic-copy",metadata:{"mapbox:autocomposite":!0,"mapbox:type":"template"},center:[-71.05701444377173,42.35115277896384],zoom:16.367235566772464,bearing:0,pitch:0,sources:{composite:{url:"mapbox://mapbox.mapbox-streets-v7",type:"vector"},"mapbox://mapbox.satellite":{url:"mapbox://mapbox.satellite",type:"raster",tileSize:256},spots:{type:"geojson",data:{type:"FeatureCollection",features:[]},cluster:!0,clusterMaxZoom:14,clusterRadius:50}},sprite:"mapbox://sprites/christikaes/cizd08d1500bm2spm00cftt8r",glyphs:"mapbox://fonts/christikaes/{fontstack}/{range}.pbf",layers:[{id:"background",type:"background",paint:{"background-color":"#dedede"}},{id:"landuse_overlay_national_park",type:"fill",source:"composite","source-layer":"landuse_overlay",filter:["==","class","national_park"],paint:{"fill-color":"#d2edae","fill-opacity":.75}},{id:"landuse_park",type:"fill",source:"composite","source-layer":"landuse",filter:["==","class","park"],paint:{"fill-color":"#d2edae"}},{id:"waterway",type:"line",source:"composite","source-layer":"waterway",filter:["all",["==","$type","LineString"],["in","class","canal","river"]],paint:{"line-color":"#a0cfdf","line-width":{base:1.4,stops:[[8,.5],[20,15]]}}},{id:"water",type:"fill",source:"composite","source-layer":"water",paint:{"fill-color":"#a0cfdf"}},{id:"building",type:"fill",source:"composite","source-layer":"building",paint:{"fill-color":"#d6d6d6"}},{id:"satellite",type:"raster",metadata:{},source:"mapbox://mapbox.satellite",layout:{visibility:"visible"},paint:{"raster-opacity":0}},{id:"road_minor",type:"line",source:"composite","source-layer":"road",filter:["all",["==","$type","LineString"],["all",["in","class","link","motorway_link","path","pedestrian","service","street","street_limited","track"],["in","structure","ford","none"]]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"hsla(0, 0%, 94%, 0.81)","line-width":{base:1.55,stops:[[4,.25],[20,30]]},"line-opacity":1}},{id:"road_major",type:"line",source:"composite","source-layer":"road",filter:["all",["==","$type","LineString"],["all",["in","class","motorway","primary","secondary","tertiary","trunk"],["in","structure","ford","none"]]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"hsla(0, 0%, 100%, 0.78)","line-width":{base:1.4,stops:[[8,.5],[19,30]]},"line-opacity":1}},{id:"bridge_minor case",type:"line",source:"composite","source-layer":"road",filter:["all",["==","$type","LineString"],["all",["==","structure","bridge"],["in","class","link","motorway_link","path","pedestrian","service","street","street_limited","track"]]],layout:{"line-cap":"butt","line-join":"miter"},paint:{"line-color":"#dedede","line-width":{base:1.6,stops:[[12,.5],[20,10]]},"line-gap-width":{base:1.55,stops:[[4,.25],[20,30]]}}},{id:"bridge_major case",type:"line",source:"composite","source-layer":"road",filter:["all",["==","$type","LineString"],["all",["==","structure","bridge"],["in","class","motorway","primary","secondary","tertiary","trunk"]]],layout:{"line-cap":"butt","line-join":"miter"},paint:{"line-color":"#dedede","line-width":{base:1.6,stops:[[12,.5],[20,10]]},"line-gap-width":{base:1.55,stops:[[4,.25],[20,30]]}}},{id:"bridge_minor",type:"line",source:"composite","source-layer":"road",filter:["all",["==","$type","LineString"],["all",["==","structure","bridge"],["in","class","link","motorway_link","path","pedestrian","service","street","street_limited","track"]]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#efefef","line-width":{base:1.55,stops:[[4,.25],[20,30]]}}},{id:"bridge_major",type:"line",source:"composite","source-layer":"road",filter:["all",["==","$type","LineString"],["all",["==","structure","bridge"],["in","class","motorway","primary","secondary","tertiary","trunk"]]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fff","line-width":{base:1.4,stops:[[6,.5],[20,30]]}}},{id:"admin_country",type:"line",source:"composite","source-layer":"admin",filter:["all",["==","$type","LineString"],["all",["<=","admin_level",2],["==","maritime",0]]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#8b8a8a","line-width":{base:1.3,stops:[[3,.5],[22,15]]}}},{id:"poi_label",type:"symbol",source:"composite","source-layer":"poi_label",minzoom:5,filter:["all",["==","$type","Point"],["all",["==","localrank",1],["==","scalerank",1]]],layout:{"icon-image":"{maki}-11","text-offset":[0,.5],"text-field":"{name_en}","text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-max-width":8,"text-anchor":"top","text-size":11,"icon-size":1},paint:{"text-color":"#666","text-halo-width":1,"text-halo-color":"rgba(255,255,255,0.75)","text-halo-blur":1}},{id:"road_major_label",type:"symbol",source:"composite","source-layer":"road_label",filter:["all",["==","$type","LineString"],["in","class","motorway","primary","secondary","tertiary","trunk"]],layout:{"symbol-placement":"line","text-field":"{name_en}","text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-transform":"uppercase","text-letter-spacing":.1,"text-size":{base:1.4,stops:[[10,8],[17,14]]}},paint:{"text-color":"hsl(0, 1%, 24%)","text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":2}},{id:"place_label_other",type:"symbol",source:"composite","source-layer":"place_label",minzoom:8,filter:["all",["==","$type","Point"],["in","type","hamlet","island","neighbourhood","suburb","town","village"]],layout:{"text-field":"{name_en}","text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-max-width":6,"text-size":{stops:[[6,12],[12,16]]}},paint:{"text-color":"hsl(0, 0%, 25%)","text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":4,"text-halo-blur":1}},{id:"place_label_city",type:"symbol",source:"composite","source-layer":"place_label",maxzoom:16,filter:["all",["==","$type","Point"],["==","type","city"]],layout:{"text-field":"{name_en}","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-max-width":14,"text-size":{stops:[[3,12],[16,27]]},"text-line-height":14},paint:{"text-color":"hsl(0, 0%, 24%)","text-halo-color":"rgba(255,255,255,0.75)","text-halo-width":2,"text-halo-blur":1}},{id:"country_label",type:"symbol",source:"composite","source-layer":"country_label",maxzoom:12,filter:["==","$type","Point"],layout:{"text-field":"{name_en}","text-font":["Open Sans Regular","Arial Unicode MS Regular"],"text-max-width":10,"text-size":{stops:[[3,14],[8,22]]}},paint:{"text-color":"hsl(0, 0%, 25%)","text-halo-color":"rgba(255,255,255,0.75)","text-halo-width":1,"text-halo-blur":1}},{id:"poi-label",type:"symbol",source:"composite","source-layer":"poi_label",filter:["in","$type","LineString","Point","Polygon"],layout:{"text-size":10,"icon-image":"circle-11","text-transform":"uppercase",visibility:"visible","text-offset":[0,.6],"icon-size":.5,"text-anchor":"top","text-field":"{name}","text-letter-spacing":0},paint:{"text-color":"hsl(0, 0%, 26%)","text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":2}},{id:"unclustered-points",type:"symbol",source:"spots",filter:["!has","point_count"],layout:{"icon-image":"{icon}-15","icon-allow-overlap":!0,"text-field":"{numspots}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":12}},{id:"cluster-0",type:"circle",source:"spots",paint:{"circle-color":"#51bbd6","circle-radius":18},filter:[">=","point_count",0]},{id:"cluster-1",type:"circle",source:"spots",paint:{"circle-color":"#f1f075","circle-radius":18},filter:["all",[">=","point_count",10],["<","point_count",0]]},{id:"cluster-2",type:"circle",source:"spots",paint:{"circle-color":"#f28cb1","circle-radius":18},filter:["all",[">=","point_count",20],["<","point_count",10]]},{id:"cluster-count",type:"symbol",source:"spots",layout:{"text-field":"{point_count}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":12}}],created:"2017-02-19T18:26:25.920Z",id:"cizd08d1500bm2spm00cftt8r",modified:"2017-02-19T18:26:25.920Z",owner:"christikaes",visibility:"private",draft:!1}},753:function(t,e){t.exports={Boston:[{title:"Where can I park with a disabled placard?",content:[{text:"Any parking space designated as a disabled parking spot. In Boston, this is always represented by  a blue disabled parking sign (see “Sign” section for details). Other parking ordinances may be in  effect, so obey all designated parking rules. Some spots are only in effect for a part of the day (for  example, 8am-8pm, and require a special resident permit thereafter). Other spots may require a  resident parking pass, so please pay attention and obey all designated parking rules as stated on  the sign."},{text:"Massachusetts law also allows vehicles with proper Disabled Parking authority to disregard public  meter fees. Currently, you can park for free without a time limit at any metered spot in the City of  Boston. Of note, Massachusetts Port Authority does not exempt meter fees for Disabled Parking."}]},{title:"Where am I NOT allowed to park?",content:[{text:"Do not park in a cross-hatch area (Zebra Stripe) adjacent to a HP space. This area is reserved for  van ramp access."},{text:"Disabled parking signs that say “ramp” underneath (see “sign” section). This sign denotes a ramp  so that individuals that have difficulty mounting a curve may move freely from street to sidewalk. You  should not park in front of this space."},{text:"If you do not have the appropriate residential sticker or are outside of the time window that is  detailed on the disabled parking sign."}]},{title:"I am traveling from out of state. Can I park in a disabled parking spot?",content:[{text:"Yes. The state of Massachusetts recognizes HP passes from all states."},{text:"Similarly, all U.S. States and Canada recognize the Massachusetts Disabled Placard as an authorized document for HP parking. However, New York City does not recognize Disabled Placards issued by any other authority other than the City of New York."}]},{title:"How can I apply for a HP sign in front of my house?",content:[{text:"The Registry of Motor Vehicles does not designate HP parking spaces. You must inquire with your local City or Town office. Many cities have Disability Commissions which can assist you with this."}]},{title:"New/Pending",content:[{text:"The City is currently considering enforcing the 2-hour limit on metered parking sports even with a disabled parking placard. No official changes have been made. If and when rule changes occur, we will keep you aware of them on this page."}]},{title:"Signs",content:[{img:"img/signs/1.jpg",text:"Appropriate disabled parking sport designation"},{img:"img/signs/2.jpg",text:"Designates “ramp” only. Do not park here"},{img:"img/signs/3.png",text:"Unfortunately, individuals may hang private signs on the street to try to designate disabled parking  spots for private use; however, these are not spots designated by the city and you should not park at  spots"}]}]}},754:function(t,e){t.exports={spots:[{lat:42.3605884,lng:-71.0566478,$key:0},{lat:42.3597105,lng:-71.0529804,$key:1},{lat:42.358866,lng:-71.0530764,$key:2},{lat:42.3621599,lng:-71.0609191,$key:3},{lat:42.362289,lng:-71.0607594,$key:4},{lat:42.3614474,lng:-71.0605307,$key:5},{lat:42.3587902,lng:-71.061605,$key:6},{lat:42.3590545,lng:-71.0628802,$key:7},{lat:42.3590336,lng:-71.0628288,$key:8},{lat:42.3590456,lng:-71.062739,$key:9},{lat:42.2999349,lng:-71.0722702,$key:10},{lat:42.3604596,lng:-71.065081,$key:11},{lat:42.360917,lng:-71.0652568,$key:12},{lat:42.3595269,lng:-71.0653017,$key:13},{lat:42.3585008,lng:-71.0645667,$key:14},{lat:42.3594206,lng:-71.063973,$key:15},{lat:42.3599005,lng:-71.1194061,$key:16},{lat:42.3620373,lng:-71.0635527,$key:17},{lat:42.3644379,lng:-71.063972,$key:18},{lat:42.3639065,lng:-71.0625429,$key:19},{lat:42.3639688,lng:-71.0621671,$key:20},{lat:42.3642348,lng:-71.0603951,$key:21},{lat:42.3634469,lng:-71.0594548,$key:22},{lat:42.3804097,lng:-71.0606693,$key:23},{lat:42.3584392,lng:-71.0572881,$key:24},{lat:42.3576883,lng:-71.0568698,$key:25},{lat:42.3557565,lng:-71.0580338,$key:26},{lat:42.3553195,lng:-71.0584263,$key:27},{lat:42.3560286,lng:-71.0540513,$key:28},{lat:42.357281,lng:-71.059575,$key:29},{lat:42.3650128,lng:-71.0534021,$key:30},{lat:42.3649048,lng:-71.0533043,$key:31},{lat:42.3668374,lng:-71.0527874,$key:32},{lat:42.3667707,lng:-71.0526204,$key:33},{lat:42.3619877,lng:-71.0528514,$key:34},{lat:42.3623309,lng:-71.0516395,$key:35},{lat:42.3630802,lng:-71.0518589,$key:36},{lat:42.3660619,lng:-71.050973,$key:37},{lat:42.3661621,lng:-71.0513005,$key:38},{lat:42.3667785,lng:-71.0521156,$key:39},{lat:42.3676835,lng:-71.0534823,$key:40},{lat:42.3682843,lng:-71.0561109,$key:41},{lat:42.366843,lng:-71.053588,$key:42},{lat:42.36712,lng:-71.054198,$key:43},{lat:42.36726,lng:-71.054511,$key:44},{lat:42.3672465,lng:-71.0546981,$key:45},{lat:42.366389,lng:-71.052565,$key:46},{lat:42.366245,lng:-71.0525357,$key:47},{lat:42.3662128,lng:-71.0523245,$key:48},{lat:42.3634196,lng:-71.0532428,$key:49},{lat:42.3637823,lng:-71.0520096,$key:50}]}},755:function(t,e,n){"use strict";function baseGetTag(t){return null==t?void 0===t?s:a:u&&u in Object(t)?n.i(i.a)(t):n.i(o.a)(t)}var r=n(436),i=n(758),o=n(759),a="[object Null]",s="[object Undefined]",u=r.a?r.a.toStringTag:void 0;e.a=baseGetTag},756:function(t,e,n){"use strict";(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.a=n}).call(e,n(13))},757:function(t,e,n){"use strict";var r=n(760),i=n.i(r.a)(Object.getPrototypeOf,Object);e.a=i},758:function(t,e,n){"use strict";function getRawTag(t){var e=o.call(t,s),n=t[s];try{t[s]=void 0;var r=!0}catch(t){}var i=a.call(t);return r&&(e?t[s]=n:delete t[s]),i}var r=n(436),i=Object.prototype,o=i.hasOwnProperty,a=i.toString,s=r.a?r.a.toStringTag:void 0;e.a=getRawTag},759:function(t,e,n){"use strict";function objectToString(t){return i.call(t)}var r=Object.prototype,i=r.toString;e.a=objectToString},760:function(t,e,n){"use strict";function overArg(t,e){return function(n){return t(e(n))}}e.a=overArg},761:function(t,e,n){"use strict";var r=n(756),i="object"==typeof self&&self&&self.Object===Object&&self,o=r.a||i||Function("return this")();e.a=o},762:function(t,e,n){"use strict";function isObjectLike(t){return null!=t&&"object"==typeof t}e.a=isObjectLike},764:function(t,e,n){"use strict";function select(t,e){return function(n,i){function getter(){return r.NgRedux.instance.select(o,e)}var o=t;t||(o=i.lastIndexOf("$")===i.length-1?i.substring(0,i.length-1):i),delete n[i]&&Object.defineProperty(n,i,{get:getter,enumerable:!0,configurable:!0})}}var r=n(170);e.select=select},765:function(t,e,n){"use strict";function _ngReduxFactory(t){return new i.NgRedux(t)}var r=n(0),i=n(170),o=n(439);e._ngReduxFactory=_ngReduxFactory;var a=function(){function NgReduxModule(){}return NgReduxModule.decorators=[{type:r.NgModule,args:[{providers:[o.DevToolsExtension,{provide:i.NgRedux,useFactory:_ngReduxFactory,deps:[r.NgZone]}]}]}],NgReduxModule.ctorParameters=function(){return[]},NgReduxModule}();e.NgReduxModule=a},766:function(t,e,n){"use strict";function getIn(t,e){if(!t)return t;if("function"==typeof t.getIn)return t.getIn(e);var n=e[0],r=e.slice(1);if(void 0!==t[n])return 0===r.length?t[n]:getIn(t[n],r)}e.getIn=getIn},767:function(t,e,n){"use strict";function invariant(t,e,n){if(!t){var r=e;throw n&&(r=e.indexOf("%s")!==-1?e.replace("%s",n):r=e+": "+n),new Error(r)}}e.invariant=invariant},768:function(t,e,n){"use strict";function omit(t,e){var n=Object.assign({},t);return e.forEach(function(t){return delete n[t]}),n}e.omit=omit},769:function(t,e,n){"use strict";function isFunction(t){return!!(t&&t.constructor&&t.call&&t.apply)}function isObject(t){return!(!t||"object"!=typeof t||isFunction(t))}function isPlainObject(t){return isObject(t)&&t.constructor===Object}e.isFunction=isFunction,e.isObject=isObject,e.isPlainObject=isPlainObject},770:function(t,e){t.exports=":host {\n  display: block;\n  height: 100%;\n  width: 100%; }\n\nmain {\n  font-family: Arial, Helvetica, sans-serif;\n  text-align: center;\n  display: block;\n  height: 100%;\n  width: 100%; }\n\nfooter {\n  text-align: center;\n  font-size: 0.8em; }\n"},771:function(t,e){t.exports=".add-spot {\n  position: absolute;\n  bottom: 40px;\n  left: 20px; }\n"},772:function(t,e){t.exports=""},773:function(t,e){t.exports=""},774:function(t,e){t.exports="md-toolbar {\n  position: absolute;\n  z-index: 1;\n  font-size: 30px; }\n\nmd-button {\n  min-width: 40px; }\n\nspan {\n  margin-left: 15px; }\n\n.fill-remaining-space {\n  -ms-flex: 1 1 auto;\n      flex: 1 1 auto; }\n\n.logo {\n  width: 60px;\n  height: 60px;\n  color: #FFFFFF; }\n\n.park {\n  margin: 0; }\n\n.abler {\n  margin: 0;\n  color: #FFFFFF; }\n\n@media screen and (max-width: 400px) {\n  .park {\n    display: none; }\n  .abler {\n    display: none; } }\n"},775:function(t,e){t.exports=":host {\n  position: absolute;\n  height: 100%;\n  width: 100%;\n  left: 0;\n  top: 0;\n  pointer-events: none; }\n\n.overlay {\n  height: 100%;\n  width: 100%;\n  background-color: rgba(255, 255, 255, 0.5);\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-pack: center;\n      justify-content: center;\n  -ms-flex-align: center;\n      align-items: center; }\n"},776:function(t,e){t.exports=""},777:function(t,e){t.exports=".map-view {\n  position: absolute;\n  bottom: 40px;\n  right: 20px;\n  background-color: white; }\n\n.zoom {\n  position: absolute;\n  bottom: 90px;\n  right: 20px;\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-direction: column;\n      flex-direction: column; }\n  .zoom button {\n    border-radius: 0px; }\n\n.recenter {\n  position: absolute;\n  bottom: 180px;\n  right: 20px; }\n"},778:function(t,e){t.exports=".map {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%; }\n\n.marker {\n  background-color: blue;\n  height: 50px;\n  width: 50px; }\n"},779:function(t,e){t.exports=".map {\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  top: 0;\n  left: 0; }\n"},780:function(t,e){t.exports=":host {\n  color: black;\n  position: absolute;\n  z-index: 1;\n  top: 60px;\n  left: 0;\n  right: 0;\n  padding: 20px 10px;\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-pack: center;\n      justify-content: center; }\n  :host .places-search {\n    font-size: 18px;\n    font-family: Roboto;\n    font-weight: 300;\n    display: inline-block;\n    vertical-align: middle;\n    border: none;\n    height: 40px;\n    width: 75%;\n    max-width: 700px;\n    text-overflow: ellipsis;\n    background-color: white; }\n  :host .search {\n    height: 40px;\n    display: inline-block;\n    border-radius: 3px; }\n  :host .clear {\n    height: 40px;\n    background-color: white;\n    display: inline-block;\n    border-radius: 3px; }\n"},781:function(t,e){t.exports=".add-spot {\n  position: absolute;\n  bottom: 40px;\n  left: 20px; }\n"},782:function(t,e){t.exports=".container {\n  bottom: 0px;\n  left: 0px;\n  width: 100%;\n  z-index: 1001; }\n\n.header {\n  width: 100%;\n  background-color: white; }\n\n.content {\n  max-height: 200px;\n  overflow-y: scroll;\n  background-color: white; }\n\nmd-list-item {\n  text-align: left; }\n  md-list-item .large-text {\n    font-size: 18px;\n    line-height: 40px;\n    font-weight: bold; }\n  md-list-item .right {\n    margin-right: 20px;\n    float: right; }\n    md-list-item .right img {\n      margin-right: 10px; }\n  md-list-item a {\n    font-weight: bold;\n    color: #3F51B5; }\n  md-list-item .divider {\n    margin-top: 15px;\n    width: 100%;\n    height: 1px;\n    background-color: grey; }\n"},783:function(t,e){t.exports=".container {\n  padding: 10px;\n  position: relative; }\n  .container .content {\n    padding-bottom: 30px; }\n  .container .next {\n    position: absolute;\n    right: 10px;\n    bottom: 10px; }\n  .container .previous {\n    position: absolute;\n    left: 10px;\n    bottom: 10px; }\n"},784:function(t,e){t.exports=".container {\n  overflow-x: hidden;\n  position: relative; }\n"},785:function(t,e){t.exports=".tab-content {\n  text-align: center; }\n"},786:function(t,e){t.exports=".content {\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-direction: column;\n      flex-direction: column;\n  height: 100%;\n  width: 100%; }\n\n.map-container {\n  -ms-flex: 1 1 auto;\n      flex: 1 1 auto;\n  position: relative; }\n"},787:function(t,e){t.exports=".content {\n  text-align: left; }\n\n.content .line {\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-direction: row;\n      flex-direction: row;\n  -ms-flex-align: center;\n      align-items: center;\n  padding: 20px; }\n  .content .line img {\n    margin: 10px;\n    height: 100px;\n    width: 60px; }\n\n.separated {\n  border-bottom: 1px solid #ccc; }\n\n.fill-remaining-space {\n  -ms-flex: 1 1 auto;\n      flex: 1 1 auto; }\n"},788:function(t,e){t.exports="* {\n  color: #f87c08; }\n"},789:function(t,e){t.exports="<main>\n  <router-outlet></router-outlet>\n</main>\n"},790:function(t,e){t.exports='<button md-raised-button color="primary" (click)="onOpen()" class="add-spot">\n    ADD SPOT\n</button>'},791:function(t,e){t.exports='<pa-drawer [open]="opened">\n    <pa-stepper (close)="onClose()" (done)="onDone($event)" (stepChange)="onStepChange($event)" [stepIndex]="step">\n        <!-- location -->\n        <pa-step [previousCopy]="\'Cancel\'" [nextCopy]="\'Next\'" (next)="onLocationSet()">\n            Drag the map to place the marker over where the spot is located\n        </pa-step>\n        <!-- details -->\n        <pa-step [previousCopy]="\'Back\'" [nextCopy]="\'Submit\'">\n            <h2>How many spaces are there?</h2>\n            <md-button-toggle-group name="spaces-buttons" (change)="changeNumSpots($event.value)">\n                <md-button-toggle value="1" checked=true>1</md-button-toggle>\n                <md-button-toggle value="2">2</md-button-toggle>\n                <md-button-toggle value="3">3</md-button-toggle>\n                <md-button-toggle value="4">4</md-button-toggle>\n                <md-button-toggle value="Many">Many</md-button-toggle>\n            </md-button-toggle-group>\n            <h2>What type of space is this?</h2>\n            <md-button-toggle-group name="spaces-buttons" (change)="changeSpotType($event.value)">\n                <md-button-toggle value="regular">Regular</md-button-toggle>\n                <md-button-toggle value="accessible">Accessible</md-button-toggle>\n            </md-button-toggle-group>\n            <input mdInput aria-label="description" placeholder="Description">\n        </pa-step>\n        <!-- submitted -->\n        <pa-step [previousCopy]="\'\'" [nextCopy]="\'OK\'">\n           Thank you for your help! The details have been submitted, we will review the submission and add it to the map accordingly.\n        </pa-step>\n    </pa-stepper>\n</pa-drawer>'},792:function(t,e){t.exports='<pa-add-spot-button (open)="onOpenAddSpot()"></pa-add-spot-button>\n\n<pa-add-spot-drawer [opened]="isAppMode" [step]="addSpotStep" (close)="onCloseAddSpot()" (stepChange)="onAddSpotStepChange($event)"></pa-add-spot-drawer>\n'},793:function(t,e){t.exports='<div [@slideUp]="state">\n    <ng-content></ng-content>\n</div>'},794:function(t,e){t.exports='<md-toolbar color="primary">\n   <button md-button>\n    TEXT MODE\n   </button> \n\n  <span class="fill-remaining-space"></span>\n  <md-icon svgIcon="logo" class="logo" (click)="onClickHome()"></md-icon>\n  <span class="park" (click)="onClickHome()">park</span><span class="abler" (click)="onClickHome()">abler</span>\n  <span class="fill-remaining-space"></span>\n\n  <button md-button [mdMenuTriggerFor]="menu">\n    HELP\n  </button>\n  <md-menu #menu="mdMenu">\n    <button md-menu-item [routerLink]="\'/rulesinfo\'">\n      <md-icon>information</md-icon>\n      <span>Parking Rules</span>\n    </button>\n    <pa-tutorial></pa-tutorial>\n  </md-menu>\n</md-toolbar>\n'},795:function(t,e){t.exports="<div class='overlay' *ngIf=\"open\">\n    <md-icon>add_location</md-icon>\n</div>"},796:function(t,e){t.exports='<pa-map-gl *ngIf="supportsGL" [zoom]="zoom" [mode]="mode" [center]="center" [spots]="spots"></pa-map-gl>\n<!--<pa-map-js *ngIf="!supportsGL" [zoom]="zoom" [mode]="mode" [center]="center" [spots]="spots"></pa-map-js>-->\n<pa-map-controls (zoomChange)="zoomChange($event)" (modeChange)="modeChange($event)" (recenterChange)="recenterChange($event)"></pa-map-controls>\n\n<pa-map-addspot-overlay [open]="showAddSpotOverlay"></pa-map-addspot-overlay>'},797:function(t,e){t.exports='<div class="container">\n  <md-button-toggle-group name="spaces-buttons" class="map-view" color="secondary" (change)="changeMode($event.value)">\n    <md-button-toggle value="street" checked=true>Street</md-button-toggle>\n    <md-button-toggle value="satellite">Satellite</md-button-toggle>\n  </md-button-toggle-group>\n  <div class="zoom">\n    <button md-mini-fab (click)="changeZoom(1)"><md-icon>add</md-icon></button>\n    <button md-mini-fab (click)="changeZoom(-1)"><md-icon>remove</md-icon></button>\n  </div>\n  <button md-mini-fab class="recenter" (click)="recenter()"><md-icon>gps_fixed</md-icon></button>\n</div>\n'},798:function(t,e){t.exports='<div #MapDiv class="map"></div>\n'},799:function(t,e){t.exports='<div #googleMapsDiv class="map"></div>\n'},80:function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}__export(n(714)),__export(n(717)),__export(n(713)),__export(n(716)),__export(n(715))},800:function(t,e){t.exports='<button md-mini-fab color="secondary" class="clear" disabled>\n  <md-icon>clear</md-icon>\n</button>\n\n<md-input-container class="places-search">\n  <input mdInput placeholder="Find parking near..." [mdAutocomplete]="auto" [formControl]="placesControl">\n</md-input-container>\n\n<md-autocomplete #auto="mdAutocomplete" class="autocomplete">\n  <md-option *ngFor="let place of matchingPlaceCollection | async" [value]="place.text" (click)="selectOption(place)">\n    {{ place.place_name }}\n  </md-option>\n</md-autocomplete>\n\n<button md-mini-fab color="primary" class="search" (click)="search()">\n  <md-icon>search</md-icon>\n</button>'},801:function(t,e){t.exports='<pa-drawer [open]="opened">\n    <pa-stepper (close)="onClose()" (done)="onClose()" (stepChange)="onStepChange()">\n        <!-- details -->\n        <pa-step [previousCopy]="\'Cancel\'" [nextCopy]="\'Submit\'">\n            <h2>How many spaces are there?</h2>\n            <md-button-toggle-group name="spaces-buttons" (change)="changeNumSpots($event.value)">\n                <md-button-toggle value="None" checked=true>None</md-button-toggle>\n                    <md-button-toggle value="1">1</md-button-toggle>\n                    <md-button-toggle value="2">2</md-button-toggle>\n                    <md-button-toggle value="3">3</md-button-toggle>\n                    <md-button-toggle value="Many">Many</md-button-toggle>\n            </md-button-toggle-group>\n            <h2>What type of space is this?</h2>\n            <md-button-toggle-group name="spaces-buttons" (change)="changeSpotType($event.value)">\n                <md-button-toggle value="regular">Regular</md-button-toggle>\n                <md-button-toggle value="accessible">Accessible</md-button-toggle>\n            </md-button-toggle-group>\n            <input mdInput aria-label="description" placeholder="Description">\n        </pa-step>\n        <!-- submitted -->\n        <pa-step [previousCopy]="\'\'" [nextCopy]="\'OK\'">\n            Thank you for your help! The details have been submitted, we will review the submission and add it to the map accordingly.\n        </pa-step>\n    </pa-stepper>\n</pa-drawer>'},802:function(t,e){t.exports='<div class="container" *ngIf="enabled && !hidden" [ngClass]="{ expanded: expanded }">\n  <button md-button class="header" (click)="toggleExapand()">\n    {{numSpot}} spots near destination\n  </button>\n\n  <md-nav-list class="content" *ngIf="expanded">\n    <md-list-item *ngFor="let spot of spots" class="list-item" (click)="onClickSpot(spot)">\n      <div md-line>\n        <span class="large-text">1 Space</span>\n        <a class="right" href="http://maps.google.com/maps?daddr={{spot.position.lat}},{{spot.position.lng}}" target="_blank">\n          <img md-list-avatar src="img/icons/ic_directions.svg" alt="directions">\n        </a>\n      </div>\n      <div md-line>\n        <span> within {{spot.distanceToDest}} meters </span>\n        <a (click)="onReport()">\n          Report\n        </a>\n        <a class="right" href="http://maps.google.com/maps?daddr={{spot.position.lat}},{{spot.position.lng}}" target="_blank">\n          Directions\n        </a>\n      </div>\n      <div md-line class="divider"></div>\n    </md-list-item>\n  </md-nav-list>\n</div>\n'},803:function(t,e){t.exports="<div class='container' [@stepperSlide]='state'>\n    <div class='content'>\n        <ng-content></ng-content>\n    </div>\n    <button md-button color=\"primary\" (click)=\"onPrevious()\" class='previous'> {{previousCopy}} </button>\n    <button md-raised-button color=\"primary\" (click)=\"onNext()\" class='next'> {{nextCopy}} </button>\n</div>\n"},804:function(t,e){t.exports='<div class="container">\n    <ng-content></ng-content>\n</div>'},805:function(t,e){t.exports='<md-tab-group [dynamicHeight] = true>\n  <md-tab label="Welcome" class="tab-content">\n    <h1>Welcome to parkabler!</h1>\n    <p>\n      You can use this app to find and navigate to handicapped accessible parking spots.\n    </p>\n    <p>\n      You can also add new spots that we don\'t know about yet and report spaces with incorrect information.\n    </p>\n    <p>\n      Let\'s get started!\n    </p>\n  </md-tab>\n  <md-tab label="Setting Destination" class="tab-content">\n    <h1>Setting Destination</h1>\n    <p>\n      You can search for any location that you want to go to from the search bar.\n    </p>\n    <p>\n      You can also find parking near you by selecting \'Near Me\'.\n    </p>\n  </md-tab>\n  <md-tab label="Navigating" class="tab-content">\n    <h1>Navigating</h1>\n    <p>\n      Once you know where you want to go, just tap \'directions\' and get going with your favorite navigation app.\n    </p>\n    <p>\n      If you find that this spot data is innacurate, please hit \'report\' so that we can correct the information.\n    </p>\n    <p>\n      Thank you for your help!\n    </p>\n  </md-tab>\n  <md-tab label="Adding Spots" class="tab-content">\n    <h1>Adding Spots</h1>\n    <p>\n      We rely on your help to keep our data up to date! If you see a spot that\'s not on our map, please share it by clicking \'Add Spot\'.\n    </p>\n    <p>\n      Drag the map around so that the pin is centered over the location of the parking spot, and add details.\n    </p>\n    <p>\n      Thank you for your help!\n    </p>\n  </md-tab>\n</md-tab-group>\n<md-dialog-actions>\n  <button md-dialog-close md-raised-button color="secondary">close</button>\n  <button md-dialog-close md-raised-button color="primary">next</button>\n</md-dialog-actions>'},806:function(t,e){t.exports='<button md-menu-item (click)="onClickTutorial()">\n    <md-icon>school</md-icon>\n    <span>Tutorial</span>\n</button>'},807:function(t,e){t.exports='<pa-header></pa-header>\n<div class="content">\n  <div class="map-container">\n    <pa-map></pa-map>\n    <pa-places (placeUpdate)="onPlaceUpdate($event)"></pa-places>\n  </div>\n  <div>\n  <pa-add-spot></pa-add-spot>\n  <!--<pa-report-spot [opened]="mode==appModes.ReportSpot" (close)="onCloseReportSpot()" (open)="onOpenReportSpot()"></pa-add-spot>-->\n  <pa-spots-list [spots]="nearbySpots$ | async"></pa-spots-list>\n  </div>\n</div>\n'},808:function(t,e){t.exports='<div @slideLeft>\n  <md-toolbar color="primary">\n    <button md-button *ngIf=\'isHome\' [routerLink]="\'\'">< Map</button>\n    <button md-button *ngIf=\'!isHome\' [routerLink]="\'/rulesinfo\'">< Back</button>\n    <span>{{title}}</span>\n  </md-toolbar>\n\n  <!-- Show a nav list for nav pages (home page) -->\n  <md-nav-list *ngIf=\'isHome\' class="content" @slideRight>\n    <a md-list-item *ngFor="let item of content" [routerLink]="item.href">\n      {{item.text}}\n      <!-- TODO Chevron_right not showing up on phone -->\n      <span class="fill-remaining-space"></span>\n      <md-icon>chevron_right</md-icon>\n    </a>\n  </md-nav-list>\n\n  <!-- Show content for regular content -->\n  <div *ngIf=\'!isHome\' class="content" @slideLeft>\n    <div *ngFor="let item of content" class="line" [ngClass]="{separated: !!item.img}">\n      <img *ngIf=\'!!item.img\' src="{{item.img}}"/>\n      <div>{{item.text}}</div>\n    </div>\n  </div>\n</div>\n'},809:function(t,e){t.exports="<p>\n  Text View!!\n</p>\n"},810:function(t,e,n){"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function getLogLevel(t,e,n,i){switch(void 0===t?"undefined":r(t)){case"object":return"function"==typeof t[i]?t[i].apply(t,_toConsumableArray(n)):t[i];case"function":return t(e);default:return t}}function defaultTitleFormatter(t){var e=t.timestamp,n=t.duration;return function(t,r,i){var o=["action"];return e&&o.push("@ "+r),o.push(String(t.type)),n&&o.push("(in "+i.toFixed(2)+" ms)"),o.join(" ")}}function printBuffer(t,e){var n=e.logger,r=e.actionTransformer,o=e.titleFormatter,s=void 0===o?defaultTitleFormatter(e):o,u=e.collapsed,l=e.colors,c=e.level,p=e.diff;t.forEach(function(e,o){var h=e.started,f=e.startedTime,d=e.action,m=e.prevState,y=e.error,g=e.took,v=e.nextState,_=t[o+1];_&&(v=_.prevState,g=_.started-h);var x=r(d),b="function"==typeof u?u(function(){return v},d,e):u,w=(0,i.formatTime)(f),S=l.title?"color: "+l.title(x)+";":null,T=s(x,w,g);try{b?l.title?n.groupCollapsed("%c "+T,S):n.groupCollapsed(T):l.title?n.group("%c "+T,S):n.group(T)}catch(t){n.log(T)}var E=getLogLevel(c,x,[m],"prevState"),A=getLogLevel(c,x,[x],"action"),P=getLogLevel(c,x,[y,m],"error"),C=getLogLevel(c,x,[v],"nextState");E&&(l.prevState?n[E]("%c prev state","color: "+l.prevState(m)+"; font-weight: bold",m):n[E]("prev state",m)),A&&(l.action?n[A]("%c action","color: "+l.action(x)+"; font-weight: bold",x):n[A]("action",x)),y&&P&&(l.error?n[P]("%c error","color: "+l.error(y,m)+"; font-weight: bold",y):n[P]("error",y)),C&&(l.nextState?n[C]("%c next state","color: "+l.nextState(v)+"; font-weight: bold",v):n[C]("next state",v)),p&&(0,a.default)(m,v,n,b);try{n.groupEnd()}catch(t){n.log("—— log end ——")}})}Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.printBuffer=printBuffer;var i=n(440),o=n(812),a=_interopRequireDefault(o)},811:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={level:"log",logger:console,logErrors:!0,collapsed:void 0,predicate:void 0,duration:!1,timestamp:!0,stateTransformer:function(t){return t},actionTransformer:function(t){return t},errorTransformer:function(t){return t},colors:{title:function(){return"inherit"},prevState:function(){return"#9E9E9E"},action:function(){return"#03A9F4"},nextState:function(){return"#4CAF50"},error:function(){return"#F20404"}},diff:!1,diffPredicate:void 0,transformer:void 0},t.exports=e.default},812:function(t,e,n){"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function style(t){return"color: "+o[t].color+"; font-weight: bold"}function render(t){var e=t.kind,n=t.path,r=t.lhs,i=t.rhs,o=t.index,a=t.item;switch(e){case"E":return[n.join("."),r,"→",i];case"N":return[n.join("."),i];case"D":return[n.join(".")];case"A":return[n.join(".")+"["+o+"]",a];default:return[]}}function diffLogger(t,e,n,r){var a=(0,i.default)(t,e);try{r?n.groupCollapsed("diff"):n.group("diff")}catch(t){n.log("diff")}a?a.forEach(function(t){var e=t.kind,r=render(t);n.log.apply(n,["%c "+o[e].text,style(e)].concat(_toConsumableArray(r)))}):n.log("—— no diff ——");try{n.groupEnd()}catch(t){n.log("—— diff end —— ")}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=diffLogger;var r=n(740),i=_interopRequireDefault(r),o={E:{color:"#2196F3",text:"CHANGED:"},N:{color:"#4CAF50",text:"ADDED:"},D:{color:"#F44336",text:"DELETED:"},A:{color:"#2196F3",text:"ARRAY:"}};t.exports=e.default},813:function(t,e,n){"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function createLogger(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=r({},s.default,t),n=e.logger,a=e.transformer,u=e.stateTransformer,l=e.errorTransformer,c=e.predicate,p=e.logErrors,h=e.diffPredicate;if(void 0===n)return function(){return function(t){return function(e){return t(e)}}};if(a&&console.error("Option 'transformer' is deprecated, use 'stateTransformer' instead!"),t.getState&&t.dispatch)return console.error("redux-logger not installed. Make sure to pass logger instance as middleware:\n\nimport createLogger from 'redux-logger';\n\nconst logger = createLogger();\nconst store = createStore(\n  reducer,\n  applyMiddleware(logger)\n);"),function(){return function(t){return function(e){return t(e)}}};var f=[];return function(t){var n=t.getState;return function(t){return function(a){if("function"==typeof c&&!c(n,a))return t(a);var s={};f.push(s),s.started=o.timer.now(),s.startedTime=new Date,s.prevState=u(n()),s.action=a;var d=void 0;if(p)try{d=t(a)}catch(t){s.error=l(t)}else d=t(a);s.took=o.timer.now()-s.started,s.nextState=u(n());var m=e.diff&&"function"==typeof h?h(n,a):e.diff;if((0,i.printBuffer)(f,r({},e,{diff:m})),f.length=0,s.error)throw s.error;return d}}}}Object.defineProperty(e,"__esModule",{value:!0});var r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},i=n(810),o=n(440),a=n(811),s=_interopRequireDefault(a);e.default=createLogger,t.exports=e.default},814:function(t,e,n){"use strict";function applyMiddleware(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return function(n,o,a){var s=t(n,o,a),u=s.dispatch,l=[],c={getState:s.getState,dispatch:function(t){return u(t)}};return l=e.map(function(t){return t(c)}),u=r.a.apply(void 0,l)(s.dispatch),i({},s,{dispatch:u})}}}var r=n(441);e.a=applyMiddleware;var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}},815:function(t,e,n){"use strict";function bindActionCreator(t,e){return function(){return e(t.apply(void 0,arguments))}}function bindActionCreators(t,e){if("function"==typeof t)return bindActionCreator(t,e);if("object"!=typeof t||null===t)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===t?"null":typeof t)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');for(var n=Object.keys(t),r={},i=0;i<n.length;i++){var o=n[i],a=t[o];"function"==typeof a&&(r[o]=bindActionCreator(a,e))}return r}e.a=bindActionCreators},816:function(t,e,n){"use strict";function getUndefinedStateErrorMessage(t,e){var n=e&&e.type;return"Given action "+(n&&'"'+n.toString()+'"'||"an action")+', reducer "'+t+'" returned undefined. To ignore an action, you must explicitly return the previous state.'}function getUnexpectedStateShapeWarningMessage(t,e,o,a){var s=Object.keys(e),u=o&&o.type===r.b.INIT?"preloadedState argument passed to createStore":"previous state received by the reducer";if(0===s.length)return"Store does not have a valid reducer. Make sure the argument passed to combineReducers is an object whose values are reducers.";if(!n.i(i.a)(t))return"The "+u+' has unexpected type of "'+{}.toString.call(t).match(/\s([a-z|A-Z]+)/)[1]+'". Expected argument to be an object with the following keys: "'+s.join('", "')+'"';var l=Object.keys(t).filter(function(t){return!e.hasOwnProperty(t)&&!a[t]});return l.forEach(function(t){a[t]=!0}),l.length>0?"Unexpected "+(l.length>1?"keys":"key")+' "'+l.join('", "')+'" found in '+u+'. Expected to find one of the known reducer keys instead: "'+s.join('", "')+'". Unexpected keys will be ignored.':void 0}function assertReducerSanity(t){Object.keys(t).forEach(function(e){var n=t[e];if(void 0===n(void 0,{type:r.b.INIT}))throw new Error('Reducer "'+e+'" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined.');if(void 0===n(void 0,{type:"@@redux/PROBE_UNKNOWN_ACTION_"+Math.random().toString(36).substring(7).split("").join(".")}))throw new Error('Reducer "'+e+"\" returned undefined when probed with a random type. Don't try to handle "+r.b.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined.')})}function combineReducers(t){for(var e=Object.keys(t),r={},i=0;i<e.length;i++){var a=e[i];"production"!==n.i({ENV:"build"}).NODE_ENV&&void 0===t[a]&&n.i(o.a)('No reducer provided for key "'+a+'"'),"function"==typeof t[a]&&(r[a]=t[a])}var s=Object.keys(r);if("production"!==n.i({ENV:"build"}).NODE_ENV)var u={};var l;try{assertReducerSanity(r)}catch(t){l=t}return function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=arguments[1];if(l)throw l;if("production"!==n.i({ENV:"build"}).NODE_ENV){var i=getUnexpectedStateShapeWarningMessage(t,r,e,u);i&&n.i(o.a)(i)}for(var a=!1,c={},p=0;p<s.length;p++){var h=s[p],f=r[h],d=t[h],m=f(d,e);if(void 0===m){var y=getUndefinedStateErrorMessage(h,e);throw new Error(y)}c[h]=m,a=a||m!==d}return a?c:t}}var r=n(442),i=n(437),o=n(444);e.a=combineReducers}},[1112]);
//# sourceMappingURL=app.6116d6db9cd5c2065691.js.map